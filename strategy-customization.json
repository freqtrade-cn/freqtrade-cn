{"version":2,"kind":"Article","sha256":"e92e2991f15bebc7659c093b20696ed23c7f327efb252c908cd92b851b7c6138","slug":"strategy-customization","location":"/strategy-customization.md","dependencies":[],"frontmatter":{"title":"策略自定义指南","description":"本文档介绍如何在 Freqtrade 中自定义交易策略,包括添加新指标、设置交易规则等内容。","short_title":"策略自定义","subtitle":"如何开发自己的交易策略","tags":["策略开发","自定义","指标","交易规则","编程"],"subject":"Freqtrade 策略开发","authors":[{"id":"Freqtrade","name":"Freqtrade"}],"github":"https://github.com/freqtrade-cn/docs_zh-CN","keywords":["Freqtrade","中文文档","交易机器人","量化交易","加密货币","数字货币","区块链","人工智能","机器学习"],"edit_url":"https://github.com/freqtrade-cn/docs_zh-CN/blob/main/strategy-customization.md","exports":[{"format":"md","filename":"strategy-customization.md","url":"/build/strategy-customizati-2f2ab3a165753cdf5bc0cb6654dd7378.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"策略自定义","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"dbdyneIzaT"}],"identifier":"id","label":"策略自定义","html_id":"id","implicit":true,"key":"KXgOHp0eEY"},{"type":"paragraph","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"本页将介绍如何自定义你的策略、添加新指标以及设置交易规则。","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"b6J4Vhk2XU"}],"key":"ZGMrmwalpi"},{"type":"paragraph","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"如果你还没有了解过，建议先阅读：","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"wLm7Vp4aAL"}],"key":"bIR71D2Ksi"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":24,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"link","url":"/strategy-101","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"Freqtrade 策略 101","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"iphkCMJzGZ"}],"urlSource":"strategy-101.md","dataUrl":"/strategy-101.json","internal":true,"protocol":"file","key":"w1Qmq86MDB"},{"type":"text","value":"，快速入门策略开发","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"T6IOVVBx7n"}],"key":"K4Zmr7uZw2"},{"type":"listItem","spread":true,"position":{"start":{"line":25,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"link","url":"/bot-basics","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"Freqtrade 机器人基础","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"FspPtqXBNF"}],"urlSource":"bot-basics.md","dataUrl":"/bot-basics.json","internal":true,"protocol":"file","key":"bOs83po1QR"},{"type":"text","value":"，了解机器人整体运行机制","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"Fp0JZbgRuz"}],"key":"GQcjZuFnIM"}],"key":"MJanfzyHki"},{"type":"heading","depth":3,"position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"开发你自己的策略","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"KkD6E2p3e2"}],"identifier":"id","label":"开发你自己的策略","html_id":"id-1","implicit":true,"key":"SKqloSQCpQ"},{"type":"paragraph","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"text","value":"机器人自带了一个默认策略文件。","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"Nv7q75zEoz"}],"key":"yO3d5tcdF7"},{"type":"paragraph","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"text","value":"此外，","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"Ow2qoxB52J"},{"type":"link","url":"https://github.com/freqtrade/freqtrade-strategies","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"text","value":"策略仓库","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"SDmaUqHXKd"}],"urlSource":"https://github.com/freqtrade/freqtrade-strategies","error":true,"key":"oYsO2RDsDp"},{"type":"text","value":"中还提供了其他策略。","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"mLINQSJJhv"}],"key":"mMLK7c2tJk"},{"type":"paragraph","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"text","value":"不过你很可能有自己的策略想法。","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"AOHB58jfP0"}],"key":"ltOBD5UZLt"},{"type":"paragraph","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"text","value":"本文档旨在帮助你将想法转化为可运行的策略。","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"bKCP1PLzou"}],"key":"FUibYFNNKO"},{"type":"heading","depth":4,"position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"text","value":"生成策略模板","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"H9dJ0t64CO"}],"identifier":"id","label":"生成策略模板","html_id":"id-2","implicit":true,"key":"vOEqWqq5by"},{"type":"paragraph","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"text","value":"你可以通过以下命令快速开始：","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"YC32ddXKRk"}],"key":"p9na7uzWSA"},{"type":"code","lang":"bash","value":"freqtrade new-strategy --strategy AwesomeStrategy","position":{"start":{"line":41,"column":1},"end":{"line":43,"column":1}},"key":"DeslKxNgbh"},{"type":"paragraph","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"children":[{"type":"text","value":"这会基于模板创建一个名为 ","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"key":"L1UWCy9f2n"},{"type":"inlineCode","value":"AwesomeStrategy","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"key":"si3Ml7qoVS"},{"type":"text","value":" 的新策略，文件路径为 ","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"key":"RjVqnK4vD2"},{"type":"inlineCode","value":"user_data/strategies/AwesomeStrategy.py","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"key":"barkT335VP"},{"type":"text","value":"。","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"key":"m6AvB7gXnm"}],"key":"WmGtGbfdCn"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"klvFfNRN8i"}],"key":"eVDb8xvHA9"},{"type":"paragraph","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"children":[{"type":"text","value":"策略的","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"mmP1YqKQwr"},{"type":"emphasis","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"children":[{"type":"text","value":"名称","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"na3LTLdi0F"}],"key":"BaS84oiZow"},{"type":"text","value":"和文件名是有区别的。大多数命令中，Freqtrade 使用的是","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"G7xztoHkBb"},{"type":"emphasis","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"children":[{"type":"text","value":"策略类名","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"nS0LykCJOe"}],"key":"NQGxLUwPbi"},{"type":"text","value":"，而不是文件名。","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"XJUw9ALyde"}],"key":"Xzl5As4HMg"},{"type":"paragraph","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"children":[{"type":"inlineCode","value":"new-strategy","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"key":"F8E5vxrbPm"},{"type":"text","value":" 命令生成的示例策略并不会直接盈利。","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"key":"ZZepKDowuj"}],"key":"qBkfJobCTQ"}],"key":"yUhXwOcg06"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"不同模板级别","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"AuYMwu2BZj"}],"key":"QgpomRYSZw"},{"type":"paragraph","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"children":[{"type":"inlineCode","value":"freqtrade new-strategy","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"qQwcV4o8aU"},{"type":"text","value":" 有一个额外参数 ","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"acy1ebimqE"},{"type":"inlineCode","value":"--template","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"F0PAJsg6M2"},{"type":"text","value":"，可控制生成策略的复杂程度。用 ","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"UbJyQliEsx"},{"type":"inlineCode","value":"--template minimal","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"oJ2XA8QzSC"},{"type":"text","value":" 可获得一个空白策略，无任何指标示例；用 ","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"fNtr32B2at"},{"type":"inlineCode","value":"--template advanced","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"C2r7cLy73U"},{"type":"text","value":" 可获得包含更多复杂特性的模板。","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"foJpUwPKs5"}],"key":"KyiuiKK6h9"}],"key":"covsOrzfhi"},{"type":"heading","depth":4,"position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"children":[{"type":"text","value":"策略结构剖析","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"rfiPGl4usf"}],"identifier":"id","label":"策略结构剖析","html_id":"id-3","implicit":true,"key":"oguHLZjZ1g"},{"type":"paragraph","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"children":[{"type":"text","value":"一个策略文件包含构建策略逻辑所需的全部信息：","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"key":"n6OMgcgx03"}],"key":"x3rORXZOb2"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":61,"column":1},"end":{"line":75,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"children":[{"type":"text","value":"K线数据（OHLCV 格式）","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"IWobiWuSH8"}],"key":"hNTHyJlStq"},{"type":"listItem","spread":true,"position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"children":[{"type":"text","value":"各类指标","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"sUBHFGGZGW"}],"key":"e0aE9C1ApH"},{"type":"listItem","spread":true,"position":{"start":{"line":63,"column":1},"end":{"line":64,"column":1}},"children":[{"type":"text","value":"入场逻辑","position":{"start":{"line":63,"column":1},"end":{"line":63,"column":1}},"key":"evjLkvQTuX"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"children":[{"type":"text","value":"信号","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"key":"moGisIlINx"}],"key":"A514OP63pm"}],"key":"dHHMHJAdhC"}],"key":"zTnMpBTk3u"},{"type":"listItem","spread":true,"position":{"start":{"line":65,"column":1},"end":{"line":68,"column":1}},"children":[{"type":"text","value":"出场逻辑","position":{"start":{"line":65,"column":1},"end":{"line":65,"column":1}},"key":"S4oL6IABSL"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":66,"column":1},"end":{"line":68,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"children":[{"type":"text","value":"信号","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"key":"UAGTa5ZWZ2"}],"key":"sFPb8tiUAJ"},{"type":"listItem","spread":true,"position":{"start":{"line":67,"column":1},"end":{"line":67,"column":1}},"children":[{"type":"text","value":"最小收益率（ROI）","position":{"start":{"line":67,"column":1},"end":{"line":67,"column":1}},"key":"BvtbYeZyJw"}],"key":"lhwA2GmvGg"},{"type":"listItem","spread":true,"position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"children":[{"type":"text","value":"回调函数（自定义函数）","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"Gt7vtcpdmB"}],"key":"xm91tqdTTI"}],"key":"XCfzfj81XV"}],"key":"wWn5Q1Lwtw"},{"type":"listItem","spread":true,"position":{"start":{"line":69,"column":1},"end":{"line":72,"column":1}},"children":[{"type":"text","value":"止损","position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"key":"qIDcqaUnXX"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":70,"column":1},"end":{"line":72,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"children":[{"type":"text","value":"固定/绝对止损","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"riYflzzAYq"}],"key":"ObREXN8P2w"},{"type":"listItem","spread":true,"position":{"start":{"line":71,"column":1},"end":{"line":71,"column":1}},"children":[{"type":"text","value":"跟踪止损","position":{"start":{"line":71,"column":1},"end":{"line":71,"column":1}},"key":"zYxmkS7UTn"}],"key":"GMbHQQC35h"},{"type":"listItem","spread":true,"position":{"start":{"line":72,"column":1},"end":{"line":72,"column":1}},"children":[{"type":"text","value":"回调函数（自定义函数）","position":{"start":{"line":72,"column":1},"end":{"line":72,"column":1}},"key":"Jb82WJ3Nrx"}],"key":"H1WJVkmagc"}],"key":"plCEH4NCWc"}],"key":"or2aQzjB55"},{"type":"listItem","spread":true,"position":{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},"children":[{"type":"text","value":"定价（可选）","position":{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},"key":"TcQvvjeX6N"}],"key":"yb5agWq3AE"},{"type":"listItem","spread":true,"position":{"start":{"line":74,"column":1},"end":{"line":75,"column":1}},"children":[{"type":"text","value":"持仓调整（可选）","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"key":"jyONLOR6yn"}],"key":"UGh4YxDLMv"}],"key":"sGnHQlcPZd"},{"type":"paragraph","position":{"start":{"line":76,"column":1},"end":{"line":77,"column":1}},"children":[{"type":"text","value":"机器人自带一个名为 ","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"RNKEhP6iyM"},{"type":"inlineCode","value":"SampleStrategy","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"OQhrWG0mIg"},{"type":"text","value":" 的示例策略，可作为参考：","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"dpvd3SqCbE"},{"type":"inlineCode","value":"user_data/strategies/sample_strategy.py","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"iNckhTQWde"},{"type":"text","value":"。\n你可以用参数 ","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"u4zq3lGN4o"},{"type":"inlineCode","value":"--strategy SampleStrategy","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"SP2R6eMDSB"},{"type":"text","value":" 进行测试。注意这里用的是策略类名，而不是文件名。","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"WYWlTnv3jo"}],"key":"bETra2VZPL"},{"type":"paragraph","position":{"start":{"line":79,"column":1},"end":{"line":79,"column":1}},"children":[{"type":"text","value":"此外，还有一个名为 ","position":{"start":{"line":79,"column":1},"end":{"line":79,"column":1}},"key":"sy3jHUDA7h"},{"type":"inlineCode","value":"INTERFACE_VERSION","position":{"start":{"line":79,"column":1},"end":{"line":79,"column":1}},"key":"bvUL9UNxqr"},{"type":"text","value":" 的属性，用于定义策略接口的版本。当前版本为 3，如果未在策略中显式设置，则默认为 3。","position":{"start":{"line":79,"column":1},"end":{"line":79,"column":1}},"key":"zKunFmF86r"}],"key":"sLHJCBuLRG"},{"type":"paragraph","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"children":[{"type":"text","value":"你可能会看到旧策略设置为接口版本 2，未来版本会要求升级到 v3。","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"tCxEoX87wH"}],"key":"ZmkAj3o4Oc"},{"type":"paragraph","position":{"start":{"line":83,"column":1},"end":{"line":83,"column":1}},"children":[{"type":"text","value":"用 ","position":{"start":{"line":83,"column":1},"end":{"line":83,"column":1}},"key":"O7MbvtRlX8"},{"type":"inlineCode","value":"trade","position":{"start":{"line":83,"column":1},"end":{"line":83,"column":1}},"key":"LTIr0KTWq3"},{"type":"text","value":" 命令即可启动机器人进入 dry 或 live 模式：","position":{"start":{"line":83,"column":1},"end":{"line":83,"column":1}},"key":"AotWTGFC8d"}],"key":"SG7W540OCb"},{"type":"code","lang":"bash","value":"freqtrade trade --strategy AwesomeStrategy","position":{"start":{"line":85,"column":1},"end":{"line":87,"column":1}},"key":"ftnFXAderQ"},{"type":"heading","depth":4,"position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"children":[{"type":"text","value":"机器人运行模式","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"key":"tyxlR6btFr"}],"identifier":"id","label":"机器人运行模式","html_id":"id-4","implicit":true,"key":"JnciV2A2Hi"},{"type":"paragraph","position":{"start":{"line":91,"column":1},"end":{"line":91,"column":1}},"children":[{"type":"text","value":"Freqtrade 策略可在 5 种主要模式下被机器人处理：","position":{"start":{"line":91,"column":1},"end":{"line":91,"column":1}},"key":"cZFOvEgzuH"}],"key":"HPvdr6NkvT"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":93,"column":1},"end":{"line":98,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"children":[{"type":"text","value":"回测（backtesting）","position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"key":"q4nYt7qko5"}],"key":"lJfDsQxW0L"},{"type":"listItem","spread":true,"position":{"start":{"line":94,"column":1},"end":{"line":94,"column":1}},"children":[{"type":"text","value":"超参优化（hyperopting）","position":{"start":{"line":94,"column":1},"end":{"line":94,"column":1}},"key":"FGLS7b3m6m"}],"key":"BzA5cEr8V2"},{"type":"listItem","spread":true,"position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"children":[{"type":"text","value":"模拟盘（dry/forward testing）","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"aBwHyqwl7R"}],"key":"PFXWSrNbNl"},{"type":"listItem","spread":true,"position":{"start":{"line":96,"column":1},"end":{"line":96,"column":1}},"children":[{"type":"text","value":"实盘（live）","position":{"start":{"line":96,"column":1},"end":{"line":96,"column":1}},"key":"DQs1I5zLCV"}],"key":"BMWxPPaFxH"},{"type":"listItem","spread":true,"position":{"start":{"line":97,"column":1},"end":{"line":98,"column":1}},"children":[{"type":"text","value":"FreqAI（本页不涉及）","position":{"start":{"line":97,"column":1},"end":{"line":97,"column":1}},"key":"hHStwHbmIu"}],"key":"j7zRG9BX5Y"}],"key":"dvIPwgTUuc"},{"type":"paragraph","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"children":[{"type":"text","value":"关于如何设置 dry 或 live 模式，请查阅","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"o0N44TlyOX"},{"type":"link","url":"/configuration","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"children":[{"type":"text","value":"配置文档","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"UtxfiggAYP"}],"urlSource":"configuration.md","dataUrl":"/configuration.json","internal":true,"protocol":"file","key":"trvieandoE"},{"type":"text","value":"。","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"q1i05vaFcM"}],"key":"kJQ4IZlMqv"},{"type":"paragraph","position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"children":[{"type":"strong","position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"children":[{"type":"text","value":"测试时请始终使用 dry 模式，这样可以在不冒资金风险的情况下了解策略实际表现。","position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"key":"uZLzLXOgOo"}],"key":"kw0PEIRcjm"}],"key":"UfbbK3Oblk"},{"type":"heading","depth":3,"position":{"start":{"line":103,"column":1},"end":{"line":103,"column":1}},"children":[{"type":"text","value":"深入剖析","position":{"start":{"line":103,"column":1},"end":{"line":103,"column":1}},"key":"K87miBm2wC"}],"identifier":"id","label":"深入剖析","html_id":"id-5","implicit":true,"key":"Mf0lUAkYzg"},{"type":"paragraph","position":{"start":{"line":105,"column":1},"end":{"line":105,"column":1}},"children":[{"type":"strong","position":{"start":{"line":105,"column":1},"end":{"line":105,"column":1}},"children":[{"type":"text","value":"以下内容将以 ","position":{"start":{"line":105,"column":1},"end":{"line":105,"column":1}},"key":"xmW5LgQVsI"},{"type":"link","url":"https://github.com/freqtrade/freqtrade/blob/develop/freqtrade/templates/sample_strategy.py","position":{"start":{"line":105,"column":1},"end":{"line":105,"column":1}},"children":[{"type":"text","value":"user​_data​/strategies​/sample​_strategy​.py","position":{"start":{"line":105,"column":1},"end":{"line":105,"column":1}},"key":"DZlWbuDgAw"}],"urlSource":"https://github.com/freqtrade/freqtrade/blob/develop/freqtrade/templates/sample_strategy.py","data":{"kind":"file","org":"freqtrade","repo":"freqtrade","reference":"develop","file":"freqtrade/templates/sample_strategy.py","raw":"https://raw.githubusercontent.com/freqtrade/freqtrade/develop/freqtrade/templates/sample_strategy.py"},"internal":false,"protocol":"github","key":"VI82l3vdE7"},{"type":"text","value":" 为参考。","position":{"start":{"line":105,"column":1},"end":{"line":105,"column":1}},"key":"jZt5SS54xI"}],"key":"oaSv7H9QxV"}],"key":"zQA761lp2U"},{"type":"admonition","kind":"caution","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"策略与回测","position":{"start":{"line":107,"column":1},"end":{"line":107,"column":1}},"key":"oA2feqoOB9"}],"key":"VGyON6de2F"},{"type":"paragraph","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"children":[{"type":"text","value":"为避免回测与 dry/live 模式下出现问题和意外差异，请注意回测时 ","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"key":"zDBPxHVKOq"},{"type":"inlineCode","value":"populate_*()","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"key":"SI0EMaRJlc"},{"type":"text","value":" 方法会一次性传入完整时间区间。","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"key":"bL195tgfAV"}],"key":"Fixzr9gSPH"},{"type":"paragraph","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"children":[{"type":"text","value":"因此建议使用向量化操作（针对整个 dataframe，而非循环），避免用 ","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"PtY8YBSlw1"},{"type":"inlineCode","value":"df.iloc[-1]","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"ITFpnQmEZj"},{"type":"text","value":"，而应用 ","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"mPsfEfWFMA"},{"type":"inlineCode","value":"df.shift()","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"WF5fVGi8Cn"},{"type":"text","value":" 获取前一根K线。","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"cXf4r429k7"}],"key":"iOxATLHSGv"}],"key":"k9AFRaDD8q"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"警惕未来数据","position":{"start":{"line":113,"column":1},"end":{"line":113,"column":1}},"key":"O86MUBLLiC"}],"key":"kCL6R3c3WT"},{"type":"paragraph","position":{"start":{"line":114,"column":1},"end":{"line":114,"column":1}},"children":[{"type":"text","value":"回测时 ","position":{"start":{"line":114,"column":1},"end":{"line":114,"column":1}},"key":"kLnTAyF6dD"},{"type":"inlineCode","value":"populate_*()","position":{"start":{"line":114,"column":1},"end":{"line":114,"column":1}},"key":"m9GQANHFy0"},{"type":"text","value":" 方法会传入完整时间区间，策略作者需确保不使用未来数据。","position":{"start":{"line":114,"column":1},"end":{"line":114,"column":1}},"key":"zA9No0a4uz"}],"key":"XvYFkV1XhU"},{"type":"paragraph","position":{"start":{"line":116,"column":1},"end":{"line":116,"column":1}},"children":[{"type":"text","value":"常见错误模式见文档后面的","position":{"start":{"line":116,"column":1},"end":{"line":116,"column":1}},"key":"ZPwQwmqVTl"},{"type":"link","url":"#%E5%BC%80%E5%8F%91%E7%AD%96%E7%95%A5%E6%97%B6%E7%9A%84%E5%B8%B8%E8%A7%81%E9%94%99%E8%AF%AF","position":{"start":{"line":116,"column":1},"end":{"line":116,"column":1}},"children":[{"type":"text","value":"常见错误","position":{"start":{"line":116,"column":1},"end":{"line":116,"column":1}},"key":"zwLzn70eDW"}],"urlSource":"#%E5%BC%80%E5%8F%91%E7%AD%96%E7%95%A5%E6%97%B6%E7%9A%84%E5%B8%B8%E8%A7%81%E9%94%99%E8%AF%AF","key":"umvVSPTkku"},{"type":"text","value":"章节。","position":{"start":{"line":116,"column":1},"end":{"line":116,"column":1}},"key":"aN3zFPdtuI"}],"key":"PSCNCAxoCe"}],"key":"oow76UvpSi"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"前视与递归分析","position":{"start":{"line":119,"column":1},"end":{"line":119,"column":1}},"key":"DA6UtYpsYQ"}],"key":"OuXWTYWhgZ"},{"type":"paragraph","position":{"start":{"line":120,"column":1},"end":{"line":120,"column":1}},"children":[{"type":"text","value":"Freqtrade 提供了两条命令帮助检测常见的前视（未来数据）和递归偏差（指标值方差）问题。在 dry/live 前，建议先用 ","position":{"start":{"line":120,"column":1},"end":{"line":120,"column":1}},"key":"BGZCh4HByE"},{"type":"link","url":"/lookahead-analysis","position":{"start":{"line":120,"column":1},"end":{"line":120,"column":1}},"children":[{"type":"text","value":"lookahead","position":{"start":{"line":120,"column":1},"end":{"line":120,"column":1}},"key":"mzuBE9To6l"}],"urlSource":"lookahead-analysis.md","dataUrl":"/lookahead-analysis.json","internal":true,"protocol":"file","key":"nIdcRUxoLi"},{"type":"text","value":" 和 ","position":{"start":{"line":120,"column":1},"end":{"line":120,"column":1}},"key":"DY4oy9Cq6W"},{"type":"link","url":"/recursive-analysis","position":{"start":{"line":120,"column":1},"end":{"line":120,"column":1}},"children":[{"type":"text","value":"recursive","position":{"start":{"line":120,"column":1},"end":{"line":120,"column":1}},"key":"c6CbDp2fLC"}],"urlSource":"recursive-analysis.md","dataUrl":"/recursive-analysis.json","internal":true,"protocol":"file","key":"aINc5rDhhl"},{"type":"text","value":" 工具分析。","position":{"start":{"line":120,"column":1},"end":{"line":120,"column":1}},"key":"TlSWOtNzsa"}],"key":"Y7rk9Vm6ax"}],"key":"ZnyNx0XvGL"},{"type":"heading","depth":4,"position":{"start":{"line":123,"column":1},"end":{"line":123,"column":1}},"children":[{"type":"text","value":"DataFrame","position":{"start":{"line":123,"column":1},"end":{"line":123,"column":1}},"key":"LwrCfcmvj2"}],"identifier":"dataframe","label":"DataFrame","html_id":"dataframe","implicit":true,"key":"Y0y8n6n5SJ"},{"type":"paragraph","position":{"start":{"line":125,"column":1},"end":{"line":126,"column":1}},"children":[{"type":"text","value":"Freqtrade 使用 ","position":{"start":{"line":125,"column":1},"end":{"line":125,"column":1}},"key":"Tr9sGqHt2o"},{"type":"link","url":"https://pandas.pydata.org/","position":{"start":{"line":125,"column":1},"end":{"line":125,"column":1}},"children":[{"type":"text","value":"pandas","position":{"start":{"line":125,"column":1},"end":{"line":125,"column":1}},"key":"EJQtpQ2aL8"}],"urlSource":"https://pandas.pydata.org/","key":"vFOYDq5EnY"},{"type":"text","value":" 存储/提供 K 线（OHLCV）数据。\nPandas 是处理表格数据的强大库。","position":{"start":{"line":125,"column":1},"end":{"line":125,"column":1}},"key":"Rb9S7iwlPO"}],"key":"NlALFXFQq2"},{"type":"paragraph","position":{"start":{"line":128,"column":1},"end":{"line":128,"column":1}},"children":[{"type":"text","value":"DataFrame 的每一行对应一根K线，最新的完整K线总是排在最后（按日期排序）。","position":{"start":{"line":128,"column":1},"end":{"line":128,"column":1}},"key":"JMDckkUDln"}],"key":"zsfFrjxKct"},{"type":"paragraph","position":{"start":{"line":130,"column":1},"end":{"line":130,"column":1}},"children":[{"type":"text","value":"用 pandas 的 ","position":{"start":{"line":130,"column":1},"end":{"line":130,"column":1}},"key":"srPRxhmnvR"},{"type":"inlineCode","value":"head()","position":{"start":{"line":130,"column":1},"end":{"line":130,"column":1}},"key":"S5C68TL5vC"},{"type":"text","value":" 查看前几行：","position":{"start":{"line":130,"column":1},"end":{"line":130,"column":1}},"key":"ZZaZv3qt7t"}],"key":"AjjV1KhDBC"},{"type":"code","lang":"output","value":"> dataframe.head()\n                       date      open      high       low     close     volume\n0 2021-11-09 23:25:00+00:00  67279.67  67321.84  67255.01  67300.97   44.62253\n1 2021-11-09 23:30:00+00:00  67300.97  67301.34  67183.03  67187.01   61.38076\n2 2021-11-09 23:35:00+00:00  67187.02  67187.02  67031.93  67123.81  113.42728\n3 2021-11-09 23:40:00+00:00  67123.80  67222.40  67080.33  67160.48   78.96008\n4 2021-11-09 23:45:00+00:00  67160.48  67160.48  66901.26  66943.37  111.39292","position":{"start":{"line":132,"column":1},"end":{"line":140,"column":1}},"key":"TKa32JqbcF"},{"type":"paragraph","position":{"start":{"line":142,"column":1},"end":{"line":142,"column":1}},"children":[{"type":"text","value":"DataFrame 是一个表格，列不是单一值，而是一组数据。因此，像下面这样直接用 Python 比较会报错：","position":{"start":{"line":142,"column":1},"end":{"line":142,"column":1}},"key":"yIBYqlSrbr"}],"key":"Hwix7em5cN"},{"type":"code","lang":"python","value":"    if dataframe['rsi'] > 30:\n        dataframe['enter_long'] = 1","position":{"start":{"line":144,"column":1},"end":{"line":147,"column":1}},"key":"AMBJZqdEFY"},{"type":"paragraph","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"children":[{"type":"text","value":"上述写法会报错：","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"key":"n3MpUGRnsP"},{"type":"inlineCode","value":"The truth value of a Series is ambiguous [...]","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"key":"evqRyOVg99"},{"type":"text","value":"。","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"key":"aKnh16P0fT"}],"key":"JTAXQ51jE9"},{"type":"paragraph","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"children":[{"type":"text","value":"应改为 pandas 向量化写法，对整个 dataframe 执行操作：","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"key":"IT2T0PRuar"}],"key":"cgu0cioncA"},{"type":"code","lang":"python","value":"    dataframe.loc[\n        (dataframe['rsi'] > 30)\n    , 'enter_long'] = 1","position":{"start":{"line":153,"column":1},"end":{"line":157,"column":1}},"key":"QQtRFiIdis"},{"type":"paragraph","position":{"start":{"line":159,"column":1},"end":{"line":159,"column":1}},"children":[{"type":"text","value":"这样会在 RSI 大于 30 时，为新列 ","position":{"start":{"line":159,"column":1},"end":{"line":159,"column":1}},"key":"Mn3V4BgTKT"},{"type":"inlineCode","value":"enter_long","position":{"start":{"line":159,"column":1},"end":{"line":159,"column":1}},"key":"xjyFqZkWAv"},{"type":"text","value":" 赋值 1。","position":{"start":{"line":159,"column":1},"end":{"line":159,"column":1}},"key":"BBGjwCAWRa"}],"key":"vh9RB3UfW8"},{"type":"paragraph","position":{"start":{"line":161,"column":1},"end":{"line":161,"column":1}},"children":[{"type":"text","value":"Freqtrade 会用这个新列作为入场信号，假定下一根K线开盘时开仓。","position":{"start":{"line":161,"column":1},"end":{"line":161,"column":1}},"key":"XVyaWOd6LS"}],"key":"yUtJHrBJdq"},{"type":"paragraph","position":{"start":{"line":163,"column":1},"end":{"line":163,"column":1}},"children":[{"type":"text","value":"Pandas 支持高效的向量化计算，建议尽量避免循环，直接用向量化方法。","position":{"start":{"line":163,"column":1},"end":{"line":163,"column":1}},"key":"oQtDIVK3YS"}],"key":"Mio4rxlb5s"},{"type":"paragraph","position":{"start":{"line":165,"column":1},"end":{"line":165,"column":1}},"children":[{"type":"text","value":"向量化操作会对整列数据进行计算，比逐行循环快得多。","position":{"start":{"line":165,"column":1},"end":{"line":165,"column":1}},"key":"QdAMZMJMyK"}],"key":"U9ACWBDmpp"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"信号 vs 交易","position":{"start":{"line":167,"column":1},"end":{"line":167,"column":1}},"key":"Nwfqgnn5SD"}],"key":"M1HCvFCLjn"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":169,"column":1},"end":{"line":170,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":169,"column":1},"end":{"line":169,"column":1}},"children":[{"type":"text","value":"信号由指标在K线收盘时生成，表示有意愿开仓。","position":{"start":{"line":169,"column":1},"end":{"line":169,"column":1}},"key":"Zr7CVAcZIM"}],"key":"GjWs9rgJ5S"},{"type":"listItem","spread":true,"position":{"start":{"line":170,"column":1},"end":{"line":170,"column":1}},"children":[{"type":"text","value":"交易是在实际下单（实盘时在交易所），会尽量在下一根K线开盘时成交。","position":{"start":{"line":170,"column":1},"end":{"line":170,"column":1}},"key":"HPxRIOuNGS"}],"key":"oSVGMRCUQh"}],"key":"ijzF2s8TpI"}],"key":"x2s7J2s37U"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"交易下单假设","position":{"start":{"line":174,"column":1},"end":{"line":174,"column":1}},"key":"Y4HecP4F3A"}],"key":"vzderyrocR"},{"type":"paragraph","position":{"start":{"line":176,"column":1},"end":{"line":176,"column":1}},"children":[{"type":"text","value":"回测时，信号在K线收盘时生成，交易在下一根K线开盘时执行。","position":{"start":{"line":176,"column":1},"end":{"line":176,"column":1}},"key":"DHtIgoIE7m"}],"key":"qSpUrpOZ2V"},{"type":"paragraph","position":{"start":{"line":178,"column":1},"end":{"line":178,"column":1}},"children":[{"type":"text","value":"dry/live 模式下，因需先分析所有交易对 dataframe，再处理下单，可能有延迟。建议减少交易对数量，并用高主频 CPU。","position":{"start":{"line":178,"column":1},"end":{"line":178,"column":1}},"key":"Cg2HnwlhZE"}],"key":"V63XZCmqVi"}],"key":"XeEJMiTiGK"},{"type":"heading","depth":5,"position":{"start":{"line":182,"column":1},"end":{"line":182,"column":1}},"children":[{"type":"text","value":"为什么看不到\"实时\"K线数据？","position":{"start":{"line":182,"column":1},"end":{"line":182,"column":1}},"key":"ppWuqieUcb"}],"identifier":"id-k","label":"为什么看不到\"实时\"K线数据？","html_id":"id-k","implicit":true,"key":"YYJtUB99IL"},{"type":"paragraph","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"children":[{"type":"text","value":"Freqtrade 不会在 dataframe 中存储未完成/未收盘的K线。","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"key":"OZJuN5QqAf"}],"key":"EXLlu8m1jj"},{"type":"paragraph","position":{"start":{"line":186,"column":1},"end":{"line":186,"column":1}},"children":[{"type":"text","value":"用未完成数据做决策叫\"重绘\"，有些平台允许，但 Freqtrade 不支持。只有完整K线数据可用。","position":{"start":{"line":186,"column":1},"end":{"line":186,"column":1}},"key":"ffucMPh8M3"}],"key":"PhocTwtBTC"},{"type":"heading","depth":4,"position":{"start":{"line":188,"column":1},"end":{"line":188,"column":1}},"children":[{"type":"text","value":"自定义指标","position":{"start":{"line":188,"column":1},"end":{"line":188,"column":1}},"key":"attAyPSyYQ"}],"identifier":"id","label":"自定义指标","html_id":"id-6","implicit":true,"key":"BX8QF2QHjr"},{"type":"paragraph","position":{"start":{"line":190,"column":1},"end":{"line":190,"column":1}},"children":[{"type":"text","value":"入场和出场信号需要用到指标。你可以在策略文件的 ","position":{"start":{"line":190,"column":1},"end":{"line":190,"column":1}},"key":"zIaIxu1QFK"},{"type":"inlineCode","value":"populate_indicators()","position":{"start":{"line":190,"column":1},"end":{"line":190,"column":1}},"key":"SEudzS6tIl"},{"type":"text","value":" 方法中添加更多指标。","position":{"start":{"line":190,"column":1},"end":{"line":190,"column":1}},"key":"dsFi9OKy3H"}],"key":"IT2QHePNHy"},{"type":"paragraph","position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"children":[{"type":"text","value":"只应添加在 ","position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"key":"GLNfnFP2js"},{"type":"inlineCode","value":"populate_entry_trend()","position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"key":"qFVXn2xgZn"},{"type":"text","value":"、","position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"key":"McObZXCiBs"},{"type":"inlineCode","value":"populate_exit_trend()","position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"key":"tIEmVQn1oF"},{"type":"text","value":" 或用于生成其他指标的指标，否则会影响性能。","position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"key":"a5xsb42NxD"}],"key":"kPeaWoHdF5"},{"type":"paragraph","position":{"start":{"line":194,"column":1},"end":{"line":194,"column":1}},"children":[{"type":"text","value":"务必返回 dataframe，且不要删除/修改 “open”, “high”, “low”, “close”, “volume” 这几列，否则会导致异常。","position":{"start":{"line":194,"column":1},"end":{"line":194,"column":1}},"key":"qVsG3PoTnQ"}],"key":"tFF2pebz4f"},{"type":"paragraph","position":{"start":{"line":196,"column":1},"end":{"line":196,"column":1}},"children":[{"type":"text","value":"示例：","position":{"start":{"line":196,"column":1},"end":{"line":196,"column":1}},"key":"LyjuozyTil"}],"key":"lb5MgmajqZ"},{"type":"code","lang":"python","value":"def populate_indicators(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n    \"\"\"\n    为给定 DataFrame 添加多种技术指标\n\n    性能提示：为获得最佳性能，请只用你策略或超参优化用到的指标，否则会浪费内存和 CPU。\n    :param dataframe: 交易所数据 DataFrame\n    :param metadata: 额外信息，如当前交易对\n    :return: 包含所有策略所需指标的 DataFrame\n    \"\"\"\n    dataframe['sar'] = ta.SAR(dataframe)\n    dataframe['adx'] = ta.ADX(dataframe)\n    stoch = ta.STOCHF(dataframe)\n    dataframe['fastd'] = stoch['fastd']\n    dataframe['fastk'] = stoch['fastk']\n    dataframe['bb_lower'] = ta.BBANDS(dataframe, nbdevup=2, nbdevdn=2)['lowerband']\n    dataframe['sma'] = ta.SMA(dataframe, timeperiod=40)\n    dataframe['tema'] = ta.TEMA(dataframe, timeperiod=9)\n    dataframe['mfi'] = ta.MFI(dataframe)\n    dataframe['rsi'] = ta.RSI(dataframe)\n    dataframe['ema5'] = ta.EMA(dataframe, timeperiod=5)\n    dataframe['ema10'] = ta.EMA(dataframe, timeperiod=10)\n    dataframe['ema50'] = ta.EMA(dataframe, timeperiod=50)\n    dataframe['ema100'] = ta.EMA(dataframe, timeperiod=100)\n    dataframe['ao'] = awesome_oscillator(dataframe)\n    macd = ta.MACD(dataframe)\n    dataframe['macd'] = macd['macd']\n    dataframe['macdsignal'] = macd['macdsignal']\n    dataframe['macdhist'] = macd['macdhist']\n    hilbert = ta.HT_SINE(dataframe)\n    dataframe['htsine'] = hilbert['sine']\n    dataframe['htleadsine'] = hilbert['leadsine']\n    dataframe['plus_dm'] = ta.PLUS_DM(dataframe)\n    dataframe['plus_di'] = ta.PLUS_DI(dataframe)\n    dataframe['minus_dm'] = ta.MINUS_DM(dataframe)\n    dataframe['minus_di'] = ta.MINUS_DI(dataframe)\n\n    # 记得始终返回 dataframe\n    return dataframe","position":{"start":{"line":198,"column":1},"end":{"line":237,"column":1}},"key":"s43I17aFf0"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"想要更多指标示例？","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"Zm3Zu1nqwM"}],"key":"dcLdgObEhO"},{"type":"paragraph","position":{"start":{"line":240,"column":1},"end":{"line":240,"column":1}},"children":[{"type":"text","value":"请参考 ","position":{"start":{"line":240,"column":1},"end":{"line":240,"column":1}},"key":"iAeg583Elo"},{"type":"link","url":"https://github.com/freqtrade/freqtrade/blob/develop/freqtrade/templates/sample_strategy.py","position":{"start":{"line":240,"column":1},"end":{"line":240,"column":1}},"children":[{"type":"text","value":"user​_data​/strategies​/sample​_strategy​.py","position":{"start":{"line":240,"column":1},"end":{"line":240,"column":1}},"key":"jBS3s2y1Lp"}],"urlSource":"https://github.com/freqtrade/freqtrade/blob/develop/freqtrade/templates/sample_strategy.py","data":{"kind":"file","org":"freqtrade","repo":"freqtrade","reference":"develop","file":"freqtrade/templates/sample_strategy.py","raw":"https://raw.githubusercontent.com/freqtrade/freqtrade/develop/freqtrade/templates/sample_strategy.py"},"internal":false,"protocol":"github","key":"vTzim5Dkfk"},{"type":"text","value":"，取消注释你需要的指标。","position":{"start":{"line":240,"column":1},"end":{"line":240,"column":1}},"key":"h4f13dPrmr"}],"key":"zIm03QKVxR"}],"key":"RG3hcK6LgG"},{"type":"heading","depth":5,"position":{"start":{"line":243,"column":1},"end":{"line":243,"column":1}},"children":[{"type":"text","value":"指标库","position":{"start":{"line":243,"column":1},"end":{"line":243,"column":1}},"key":"iQClRWMg2l"}],"identifier":"id","label":"指标库","html_id":"id-7","implicit":true,"key":"x6BCPJMVas"},{"type":"paragraph","position":{"start":{"line":245,"column":1},"end":{"line":245,"column":1}},"children":[{"type":"text","value":"Freqtrade 默认安装了以下技术指标库：","position":{"start":{"line":245,"column":1},"end":{"line":245,"column":1}},"key":"VekAus9ApF"}],"key":"lt3Ks1QTb5"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":247,"column":1},"end":{"line":250,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":247,"column":1},"end":{"line":247,"column":1}},"children":[{"type":"link","url":"https://ta-lib.github.io/ta-lib-python/","position":{"start":{"line":247,"column":1},"end":{"line":247,"column":1}},"children":[{"type":"text","value":"ta-lib","position":{"start":{"line":247,"column":1},"end":{"line":247,"column":1}},"key":"YjT59RgzIn"}],"urlSource":"https://ta-lib.github.io/ta-lib-python/","key":"qvN73NuQXy"}],"key":"zekLh0Y3c3"},{"type":"listItem","spread":true,"position":{"start":{"line":248,"column":1},"end":{"line":248,"column":1}},"children":[{"type":"link","url":"https://twopirllc.github.io/pandas-ta/","position":{"start":{"line":248,"column":1},"end":{"line":248,"column":1}},"children":[{"type":"text","value":"pandas-ta","position":{"start":{"line":248,"column":1},"end":{"line":248,"column":1}},"key":"AqjGjvzduG"}],"urlSource":"https://twopirllc.github.io/pandas-ta/","key":"GAEGEPaErI"}],"key":"g98gNqmcE6"},{"type":"listItem","spread":true,"position":{"start":{"line":249,"column":1},"end":{"line":250,"column":1}},"children":[{"type":"link","url":"https://technical.freqtrade.io","position":{"start":{"line":249,"column":1},"end":{"line":249,"column":1}},"children":[{"type":"text","value":"technical","position":{"start":{"line":249,"column":1},"end":{"line":249,"column":1}},"key":"fWQbeGDcjD"}],"urlSource":"https://technical.freqtrade.io","key":"mXJiAP6Ott"}],"key":"p6IgqxEVV4"}],"key":"Nv0yqBYEzz"},{"type":"paragraph","position":{"start":{"line":251,"column":1},"end":{"line":251,"column":1}},"children":[{"type":"text","value":"如有需要可安装其他技术指标库，或自行编写自定义指标。","position":{"start":{"line":251,"column":1},"end":{"line":251,"column":1}},"key":"OSi3eAVOzB"}],"key":"EaFeNQDaJo"},{"type":"heading","depth":4,"position":{"start":{"line":253,"column":1},"end":{"line":253,"column":1}},"children":[{"type":"text","value":"策略启动期","position":{"start":{"line":253,"column":1},"end":{"line":253,"column":1}},"key":"XSt7Ibnxff"}],"identifier":"id","label":"策略启动期","html_id":"id-8","implicit":true,"key":"t8Zgs12I8i"},{"type":"paragraph","position":{"start":{"line":255,"column":1},"end":{"line":255,"column":1}},"children":[{"type":"text","value":"部分指标在启动初期因数据不足会出现 NaN 或计算不准确。Freqtrade 无法自动判断不稳定期长度，会直接用 dataframe 中的指标值。","position":{"start":{"line":255,"column":1},"end":{"line":255,"column":1}},"key":"G2mxwicNYG"}],"key":"FsjA4ABurN"},{"type":"paragraph","position":{"start":{"line":257,"column":1},"end":{"line":257,"column":1}},"children":[{"type":"text","value":"为此，策略可设置 ","position":{"start":{"line":257,"column":1},"end":{"line":257,"column":1}},"key":"mt5V1A93jw"},{"type":"inlineCode","value":"startup_candle_count","position":{"start":{"line":257,"column":1},"end":{"line":257,"column":1}},"key":"KSLv1dbw0S"},{"type":"text","value":" 属性。","position":{"start":{"line":257,"column":1},"end":{"line":257,"column":1}},"key":"S484UKX0Dc"}],"key":"HSxUTl2IqA"},{"type":"paragraph","position":{"start":{"line":259,"column":1},"end":{"line":259,"column":1}},"children":[{"type":"text","value":"该值应设为策略中所有指标所需的最大历史K线数。若用到高阶时间周期 informative pair，","position":{"start":{"line":259,"column":1},"end":{"line":259,"column":1}},"key":"diGr0BXCwQ"},{"type":"inlineCode","value":"startup_candle_count","position":{"start":{"line":259,"column":1},"end":{"line":259,"column":1}},"key":"TAAQ3pkcqn"},{"type":"text","value":" 也无需改变，只需用最大周期。","position":{"start":{"line":259,"column":1},"end":{"line":259,"column":1}},"key":"c5T4QlIgrX"}],"key":"syE1vFsAOe"},{"type":"paragraph","position":{"start":{"line":261,"column":1},"end":{"line":261,"column":1}},"children":[{"type":"text","value":"可用 ","position":{"start":{"line":261,"column":1},"end":{"line":261,"column":1}},"key":"jENC0U6n2V"},{"type":"link","url":"/recursive-analysis","position":{"start":{"line":261,"column":1},"end":{"line":261,"column":1}},"children":[{"type":"text","value":"recursive-analysis","position":{"start":{"line":261,"column":1},"end":{"line":261,"column":1}},"key":"PD9nGpP34U"}],"urlSource":"recursive-analysis.md","dataUrl":"/recursive-analysis.json","internal":true,"protocol":"file","key":"hxP5AuFptx"},{"type":"text","value":" 检查合适的 ","position":{"start":{"line":261,"column":1},"end":{"line":261,"column":1}},"key":"HaShOoKT02"},{"type":"inlineCode","value":"startup_candle_count","position":{"start":{"line":261,"column":1},"end":{"line":261,"column":1}},"key":"ShIIVQ1n99"},{"type":"text","value":"。当递归分析显示方差为 0% 时，说明历史数据已足够。","position":{"start":{"line":261,"column":1},"end":{"line":261,"column":1}},"key":"AIPabnLYdS"}],"key":"MyK7Mlpkiz"},{"type":"paragraph","position":{"start":{"line":263,"column":1},"end":{"line":263,"column":1}},"children":[{"type":"text","value":"如本例策略用到 ema100，则应设为 400（","position":{"start":{"line":263,"column":1},"end":{"line":263,"column":1}},"key":"sCMAFwSjqq"},{"type":"inlineCode","value":"startup_candle_count = 400","position":{"start":{"line":263,"column":1},"end":{"line":263,"column":1}},"key":"EvxIUPip2Q"},{"type":"text","value":"），以保证 ema100 计算准确。","position":{"start":{"line":263,"column":1},"end":{"line":263,"column":1}},"key":"zGFfDr2Wc9"}],"key":"ZVIZ9PbxTQ"},{"type":"code","lang":"python","value":"    dataframe['ema100'] = ta.EMA(dataframe, timeperiod=100)","position":{"start":{"line":265,"column":1},"end":{"line":267,"column":1}},"key":"m92US3QR39"},{"type":"paragraph","position":{"start":{"line":269,"column":1},"end":{"line":269,"column":1}},"children":[{"type":"text","value":"告知机器人所需历史长度后，回测和超参优化可从指定时间点开始。","position":{"start":{"line":269,"column":1},"end":{"line":269,"column":1}},"key":"F5P4SlVX7l"}],"key":"dTqmCB9YLk"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"多次获取 OHLCV 的警告","position":{"start":{"line":271,"column":1},"end":{"line":271,"column":1}},"key":"EwSXpCZzk0"}],"key":"eF05LuuJww"},{"type":"paragraph","position":{"start":{"line":272,"column":1},"end":{"line":272,"column":1}},"children":[{"type":"text","value":"若收到 ","position":{"start":{"line":272,"column":1},"end":{"line":272,"column":1}},"key":"lMQlvqw3xr"},{"type":"inlineCode","value":"WARNING - Using 3 calls to get OHLCV...","position":{"start":{"line":272,"column":1},"end":{"line":272,"column":1}},"key":"okXpAwwYDb"},{"type":"text","value":"，请考虑是否真的需要这么多历史数据。过多会导致多次网络请求，拖慢机器人刷新速度。","position":{"start":{"line":272,"column":1},"end":{"line":272,"column":1}},"key":"O7s8Xq5mWb"}],"key":"pHIO67Cpi9"},{"type":"paragraph","position":{"start":{"line":274,"column":1},"end":{"line":274,"column":1}},"children":[{"type":"text","value":"最多允许 5 次请求，避免过载。","position":{"start":{"line":274,"column":1},"end":{"line":274,"column":1}},"key":"MAxuNZPssg"}],"key":"ME1E7AkIMO"}],"key":"nJF9tPgFSa"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"BJh4D3yGom"}],"key":"ZDUYUHVELc"},{"type":"paragraph","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"children":[{"type":"inlineCode","value":"startup_candle_count","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"key":"a7HxMhS6Ue"},{"type":"text","value":" 应小于 ","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"key":"zTnnUpuMaG"},{"type":"inlineCode","value":"ohlcv_candle_limit * 5","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"key":"akdyTVEXwj"},{"type":"text","value":"（大多数交易所为 500 * 5），Dry-Run/Live 模式下只会有这么多K线。","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"key":"VkuCsVQwea"}],"key":"hc6PRRl1yH"}],"key":"Pxk1ZZVIHf"},{"type":"heading","depth":5,"position":{"start":{"line":281,"column":1},"end":{"line":281,"column":1}},"children":[{"type":"text","value":"示例","position":{"start":{"line":281,"column":1},"end":{"line":281,"column":1}},"key":"KVnU1Pj5oD"}],"identifier":"id","label":"示例","html_id":"id-9","implicit":true,"key":"LvTpEz9bfS"},{"type":"paragraph","position":{"start":{"line":283,"column":1},"end":{"line":283,"column":1}},"children":[{"type":"text","value":"假设用 EMA100 策略回测 2019 年 1 月的 5m K 线：","position":{"start":{"line":283,"column":1},"end":{"line":283,"column":1}},"key":"ruFXqyh9aO"}],"key":"subN01wMNF"},{"type":"code","lang":"bash","value":"freqtrade backtesting --timerange 20190101-20190201 --timeframe 5m","position":{"start":{"line":285,"column":1},"end":{"line":287,"column":1}},"key":"HrHuE85vqH"},{"type":"paragraph","position":{"start":{"line":289,"column":1},"end":{"line":289,"column":1}},"children":[{"type":"text","value":"若 ","position":{"start":{"line":289,"column":1},"end":{"line":289,"column":1}},"key":"PedPj8Cg9g"},{"type":"inlineCode","value":"startup_candle_count","position":{"start":{"line":289,"column":1},"end":{"line":289,"column":1}},"key":"ocSTkoJDwp"},{"type":"text","value":" 设为 400，回测会自动加载 400 根K线的历史数据，即从 ","position":{"start":{"line":289,"column":1},"end":{"line":289,"column":1}},"key":"X4CcuPlTno"},{"type":"inlineCode","value":"20190101 - (400 * 5m)","position":{"start":{"line":289,"column":1},"end":{"line":289,"column":1}},"key":"PhYGTW9qZ6"},{"type":"text","value":"，约等于 2018-12-30 11:40:00。","position":{"start":{"line":289,"column":1},"end":{"line":289,"column":1}},"key":"I5QHWHQ0Ac"}],"key":"mXzkx4Q2db"},{"type":"paragraph","position":{"start":{"line":291,"column":1},"end":{"line":291,"column":1}},"children":[{"type":"text","value":"若有该数据，指标会用扩展时间段计算，启动期（到 2019-01-01 00:00:00）会被剔除。","position":{"start":{"line":291,"column":1},"end":{"line":291,"column":1}},"key":"li8qR5uDmT"}],"key":"zMgpyYa7nF"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"启动期数据不可用","position":{"start":{"line":293,"column":1},"end":{"line":293,"column":1}},"key":"W2MeRggE1t"}],"key":"Y2LjFyrAdv"},{"type":"paragraph","position":{"start":{"line":294,"column":1},"end":{"line":294,"column":1}},"children":[{"type":"text","value":"若历史数据不足，回测会自动调整起始时间。例如本例会从 2019-01-02 09:20:00 开始。","position":{"start":{"line":294,"column":1},"end":{"line":294,"column":1}},"key":"JxWfdw9uPd"}],"key":"t2dbHBGAHr"}],"key":"BQVC9WgoG6"},{"type":"heading","depth":4,"position":{"start":{"line":297,"column":1},"end":{"line":297,"column":1}},"children":[{"type":"text","value":"入场信号规则","position":{"start":{"line":297,"column":1},"end":{"line":297,"column":1}},"key":"nHTewOWmKO"}],"identifier":"id","label":"入场信号规则","html_id":"id-10","implicit":true,"key":"XkUroXv39d"},{"type":"paragraph","position":{"start":{"line":299,"column":1},"end":{"line":299,"column":1}},"children":[{"type":"text","value":"编辑策略文件中的 ","position":{"start":{"line":299,"column":1},"end":{"line":299,"column":1}},"key":"zH8nt8a0vs"},{"type":"inlineCode","value":"populate_entry_trend()","position":{"start":{"line":299,"column":1},"end":{"line":299,"column":1}},"key":"i03PspxaC5"},{"type":"text","value":" 方法，更新入场逻辑。","position":{"start":{"line":299,"column":1},"end":{"line":299,"column":1}},"key":"D6N2AXUTqE"}],"key":"Kkp7po7g8Q"},{"type":"paragraph","position":{"start":{"line":301,"column":1},"end":{"line":301,"column":1}},"children":[{"type":"text","value":"务必返回 dataframe，且不要删除/修改 “open”, “high”, “low”, “close”, “volume” 这几列，否则会导致异常。","position":{"start":{"line":301,"column":1},"end":{"line":301,"column":1}},"key":"yH71s9fGyH"}],"key":"WZf5Dq2ef2"},{"type":"paragraph","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"children":[{"type":"text","value":"该方法还需定义新列 ","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"key":"GTOeVYH5vU"},{"type":"inlineCode","value":"enter_long","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"key":"LyJOdHxC5j"},{"type":"text","value":"（做空为 ","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"key":"VL6WoeR82A"},{"type":"inlineCode","value":"enter_short","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"key":"gLceAJn9qD"},{"type":"text","value":"），入场时为 1，无操作为 0。即使只做空也必须设置 ","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"key":"w1YehWy9qS"},{"type":"inlineCode","value":"enter_long","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"key":"msmNBzErbA"},{"type":"text","value":"。","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"key":"qnQrSkVdJb"}],"key":"x7fGbv8Dpu"},{"type":"paragraph","position":{"start":{"line":305,"column":1},"end":{"line":305,"column":1}},"children":[{"type":"text","value":"可用 ","position":{"start":{"line":305,"column":1},"end":{"line":305,"column":1}},"key":"OGfV0kwE85"},{"type":"inlineCode","value":"enter_tag","position":{"start":{"line":305,"column":1},"end":{"line":305,"column":1}},"key":"V7Xx5M08gQ"},{"type":"text","value":" 列为信号命名，便于后续调试和分析。","position":{"start":{"line":305,"column":1},"end":{"line":305,"column":1}},"key":"YPtWD7cHgQ"}],"key":"uXvP2ih8wf"},{"type":"paragraph","position":{"start":{"line":307,"column":1},"end":{"line":307,"column":1}},"children":[{"type":"text","value":"示例（来自 sample_strategy.py）：","position":{"start":{"line":307,"column":1},"end":{"line":307,"column":1}},"key":"m6HJeYk62D"}],"key":"CbJ5dGsBT4"},{"type":"code","lang":"python","value":"def populate_entry_trend(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n    \"\"\"\n    基于技术指标，为给定 dataframe 生成买入信号\n    :param dataframe: 已填充指标的 DataFrame\n    :param metadata: 额外信息，如当前交易对\n    :return: 包含买入信号的 DataFrame\n    \"\"\"\n    dataframe.loc[\n        (\n            (qtpylib.crossed_above(dataframe['rsi'], 30)) &  # RSI 上穿 30\n            (dataframe['tema'] <= dataframe['bb_middleband']) &  # 条件\n            (dataframe['tema'] > dataframe['tema'].shift(1)) &  # 条件\n            (dataframe['volume'] > 0)  # 确保有成交量\n        ),\n        ['enter_long', 'enter_tag']] = (1, 'rsi_cross')\n\n    return dataframe","position":{"start":{"line":309,"column":1},"end":{"line":327,"column":1}},"key":"RNr1mkMEjz"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"做空信号","position":{"start":{"line":329,"column":1},"end":{"line":329,"column":1}},"key":"cLYpfAO9TW"}],"key":"UuEuQhJ91O"},{"type":"paragraph","position":{"start":{"line":330,"column":1},"end":{"line":332,"column":1}},"children":[{"type":"text","value":"做空可通过设置 ","position":{"start":{"line":330,"column":1},"end":{"line":330,"column":1}},"key":"jgLo9sQgV9"},{"type":"inlineCode","value":"enter_short","position":{"start":{"line":330,"column":1},"end":{"line":330,"column":1}},"key":"maHrIHEPP0"},{"type":"text","value":"（对应多头的 ","position":{"start":{"line":330,"column":1},"end":{"line":330,"column":1}},"key":"ZhRtBklNQK"},{"type":"inlineCode","value":"enter_long","position":{"start":{"line":330,"column":1},"end":{"line":330,"column":1}},"key":"Wg1F4VZFIF"},{"type":"text","value":"）实现。\n","position":{"start":{"line":330,"column":1},"end":{"line":330,"column":1}},"key":"d1vmBdZYTu"},{"type":"inlineCode","value":"enter_tag","position":{"start":{"line":330,"column":1},"end":{"line":330,"column":1}},"key":"IGG72Q96Sh"},{"type":"text","value":" 列用法相同。\n做空需交易所和市场支持！如需做空，务必设置 ","position":{"start":{"line":330,"column":1},"end":{"line":330,"column":1}},"key":"mGAAyVw8O1"},{"type":"link","url":"#can-short","position":{"start":{"line":330,"column":1},"end":{"line":330,"column":1}},"children":[{"type":"inlineCode","value":"can_short","position":{"start":{"line":330,"column":1},"end":{"line":330,"column":1}},"key":"gdHSOWprfY"}],"urlSource":"#can-short","key":"Gv2ftMFyah"},{"type":"text","value":" 为 True。","position":{"start":{"line":330,"column":1},"end":{"line":330,"column":1}},"key":"DRXJNMfyIk"}],"key":"WCKZY2UAtW"},{"type":"code","lang":"python","value":"# 支持多空\ncan_short = True\n\ndef populate_entry_trend(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n    dataframe.loc[\n        (\n            (qtpylib.crossed_above(dataframe['rsi'], 30)) &\n            (dataframe['tema'] <= dataframe['bb_middleband']) &\n            (dataframe['tema'] > dataframe['tema'].shift(1)) &\n            (dataframe['volume'] > 0)\n        ),\n        ['enter_long', 'enter_tag']] = (1, 'rsi_cross')\n\n    dataframe.loc[\n        (\n            (qtpylib.crossed_below(dataframe['rsi'], 70)) &\n            (dataframe['tema'] > dataframe['bb_middleband']) &\n            (dataframe['tema'] < dataframe['tema'].shift(1)) &\n            (dataframe['volume'] > 0)\n        ),\n        ['enter_short', 'enter_tag']] = (1, 'rsi_cross')\n\n    return dataframe","position":{"start":{"line":334,"column":1},"end":{"line":358,"column":1}},"key":"Xhw1sWe445"}],"key":"wnsAadKIW2"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Tip","key":"NJ4hmcgm6h"}],"key":"tVDT1xOmwX"},{"type":"paragraph","position":{"start":{"line":363,"column":1},"end":{"line":363,"column":1}},"children":[{"type":"text","value":"买入需要有卖方，因此需 ","position":{"start":{"line":363,"column":1},"end":{"line":363,"column":1}},"key":"UMSVsxKO0t"},{"type":"inlineCode","value":"dataframe['volume'] > 0","position":{"start":{"line":363,"column":1},"end":{"line":363,"column":1}},"key":"NzRFqmrWs4"},{"type":"text","value":"，避免在无成交量时买入/卖出。","position":{"start":{"line":363,"column":1},"end":{"line":363,"column":1}},"key":"XYscIDb1WZ"}],"key":"L5662P689v"}],"key":"jR9atS3t1T"},{"type":"heading","depth":4,"position":{"start":{"line":366,"column":1},"end":{"line":366,"column":1}},"children":[{"type":"text","value":"出场信号规则","position":{"start":{"line":366,"column":1},"end":{"line":366,"column":1}},"key":"Y980MjfwfF"}],"identifier":"id","label":"出场信号规则","html_id":"id-11","implicit":true,"key":"rxohVuMQAv"},{"type":"paragraph","position":{"start":{"line":368,"column":1},"end":{"line":368,"column":1}},"children":[{"type":"text","value":"编辑策略文件中的 ","position":{"start":{"line":368,"column":1},"end":{"line":368,"column":1}},"key":"RJ3TfMPnjT"},{"type":"inlineCode","value":"populate_exit_trend()","position":{"start":{"line":368,"column":1},"end":{"line":368,"column":1}},"key":"vMgsrJLEv1"},{"type":"text","value":" 方法，更新出场逻辑。","position":{"start":{"line":368,"column":1},"end":{"line":368,"column":1}},"key":"t9GdAVOoPM"}],"key":"fAqXOyZOzV"},{"type":"paragraph","position":{"start":{"line":370,"column":1},"end":{"line":370,"column":1}},"children":[{"type":"text","value":"可通过在配置或策略中设置 ","position":{"start":{"line":370,"column":1},"end":{"line":370,"column":1}},"key":"dLjBUN5ghQ"},{"type":"inlineCode","value":"use_exit_signal","position":{"start":{"line":370,"column":1},"end":{"line":370,"column":1}},"key":"Mu6rfQrqaV"},{"type":"text","value":" 为 false 禁用出场信号。","position":{"start":{"line":370,"column":1},"end":{"line":370,"column":1}},"key":"i22qq42lzj"}],"key":"uGMVSmV9Wk"},{"type":"paragraph","position":{"start":{"line":372,"column":1},"end":{"line":372,"column":1}},"children":[{"type":"inlineCode","value":"use_exit_signal","position":{"start":{"line":372,"column":1},"end":{"line":372,"column":1}},"key":"ZtoQt5R0OC"},{"type":"text","value":" 不影响","position":{"start":{"line":372,"column":1},"end":{"line":372,"column":1}},"key":"v7dyobQFsO"},{"type":"link","url":"#%E4%BF%A1%E5%8F%B7%E5%86%B2%E7%AA%81","position":{"start":{"line":372,"column":1},"end":{"line":372,"column":1}},"children":[{"type":"text","value":"信号冲突规则","position":{"start":{"line":372,"column":1},"end":{"line":372,"column":1}},"key":"Su7gUqrYJA"}],"urlSource":"#%E4%BF%A1%E5%8F%B7%E5%86%B2%E7%AA%81","key":"nwB3w3Q8pN"},{"type":"text","value":"，后者仍然生效，可能阻止入场。","position":{"start":{"line":372,"column":1},"end":{"line":372,"column":1}},"key":"SfVT8YXcq6"}],"key":"RD1fiUjPmU"},{"type":"paragraph","position":{"start":{"line":374,"column":1},"end":{"line":374,"column":1}},"children":[{"type":"text","value":"务必返回 dataframe，且不要删除/修改 “open”, “high”, “low”, “close”, “volume” 这几列，否则会导致异常。","position":{"start":{"line":374,"column":1},"end":{"line":374,"column":1}},"key":"YHVqiYmPvi"}],"key":"rLC3x1ebNm"},{"type":"paragraph","position":{"start":{"line":376,"column":1},"end":{"line":376,"column":1}},"children":[{"type":"text","value":"该方法还需定义新列 ","position":{"start":{"line":376,"column":1},"end":{"line":376,"column":1}},"key":"OfNo3sgeQ7"},{"type":"inlineCode","value":"exit_long","position":{"start":{"line":376,"column":1},"end":{"line":376,"column":1}},"key":"erncUnpuHF"},{"type":"text","value":"（做空为 ","position":{"start":{"line":376,"column":1},"end":{"line":376,"column":1}},"key":"I6YGpn54Bw"},{"type":"inlineCode","value":"exit_short","position":{"start":{"line":376,"column":1},"end":{"line":376,"column":1}},"key":"koQSZ29Yh8"},{"type":"text","value":"），出场时为 1，无操作为 0。","position":{"start":{"line":376,"column":1},"end":{"line":376,"column":1}},"key":"bsG25JPVmL"}],"key":"PRYiKHngv0"},{"type":"paragraph","position":{"start":{"line":378,"column":1},"end":{"line":378,"column":1}},"children":[{"type":"text","value":"可用 ","position":{"start":{"line":378,"column":1},"end":{"line":378,"column":1}},"key":"RkZkuWwUrs"},{"type":"inlineCode","value":"exit_tag","position":{"start":{"line":378,"column":1},"end":{"line":378,"column":1}},"key":"pY16yFLbfE"},{"type":"text","value":" 列为信号命名，便于后续调试和分析。","position":{"start":{"line":378,"column":1},"end":{"line":378,"column":1}},"key":"MkKpHatMgS"}],"key":"PpV6sAnYoV"},{"type":"paragraph","position":{"start":{"line":380,"column":1},"end":{"line":380,"column":1}},"children":[{"type":"text","value":"示例（来自 sample_strategy.py）：","position":{"start":{"line":380,"column":1},"end":{"line":380,"column":1}},"key":"ZapLbq0hFP"}],"key":"ramtOIf3Z3"},{"type":"code","lang":"python","value":"def populate_exit_trend(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n    \"\"\"\n    基于技术指标，为给定 dataframe 生成卖出信号\n    :param dataframe: 已填充指标的 DataFrame\n    :param metadata: 额外信息，如当前交易对\n    :return: 包含卖出信号的 DataFrame\n    \"\"\"\n    dataframe.loc[\n        (\n            (qtpylib.crossed_above(dataframe['rsi'], 70)) &  # RSI 上穿 70\n            (dataframe['tema'] > dataframe['bb_middleband']) &  # 条件\n            (dataframe['tema'] < dataframe['tema'].shift(1)) &  # 条件\n            (dataframe['volume'] > 0)  # 确保有成交量\n        ),\n        ['exit_long', 'exit_tag']] = (1, 'rsi_too_high')\n    return dataframe","position":{"start":{"line":382,"column":1},"end":{"line":399,"column":1}},"key":"pr63A9aA1e"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"做空平仓","position":{"start":{"line":401,"column":1},"end":{"line":401,"column":1}},"key":"weKQ1BKG48"}],"key":"n7n63nmfpj"},{"type":"paragraph","position":{"start":{"line":402,"column":1},"end":{"line":402,"column":1}},"children":[{"type":"text","value":"做空平仓可通过设置 ","position":{"start":{"line":402,"column":1},"end":{"line":402,"column":1}},"key":"RV7uCJ3DFU"},{"type":"inlineCode","value":"exit_short","position":{"start":{"line":402,"column":1},"end":{"line":402,"column":1}},"key":"yoqu00o0sq"},{"type":"text","value":"（对应多头的 ","position":{"start":{"line":402,"column":1},"end":{"line":402,"column":1}},"key":"U72mf4yEXm"},{"type":"inlineCode","value":"exit_long","position":{"start":{"line":402,"column":1},"end":{"line":402,"column":1}},"key":"dGCAUhQJ7O"},{"type":"text","value":"）实现。","position":{"start":{"line":402,"column":1},"end":{"line":402,"column":1}},"key":"PE3SYQXymd"}],"key":"lPWrkniMbr"},{"type":"paragraph","position":{"start":{"line":404,"column":1},"end":{"line":404,"column":1}},"children":[{"type":"inlineCode","value":"exit_tag","position":{"start":{"line":404,"column":1},"end":{"line":404,"column":1}},"key":"NHPzWrgp87"},{"type":"text","value":" 列用法相同。","position":{"start":{"line":404,"column":1},"end":{"line":404,"column":1}},"key":"v0sURfRKmd"}],"key":"xFd16Ih6Ao"},{"type":"paragraph","position":{"start":{"line":406,"column":1},"end":{"line":406,"column":1}},"children":[{"type":"text","value":"做空需交易所和市场支持！如需做空，务必设置 ","position":{"start":{"line":406,"column":1},"end":{"line":406,"column":1}},"key":"iXUgMHndpx"},{"type":"link","url":"#can-short","position":{"start":{"line":406,"column":1},"end":{"line":406,"column":1}},"children":[{"type":"inlineCode","value":"can_short","position":{"start":{"line":406,"column":1},"end":{"line":406,"column":1}},"key":"ZFsaPNNnUr"}],"urlSource":"#can-short","key":"dvZqjLE0iw"},{"type":"text","value":" 为 True。","position":{"start":{"line":406,"column":1},"end":{"line":406,"column":1}},"key":"LbOXCrXeTh"}],"key":"ys5CqlisXU"},{"type":"code","lang":"python","value":"    # 支持多空\n    can_short = True\n\n    def populate_exit_trend(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n        dataframe.loc[\n            (\n                (qtpylib.crossed_above(dataframe['rsi'], 70)) &\n                (dataframe['tema'] > dataframe['bb_middleband']) &\n                (dataframe['tema'] < dataframe['tema'].shift(1)) &\n                (dataframe['volume'] > 0)\n            ),\n            ['exit_long', 'exit_tag']] = (1, 'rsi_too_high')\n        dataframe.loc[\n            (\n                (qtpylib.crossed_below(dataframe['rsi'], 30)) &\n                (dataframe['tema'] < dataframe['bb_middleband']) &\n                (dataframe['tema'] > dataframe['tema'].shift(1)) &\n                (dataframe['volume'] > 0)\n            ),\n            ['exit_short', 'exit_tag']] = (1, 'rsi_too_low')\n        return dataframe","position":{"start":{"line":408,"column":1},"end":{"line":430,"column":1}},"key":"YoI0shEYDn"}],"key":"MgFufn03AT"},{"type":"heading","depth":4,"position":{"start":{"line":434,"column":1},"end":{"line":434,"column":1}},"children":[{"type":"text","value":"最小收益率（ROI）","position":{"start":{"line":434,"column":1},"end":{"line":434,"column":1}},"key":"TDq8Tafm3S"}],"identifier":"id-roi","label":"最小收益率（ROI）","html_id":"id-roi","implicit":true,"key":"oFa3faCf1q"},{"type":"paragraph","position":{"start":{"line":436,"column":1},"end":{"line":436,"column":1}},"children":[{"type":"inlineCode","value":"minimal_roi","position":{"start":{"line":436,"column":1},"end":{"line":436,"column":1}},"key":"ceS5Q99Auw"},{"type":"text","value":" 策略变量定义了交易在退出前应达到的最小收益率，与出场信号无关。","position":{"start":{"line":436,"column":1},"end":{"line":436,"column":1}},"key":"FoI07o4h85"}],"key":"EPiCHO0NTa"},{"type":"paragraph","position":{"start":{"line":438,"column":1},"end":{"line":438,"column":1}},"children":[{"type":"text","value":"格式如下，是一个 python 字典，键为开仓后经过的分钟数，值为百分比：","position":{"start":{"line":438,"column":1},"end":{"line":438,"column":1}},"key":"ulZcJayofQ"}],"key":"X3u28yYGas"},{"type":"code","lang":"python","value":"minimal_roi = {\n    \"40\": 0.0,\n    \"30\": 0.01,\n    \"20\": 0.02,\n    \"0\": 0.04\n}","position":{"start":{"line":440,"column":1},"end":{"line":447,"column":1}},"key":"ImVUmp9cEq"},{"type":"paragraph","position":{"start":{"line":449,"column":1},"end":{"line":449,"column":1}},"children":[{"type":"text","value":"上述配置含义：","position":{"start":{"line":449,"column":1},"end":{"line":449,"column":1}},"key":"Ai1f2UEL8d"}],"key":"BQT5VIZc7n"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":451,"column":1},"end":{"line":455,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":451,"column":1},"end":{"line":451,"column":1}},"children":[{"type":"text","value":"达到 4% 盈利时退出","position":{"start":{"line":451,"column":1},"end":{"line":451,"column":1}},"key":"kQ4usds46u"}],"key":"H9LlhHa8fL"},{"type":"listItem","spread":true,"position":{"start":{"line":452,"column":1},"end":{"line":452,"column":1}},"children":[{"type":"text","value":"20 分钟后达到 2% 盈利时退出","position":{"start":{"line":452,"column":1},"end":{"line":452,"column":1}},"key":"xyDxNQMqvI"}],"key":"VBWbBKpBQs"},{"type":"listItem","spread":true,"position":{"start":{"line":453,"column":1},"end":{"line":453,"column":1}},"children":[{"type":"text","value":"30 分钟后达到 1% 盈利时退出","position":{"start":{"line":453,"column":1},"end":{"line":453,"column":1}},"key":"HZqO2Y3yTe"}],"key":"lPxU4cfCJ1"},{"type":"listItem","spread":true,"position":{"start":{"line":454,"column":1},"end":{"line":455,"column":1}},"children":[{"type":"text","value":"40 分钟后只要不亏损就退出","position":{"start":{"line":454,"column":1},"end":{"line":454,"column":1}},"key":"IKgk5VXfp7"}],"key":"X9hPPN5918"}],"key":"VIMfMgwgsq"},{"type":"paragraph","position":{"start":{"line":456,"column":1},"end":{"line":456,"column":1}},"children":[{"type":"text","value":"计算时包含手续费。","position":{"start":{"line":456,"column":1},"end":{"line":456,"column":1}},"key":"nfqGWbIST5"}],"key":"XywwTQLbX6"},{"type":"heading","depth":5,"position":{"start":{"line":458,"column":1},"end":{"line":458,"column":1}},"children":[{"type":"text","value":"禁用最小 ROI","position":{"start":{"line":458,"column":1},"end":{"line":458,"column":1}},"key":"PFuMywPLmT"}],"identifier":"id-roi","label":"禁用最小 ROI","html_id":"id-roi-1","implicit":true,"key":"uvtSwsNnCj"},{"type":"paragraph","position":{"start":{"line":460,"column":1},"end":{"line":460,"column":1}},"children":[{"type":"text","value":"如需完全禁用 ROI，将其设为空字典：","position":{"start":{"line":460,"column":1},"end":{"line":460,"column":1}},"key":"oa1LF898Sd"}],"key":"dnR0lIuCg2"},{"type":"code","lang":"python","value":"minimal_roi = {}","position":{"start":{"line":462,"column":1},"end":{"line":464,"column":1}},"key":"XX9eO3HGj4"},{"type":"heading","depth":5,"position":{"start":{"line":466,"column":1},"end":{"line":466,"column":1}},"children":[{"type":"text","value":"ROI 中用计算表达式","position":{"start":{"line":466,"column":1},"end":{"line":466,"column":1}},"key":"SBpAmgvbjA"}],"identifier":"roi","label":"ROI 中用计算表达式","html_id":"roi","implicit":true,"key":"QIaroVXt5m"},{"type":"paragraph","position":{"start":{"line":468,"column":1},"end":{"line":468,"column":1}},"children":[{"type":"text","value":"如需按K线周期（timeframe）设置时间，可用如下写法：","position":{"start":{"line":468,"column":1},"end":{"line":468,"column":1}},"key":"zC5mIC06qL"}],"key":"CDBwwGo1Xd"},{"type":"code","lang":"python","value":"from freqtrade.exchange import timeframe_to_minutes\n\nclass AwesomeStrategy(IStrategy):\n\n    timeframe = \"1d\"\n    timeframe_mins = timeframe_to_minutes(timeframe)\n    minimal_roi = {\n        \"0\": 0.05,                      # 前 3 根 K 线 5%\n        str(timeframe_mins * 3): 0.02,  # 3 根 K 线后 2%\n        str(timeframe_mins * 6): 0.01,  # 6 根 K 线后 1%\n    }","position":{"start":{"line":470,"column":1},"end":{"line":482,"column":1}},"key":"NGTwS2uCQY"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"未立即成交的订单","position":{"start":{"line":484,"column":1},"end":{"line":484,"column":1}},"key":"Kssh1awUpT"}],"key":"G4Q6uAp4LD"},{"type":"paragraph","position":{"start":{"line":485,"column":1},"end":{"line":485,"column":1}},"children":[{"type":"inlineCode","value":"minimal_roi","position":{"start":{"line":485,"column":1},"end":{"line":485,"column":1}},"key":"Pf2YEaUq5U"},{"type":"text","value":" 以 ","position":{"start":{"line":485,"column":1},"end":{"line":485,"column":1}},"key":"Rz5fZCUTvS"},{"type":"inlineCode","value":"trade.open_date","position":{"start":{"line":485,"column":1},"end":{"line":485,"column":1}},"key":"wCBmLfDbM0"},{"type":"text","value":" 为基准，即首次下单时间。","position":{"start":{"line":485,"column":1},"end":{"line":485,"column":1}},"key":"zQ81RbazN7"}],"key":"dLa78Powpc"},{"type":"paragraph","position":{"start":{"line":487,"column":1},"end":{"line":487,"column":1}},"children":[{"type":"text","value":"对于未立即成交的限价单（如用 ","position":{"start":{"line":487,"column":1},"end":{"line":487,"column":1}},"key":"FMGD1SHkto"},{"type":"inlineCode","value":"custom_entry_price()","position":{"start":{"line":487,"column":1},"end":{"line":487,"column":1}},"key":"eXEIiIuZ10"},{"type":"text","value":"），或用 ","position":{"start":{"line":487,"column":1},"end":{"line":487,"column":1}},"key":"qPEx67wvr0"},{"type":"inlineCode","value":"adjust_entry_price()","position":{"start":{"line":487,"column":1},"end":{"line":487,"column":1}},"key":"EZ9o8E0sje"},{"type":"text","value":" 调整价格的情况，时间仍以首次下单为准。","position":{"start":{"line":487,"column":1},"end":{"line":487,"column":1}},"key":"helnB99H8c"}],"key":"IUMqoVeOLi"}],"key":"MMWBt7B4dh"},{"type":"heading","depth":4,"position":{"start":{"line":490,"column":1},"end":{"line":490,"column":1}},"children":[{"type":"text","value":"止损","position":{"start":{"line":490,"column":1},"end":{"line":490,"column":1}},"key":"doGPjsdp3V"}],"identifier":"id","label":"止损","html_id":"id-12","implicit":true,"key":"ASk8H0E1rT"},{"type":"paragraph","position":{"start":{"line":492,"column":1},"end":{"line":492,"column":1}},"children":[{"type":"text","value":"强烈建议设置止损，以保护资金免受极端行情影响。","position":{"start":{"line":492,"column":1},"end":{"line":492,"column":1}},"key":"dsvEUEi0el"}],"key":"PkNaQdatHW"},{"type":"paragraph","position":{"start":{"line":494,"column":1},"end":{"line":494,"column":1}},"children":[{"type":"text","value":"如设置 10% 止损：","position":{"start":{"line":494,"column":1},"end":{"line":494,"column":1}},"key":"gM2awJHk89"}],"key":"lNP79awKTG"},{"type":"code","lang":"python","value":"stoploss = -0.10","position":{"start":{"line":496,"column":1},"end":{"line":498,"column":1}},"key":"XPs8fuKnMz"},{"type":"paragraph","position":{"start":{"line":500,"column":1},"end":{"line":500,"column":1}},"children":[{"type":"text","value":"更多止损功能详见","position":{"start":{"line":500,"column":1},"end":{"line":500,"column":1}},"key":"wADaBR2zI1"},{"type":"link","url":"/stoploss","position":{"start":{"line":500,"column":1},"end":{"line":500,"column":1}},"children":[{"type":"text","value":"止损专页","position":{"start":{"line":500,"column":1},"end":{"line":500,"column":1}},"key":"A6IgSGC3Mw"}],"urlSource":"stoploss.md","dataUrl":"/stoploss.json","internal":true,"protocol":"file","key":"aZaNjUvGef"},{"type":"text","value":"。","position":{"start":{"line":500,"column":1},"end":{"line":500,"column":1}},"key":"FTe6MRCOUq"}],"key":"mz58ShaPRE"},{"type":"heading","depth":4,"position":{"start":{"line":502,"column":1},"end":{"line":502,"column":1}},"children":[{"type":"text","value":"时间周期（Timeframe）","position":{"start":{"line":502,"column":1},"end":{"line":502,"column":1}},"key":"Rk2nDLaESs"}],"identifier":"id-timeframe","label":"时间周期（Timeframe）","html_id":"id-timeframe","implicit":true,"key":"VD2Cwiz5LX"},{"type":"paragraph","position":{"start":{"line":504,"column":1},"end":{"line":504,"column":1}},"children":[{"type":"text","value":"即策略用的K线周期。","position":{"start":{"line":504,"column":1},"end":{"line":504,"column":1}},"key":"Qlc4Oj7ymD"}],"key":"Dbveqh8hC6"},{"type":"paragraph","position":{"start":{"line":506,"column":1},"end":{"line":506,"column":1}},"children":[{"type":"text","value":"常见值有 “1m”、“5m”、“15m”、“1h”，也可用交易所支持的其他周期。","position":{"start":{"line":506,"column":1},"end":{"line":506,"column":1}},"key":"R3wMdgziww"}],"key":"Kv2aqlPf0E"},{"type":"paragraph","position":{"start":{"line":508,"column":1},"end":{"line":508,"column":1}},"children":[{"type":"text","value":"同一入场/出场信号在不同周期下效果可能完全不同。","position":{"start":{"line":508,"column":1},"end":{"line":508,"column":1}},"key":"GvqEE2UENz"}],"key":"La1Lhw8iyw"},{"type":"paragraph","position":{"start":{"line":510,"column":1},"end":{"line":510,"column":1}},"children":[{"type":"text","value":"在策略方法中可通过 ","position":{"start":{"line":510,"column":1},"end":{"line":510,"column":1}},"key":"bm5Xrug332"},{"type":"inlineCode","value":"self.timeframe","position":{"start":{"line":510,"column":1},"end":{"line":510,"column":1}},"key":"gag6oZCPgs"},{"type":"text","value":" 访问。","position":{"start":{"line":510,"column":1},"end":{"line":510,"column":1}},"key":"QlX1mMni1A"}],"key":"swg4tkuC3L"},{"type":"heading","depth":4,"position":{"start":{"line":512,"column":1},"end":{"line":512,"column":1}},"children":[{"type":"text","value":"是否支持做空","position":{"start":{"line":512,"column":1},"end":{"line":512,"column":1}},"key":"kdwjnYbphG"}],"identifier":"id","label":"是否支持做空","html_id":"id-13","implicit":true,"key":"Xj4SEezB82"},{"type":"paragraph","position":{"start":{"line":514,"column":1},"end":{"line":514,"column":1}},"children":[{"type":"text","value":"如需在合约市场做空，需设置 ","position":{"start":{"line":514,"column":1},"end":{"line":514,"column":1}},"key":"VoAgnlTanN"},{"type":"inlineCode","value":"can_short = True","position":{"start":{"line":514,"column":1},"end":{"line":514,"column":1}},"key":"IY7uT9IAZY"},{"type":"text","value":"。","position":{"start":{"line":514,"column":1},"end":{"line":514,"column":1}},"key":"fTPxqu2Uq5"}],"key":"MdUZ4rLIOd"},{"type":"paragraph","position":{"start":{"line":516,"column":1},"end":{"line":516,"column":1}},"children":[{"type":"text","value":"启用后，策略在现货市场会加载失败。","position":{"start":{"line":516,"column":1},"end":{"line":516,"column":1}},"key":"IRchy8AjsL"}],"key":"vTLr6zV5jN"},{"type":"paragraph","position":{"start":{"line":518,"column":1},"end":{"line":518,"column":1}},"children":[{"type":"text","value":"如 ","position":{"start":{"line":518,"column":1},"end":{"line":518,"column":1}},"key":"tv1ny0dcYS"},{"type":"inlineCode","value":"enter_short","position":{"start":{"line":518,"column":1},"end":{"line":518,"column":1}},"key":"JK0EGBdUlR"},{"type":"text","value":" 列有 1，但 ","position":{"start":{"line":518,"column":1},"end":{"line":518,"column":1}},"key":"PQvq6vi76O"},{"type":"inlineCode","value":"can_short = False","position":{"start":{"line":518,"column":1},"end":{"line":518,"column":1}},"key":"zPL5HuaytR"},{"type":"text","value":"（默认），则即使配置了合约市场也不会做空。","position":{"start":{"line":518,"column":1},"end":{"line":518,"column":1}},"key":"KxK1PbTqdw"}],"key":"vHuSIqWdza"},{"type":"heading","depth":4,"position":{"start":{"line":520,"column":1},"end":{"line":520,"column":1}},"children":[{"type":"text","value":"Metadata 字典","position":{"start":{"line":520,"column":1},"end":{"line":520,"column":1}},"key":"n0xassFJfK"}],"identifier":"metadata","label":"Metadata 字典","html_id":"metadata","implicit":true,"key":"W6Mta5dicO"},{"type":"paragraph","position":{"start":{"line":522,"column":1},"end":{"line":523,"column":1}},"children":[{"type":"inlineCode","value":"metadata","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"j9ym5xdiGH"},{"type":"text","value":" 字典（","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"Axns1Pt7bj"},{"type":"inlineCode","value":"populate_entry_trend","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"w7PT4evDMl"},{"type":"text","value":"、","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"iFVyULVEEX"},{"type":"inlineCode","value":"populate_exit_trend","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"wLGYKnZHO3"},{"type":"text","value":"、","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"jCYcarQbBl"},{"type":"inlineCode","value":"populate_indicators","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"MYKeUYwiJf"},{"type":"text","value":" 可用）包含额外信息。\n目前有 ","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"eIlVYpTrxh"},{"type":"inlineCode","value":"pair","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"VOm0dJkSd1"},{"type":"text","value":"，可通过 ","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"bZvRSJEAeM"},{"type":"inlineCode","value":"metadata['pair']","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"mryfHACp08"},{"type":"text","value":" 获取，如 ","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"kigT2ee3z0"},{"type":"inlineCode","value":"XRP/BTC","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"WfMkKfBJAk"},{"type":"text","value":"（合约市场为 ","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"Xn8KbvYvkI"},{"type":"inlineCode","value":"XRP/BTC:BTC","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"FQmp8dw5ir"},{"type":"text","value":"）。","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"gDrfK6kMd6"}],"key":"vP4vMEsIK1"},{"type":"paragraph","position":{"start":{"line":525,"column":1},"end":{"line":525,"column":1}},"children":[{"type":"text","value":"metadata 不应被修改，也不会在策略函数间持久化。","position":{"start":{"line":525,"column":1},"end":{"line":525,"column":1}},"key":"gLnhRfNkbt"}],"key":"xoOfQQWS46"},{"type":"paragraph","position":{"start":{"line":527,"column":1},"end":{"line":527,"column":1}},"children":[{"type":"text","value":"如需持久化信息，请查阅","position":{"start":{"line":527,"column":1},"end":{"line":527,"column":1}},"key":"YoctOr9i47"},{"type":"crossReference","url":"/strategy-advanced","position":{"start":{"line":527,"column":1},"end":{"line":527,"column":1}},"children":[{"type":"text","value":"信息存储","position":{"start":{"line":527,"column":1},"end":{"line":527,"column":1}},"key":"mfcWoioztu"}],"urlSource":"strategy-advanced.md#storing-information-persistent","dataUrl":"/strategy-advanced.json","identifier":"storing-information-persistent","label":"storing-information-persistent","remote":true,"protocol":"file","key":"FPjKDeX6o0"},{"type":"text","value":"。","position":{"start":{"line":527,"column":1},"end":{"line":527,"column":1}},"key":"tYOFgImEAY"}],"key":"UZCfZtiaET"},{"type":"include","file":"includes/strategy-imports.md","literal":false,"lang":"markdown","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"策略所需的导入","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LyVBr6FVB1"}],"identifier":"id","label":"策略所需的导入","html_id":"id-14","implicit":true,"key":"OqDUZx6I2V"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"在创建策略时，你需要导入必要的模块和类。以下是一个策略所需的导入：","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"e8REOwV1Kz"}],"key":"Ff6RjU5vVM"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"默认情况下，我们建议使用以下导入作为策略的基础：\n这将涵盖 freqtrade 功能所需的所有导入。\n当然，你可以根据需要添加更多导入。","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"vgr6rClMb4"}],"key":"eXaQwBP3jn"},{"type":"code","lang":"python","value":"# flake8: noqa: F401\n# isort: skip_file\n# --- Do not remove these imports ---\nimport numpy as np\nimport pandas as pd\nfrom datetime import datetime, timedelta, timezone\nfrom pandas import DataFrame\nfrom typing import Dict, Optional, Union, Tuple\n\nfrom freqtrade.strategy import (\n    IStrategy,\n    Trade, \n    Order,\n    PairLocks,\n    informative,  # @informative decorator\n    # Hyperopt Parameters\n    BooleanParameter,\n    CategoricalParameter,\n    DecimalParameter,\n    IntParameter,\n    RealParameter,\n    # timeframe helpers\n    timeframe_to_minutes,\n    timeframe_to_next_date,\n    timeframe_to_prev_date,\n    # Strategy helper functions\n    merge_informative_pair,\n    stoploss_from_absolute,\n    stoploss_from_open,\n)\n\n# --------------------------------\n# Add your lib to import here\nimport talib.abstract as ta\nfrom technical import qtpylib","position":{"start":{"line":9,"column":1},"end":{"line":45,"column":1}},"key":"XaCNJ0HJ8Q"}],"key":"Xh2tZ1s4T2"},{"type":"heading","depth":3,"position":{"start":{"line":532,"column":1},"end":{"line":532,"column":1}},"children":[{"type":"text","value":"策略文件加载","position":{"start":{"line":532,"column":1},"end":{"line":532,"column":1}},"key":"WHuaB8GxsH"}],"identifier":"id","label":"策略文件加载","html_id":"id-15","implicit":true,"key":"Teq0pdW64k"},{"type":"paragraph","position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"children":[{"type":"text","value":"默认情况下，freqtrade 会尝试从 ","position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"key":"uZKs5cvOgu"},{"type":"inlineCode","value":"userdir","position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"key":"vItEuuUFFe"},{"type":"text","value":"（默认 ","position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"key":"RjLJ1U6fSM"},{"type":"inlineCode","value":"user_data/strategies","position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"key":"ZJutOkAb6A"},{"type":"text","value":"）下所有 ","position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"key":"Lo4pKaxNRq"},{"type":"inlineCode","value":".py","position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"key":"AMRgP4Zg3K"},{"type":"text","value":" 文件加载策略。","position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"key":"lcxuDFbK5H"}],"key":"MPXTb6sRe5"},{"type":"paragraph","position":{"start":{"line":536,"column":1},"end":{"line":536,"column":1}},"children":[{"type":"text","value":"假设你的策略叫 ","position":{"start":{"line":536,"column":1},"end":{"line":536,"column":1}},"key":"ydKlyc1GFs"},{"type":"inlineCode","value":"AwesomeStrategy","position":{"start":{"line":536,"column":1},"end":{"line":536,"column":1}},"key":"S8fiVghTyB"},{"type":"text","value":"，文件为 ","position":{"start":{"line":536,"column":1},"end":{"line":536,"column":1}},"key":"xwFpg8pam2"},{"type":"inlineCode","value":"user_data/strategies/AwesomeStrategy.py","position":{"start":{"line":536,"column":1},"end":{"line":536,"column":1}},"key":"ZKheiruzKf"},{"type":"text","value":"，可用如下命令 dry（或 live，视配置而定）运行：","position":{"start":{"line":536,"column":1},"end":{"line":536,"column":1}},"key":"iJGJuZNnK3"}],"key":"tWZXvVnimX"},{"type":"code","lang":"bash","value":"freqtrade trade --strategy AwesomeStrategy","position":{"start":{"line":538,"column":1},"end":{"line":540,"column":1}},"key":"PBFoWIWvCx"},{"type":"paragraph","position":{"start":{"line":542,"column":1},"end":{"line":542,"column":1}},"children":[{"type":"text","value":"注意这里用的是类名，不是文件名。","position":{"start":{"line":542,"column":1},"end":{"line":542,"column":1}},"key":"iKPp3XgAg7"}],"key":"WPHs4HgyR8"},{"type":"paragraph","position":{"start":{"line":544,"column":1},"end":{"line":544,"column":1}},"children":[{"type":"text","value":"用 ","position":{"start":{"line":544,"column":1},"end":{"line":544,"column":1}},"key":"UhI8qqdWX8"},{"type":"inlineCode","value":"freqtrade list-strategies","position":{"start":{"line":544,"column":1},"end":{"line":544,"column":1}},"key":"TZlPCkoofc"},{"type":"text","value":" 可查看所有可加载的策略（正确目录下的所有策略）。会有\"状态\"字段，提示潜在问题。","position":{"start":{"line":544,"column":1},"end":{"line":544,"column":1}},"key":"pGkArBeg8o"}],"key":"D2WuyiDz0U"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"自定义策略目录","position":{"start":{"line":546,"column":1},"end":{"line":546,"column":1}},"key":"ntTZbgxSSs"}],"key":"TOgEs6hLZ7"},{"type":"paragraph","position":{"start":{"line":547,"column":1},"end":{"line":547,"column":1}},"children":[{"type":"text","value":"可用 ","position":{"start":{"line":547,"column":1},"end":{"line":547,"column":1}},"key":"MUW7OehRgU"},{"type":"inlineCode","value":"--strategy-path user_data/otherPath","position":{"start":{"line":547,"column":1},"end":{"line":547,"column":1}},"key":"zjFjTKC9fx"},{"type":"text","value":" 指定其他目录。所有需用策略的命令均支持此参数。","position":{"start":{"line":547,"column":1},"end":{"line":547,"column":1}},"key":"omPpSXOlFX"}],"key":"bf573UcB3d"}],"key":"bP8VaO2EnF"},{"type":"heading","depth":3,"position":{"start":{"line":550,"column":1},"end":{"line":550,"column":1}},"children":[{"type":"text","value":"辅助交易对（Informative Pairs）","position":{"start":{"line":550,"column":1},"end":{"line":550,"column":1}},"key":"MtIaSGvXUF"}],"identifier":"id-informative-pairs","label":"辅助交易对（Informative Pairs）","html_id":"id-informative-pairs","implicit":true,"key":"kvuUf1MoqN"},{"type":"heading","depth":4,"position":{"start":{"line":554,"column":1},"end":{"line":554,"column":1}},"children":[{"type":"text","value":"获取非交易对的数据","position":{"start":{"line":554,"column":1},"end":{"line":554,"column":1}},"key":"BqJeTAfbLR"}],"label":"get-data-for-non-tradeable-pairs","identifier":"get-data-for-non-tradeable-pairs","html_id":"get-data-for-non-tradeable-pairs","key":"NebzlqzPKU"},{"type":"paragraph","position":{"start":{"line":556,"column":1},"end":{"line":556,"column":1}},"children":[{"type":"text","value":"有些策略需要参考更大周期的其他交易对数据。","position":{"start":{"line":556,"column":1},"end":{"line":556,"column":1}},"key":"aSm7T0PMVq"}],"key":"YdRyWAYb5c"},{"type":"paragraph","position":{"start":{"line":558,"column":1},"end":{"line":558,"column":1}},"children":[{"type":"text","value":"这些辅助对的 OHLCV 数据会在常规白名单刷新时一并下载，可通过 ","position":{"start":{"line":558,"column":1},"end":{"line":558,"column":1}},"key":"AdVsbvWVbQ"},{"type":"inlineCode","value":"DataProvider","position":{"start":{"line":558,"column":1},"end":{"line":558,"column":1}},"key":"jML5ZDxVvL"},{"type":"text","value":" 获取。","position":{"start":{"line":558,"column":1},"end":{"line":558,"column":1}},"key":"qe4NHQDVtJ"}],"key":"nscrtUpzZO"},{"type":"paragraph","position":{"start":{"line":560,"column":1},"end":{"line":560,"column":1}},"children":[{"type":"text","value":"这些对","position":{"start":{"line":560,"column":1},"end":{"line":560,"column":1}},"key":"DikJE9KRQS"},{"type":"strong","position":{"start":{"line":560,"column":1},"end":{"line":560,"column":1}},"children":[{"type":"text","value":"不会","position":{"start":{"line":560,"column":1},"end":{"line":560,"column":1}},"key":"s3IuAIf2PB"}],"key":"OZyT7coQZO"},{"type":"text","value":"被交易，除非也在白名单或被动态白名单（如 ","position":{"start":{"line":560,"column":1},"end":{"line":560,"column":1}},"key":"y0KEIYSL96"},{"type":"inlineCode","value":"VolumePairlist","position":{"start":{"line":560,"column":1},"end":{"line":560,"column":1}},"key":"PUuekNUqKv"},{"type":"text","value":"）选中。","position":{"start":{"line":560,"column":1},"end":{"line":560,"column":1}},"key":"c5L7MQMBCb"}],"key":"nm2qFtWrX8"},{"type":"paragraph","position":{"start":{"line":562,"column":1},"end":{"line":562,"column":1}},"children":[{"type":"text","value":"需用元组指定，格式为 ","position":{"start":{"line":562,"column":1},"end":{"line":562,"column":1}},"key":"IsJicAcyBA"},{"type":"inlineCode","value":"(\"pair\", \"timeframe\")","position":{"start":{"line":562,"column":1},"end":{"line":562,"column":1}},"key":"beaKDetAjL"},{"type":"text","value":"，第一个为交易对，第二个为周期。","position":{"start":{"line":562,"column":1},"end":{"line":562,"column":1}},"key":"BGLNmDCy7h"}],"key":"suoWskJHIM"},{"type":"paragraph","position":{"start":{"line":564,"column":1},"end":{"line":564,"column":1}},"children":[{"type":"text","value":"示例：","position":{"start":{"line":564,"column":1},"end":{"line":564,"column":1}},"key":"Qox1T5OPCE"}],"key":"NN8juIdm4v"},{"type":"code","lang":"python","value":"def informative_pairs(self):\n    return [(\"ETH/USDT\", \"5m\"),\n            (\"BTC/TUSD\", \"15m\"),\n            ]","position":{"start":{"line":566,"column":1},"end":{"line":571,"column":1}},"key":"y0DJa31KRC"},{"type":"paragraph","position":{"start":{"line":573,"column":1},"end":{"line":573,"column":1}},"children":[{"type":"text","value":"完整示例见","position":{"start":{"line":573,"column":1},"end":{"line":573,"column":1}},"key":"A9ej12M9OL"},{"type":"link","url":"#%E5%AE%8C%E6%95%B4%E6%95%B0%E6%8D%AE%E6%8F%90%E4%BE%9B%E8%80%85%E7%A4%BA%E4%BE%8B","position":{"start":{"line":573,"column":1},"end":{"line":573,"column":1}},"children":[{"type":"text","value":"DataProvider 部分","position":{"start":{"line":573,"column":1},"end":{"line":573,"column":1}},"key":"vctPxoYqqU"}],"urlSource":"#%E5%AE%8C%E6%95%B4%E6%95%B0%E6%8D%AE%E6%8F%90%E4%BE%9B%E8%80%85%E7%A4%BA%E4%BE%8B","key":"RVG4mNdNhN"},{"type":"text","value":"。","position":{"start":{"line":573,"column":1},"end":{"line":573,"column":1}},"key":"RXnlofbaGe"}],"key":"FML3sNkFME"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"swK4Wu5myj"}],"key":"eF6W9sjQ2R"},{"type":"paragraph","position":{"start":{"line":576,"column":1},"end":{"line":576,"column":1}},"children":[{"type":"text","value":"这些对会随白名单刷新，建议列表不要太长。","position":{"start":{"line":576,"column":1},"end":{"line":576,"column":1}},"key":"SDGTbqK53P"}],"key":"nWTZ0QPimV"},{"type":"paragraph","position":{"start":{"line":578,"column":1},"end":{"line":578,"column":1}},"children":[{"type":"text","value":"只要交易所支持，所有周期和对都可用。","position":{"start":{"line":578,"column":1},"end":{"line":578,"column":1}},"key":"aUvsle0Kn9"}],"key":"KXpmMnmpVX"},{"type":"paragraph","position":{"start":{"line":580,"column":1},"end":{"line":580,"column":1}},"children":[{"type":"text","value":"但建议尽量用重采样方式获取大周期，避免请求过多被封。","position":{"start":{"line":580,"column":1},"end":{"line":580,"column":1}},"key":"TCmTfi6igN"}],"key":"jCadWL3AKy"}],"key":"X42YSQRg1W"},{"type":"admonition","kind":"attention","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"其他K线类型","position":{"start":{"line":583,"column":1},"end":{"line":583,"column":1}},"key":"k2nGjBsID4"}],"key":"xZJjra1KGu"},{"type":"paragraph","position":{"start":{"line":584,"column":1},"end":{"line":584,"column":1}},"children":[{"type":"text","value":"informative_pairs 还可加第三个元素，显式指定K线类型。","position":{"start":{"line":584,"column":1},"end":{"line":584,"column":1}},"key":"vak142l0lb"}],"key":"DatIt8VCk9"},{"type":"paragraph","position":{"start":{"line":586,"column":1},"end":{"line":586,"column":1}},"children":[{"type":"text","value":"可用性取决于交易模式和交易所。一般现货对不能用于合约市场，反之亦然。","position":{"start":{"line":586,"column":1},"end":{"line":586,"column":1}},"key":"ChUDSmt9gY"}],"key":"cnhBwv1l3W"},{"type":"paragraph","position":{"start":{"line":588,"column":1},"end":{"line":588,"column":1}},"children":[{"type":"text","value":"详情见交易所文档。","position":{"start":{"line":588,"column":1},"end":{"line":588,"column":1}},"key":"gFRz0FcSey"}],"key":"fOsqx0nHUC"}],"key":"JH4C6VCD9q"},{"type":"code","lang":"python","value":"    def informative_pairs(self):\n        return [\n            (\"ETH/USDT\", \"5m\", \"\"),   # 默认 K 线类型，随 trading_mode 变化（推荐）\n            (\"ETH/USDT\", \"5m\", \"spot\"),   # 强制用现货 K 线（仅现货机器人）\n            (\"BTC/TUSD\", \"15m\", \"futures\"),  # 用合约 K 线（仅合约机器人）\n            (\"BTC/TUSD\", \"15m\", \"mark\"),  # 用标记 K 线（仅合约机器人）\n        ]","position":{"start":{"line":591,"column":1},"end":{"line":599,"column":1}},"key":"MWIuYL2jcq"},{"type":"heading","depth":4,"position":{"start":{"line":601,"column":1},"end":{"line":601,"column":1}},"children":[{"type":"text","value":"Informative pairs 装饰器（","position":{"start":{"line":601,"column":1},"end":{"line":601,"column":1}},"key":"QpIGUxYyLv"},{"type":"inlineCode","value":"@informative()","position":{"start":{"line":601,"column":1},"end":{"line":601,"column":1}},"key":"iKtH1Hckw4"},{"type":"text","value":"）","position":{"start":{"line":601,"column":1},"end":{"line":601,"column":1}},"key":"ig5QuQsOaV"}],"identifier":"informative-pairs-informative","label":"Informative pairs 装饰器（@informative()）","html_id":"informative-pairs-informative","implicit":true,"key":"HrzbOw23pQ"},{"type":"paragraph","position":{"start":{"line":603,"column":1},"end":{"line":603,"column":1}},"children":[{"type":"text","value":"可用 ","position":{"start":{"line":603,"column":1},"end":{"line":603,"column":1}},"key":"qoYv0cWeiv"},{"type":"inlineCode","value":"@informative","position":{"start":{"line":603,"column":1},"end":{"line":603,"column":1}},"key":"tUpXSQBoGo"},{"type":"text","value":" 装饰器快速定义 informative pair。所有被装饰的 ","position":{"start":{"line":603,"column":1},"end":{"line":603,"column":1}},"key":"gKspCow5PF"},{"type":"inlineCode","value":"populate_indicators_*","position":{"start":{"line":603,"column":1},"end":{"line":603,"column":1}},"key":"yAGCqCWkZO"},{"type":"text","value":" 方法独立运行，不能访问其他 informative pair 的数据。但所有 informative dataframe 会合并传递给主 ","position":{"start":{"line":603,"column":1},"end":{"line":603,"column":1}},"key":"SJSPYl6jhk"},{"type":"inlineCode","value":"populate_indicators()","position":{"start":{"line":603,"column":1},"end":{"line":603,"column":1}},"key":"rI10a0t0wL"},{"type":"text","value":"。","position":{"start":{"line":603,"column":1},"end":{"line":603,"column":1}},"key":"TqsxMpgxKh"}],"key":"QaHDNeIHSa"},{"type":"admonition","kind":"caution","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Caution","key":"Bn4CfYDAza"}],"key":"U11z0g8Vjv"},{"type":"paragraph","position":{"start":{"line":606,"column":1},"end":{"line":606,"column":1}},"children":[{"type":"text","value":"若需用一个 informative pair 的数据生成另一个 informative pair，请勿用 ","position":{"start":{"line":606,"column":1},"end":{"line":606,"column":1}},"key":"rB0y7BrOWZ"},{"type":"inlineCode","value":"@informative","position":{"start":{"line":606,"column":1},"end":{"line":606,"column":1}},"key":"nWR1P3zPG4"},{"type":"text","value":" 装饰器，而应手动定义 informative pair，见","position":{"start":{"line":606,"column":1},"end":{"line":606,"column":1}},"key":"rGzLx140tQ"},{"type":"link","url":"#%E5%AE%8C%E6%95%B4%E6%95%B0%E6%8D%AE%E6%8F%90%E4%BE%9B%E8%80%85%E7%A4%BA%E4%BE%8B","position":{"start":{"line":606,"column":1},"end":{"line":606,"column":1}},"children":[{"type":"text","value":"DataProvider 部分","position":{"start":{"line":606,"column":1},"end":{"line":606,"column":1}},"key":"La3UQ4LcgK"}],"urlSource":"#%E5%AE%8C%E6%95%B4%E6%95%B0%E6%8D%AE%E6%8F%90%E4%BE%9B%E8%80%85%E7%A4%BA%E4%BE%8B","key":"hU5H0C5iaX"},{"type":"text","value":"。","position":{"start":{"line":606,"column":1},"end":{"line":606,"column":1}},"key":"Uk7zOs7K9M"}],"key":"E9Ysr3OHAW"}],"key":"VU8Gy8qtnU"},{"type":"paragraph","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"children":[{"type":"text","value":"超参优化时，hyperoptable 参数不支持 ","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"key":"qbKTBFUQeq"},{"type":"inlineCode","value":".value","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"key":"Ek79p1k0cb"},{"type":"text","value":"，请用 ","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"key":"t6PZFxtMkO"},{"type":"inlineCode","value":".range","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"key":"PovlidaOQa"},{"type":"text","value":"。见","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"key":"IAyM9FQLFX"},{"type":"crossReference","url":"/hyperopt","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"children":[{"type":"text","value":"优化指标参数","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"key":"nwYjiECQk1"}],"urlSource":"hyperopt.md#optimizing-an-indicator-parameter","dataUrl":"/hyperopt.json","identifier":"optimizing-an-indicator-parameter","label":"optimizing-an-indicator-parameter","remote":true,"protocol":"file","key":"nkkO3NPluA"},{"type":"text","value":"。","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"key":"ixsUGE32HW"}],"key":"PKtEZJca30"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"完整文档","position":{"start":{"line":611,"column":1},"end":{"line":611,"column":1}},"key":"qD0DdQa7Jo"}],"key":"kpuQA5tlID"},{"type":"code","lang":"python","value":"    def informative(\n        timeframe: str,\n        asset: str = \"\",\n        fmt: str | Callable[[Any], str] | None = None,\n        *,\n        candle_type: CandleType | str | None = None,\n        ffill: bool = True,\n    ) -> Callable[[PopulateIndicators], PopulateIndicators]:\n        \"\"\"\n        用于 populate_indicators_Nn(self, dataframe, metadata) 的装饰器，定义 informative 指标。\n        \n        用法示例：\n\n            @informative('1h')\n            def populate_indicators_1h(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n                dataframe['rsi'] = ta.RSI(dataframe, timeperiod=14)\n                return dataframe\n\n        :param timeframe: 辅助K线周期，必须大于等于主策略周期。\n        :param asset: 辅助资产，如 BTC、BTC/USDT、ETH/BTC。不指定则用当前对。支持格式化字符串。\n        :param fmt: 列名格式（str）或格式化函数。默认：\n        * {base}_{quote}_{column}_{timeframe}（指定 asset 时）\n        * {column}_{timeframe}（未指定 asset 时）\n        支持变量：{base}、{BASE}、{quote}、{QUOTE}、{asset}、{column}、{timeframe}\n        :param ffill: informative pair 合并后是否前向填充。\n        :param candle_type: '', mark, index, premiumIndex, funding_rate\n        \"\"\"","position":{"start":{"line":613,"column":1},"end":{"line":641,"column":1}},"key":"d42jauE3ua"}],"key":"IzJ2SWxNr7"},{"type":"admonition","kind":"hint","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"快速定义 informative pair","position":{"start":{"line":645,"column":1},"end":{"line":645,"column":1}},"key":"RZUdOZqr7u"}],"key":"myxkSFkVKY"},{"type":"paragraph","position":{"start":{"line":647,"column":1},"end":{"line":647,"column":1}},"children":[{"type":"text","value":"大多数情况下无需用 ","position":{"start":{"line":647,"column":1},"end":{"line":647,"column":1}},"key":"Hgbn7yt9WY"},{"type":"inlineCode","value":"merge_informative_pair()","position":{"start":{"line":647,"column":1},"end":{"line":647,"column":1}},"key":"IJ1ICgVjvx"},{"type":"text","value":"，可直接用装饰器：","position":{"start":{"line":647,"column":1},"end":{"line":647,"column":1}},"key":"YJ49zcW1Zo"}],"key":"e0c4UMnE6t"},{"type":"code","lang":"python","value":"\n    from datetime import datetime\n    from freqtrade.persistence import Trade\n    from freqtrade.strategy import IStrategy, informative\n\n    class AwesomeStrategy(IStrategy):\n        \n        # 可省略 informative_pairs 方法\n\n        # 为每个对定义高阶周期 informative pair。可叠加装饰器。\n        @informative('30m')\n        @informative('1h')\n        def populate_indicators_1h(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n            dataframe['rsi'] = ta.RSI(dataframe, timeperiod=14)\n            return dataframe\n\n        # 定义 BTC/STAKE informative pair。可用 {stake} 占位符。最终列名如 'btc_usdt_rsi_1h'。\n        @informative('1h', 'BTC/{stake}')\n        def populate_indicators_btc_1h(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n            dataframe['rsi'] = ta.RSI(dataframe, timeperiod=14)\n            return dataframe\n\n        # 定义 BTC/ETH informative pair。需指定 quote。最终列名如 'eth_btc_rsi_1h'。\n        @informative('1h', 'ETH/BTC')\n        def populate_indicators_eth_btc_1h(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n            dataframe['rsi'] = ta.RSI(dataframe, timeperiod=14)\n            return dataframe\n    \n        # 可自定义列名格式\n        @informative('1h', 'BTC/{stake}', '{column}_{timeframe}')\n        def populate_indicators_btc_1h_2(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n            dataframe['rsi_upper'] = ta.RSI(dataframe, timeperiod=14)\n            return dataframe\n    \n        def populate_indicators(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n            dataframe['rsi'] = ta.RSI(dataframe, timeperiod=14)\n            dataframe['rsi_less'] = dataframe['rsi'] < dataframe['rsi_1h']\n            return dataframe","position":{"start":{"line":649,"column":1},"end":{"line":688,"column":1}},"key":"bussSArMLw"}],"key":"NL5qKzT2h8"},{"type":"admonition","kind":"attention","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Attention","key":"Av0Rm2Z6VR"}],"key":"UEjdhnVMvH"},{"type":"paragraph","position":{"start":{"line":693,"column":1},"end":{"line":693,"column":1}},"children":[{"type":"text","value":"访问其他对的 informative dataframe 时建议用字符串格式化，便于后续更换 stake 货币。","position":{"start":{"line":693,"column":1},"end":{"line":693,"column":1}},"key":"eVb9OfSuYN"}],"key":"qae7D2ab05"},{"type":"code","lang":"python","value":"    def populate_entry_trend(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n        stake = self.config['stake_currency']\n        dataframe.loc[\n            (\n                (dataframe[f'btc_{stake}_rsi_1h'] < 35)\n                &\n                (dataframe['volume'] > 0)\n            ),\n            ['enter_long', 'enter_tag']] = (1, 'buy_signal_rsi')\n    \n        return dataframe","position":{"start":{"line":695,"column":1},"end":{"line":707,"column":1}},"key":"nWoK6cqNwg"},{"type":"paragraph","position":{"start":{"line":709,"column":1},"end":{"line":709,"column":1}},"children":[{"type":"text","value":"或用列重命名去除 stake 货币：","position":{"start":{"line":709,"column":1},"end":{"line":709,"column":1}},"key":"tItcjCfChv"},{"type":"inlineCode","value":"@informative('1h', 'BTC/{stake}', fmt='{base}_{column}_{timeframe}')","position":{"start":{"line":709,"column":1},"end":{"line":709,"column":1}},"key":"qy7IdegxR1"},{"type":"text","value":"。","position":{"start":{"line":709,"column":1},"end":{"line":709,"column":1}},"key":"XL9e4tOT8S"}],"key":"vr8mGl25eD"}],"key":"z81gXh4zNy"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"方法名重复","position":{"start":{"line":712,"column":1},"end":{"line":712,"column":1}},"key":"lB0A5C8Wd0"}],"key":"C1niza5w1O"},{"type":"paragraph","position":{"start":{"line":714,"column":1},"end":{"line":714,"column":1}},"children":[{"type":"text","value":"被 ","position":{"start":{"line":714,"column":1},"end":{"line":714,"column":1}},"key":"c9eeeKsKC0"},{"type":"inlineCode","value":"@informative()","position":{"start":{"line":714,"column":1},"end":{"line":714,"column":1}},"key":"dP9waKfJ3n"},{"type":"text","value":" 装饰的方法名必须唯一！重复会覆盖前面的定义且无报错，导致部分指标不可用。请仔细检查方法名。","position":{"start":{"line":714,"column":1},"end":{"line":714,"column":1}},"key":"JelNZcB8cV"}],"key":"gtDnvPeQVR"}],"key":"y5u5bSw8P9"},{"type":"heading","depth":4,"position":{"start":{"line":717,"column":1},"end":{"line":717,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":717,"column":1},"end":{"line":717,"column":1}},"children":[{"type":"text","value":"merge_informative_pair()","position":{"start":{"line":717,"column":1},"end":{"line":717,"column":1}},"key":"JH6w61CH2G"}],"key":"tJqAiKnTqV"}],"identifier":"merge-informative-pair","label":"merge_informative_pair()","html_id":"merge-informative-pair","implicit":true,"key":"Wqrdo2e9gF"},{"type":"paragraph","position":{"start":{"line":719,"column":1},"end":{"line":719,"column":1}},"children":[{"type":"text","value":"该方法可安全、无前视偏差地将 informative pair 合并到主 dataframe。","position":{"start":{"line":719,"column":1},"end":{"line":719,"column":1}},"key":"bu4DTVTvlh"}],"key":"PQxERsVofR"},{"type":"paragraph","position":{"start":{"line":721,"column":1},"end":{"line":721,"column":1}},"children":[{"type":"text","value":"功能：","position":{"start":{"line":721,"column":1},"end":{"line":721,"column":1}},"key":"XkyDj38IdT"}],"key":"DvAj5LOp3k"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":723,"column":1},"end":{"line":726,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":723,"column":1},"end":{"line":723,"column":1}},"children":[{"type":"text","value":"列重命名，避免冲突","position":{"start":{"line":723,"column":1},"end":{"line":723,"column":1}},"key":"aOX4TpXcy8"}],"key":"u74zH35eVq"},{"type":"listItem","spread":true,"position":{"start":{"line":724,"column":1},"end":{"line":724,"column":1}},"children":[{"type":"text","value":"无前视偏差合并","position":{"start":{"line":724,"column":1},"end":{"line":724,"column":1}},"key":"Mh1C2X7k1N"}],"key":"dR5hDkaQVh"},{"type":"listItem","spread":true,"position":{"start":{"line":725,"column":1},"end":{"line":726,"column":1}},"children":[{"type":"text","value":"可选前向填充","position":{"start":{"line":725,"column":1},"end":{"line":725,"column":1}},"key":"oh5r2XnjM4"}],"key":"vGyVeYEHhl"}],"key":"qUBVHp1RoG"},{"type":"paragraph","position":{"start":{"line":727,"column":1},"end":{"line":727,"column":1}},"children":[{"type":"text","value":"完整示例见","position":{"start":{"line":727,"column":1},"end":{"line":727,"column":1}},"key":"Jx9V8vRgyZ"},{"type":"link","url":"#%E5%AE%8C%E6%95%B4%E6%95%B0%E6%8D%AE%E6%8F%90%E4%BE%9B%E8%80%85%E7%A4%BA%E4%BE%8B","position":{"start":{"line":727,"column":1},"end":{"line":727,"column":1}},"children":[{"type":"text","value":"完整数据提供者示例","position":{"start":{"line":727,"column":1},"end":{"line":727,"column":1}},"key":"W9niZFbyXN"}],"urlSource":"#%E5%AE%8C%E6%95%B4%E6%95%B0%E6%8D%AE%E6%8F%90%E4%BE%9B%E8%80%85%E7%A4%BA%E4%BE%8B","key":"QOvcRibOkj"},{"type":"text","value":"。","position":{"start":{"line":727,"column":1},"end":{"line":727,"column":1}},"key":"kxK2YtnaKo"}],"key":"ZV3clQkZ28"},{"type":"paragraph","position":{"start":{"line":729,"column":1},"end":{"line":729,"column":1}},"children":[{"type":"text","value":"所有 informative dataframe 列会以新名字出现在主 dataframe：","position":{"start":{"line":729,"column":1},"end":{"line":729,"column":1}},"key":"GiLxhX71Yo"}],"key":"b161tdW1L9"},{"type":"admonition","kind":"important","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"列重命名","position":{"start":{"line":731,"column":1},"end":{"line":731,"column":1}},"key":"RxKFxdSqm9"}],"key":"RVnZb9CuyC"},{"type":"paragraph","position":{"start":{"line":733,"column":1},"end":{"line":733,"column":1}},"children":[{"type":"text","value":"假设 ","position":{"start":{"line":733,"column":1},"end":{"line":733,"column":1}},"key":"ytyMtD1NNR"},{"type":"inlineCode","value":"inf_tf = '1d'","position":{"start":{"line":733,"column":1},"end":{"line":733,"column":1}},"key":"YLHyiQIzXL"},{"type":"text","value":"，合并后列名如下：","position":{"start":{"line":733,"column":1},"end":{"line":733,"column":1}},"key":"k87leMLtkQ"}],"key":"PVYPUY3IKL"},{"type":"code","lang":"python","value":"    'date', 'open', 'high', 'low', 'close', 'rsi'                     # 原 dataframe\n    'date_1d', 'open_1d', 'high_1d', 'low_1d', 'close_1d', 'rsi_1d'   # informative dataframe","position":{"start":{"line":735,"column":1},"end":{"line":738,"column":1}},"key":"LkNmOcQ9FD"}],"key":"msdOFHCHYS"},{"type":"admonition","kind":"important","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"1h 列重命名","position":{"start":{"line":742,"column":1},"end":{"line":742,"column":1}},"key":"rKx8k4MpXz"}],"key":"ndwIUmWac8"},{"type":"paragraph","position":{"start":{"line":744,"column":1},"end":{"line":744,"column":1}},"children":[{"type":"text","value":"假设 ","position":{"start":{"line":744,"column":1},"end":{"line":744,"column":1}},"key":"dKs6co7s75"},{"type":"inlineCode","value":"inf_tf = '1h'","position":{"start":{"line":744,"column":1},"end":{"line":744,"column":1}},"key":"JHN81B7XGF"},{"type":"text","value":"，合并后列名如下：","position":{"start":{"line":744,"column":1},"end":{"line":744,"column":1}},"key":"BEunz1OPG0"}],"key":"JGndJSMtRl"},{"type":"code","lang":"python","value":"    'date', 'open', 'high', 'low', 'close', 'rsi'                     # 原 dataframe\n    'date_1h', 'open_1h', 'high_1h', 'low_1h', 'close_1h', 'rsi_1h'   # informative dataframe","position":{"start":{"line":746,"column":1},"end":{"line":749,"column":1}},"key":"hIhVQWnK3g"}],"key":"fmOalS26iT"},{"type":"admonition","kind":"important","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"自定义实现","position":{"start":{"line":753,"column":1},"end":{"line":753,"column":1}},"key":"eSb02cRFPm"}],"key":"fttKwcGBnf"},{"type":"paragraph","position":{"start":{"line":754,"column":1},"end":{"line":754,"column":1}},"children":[{"type":"text","value":"可自定义实现如下：","position":{"start":{"line":754,"column":1},"end":{"line":754,"column":1}},"key":"psfOw5ZIzh"}],"key":"RPFNBKmp0o"},{"type":"code","lang":"python","value":"    # 日期右移 1 根K线\n    # This is necessary since the data is always the \"open date\"\n    # and a 15m candle starting at 12:15 should not know the close of the 1h candle from 12:00 to 13:00\n    minutes = timeframe_to_minutes(inf_tf)\n    # Only do this if the timeframes are different:\n    informative['date_merge'] = informative[\"date\"] + pd.to_timedelta(minutes, 'm')\n\n    # Rename columns to be unique\n    informative.columns = [f\"{col}_{inf_tf}\" for col in informative.columns]\n    # Assuming inf_tf = '1d' - then the columns will now be:\n    # date_1d, open_1d, high_1d, low_1d, close_1d, rsi_1d\n\n    # Combine the 2 dataframes\n    # all indicators on the informative sample MUST be calculated before this point\n    dataframe = pd.merge(dataframe, informative, left_on='date', right_on=f'date_merge_{inf_tf}', how='left')\n    # FFill to have the 1d value available in every row throughout the day.\n    # Without this, comparisons would only work once per day.\n    dataframe = dataframe.ffill()","position":{"start":{"line":756,"column":1},"end":{"line":775,"column":1}},"key":"y0H7KiQm0O"}],"key":"X2AH9MpnoF"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"informative 周期 < 主周期","position":{"start":{"line":778,"column":1},"end":{"line":778,"column":1}},"key":"lkV8dqnQSl"}],"key":"IXIXGLVoNY"},{"type":"paragraph","position":{"start":{"line":779,"column":1},"end":{"line":779,"column":1}},"children":[{"type":"text","value":"用本方法时，不建议 informative 周期小于主 dataframe 周期，否则无法利用更多细节。若需用更细粒度信息，需用更高级方法（超出本文档范围）。","position":{"start":{"line":779,"column":1},"end":{"line":779,"column":1}},"key":"dd2ai9CfzA"}],"key":"eHUzWggo5h"}],"key":"wdBClBshCs"},{"type":"heading","depth":3,"position":{"start":{"line":782,"column":1},"end":{"line":782,"column":1}},"children":[{"type":"text","value":"额外数据（DataProvider）","position":{"start":{"line":782,"column":1},"end":{"line":782,"column":1}},"key":"hWZLmOI2LK"}],"identifier":"id-dataprovider","label":"额外数据（DataProvider）","html_id":"id-dataprovider","implicit":true,"key":"h8hM4KL0b2"},{"type":"paragraph","position":{"start":{"line":784,"column":1},"end":{"line":784,"column":1}},"children":[{"type":"text","value":"策略可通过 ","position":{"start":{"line":784,"column":1},"end":{"line":784,"column":1}},"key":"sI9mKRfwzN"},{"type":"inlineCode","value":"DataProvider","position":{"start":{"line":784,"column":1},"end":{"line":784,"column":1}},"key":"wrqcVtYOv0"},{"type":"text","value":" 获取更多数据。","position":{"start":{"line":784,"column":1},"end":{"line":784,"column":1}},"key":"KRiNp4FPKf"}],"key":"IP1G7pU91Z"},{"type":"paragraph","position":{"start":{"line":786,"column":1},"end":{"line":786,"column":1}},"children":[{"type":"text","value":"所有方法失败时返回 None，不抛异常。","position":{"start":{"line":786,"column":1},"end":{"line":786,"column":1}},"key":"hfk9rUwypL"}],"key":"vmdw3x6F9A"},{"type":"paragraph","position":{"start":{"line":788,"column":1},"end":{"line":788,"column":1}},"children":[{"type":"text","value":"请根据运行模式选择合适方法（见下文示例）。","position":{"start":{"line":788,"column":1},"end":{"line":788,"column":1}},"key":"t120j81DrF"}],"key":"KLlgffAMCs"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"超参优化限制","position":{"start":{"line":790,"column":1},"end":{"line":790,"column":1}},"key":"Ck0pdYOWvG"}],"key":"IGWhfQShf3"},{"type":"paragraph","position":{"start":{"line":791,"column":1},"end":{"line":791,"column":1}},"children":[{"type":"text","value":"DataProvider 在超参优化时可用，但仅限于策略内的 ","position":{"start":{"line":791,"column":1},"end":{"line":791,"column":1}},"key":"zjLlXIDRtX"},{"type":"inlineCode","value":"populate_indicators()","position":{"start":{"line":791,"column":1},"end":{"line":791,"column":1}},"key":"J5z7uEnO59"},{"type":"text","value":"，不可用于超参优化类文件。","position":{"start":{"line":791,"column":1},"end":{"line":791,"column":1}},"key":"ntBaJLoORd"}],"key":"VF35AGv6VR"},{"type":"paragraph","position":{"start":{"line":793,"column":1},"end":{"line":793,"column":1}},"children":[{"type":"text","value":"也不可用于 ","position":{"start":{"line":793,"column":1},"end":{"line":793,"column":1}},"key":"YE9saJsOIA"},{"type":"inlineCode","value":"populate_entry_trend()","position":{"start":{"line":793,"column":1},"end":{"line":793,"column":1}},"key":"do0GoovedW"},{"type":"text","value":" 和 ","position":{"start":{"line":793,"column":1},"end":{"line":793,"column":1}},"key":"TITaBsIQfo"},{"type":"inlineCode","value":"populate_exit_trend()","position":{"start":{"line":793,"column":1},"end":{"line":793,"column":1}},"key":"MEGb5l7H3p"},{"type":"text","value":"。","position":{"start":{"line":793,"column":1},"end":{"line":793,"column":1}},"key":"hEdVoU7cZy"}],"key":"KZyvXwzTXc"}],"key":"QNiMqdYpj8"},{"type":"heading","depth":4,"position":{"start":{"line":796,"column":1},"end":{"line":796,"column":1}},"children":[{"type":"text","value":"DataProvider 可用方法","position":{"start":{"line":796,"column":1},"end":{"line":796,"column":1}},"key":"cWmkXX6RAB"}],"identifier":"dataprovider","label":"DataProvider 可用方法","html_id":"dataprovider","implicit":true,"key":"LCS1U33MQH"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":798,"column":1},"end":{"line":808,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":798,"column":1},"end":{"line":798,"column":1}},"children":[{"type":"link","url":"#available_pairs","position":{"start":{"line":798,"column":1},"end":{"line":798,"column":1}},"children":[{"type":"inlineCode","value":"available_pairs","position":{"start":{"line":798,"column":1},"end":{"line":798,"column":1}},"key":"QNZl4pL0XN"}],"urlSource":"#available_pairs","key":"B2tVygaZrl"},{"type":"text","value":" - 返回缓存的所有对及其周期（pair, timeframe）元组","position":{"start":{"line":798,"column":1},"end":{"line":798,"column":1}},"key":"W8wdZoBvdp"}],"key":"Oe12m9XUNG"},{"type":"listItem","spread":true,"position":{"start":{"line":799,"column":1},"end":{"line":799,"column":1}},"children":[{"type":"link","url":"#current_whitelist","position":{"start":{"line":799,"column":1},"end":{"line":799,"column":1}},"children":[{"type":"inlineCode","value":"current_whitelist()","position":{"start":{"line":799,"column":1},"end":{"line":799,"column":1}},"key":"RFoRt738W5"}],"urlSource":"#current_whitelist","key":"GqwGNZToyG"},{"type":"text","value":" - 返回当前白名单对列表，适合动态白名单（如 VolumePairlist）","position":{"start":{"line":799,"column":1},"end":{"line":799,"column":1}},"key":"YOPuukLJwy"}],"key":"TNLIUUJztq"},{"type":"listItem","spread":true,"position":{"start":{"line":800,"column":1},"end":{"line":800,"column":1}},"children":[{"type":"link","url":"#get_pair_dataframepair-timeframe","position":{"start":{"line":800,"column":1},"end":{"line":800,"column":1}},"children":[{"type":"inlineCode","value":"get_pair_dataframe(pair, timeframe)","position":{"start":{"line":800,"column":1},"end":{"line":800,"column":1}},"key":"LFAaMSH5VG"}],"urlSource":"#get_pair_dataframepair-timeframe","key":"ZdgH6uVm42"},{"type":"text","value":" - 通用方法，回测时返回历史数据，dry/live 时返回缓存数据","position":{"start":{"line":800,"column":1},"end":{"line":800,"column":1}},"key":"MJT0ZgO0vV"}],"key":"ShOvf8XfKV"},{"type":"listItem","spread":true,"position":{"start":{"line":801,"column":1},"end":{"line":801,"column":1}},"children":[{"type":"link","url":"#get_analyzed_dataframepair-timeframe","position":{"start":{"line":801,"column":1},"end":{"line":801,"column":1}},"children":[{"type":"inlineCode","value":"get_analyzed_dataframe(pair, timeframe)","position":{"start":{"line":801,"column":1},"end":{"line":801,"column":1}},"key":"MrDySQBDFE"}],"urlSource":"#get_analyzed_dataframepair-timeframe","key":"kyJIj8B0Ex"},{"type":"text","value":" - 返回分析后的 dataframe 及最新分析时间","position":{"start":{"line":801,"column":1},"end":{"line":801,"column":1}},"key":"vK3FMgQuIy"}],"key":"zYGG215HBy"},{"type":"listItem","spread":true,"position":{"start":{"line":802,"column":1},"end":{"line":802,"column":1}},"children":[{"type":"inlineCode","value":"historic_ohlcv(pair, timeframe)","position":{"start":{"line":802,"column":1},"end":{"line":802,"column":1}},"key":"CR1JwB8yFF"},{"type":"text","value":" - 返回磁盘上的历史数据","position":{"start":{"line":802,"column":1},"end":{"line":802,"column":1}},"key":"Wht5eKPV9t"}],"key":"JR8f5l3dlU"},{"type":"listItem","spread":true,"position":{"start":{"line":803,"column":1},"end":{"line":803,"column":1}},"children":[{"type":"inlineCode","value":"market(pair)","position":{"start":{"line":803,"column":1},"end":{"line":803,"column":1}},"key":"SZpsneDWB3"},{"type":"text","value":" - 返回交易对市场数据（手续费、限额、精度、活跃标志等）","position":{"start":{"line":803,"column":1},"end":{"line":803,"column":1}},"key":"lzJCNziOP1"}],"key":"zrT9fSuLms"},{"type":"listItem","spread":true,"position":{"start":{"line":804,"column":1},"end":{"line":804,"column":1}},"children":[{"type":"inlineCode","value":"ohlcv(pair, timeframe)","position":{"start":{"line":804,"column":1},"end":{"line":804,"column":1}},"key":"xObLiSIH2x"},{"type":"text","value":" - 返回当前缓存的K线数据","position":{"start":{"line":804,"column":1},"end":{"line":804,"column":1}},"key":"H9Pz8Ljue5"}],"key":"gawkwW4iQW"},{"type":"listItem","spread":true,"position":{"start":{"line":805,"column":1},"end":{"line":805,"column":1}},"children":[{"type":"link","url":"#orderbookpair-maximum","position":{"start":{"line":805,"column":1},"end":{"line":805,"column":1}},"children":[{"type":"inlineCode","value":"orderbook(pair, maximum)","position":{"start":{"line":805,"column":1},"end":{"line":805,"column":1}},"key":"YxW3nGdBgf"}],"urlSource":"#orderbookpair-maximum","key":"b9AC6JGoux"},{"type":"text","value":" - 返回最新 orderbook 数据（bids/asks）","position":{"start":{"line":805,"column":1},"end":{"line":805,"column":1}},"key":"N4iLiFOiQS"}],"key":"DHjgiKC2Eh"},{"type":"listItem","spread":true,"position":{"start":{"line":806,"column":1},"end":{"line":806,"column":1}},"children":[{"type":"link","url":"#tickerpair","position":{"start":{"line":806,"column":1},"end":{"line":806,"column":1}},"children":[{"type":"inlineCode","value":"ticker(pair)","position":{"start":{"line":806,"column":1},"end":{"line":806,"column":1}},"key":"ZSoHj7oyij"}],"urlSource":"#tickerpair","key":"fLht9lg6nJ"},{"type":"text","value":" - 返回当前 ticker 数据","position":{"start":{"line":806,"column":1},"end":{"line":806,"column":1}},"key":"ZnrzpZbp9O"}],"key":"XHsGuMVFyO"},{"type":"listItem","spread":true,"position":{"start":{"line":807,"column":1},"end":{"line":808,"column":1}},"children":[{"type":"inlineCode","value":"runmode","position":{"start":{"line":807,"column":1},"end":{"line":807,"column":1}},"key":"TFdIVcumcz"},{"type":"text","value":" - 当前运行模式","position":{"start":{"line":807,"column":1},"end":{"line":807,"column":1}},"key":"SJS0sks1U3"}],"key":"EDixdRCQAh"}],"key":"brtYXsyXTM"},{"type":"heading","depth":4,"position":{"start":{"line":809,"column":1},"end":{"line":809,"column":1}},"children":[{"type":"text","value":"示例用法","position":{"start":{"line":809,"column":1},"end":{"line":809,"column":1}},"key":"No86TwKnLp"}],"identifier":"id","label":"示例用法","html_id":"id-16","implicit":true,"key":"KdOrzthJae"},{"type":"heading","depth":4,"position":{"start":{"line":811,"column":1},"end":{"line":811,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":811,"column":1},"end":{"line":811,"column":1}},"children":[{"type":"text","value":"available_pairs","position":{"start":{"line":811,"column":1},"end":{"line":811,"column":1}},"key":"CpW9WJGulT"}],"key":"e9H0J6INcN"}],"identifier":"available-pairs","label":"available_pairs","html_id":"available-pairs","implicit":true,"key":"SEaCX0zDLe"},{"type":"code","lang":"python","value":"for pair, timeframe in self.dp.available_pairs:\n    print(f\"available {pair}, {timeframe}\")","position":{"start":{"line":813,"column":1},"end":{"line":816,"column":1}},"key":"djS8pjcwJQ"},{"type":"heading","depth":4,"position":{"start":{"line":818,"column":1},"end":{"line":818,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":818,"column":1},"end":{"line":818,"column":1}},"children":[{"type":"text","value":"current_whitelist()","position":{"start":{"line":818,"column":1},"end":{"line":818,"column":1}},"key":"k5nsbcfKT6"}],"key":"fe4m5t6tJ7"}],"identifier":"current-whitelist","label":"current_whitelist()","html_id":"current-whitelist","implicit":true,"key":"OKDw84iB7r"},{"type":"paragraph","position":{"start":{"line":820,"column":1},"end":{"line":820,"column":1}},"children":[{"type":"text","value":"假设你开发了一个用 ","position":{"start":{"line":820,"column":1},"end":{"line":820,"column":1}},"key":"Jtmx9Zut0H"},{"type":"inlineCode","value":"5m","position":{"start":{"line":820,"column":1},"end":{"line":820,"column":1}},"key":"g1nG36q2xN"},{"type":"text","value":" 周期、用 ","position":{"start":{"line":820,"column":1},"end":{"line":820,"column":1}},"key":"qacgjLurbg"},{"type":"inlineCode","value":"1d","position":{"start":{"line":820,"column":1},"end":{"line":820,"column":1}},"key":"pK7TpGWl3B"},{"type":"text","value":" 周期信号的策略，且用 VolumePairList 动态选前 10 个交易对。","position":{"start":{"line":820,"column":1},"end":{"line":820,"column":1}},"key":"SbbTjtE9hD"}],"key":"e2JXRAmKRi"},{"type":"paragraph","position":{"start":{"line":822,"column":1},"end":{"line":822,"column":1}},"children":[{"type":"text","value":"策略逻辑如下：","position":{"start":{"line":822,"column":1},"end":{"line":822,"column":1}},"key":"AFc0QrBryN"}],"key":"I2m3MnAJfE"},{"type":"paragraph","position":{"start":{"line":824,"column":1},"end":{"line":824,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":824,"column":1},"end":{"line":824,"column":1}},"children":[{"type":"text","value":"每 5 分钟扫描前 10 个交易对，用 14 日 RSI 生成信号。","position":{"start":{"line":824,"column":1},"end":{"line":824,"column":1}},"key":"R4X7EeVCyZ"}],"key":"VlQDsjsDtq"}],"key":"HiTVzPrC4X"},{"type":"paragraph","position":{"start":{"line":826,"column":1},"end":{"line":826,"column":1}},"children":[{"type":"text","value":"因数据有限，无法用 5m K 线重采样成日线。大多数交易所只给 500-1000 根K线，约等于 1.74 天。我们需要至少 14 天！","position":{"start":{"line":826,"column":1},"end":{"line":826,"column":1}},"key":"aEgex4bv0W"}],"key":"LFsWTPm5L3"},{"type":"paragraph","position":{"start":{"line":828,"column":1},"end":{"line":828,"column":1}},"children":[{"type":"text","value":"因此需用 informative pair，且因白名单动态变化，不知用哪些对！","position":{"start":{"line":828,"column":1},"end":{"line":828,"column":1}},"key":"kVvUSz300q"}],"key":"dkJS1T7POI"},{"type":"paragraph","position":{"start":{"line":830,"column":1},"end":{"line":830,"column":1}},"children":[{"type":"text","value":"此时可用 ","position":{"start":{"line":830,"column":1},"end":{"line":830,"column":1}},"key":"aZ54398Olq"},{"type":"inlineCode","value":"self.dp.current_whitelist()","position":{"start":{"line":830,"column":1},"end":{"line":830,"column":1}},"key":"Qa1WMi2S9U"},{"type":"text","value":" 获取当前白名单对。","position":{"start":{"line":830,"column":1},"end":{"line":830,"column":1}},"key":"CC1snB3l2Q"}],"key":"Vd49qqiEgp"},{"type":"code","lang":"python","value":"    def informative_pairs(self):\n\n        # 获取白名单所有对\n        pairs = self.dp.current_whitelist()\n        # 为每个对分配周期\n        informative_pairs = [(pair, '1d') for pair in pairs]\n        return informative_pairs","position":{"start":{"line":832,"column":1},"end":{"line":840,"column":1}},"key":"ETtvC7OHqj"},{"type":"admonition","kind":"caution","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"current_whitelist 用于绘图","position":{"start":{"line":842,"column":1},"end":{"line":842,"column":1}},"key":"HEtv6miW5d"}],"key":"rIJ07IZuYt"},{"type":"paragraph","position":{"start":{"line":843,"column":1},"end":{"line":843,"column":1}},"children":[{"type":"text","value":"current_whitelist 不支持 ","position":{"start":{"line":843,"column":1},"end":{"line":843,"column":1}},"key":"M0LHa4Hix5"},{"type":"inlineCode","value":"plot-dataframe","position":{"start":{"line":843,"column":1},"end":{"line":843,"column":1}},"key":"lRIku2w2JR"},{"type":"text","value":"，也不支持 FreqUI 可视化（webserver 模式），因 webserver 配置无需白名单。","position":{"start":{"line":843,"column":1},"end":{"line":843,"column":1}},"key":"hKiGtHTP8n"}],"key":"p2LIPO487x"}],"key":"KLeLFyW3YA"},{"type":"heading","depth":4,"position":{"start":{"line":846,"column":1},"end":{"line":846,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":846,"column":1},"end":{"line":846,"column":1}},"children":[{"type":"text","value":"get_pair_dataframe(pair, timeframe)","position":{"start":{"line":846,"column":1},"end":{"line":846,"column":1}},"key":"O4je2Pd98e"}],"key":"aOPfHVhr7U"}],"identifier":"get-pair-dataframe-pair-timeframe","label":"get_pair_dataframe(pair, timeframe)","html_id":"get-pair-dataframe-pair-timeframe","implicit":true,"key":"OvbevV7Viv"},{"type":"code","lang":"python","value":"# 获取第一个 informative pair 的K线数据\ninf_pair, inf_timeframe = self.informative_pairs()[0]\ninformative = self.dp.get_pair_dataframe(pair=inf_pair,\n                                         timeframe=inf_timeframe)","position":{"start":{"line":848,"column":1},"end":{"line":853,"column":1}},"key":"ZMqW9fx6Yh"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"回测注意","position":{"start":{"line":855,"column":1},"end":{"line":855,"column":1}},"key":"WNaw7L0Ua1"}],"key":"ZUBbUAPGjG"},{"type":"paragraph","position":{"start":{"line":856,"column":1},"end":{"line":856,"column":1}},"children":[{"type":"text","value":"回测时，","position":{"start":{"line":856,"column":1},"end":{"line":856,"column":1}},"key":"xT9oqglNWK"},{"type":"inlineCode","value":"dp.get_pair_dataframe()","position":{"start":{"line":856,"column":1},"end":{"line":856,"column":1}},"key":"Pl8MNAapHq"},{"type":"text","value":" 在 ","position":{"start":{"line":856,"column":1},"end":{"line":856,"column":1}},"key":"UmjaIe1RMs"},{"type":"inlineCode","value":"populate_*()","position":{"start":{"line":856,"column":1},"end":{"line":856,"column":1}},"key":"LsitFQpGiv"},{"type":"text","value":" 方法中返回完整时间区间。请勿\"看未来\"，否则 dry/live 时会有意外。","position":{"start":{"line":856,"column":1},"end":{"line":856,"column":1}},"key":"RmIm957haz"}],"key":"nnCvHyupPp"},{"type":"paragraph","position":{"start":{"line":858,"column":1},"end":{"line":858,"column":1}},"children":[{"type":"text","value":"在 ","position":{"start":{"line":858,"column":1},"end":{"line":858,"column":1}},"key":"uves0xCsox"},{"type":"link","url":"/strategy-callbacks","position":{"start":{"line":858,"column":1},"end":{"line":858,"column":1}},"children":[{"type":"text","value":"回调函数","position":{"start":{"line":858,"column":1},"end":{"line":858,"column":1}},"key":"csrGnM3qIz"}],"urlSource":"strategy-callbacks.md","dataUrl":"/strategy-callbacks.json","internal":true,"protocol":"file","key":"HUMdVfuYO5"},{"type":"text","value":" 中，则只返回当前（模拟）K线前的数据。","position":{"start":{"line":858,"column":1},"end":{"line":858,"column":1}},"key":"P89SYpHqbh"}],"key":"vYIXRzy6As"}],"key":"CPg10zmqya"},{"type":"heading","depth":4,"position":{"start":{"line":861,"column":1},"end":{"line":861,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":861,"column":1},"end":{"line":861,"column":1}},"children":[{"type":"text","value":"get_analyzed_dataframe(pair, timeframe)","position":{"start":{"line":861,"column":1},"end":{"line":861,"column":1}},"key":"FnWJ1Qz6UW"}],"key":"Zw9tPXbKus"}],"identifier":"get-analyzed-dataframe-pair-timeframe","label":"get_analyzed_dataframe(pair, timeframe)","html_id":"get-analyzed-dataframe-pair-timeframe","implicit":true,"key":"U29W7hWhzc"},{"type":"paragraph","position":{"start":{"line":863,"column":1},"end":{"line":863,"column":1}},"children":[{"type":"text","value":"该方法供 freqtrade 内部用来判断最后信号，也可在特定回调中用来获取触发操作的信号（见","position":{"start":{"line":863,"column":1},"end":{"line":863,"column":1}},"key":"JDGDwAGrJ0"},{"type":"link","url":"/strategy-advanced","position":{"start":{"line":863,"column":1},"end":{"line":863,"column":1}},"children":[{"type":"text","value":"高级策略文档","position":{"start":{"line":863,"column":1},"end":{"line":863,"column":1}},"key":"BK0JYPyGLG"}],"urlSource":"strategy-advanced.md","dataUrl":"/strategy-advanced.json","internal":true,"protocol":"file","key":"pkdf1BPKo1"},{"type":"text","value":"）。","position":{"start":{"line":863,"column":1},"end":{"line":863,"column":1}},"key":"EKVRZRToz7"}],"key":"IM7ixh6IRh"},{"type":"code","lang":"python","value":"# 获取当前 dataframe\ndataframe, last_updated = self.dp.get_analyzed_dataframe(pair=metadata['pair'],\n                                                         timeframe=self.timeframe)","position":{"start":{"line":865,"column":1},"end":{"line":869,"column":1}},"key":"a5sbD1zj2f"},{"type":"admonition","kind":"caution","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"无数据","position":{"start":{"line":871,"column":1},"end":{"line":871,"column":1}},"key":"wVv9SlWQx9"}],"key":"imEXTyduPW"},{"type":"paragraph","position":{"start":{"line":872,"column":1},"end":{"line":872,"column":1}},"children":[{"type":"text","value":"若请求的对未缓存，返回空 dataframe。可用 ","position":{"start":{"line":872,"column":1},"end":{"line":872,"column":1}},"key":"bcWBTT6hIA"},{"type":"inlineCode","value":"if dataframe.empty:","position":{"start":{"line":872,"column":1},"end":{"line":872,"column":1}},"key":"IRTn9M4Qey"},{"type":"text","value":" 检查。","position":{"start":{"line":872,"column":1},"end":{"line":872,"column":1}},"key":"ZeiO45NiCs"}],"key":"fFC7LqUzNQ"}],"key":"hrANOfnqMT"},{"type":"heading","depth":4,"position":{"start":{"line":875,"column":1},"end":{"line":875,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":875,"column":1},"end":{"line":875,"column":1}},"children":[{"type":"text","value":"orderbook(pair, maximum)","position":{"start":{"line":875,"column":1},"end":{"line":875,"column":1}},"key":"H0cguiUu2P"}],"key":"c1U52aiVi4"}],"identifier":"orderbook-pair-maximum","label":"orderbook(pair, maximum)","html_id":"orderbook-pair-maximum","implicit":true,"key":"e4YHfE1tDN"},{"type":"code","lang":"python","value":"if self.dp.runmode.value in ('live', 'dry_run'):\n    ob = self.dp.orderbook(metadata['pair'], 1)\n    dataframe['best_bid'] = ob['bids'][0][0]\n    dataframe['best_ask'] = ob['asks'][0][0]","position":{"start":{"line":877,"column":1},"end":{"line":882,"column":1}},"key":"WKnDFoU0XS"},{"type":"paragraph","position":{"start":{"line":884,"column":1},"end":{"line":884,"column":1}},"children":[{"type":"text","value":"orderbook 结构与 ","position":{"start":{"line":884,"column":1},"end":{"line":884,"column":1}},"key":"Tuz7ZGyXnJ"},{"type":"link","url":"https://github.com/ccxt/ccxt/wiki/Manual#order-book-structure","position":{"start":{"line":884,"column":1},"end":{"line":884,"column":1}},"children":[{"type":"text","value":"ccxt","position":{"start":{"line":884,"column":1},"end":{"line":884,"column":1}},"key":"yacbAT02F9"}],"urlSource":"https://github.com/ccxt/ccxt/wiki/Manual#order-book-structure","error":true,"key":"kai5UOmxKW"},{"type":"text","value":" 一致：","position":{"start":{"line":884,"column":1},"end":{"line":884,"column":1}},"key":"ssliJjPkJT"}],"key":"sAwl69tqUK"},{"type":"code","lang":"js","value":"{\n    'bids': [\n        [ price, amount ],\n        ...\n    ],\n    'asks': [\n        [ price, amount ],\n        ...\n    ],\n}","position":{"start":{"line":886,"column":1},"end":{"line":897,"column":1}},"key":"Bve3OgpiEF"},{"type":"paragraph","position":{"start":{"line":899,"column":1},"end":{"line":899,"column":1}},"children":[{"type":"text","value":"用 ","position":{"start":{"line":899,"column":1},"end":{"line":899,"column":1}},"key":"zjhbrBKgwY"},{"type":"inlineCode","value":"ob['bids'][0][0]","position":{"start":{"line":899,"column":1},"end":{"line":899,"column":1}},"key":"YfPooORmdG"},{"type":"text","value":" 可取最优买价，","position":{"start":{"line":899,"column":1},"end":{"line":899,"column":1}},"key":"ZrKIzUljFr"},{"type":"inlineCode","value":"ob['bids'][0][1]","position":{"start":{"line":899,"column":1},"end":{"line":899,"column":1}},"key":"Ek0x5w9LjX"},{"type":"text","value":" 为该价位数量。","position":{"start":{"line":899,"column":1},"end":{"line":899,"column":1}},"key":"V0fylPFzM0"}],"key":"L1hYy6Gg9O"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"回测注意","position":{"start":{"line":901,"column":1},"end":{"line":901,"column":1}},"key":"OMWLSDWv1t"}],"key":"ukK76W8Tof"},{"type":"paragraph","position":{"start":{"line":902,"column":1},"end":{"line":902,"column":1}},"children":[{"type":"text","value":"订单簿不是历史数据的一部分，这意味着如果使用此方法，回测和超参数优化将无法正常工作，因为该方法将返回最新值。","position":{"start":{"line":902,"column":1},"end":{"line":902,"column":1}},"key":"tTxGrym1Wb"}],"key":"gUkR9hArMc"}],"key":"UFcR7il01R"},{"type":"heading","depth":4,"position":{"start":{"line":905,"column":1},"end":{"line":905,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":905,"column":1},"end":{"line":905,"column":1}},"children":[{"type":"text","value":"ticker(pair)","position":{"start":{"line":905,"column":1},"end":{"line":905,"column":1}},"key":"ThztTO5LYS"}],"key":"afFXpHvgKu"}],"identifier":"ticker-pair","label":"ticker(pair)","html_id":"ticker-pair","implicit":true,"key":"aPQz2pJhD8"},{"type":"code","lang":"python","value":"if self.dp.runmode.value in ('live', 'dry_run'):\n    ticker = self.dp.ticker(metadata['pair'])\n    dataframe['last_price'] = ticker['last']\n    dataframe['volume24h'] = ticker['quoteVolume']\n    dataframe['vwap'] = ticker['vwap']","position":{"start":{"line":907,"column":1},"end":{"line":913,"column":1}},"key":"iZOEEo2wJY"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"hYs92oMZX7"}],"key":"Lwwygyyd7D"},{"type":"paragraph","position":{"start":{"line":916,"column":1},"end":{"line":916,"column":1}},"children":[{"type":"text","value":"虽然 ticker 数据结构是 ccxt 统一接口的一部分，但不同交易所返回的值可能会有所不同。例如，许多交易所不返回 ","position":{"start":{"line":916,"column":1},"end":{"line":916,"column":1}},"key":"GB7b0pYXRv"},{"type":"inlineCode","value":"vwap","position":{"start":{"line":916,"column":1},"end":{"line":916,"column":1}},"key":"tWon238fVC"},{"type":"text","value":" 值，一些交易所并不总是填充 ","position":{"start":{"line":916,"column":1},"end":{"line":916,"column":1}},"key":"VcFC2PlDwO"},{"type":"inlineCode","value":"last","position":{"start":{"line":916,"column":1},"end":{"line":916,"column":1}},"key":"qdLRAU1noN"},{"type":"text","value":" 字段（所以它可能为 None）等。因此，您需要仔细验证从交易所返回的 ticker 数据，并添加适当的错误处理/默认值。","position":{"start":{"line":916,"column":1},"end":{"line":916,"column":1}},"key":"lessmCNFga"}],"key":"RZgkNHgtYm"}],"key":"KVtDFAc95T"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"回测警告","position":{"start":{"line":919,"column":1},"end":{"line":919,"column":1}},"key":"rJuO6jyBdV"}],"key":"Dzw1vAkHjX"},{"type":"paragraph","position":{"start":{"line":920,"column":1},"end":{"line":920,"column":1}},"children":[{"type":"text","value":"此方法将始终返回最新/实时值。因此，在回测/超参数优化期间使用而不检查运行模式将导致错误的结果，例如，您的整个 dataframe 将在所有行中包含相同的单个值。","position":{"start":{"line":920,"column":1},"end":{"line":920,"column":1}},"key":"ttM7xJ7lTL"}],"key":"ElFlCt5R2X"}],"key":"Uu1wAlCzXp"},{"type":"heading","depth":4,"position":{"start":{"line":923,"column":1},"end":{"line":923,"column":1}},"children":[{"type":"text","value":"发送通知","position":{"start":{"line":923,"column":1},"end":{"line":923,"column":1}},"key":"JCPVhRlgVj"}],"identifier":"id","label":"发送通知","html_id":"id-17","implicit":true,"key":"V6XyqEXPlc"},{"type":"paragraph","position":{"start":{"line":925,"column":1},"end":{"line":926,"column":1}},"children":[{"type":"text","value":"dataprovider 的 ","position":{"start":{"line":925,"column":1},"end":{"line":925,"column":1}},"key":"oPMfuEZrlm"},{"type":"inlineCode","value":".send_msg()","position":{"start":{"line":925,"column":1},"end":{"line":925,"column":1}},"key":"gYhNeDokba"},{"type":"text","value":" 可在策略中发送自定义通知。\n相同的通知在每个蜡烛图期间只会发送一次，除非第二个参数（","position":{"start":{"line":925,"column":1},"end":{"line":925,"column":1}},"key":"eEPe0urSdP"},{"type":"inlineCode","value":"always_send","position":{"start":{"line":925,"column":1},"end":{"line":925,"column":1}},"key":"uFKPyG5XfR"},{"type":"text","value":"）设置为 True。","position":{"start":{"line":925,"column":1},"end":{"line":925,"column":1}},"key":"dkER893w2S"}],"key":"uCPbz9aRoX"},{"type":"code","lang":"python","value":"    self.dp.send_msg(f\"{metadata['pair']} just got hot!\")\n\n    # 强制发送此通知，避免缓存（请阅读下面的警告！）\n    self.dp.send_msg(f\"{metadata['pair']} just got hot!\", always_send=True)","position":{"start":{"line":928,"column":1},"end":{"line":933,"column":1}},"key":"k5ZBlX6f1J"},{"type":"paragraph","position":{"start":{"line":935,"column":1},"end":{"line":935,"column":1}},"children":[{"type":"text","value":"通知只会在交易模式（实盘/模拟盘）中发送 - 因此可以在回测中无条件调用此方法。","position":{"start":{"line":935,"column":1},"end":{"line":935,"column":1}},"key":"kJlBp0s72y"}],"key":"ZBmpvvHFhA"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"消息轰炸","position":{"start":{"line":937,"column":1},"end":{"line":937,"column":1}},"key":"OnseurwEF7"}],"key":"lF7DrvAGvv"},{"type":"paragraph","position":{"start":{"line":938,"column":1},"end":{"line":938,"column":1}},"children":[{"type":"text","value":"通过在此方法中设置 ","position":{"start":{"line":938,"column":1},"end":{"line":938,"column":1}},"key":"ewErFqr2Ru"},{"type":"inlineCode","value":"always_send=True","position":{"start":{"line":938,"column":1},"end":{"line":938,"column":1}},"key":"bIc48QZwn6"},{"type":"text","value":"，您可能会给自己发送大量消息。请谨慎使用此功能，并且只在您知道不会在整个蜡烛图期间频繁触发的情况下使用，以避免每5秒就收到一条消息。","position":{"start":{"line":938,"column":1},"end":{"line":938,"column":1}},"key":"Jq3i0MO8fU"}],"key":"LzXblypPns"}],"key":"qXeAqApBLA"},{"type":"heading","depth":4,"position":{"start":{"line":941,"column":1},"end":{"line":941,"column":1}},"children":[{"type":"text","value":"完整 DataProvider 示例","position":{"start":{"line":941,"column":1},"end":{"line":941,"column":1}},"key":"AjYX5yjMjU"}],"identifier":"id-dataprovider","label":"完整 DataProvider 示例","html_id":"id-dataprovider-1","implicit":true,"key":"ldAsZgOIAC"},{"type":"code","lang":"python","value":"from freqtrade.strategy import IStrategy, merge_informative_pair\nfrom pandas import DataFrame\n\nclass SampleStrategy(IStrategy):\n    # 策略初始化...\n\n    timeframe = '5m'\n\n    # ...\n\n    def informative_pairs(self):\n\n        # 获取白名单所有对\n        pairs = self.dp.current_whitelist()\n        # 为每个对分配周期\n        informative_pairs = [(pair, '1d') for pair in pairs]\n        # 可选：添加静态对\n        informative_pairs += [(\"ETH/USDT\", \"5m\"),\n                              (\"BTC/TUSD\", \"15m\"),\n                            ]\n        return informative_pairs\n\n    def populate_indicators(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n        if not self.dp:\n            # DataProvider 不可用时不做任何操作\n            return dataframe\n\n        inf_tf = '1d'\n        # 获取信息对\n        informative = self.dp.get_pair_dataframe(pair=metadata['pair'], timeframe=inf_tf)\n        # 获取14天RSI\n        informative['rsi'] = ta.RSI(informative, timeperiod=14)\n\n        # 使用辅助函数 merge_informative_pair 安全地合并交易对\n        # 自动重命名列并合并较短时间周期的 dataframe 和较长时间周期的信息对\n        # 使用 ffill 使1天的值在一天中的每一行都可用\n        # 如果没有这个，原始数据框和信息对的列之间的比较每天只能进行一次\n        # 此方法的完整文档，见下文\n        dataframe = merge_informative_pair(dataframe, informative, self.timeframe, inf_tf, ffill=True)\n\n        # 计算原始数据框的RSI（5分钟时间周期）\n        dataframe['rsi'] = ta.RSI(dataframe, timeperiod=14)\n\n        # 其他操作\n        # ...\n\n        return dataframe\n\n    def populate_entry_trend(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n\n        dataframe.loc[\n            (\n                (qtpylib.crossed_above(dataframe['rsi'], 30)) &  # RSI 上穿 30\n                (dataframe['rsi_1d'] < 30) &                     # 日线 RSI < 30\n                (dataframe['volume'] > 0)                        # 有成交量\n            ),\n            ['enter_long', 'enter_tag']] = (1, 'rsi_cross')\n","position":{"start":{"line":943,"column":1},"end":{"line":1002,"column":1}},"key":"ex5F8lZyn2"},{"type":"thematicBreak","position":{"start":{"line":1004,"column":1},"end":{"line":1004,"column":1}},"key":"Y2gv8VspdN"},{"type":"heading","depth":3,"position":{"start":{"line":1006,"column":1},"end":{"line":1006,"column":1}},"children":[{"type":"text","value":"额外数据（钱包 Wallets）","position":{"start":{"line":1006,"column":1},"end":{"line":1006,"column":1}},"key":"I6AZwlX1SW"}],"identifier":"id-wallets","label":"额外数据（钱包 Wallets）","html_id":"id-wallets","implicit":true,"key":"riuJQiHtHz"},{"type":"paragraph","position":{"start":{"line":1008,"column":1},"end":{"line":1008,"column":1}},"children":[{"type":"text","value":"策略可通过 ","position":{"start":{"line":1008,"column":1},"end":{"line":1008,"column":1}},"key":"ZqPpYPImAt"},{"type":"inlineCode","value":"wallets","position":{"start":{"line":1008,"column":1},"end":{"line":1008,"column":1}},"key":"gFdYKjwIkl"},{"type":"text","value":" 对象获取当前钱包/账户余额。","position":{"start":{"line":1008,"column":1},"end":{"line":1008,"column":1}},"key":"a0n9LzFltg"}],"key":"Ym1mDLnUcZ"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"回测/超参优化","position":{"start":{"line":1010,"column":1},"end":{"line":1010,"column":1}},"key":"RZoMYswugO"}],"key":"ILyru1rjLh"},{"type":"paragraph","position":{"start":{"line":1011,"column":1},"end":{"line":1011,"column":1}},"children":[{"type":"text","value":"Wallets 在不同函数中表现不同。","position":{"start":{"line":1011,"column":1},"end":{"line":1011,"column":1}},"key":"hfRhV5ibfI"}],"key":"SB9kXCzdz8"},{"type":"paragraph","position":{"start":{"line":1013,"column":1},"end":{"line":1013,"column":1}},"children":[{"type":"text","value":"在 ","position":{"start":{"line":1013,"column":1},"end":{"line":1013,"column":1}},"key":"MiK2Bi1Hqd"},{"type":"inlineCode","value":"populate_*()","position":{"start":{"line":1013,"column":1},"end":{"line":1013,"column":1}},"key":"X1HWSUt0II"},{"type":"text","value":" 方法中，返回完整钱包。","position":{"start":{"line":1013,"column":1},"end":{"line":1013,"column":1}},"key":"zqTColp7uD"}],"key":"tCxOfdRQNm"},{"type":"paragraph","position":{"start":{"line":1015,"column":1},"end":{"line":1015,"column":1}},"children":[{"type":"text","value":"在 ","position":{"start":{"line":1015,"column":1},"end":{"line":1015,"column":1}},"key":"a7lQeTG7jc"},{"type":"link","url":"/strategy-callbacks","position":{"start":{"line":1015,"column":1},"end":{"line":1015,"column":1}},"children":[{"type":"text","value":"回调函数","position":{"start":{"line":1015,"column":1},"end":{"line":1015,"column":1}},"key":"hOy5xMJUF7"}],"urlSource":"strategy-callbacks.md","dataUrl":"/strategy-callbacks.json","internal":true,"protocol":"file","key":"sD2nyTDWtz"},{"type":"text","value":" 中，返回当前模拟钱包状态。","position":{"start":{"line":1015,"column":1},"end":{"line":1015,"column":1}},"key":"zWKfkUoCYK"}],"key":"bcd4pSGUqy"}],"key":"pvpy2E9jFM"},{"type":"paragraph","position":{"start":{"line":1018,"column":1},"end":{"line":1018,"column":1}},"children":[{"type":"text","value":"调用前请检查 ","position":{"start":{"line":1018,"column":1},"end":{"line":1018,"column":1}},"key":"G22EeghWXS"},{"type":"inlineCode","value":"wallets","position":{"start":{"line":1018,"column":1},"end":{"line":1018,"column":1}},"key":"DWUCDNYq25"},{"type":"text","value":" 是否可用，避免回测时报错。","position":{"start":{"line":1018,"column":1},"end":{"line":1018,"column":1}},"key":"HJOiqGpYyZ"}],"key":"A2UdgTlW4A"},{"type":"code","lang":"python","value":"if self.wallets:\n    free_eth = self.wallets.get_free('ETH')\n    used_eth = self.wallets.get_used('ETH')\n    total_eth = self.wallets.get_total('ETH')","position":{"start":{"line":1020,"column":1},"end":{"line":1025,"column":1}},"key":"RUNQVMgIDI"},{"type":"heading","depth":4,"position":{"start":{"line":1027,"column":1},"end":{"line":1027,"column":1}},"children":[{"type":"text","value":"Wallets 可用方法","position":{"start":{"line":1027,"column":1},"end":{"line":1027,"column":1}},"key":"QPom76f7HQ"}],"identifier":"wallets","label":"Wallets 可用方法","html_id":"wallets","implicit":true,"key":"dRxe8IXdYX"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1029,"column":1},"end":{"line":1032,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1029,"column":1},"end":{"line":1029,"column":1}},"children":[{"type":"inlineCode","value":"get_free(asset)","position":{"start":{"line":1029,"column":1},"end":{"line":1029,"column":1}},"key":"gP9xIu7w3H"},{"type":"text","value":" - 当前可用余额","position":{"start":{"line":1029,"column":1},"end":{"line":1029,"column":1}},"key":"ZUqfdA3PUx"}],"key":"u6aUMHzDuQ"},{"type":"listItem","spread":true,"position":{"start":{"line":1030,"column":1},"end":{"line":1030,"column":1}},"children":[{"type":"inlineCode","value":"get_used(asset)","position":{"start":{"line":1030,"column":1},"end":{"line":1030,"column":1}},"key":"BWBmM5TJ9U"},{"type":"text","value":" - 当前被占用余额（挂单）","position":{"start":{"line":1030,"column":1},"end":{"line":1030,"column":1}},"key":"ASbOixHQsb"}],"key":"VWnOaBwghz"},{"type":"listItem","spread":true,"position":{"start":{"line":1031,"column":1},"end":{"line":1032,"column":1}},"children":[{"type":"inlineCode","value":"get_total(asset)","position":{"start":{"line":1031,"column":1},"end":{"line":1031,"column":1}},"key":"i2Q810v4G1"},{"type":"text","value":" - 总余额（前两者之和）","position":{"start":{"line":1031,"column":1},"end":{"line":1031,"column":1}},"key":"KDfIieDI4j"}],"key":"UfY3nlGMgF"}],"key":"EBFEnrhC4b"},{"type":"thematicBreak","position":{"start":{"line":1033,"column":1},"end":{"line":1033,"column":1}},"key":"c3gwWty3Xj"},{"type":"heading","depth":3,"position":{"start":{"line":1035,"column":1},"end":{"line":1035,"column":1}},"children":[{"type":"text","value":"额外数据（交易记录 Trades）","position":{"start":{"line":1035,"column":1},"end":{"line":1035,"column":1}},"key":"AwRXUwLTFO"}],"identifier":"id-trades","label":"额外数据（交易记录 Trades）","html_id":"id-trades","implicit":true,"key":"o63N6QmkWJ"},{"type":"paragraph","position":{"start":{"line":1037,"column":1},"end":{"line":1037,"column":1}},"children":[{"type":"text","value":"可在策略中通过数据库查询历史交易。","position":{"start":{"line":1037,"column":1},"end":{"line":1037,"column":1}},"key":"DX3nnMn49g"}],"key":"cjRPNW0JfY"},{"type":"paragraph","position":{"start":{"line":1039,"column":1},"end":{"line":1039,"column":1}},"children":[{"type":"text","value":"在文件顶部，导入所需对象：","position":{"start":{"line":1039,"column":1},"end":{"line":1039,"column":1}},"key":"jVesTEasN2"}],"key":"WbXsQqoZWd"},{"type":"code","lang":"python","value":"from freqtrade.persistence import Trade","position":{"start":{"line":1041,"column":1},"end":{"line":1043,"column":1}},"key":"mXPAFwvGKy"},{"type":"paragraph","position":{"start":{"line":1045,"column":1},"end":{"line":1045,"column":1}},"children":[{"type":"text","value":"以下示例查询当天当前对的已平仓交易（可加其他过滤条件）：","position":{"start":{"line":1045,"column":1},"end":{"line":1045,"column":1}},"key":"B1LAHh8eSt"}],"key":"j7yHCTlgLS"},{"type":"code","lang":"python","value":"trades = Trade.get_trades_proxy(pair=metadata['pair'],\n                                open_date=datetime.now(timezone.utc) - timedelta(days=1),\n                                is_open=False,\n            ]).order_by(Trade.close_date).all()\n# 汇总该交易对的利润\ncurdayprofit = sum(trade.close_profit for trade in trades)","position":{"start":{"line":1047,"column":1},"end":{"line":1054,"column":1}},"key":"rXjrav72Zw"},{"type":"paragraph","position":{"start":{"line":1056,"column":1},"end":{"line":1056,"column":1}},"children":[{"type":"text","value":"更多方法请查阅 ","position":{"start":{"line":1056,"column":1},"end":{"line":1056,"column":1}},"key":"y0KW8xfHde"},{"type":"link","url":"/trade-object","position":{"start":{"line":1056,"column":1},"end":{"line":1056,"column":1}},"children":[{"type":"text","value":"Trade 对象","position":{"start":{"line":1056,"column":1},"end":{"line":1056,"column":1}},"key":"JL7maW9YCZ"}],"urlSource":"trade-object.md","dataUrl":"/trade-object.json","internal":true,"protocol":"file","key":"KqYruOpBKr"},{"type":"text","value":" 文档。","position":{"start":{"line":1056,"column":1},"end":{"line":1056,"column":1}},"key":"VervRfK9kn"}],"key":"qPJVUJjo6R"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"QSiSAnVeaf"}],"key":"THGFkyRA9O"},{"type":"paragraph","position":{"start":{"line":1059,"column":1},"end":{"line":1059,"column":1}},"children":[{"type":"text","value":"回测/超参优化时，","position":{"start":{"line":1059,"column":1},"end":{"line":1059,"column":1}},"key":"eI4Bz3kab2"},{"type":"inlineCode","value":"populate_*","position":{"start":{"line":1059,"column":1},"end":{"line":1059,"column":1}},"key":"LMfEIecdo3"},{"type":"text","value":" 方法中无法获取交易历史，结果为空。","position":{"start":{"line":1059,"column":1},"end":{"line":1059,"column":1}},"key":"dQIEtWCbXK"}],"key":"zFqyolIPzP"}],"key":"KVVSEItl60"},{"type":"heading","depth":3,"position":{"start":{"line":1062,"column":1},"end":{"line":1062,"column":1}},"children":[{"type":"text","value":"阻止特定对交易","position":{"start":{"line":1062,"column":1},"end":{"line":1062,"column":1}},"key":"nPcBR6yoaU"}],"identifier":"id","label":"阻止特定对交易","html_id":"id-18","implicit":true,"key":"iGqFxwIVsz"},{"type":"paragraph","position":{"start":{"line":1064,"column":1},"end":{"line":1064,"column":1}},"children":[{"type":"text","value":"Freqtrade 会在某对平仓后自动锁定该对至当前K线结束，防止同一K线内频繁交易。","position":{"start":{"line":1064,"column":1},"end":{"line":1064,"column":1}},"key":"sQ2qDJQskq"}],"key":"XYWXJFCsZR"},{"type":"paragraph","position":{"start":{"line":1066,"column":1},"end":{"line":1066,"column":1}},"children":[{"type":"text","value":"锁定对时会提示 ","position":{"start":{"line":1066,"column":1},"end":{"line":1066,"column":1}},"key":"z1TtmSiuMG"},{"type":"inlineCode","value":"Pair <pair> is currently locked.","position":{"start":{"line":1066,"column":1},"end":{"line":1066,"column":1}},"key":"hmyBemxaY1"},{"type":"text","value":"。","position":{"start":{"line":1066,"column":1},"end":{"line":1066,"column":1}},"key":"Q7GmiktNnl"}],"key":"Rpst1eKPxq"},{"type":"heading","depth":4,"position":{"start":{"line":1068,"column":1},"end":{"line":1068,"column":1}},"children":[{"type":"text","value":"在策略中锁定对","position":{"start":{"line":1068,"column":1},"end":{"line":1068,"column":1}},"key":"mD2Fv5DBnW"}],"identifier":"id","label":"在策略中锁定对","html_id":"id-19","implicit":true,"key":"ZqCc5SahTi"},{"type":"paragraph","position":{"start":{"line":1070,"column":1},"end":{"line":1070,"column":1}},"children":[{"type":"text","value":"有时希望在特定事件后锁定某对（如连续亏损）。","position":{"start":{"line":1070,"column":1},"end":{"line":1070,"column":1}},"key":"MtdEgaYODH"}],"key":"J02PqEjY9D"},{"type":"paragraph","position":{"start":{"line":1072,"column":1},"end":{"line":1072,"column":1}},"children":[{"type":"text","value":"可用 ","position":{"start":{"line":1072,"column":1},"end":{"line":1072,"column":1}},"key":"YDG8UzV2T1"},{"type":"inlineCode","value":"self.lock_pair(pair, until, [reason])","position":{"start":{"line":1072,"column":1},"end":{"line":1072,"column":1}},"key":"IMOBfJUZai"},{"type":"text","value":" 实现，","position":{"start":{"line":1072,"column":1},"end":{"line":1072,"column":1}},"key":"bLEs1dLjsX"},{"type":"inlineCode","value":"until","position":{"start":{"line":1072,"column":1},"end":{"line":1072,"column":1}},"key":"t5yC66g46R"},{"type":"text","value":" 为未来时间点，","position":{"start":{"line":1072,"column":1},"end":{"line":1072,"column":1}},"key":"G8LJAS3EJR"},{"type":"inlineCode","value":"reason","position":{"start":{"line":1072,"column":1},"end":{"line":1072,"column":1}},"key":"pRYl8bX74R"},{"type":"text","value":" 为可选说明。","position":{"start":{"line":1072,"column":1},"end":{"line":1072,"column":1}},"key":"BJUJOXVolP"}],"key":"HWeIlmtSjr"},{"type":"paragraph","position":{"start":{"line":1074,"column":1},"end":{"line":1074,"column":1}},"children":[{"type":"text","value":"可用 ","position":{"start":{"line":1074,"column":1},"end":{"line":1074,"column":1}},"key":"McYa9s7hAV"},{"type":"inlineCode","value":"self.unlock_pair(pair)","position":{"start":{"line":1074,"column":1},"end":{"line":1074,"column":1}},"key":"K2Ol8JTmQd"},{"type":"text","value":" 或 ","position":{"start":{"line":1074,"column":1},"end":{"line":1074,"column":1}},"key":"BBGz6V1EGk"},{"type":"inlineCode","value":"self.unlock_reason(<reason>)","position":{"start":{"line":1074,"column":1},"end":{"line":1074,"column":1}},"key":"BniVf6jyAx"},{"type":"text","value":" 手动解锁，后者会解锁所有因该原因锁定的对。","position":{"start":{"line":1074,"column":1},"end":{"line":1074,"column":1}},"key":"GmLaMI8n5T"}],"key":"xaxqsEepdt"},{"type":"paragraph","position":{"start":{"line":1076,"column":1},"end":{"line":1076,"column":1}},"children":[{"type":"text","value":"用 ","position":{"start":{"line":1076,"column":1},"end":{"line":1076,"column":1}},"key":"vdTelMkU4E"},{"type":"inlineCode","value":"self.is_pair_locked(pair)","position":{"start":{"line":1076,"column":1},"end":{"line":1076,"column":1}},"key":"uSEr5oBmeU"},{"type":"text","value":" 检查对是否被锁定。","position":{"start":{"line":1076,"column":1},"end":{"line":1076,"column":1}},"key":"K24PLMSjLc"}],"key":"MVnZWlSJQU"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"DIMd3gImVA"}],"key":"n65WeW26iC"},{"type":"paragraph","position":{"start":{"line":1079,"column":1},"end":{"line":1079,"column":1}},"children":[{"type":"text","value":"锁定会自动延长到下一个K线结束。如 5m 周期，锁到 10:18 会延长到 10:20。","position":{"start":{"line":1079,"column":1},"end":{"line":1079,"column":1}},"key":"SwkOl6hpEY"}],"key":"f8Eb4S1PNo"}],"key":"yicAdXvz2S"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"LJmwkKOSix"}],"key":"RS7Ev8htLJ"},{"type":"paragraph","position":{"start":{"line":1083,"column":1},"end":{"line":1083,"column":1}},"children":[{"type":"text","value":"手动锁定仅在实盘/模拟盘可用，回测时仅保护机制可锁定。","position":{"start":{"line":1083,"column":1},"end":{"line":1083,"column":1}},"key":"v8NFikrPGr"}],"key":"Hvim1vb2Fd"}],"key":"P1oHFPJsNb"},{"type":"heading","depth":5,"position":{"start":{"line":1086,"column":1},"end":{"line":1086,"column":1}},"children":[{"type":"text","value":"锁定对示例","position":{"start":{"line":1086,"column":1},"end":{"line":1086,"column":1}},"key":"SMZ056Al4M"}],"identifier":"id","label":"锁定对示例","html_id":"id-20","implicit":true,"key":"kYsQJNCESW"},{"type":"code","lang":"python","value":"from freqtrade.persistence import Trade\nfrom datetime import timedelta, datetime, timezone\n# 放在策略文件顶部\n# --------\n\n# 在 populate_indicators 或 populate_entry_trend 中：\nif self.config['runmode'].value in ('live', 'dry_run'):\n    # 查询近两天已平仓交易\n    trades = Trade.get_trades_proxy(\n        pair=metadata['pair'], is_open=False, \n        open_date=datetime.now(timezone.utc) - timedelta(days=2))\n    # 分析是否需要锁定\n    sumprofit = sum(trade.close_profit for trade in trades)\n    if sumprofit < 0:\n        # 锁定 12 小时\n        self.lock_pair(metadata['pair'], until=datetime.now(timezone.utc) + timedelta(hours=12))","position":{"start":{"line":1088,"column":1},"end":{"line":1105,"column":1}},"key":"ETKCK50Cb2"},{"type":"heading","depth":3,"position":{"start":{"line":1107,"column":1},"end":{"line":1107,"column":1}},"children":[{"type":"text","value":"打印主 dataframe","position":{"start":{"line":1107,"column":1},"end":{"line":1107,"column":1}},"key":"PjIe7eWXd2"}],"identifier":"id-dataframe","label":"打印主 dataframe","html_id":"id-dataframe","implicit":true,"key":"vZkBEyoaIe"},{"type":"paragraph","position":{"start":{"line":1109,"column":1},"end":{"line":1109,"column":1}},"children":[{"type":"text","value":"可在 ","position":{"start":{"line":1109,"column":1},"end":{"line":1109,"column":1}},"key":"Sf3L72XuP7"},{"type":"inlineCode","value":"populate_entry_trend()","position":{"start":{"line":1109,"column":1},"end":{"line":1109,"column":1}},"key":"nNYzURUw99"},{"type":"text","value":" 或 ","position":{"start":{"line":1109,"column":1},"end":{"line":1109,"column":1}},"key":"uYSegYhBMn"},{"type":"inlineCode","value":"populate_exit_trend()","position":{"start":{"line":1109,"column":1},"end":{"line":1109,"column":1}},"key":"vG2U7yV0TY"},{"type":"text","value":" 中打印当前主 dataframe，便于调试。","position":{"start":{"line":1109,"column":1},"end":{"line":1109,"column":1}},"key":"SD13ddJP5F"}],"key":"gMLptm9OIs"},{"type":"code","lang":"python","value":"def populate_entry_trend(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n    dataframe.loc[\n        (\n            #>> 你的条件 <<<\n        ),\n        ['enter_long', 'enter_tag']] = (1, 'somestring')\n\n    # 打印分析的对\n    print(f\"result for {metadata['pair']}\")\n\n    # 打印最后 5 行\n    print(dataframe.tail())\n\n    return dataframe","position":{"start":{"line":1111,"column":1},"end":{"line":1126,"column":1}},"key":"OrxTys6UeL"},{"type":"paragraph","position":{"start":{"line":1128,"column":1},"end":{"line":1128,"column":1}},"children":[{"type":"text","value":"如需打印更多行可用 ","position":{"start":{"line":1128,"column":1},"end":{"line":1128,"column":1}},"key":"fFqH67R7m9"},{"type":"inlineCode","value":"print(dataframe)","position":{"start":{"line":1128,"column":1},"end":{"line":1128,"column":1}},"key":"Cz86TI0nxW"},{"type":"text","value":"，但不建议，否则每对每 5 秒会输出约 500 行。","position":{"start":{"line":1128,"column":1},"end":{"line":1128,"column":1}},"key":"Jwq31JkdC8"}],"key":"US1n383S8B"},{"type":"heading","depth":3,"position":{"start":{"line":1130,"column":1},"end":{"line":1130,"column":1}},"children":[{"type":"text","value":"开发策略时的常见错误","position":{"start":{"line":1130,"column":1},"end":{"line":1130,"column":1}},"key":"lbk9fYeRKe"}],"identifier":"id","label":"开发策略时的常见错误","html_id":"id-21","implicit":true,"key":"bpOv7BSmVV"},{"type":"heading","depth":4,"position":{"start":{"line":1132,"column":1},"end":{"line":1132,"column":1}},"children":[{"type":"text","value":"回测时\"看未来\"","position":{"start":{"line":1132,"column":1},"end":{"line":1132,"column":1}},"key":"uTp1RtKocc"}],"identifier":"id","label":"回测时\"看未来\"","html_id":"id-22","implicit":true,"key":"eEYHz8Sgqn"},{"type":"paragraph","position":{"start":{"line":1134,"column":1},"end":{"line":1134,"column":1}},"children":[{"type":"text","value":"回测为提升性能会一次性分析整个 dataframe。策略作者需确保不\"看未来\"，即不使用 dry/live 时不可用的数据。","position":{"start":{"line":1134,"column":1},"end":{"line":1134,"column":1}},"key":"HDfOH0wJ8R"}],"key":"p9Xi6kM5WT"},{"type":"paragraph","position":{"start":{"line":1136,"column":1},"end":{"line":1136,"column":1}},"children":[{"type":"text","value":"这是常见痛点，易导致回测与 dry/live 巨大差异。看未来的策略回测时表现极佳，实盘却很差。","position":{"start":{"line":1136,"column":1},"end":{"line":1136,"column":1}},"key":"I9Ln6QjCqW"}],"key":"ZwcEjRgLVk"},{"type":"paragraph","position":{"start":{"line":1138,"column":1},"end":{"line":1138,"column":1}},"children":[{"type":"text","value":"常见错误包括：","position":{"start":{"line":1138,"column":1},"end":{"line":1138,"column":1}},"key":"FDrKnchF3c"}],"key":"u32z2Zzn9o"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1140,"column":1},"end":{"line":1145,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1140,"column":1},"end":{"line":1140,"column":1}},"children":[{"type":"text","value":"不要用 ","position":{"start":{"line":1140,"column":1},"end":{"line":1140,"column":1}},"key":"M8l1ziDqaQ"},{"type":"inlineCode","value":"shift(-1)","position":{"start":{"line":1140,"column":1},"end":{"line":1140,"column":1}},"key":"fgaCND3aQf"},{"type":"text","value":" 或负数，这会用到未来数据","position":{"start":{"line":1140,"column":1},"end":{"line":1140,"column":1}},"key":"ojBckcqQkB"}],"key":"yxV30vlR7c"},{"type":"listItem","spread":true,"position":{"start":{"line":1141,"column":1},"end":{"line":1141,"column":1}},"children":[{"type":"text","value":"不要在 ","position":{"start":{"line":1141,"column":1},"end":{"line":1141,"column":1}},"key":"oEUXRwrRoe"},{"type":"inlineCode","value":"populate_","position":{"start":{"line":1141,"column":1},"end":{"line":1141,"column":1}},"key":"Xe23yWm4rB"},{"type":"text","value":" 函数中用 ","position":{"start":{"line":1141,"column":1},"end":{"line":1141,"column":1}},"key":"fzJwNtXmJS"},{"type":"inlineCode","value":".iloc[-1]","position":{"start":{"line":1141,"column":1},"end":{"line":1141,"column":1}},"key":"rLVqw4BzkM"},{"type":"text","value":" 或其他绝对位置，dry-run 和回测时表现不同。回调函数中可安全用 iloc","position":{"start":{"line":1141,"column":1},"end":{"line":1141,"column":1}},"key":"x2H27JF2p1"}],"key":"t5ZkcZK29N"},{"type":"listItem","spread":true,"position":{"start":{"line":1142,"column":1},"end":{"line":1142,"column":1}},"children":[{"type":"text","value":"不要用 ","position":{"start":{"line":1142,"column":1},"end":{"line":1142,"column":1}},"key":"hi9yaWcaE0"},{"type":"inlineCode","value":"dataframe['mean_volume'] = dataframe['volume'].mean()","position":{"start":{"line":1142,"column":1},"end":{"line":1142,"column":1}},"key":"Itb6KNsxzE"},{"type":"text","value":" 这类全列函数，回测时会用到未来数据。应用 rolling() 计算，如 ","position":{"start":{"line":1142,"column":1},"end":{"line":1142,"column":1}},"key":"SI9M5gLMli"},{"type":"inlineCode","value":"dataframe['volume'].rolling(<window>).mean()","position":{"start":{"line":1142,"column":1},"end":{"line":1142,"column":1}},"key":"A4SA1RVlZJ"}],"key":"m37JsGwgPt"},{"type":"listItem","spread":true,"position":{"start":{"line":1143,"column":1},"end":{"line":1143,"column":1}},"children":[{"type":"text","value":"不要用 ","position":{"start":{"line":1143,"column":1},"end":{"line":1143,"column":1}},"key":"jHf3jXIwfu"},{"type":"inlineCode","value":".resample('1h')","position":{"start":{"line":1143,"column":1},"end":{"line":1143,"column":1}},"key":"wIiwJqvUFP"},{"type":"text","value":"，这会用左边界，应用 ","position":{"start":{"line":1143,"column":1},"end":{"line":1143,"column":1}},"key":"ojKQdNFa8L"},{"type":"inlineCode","value":".resample('1h', label='right')","position":{"start":{"line":1143,"column":1},"end":{"line":1143,"column":1}},"key":"uXW1hZ2Gx6"}],"key":"slPDdVA3mR"},{"type":"listItem","spread":true,"position":{"start":{"line":1144,"column":1},"end":{"line":1145,"column":1}},"children":[{"type":"text","value":"不要用 ","position":{"start":{"line":1144,"column":1},"end":{"line":1144,"column":1}},"key":"i2Otv6zsnL"},{"type":"inlineCode","value":".merge()","position":{"start":{"line":1144,"column":1},"end":{"line":1144,"column":1}},"key":"myoyQCeY7J"},{"type":"text","value":" 合并大周期到小周期，应用 ","position":{"start":{"line":1144,"column":1},"end":{"line":1144,"column":1}},"key":"o4mkv2AvGj"},{"type":"link","url":"#%E8%BE%85%E5%8A%A9%E4%BA%A4%E6%98%93%E5%AF%B9","position":{"start":{"line":1144,"column":1},"end":{"line":1144,"column":1}},"children":[{"type":"text","value":"informative pair","position":{"start":{"line":1144,"column":1},"end":{"line":1144,"column":1}},"key":"vI3i9mht4M"}],"urlSource":"#%E8%BE%85%E5%8A%A9%E4%BA%A4%E6%98%93%E5%AF%B9","key":"Ai75AqNB6L"},{"type":"text","value":" 工具。普通 merge 会有前视偏差","position":{"start":{"line":1144,"column":1},"end":{"line":1144,"column":1}},"key":"rPwoJYgx7Z"}],"key":"LNrDQKMDiD"}],"key":"gxYgrozX7u"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"如何发现问题","position":{"start":{"line":1146,"column":1},"end":{"line":1146,"column":1}},"key":"Vwwzk9prf6"}],"key":"gAUo3vEQIm"},{"type":"paragraph","position":{"start":{"line":1147,"column":1},"end":{"line":1147,"column":1}},"children":[{"type":"text","value":"建议用 ","position":{"start":{"line":1147,"column":1},"end":{"line":1147,"column":1}},"key":"wZEzEA8zmT"},{"type":"link","url":"/lookahead-analysis","position":{"start":{"line":1147,"column":1},"end":{"line":1147,"column":1}},"children":[{"type":"text","value":"lookahead-analysis","position":{"start":{"line":1147,"column":1},"end":{"line":1147,"column":1}},"key":"l1FjzFZLjJ"}],"urlSource":"lookahead-analysis.md","dataUrl":"/lookahead-analysis.json","internal":true,"protocol":"file","key":"RNevWwYwYA"},{"type":"text","value":" 和 ","position":{"start":{"line":1147,"column":1},"end":{"line":1147,"column":1}},"key":"pOAp5M0xyB"},{"type":"link","url":"/recursive-analysis","position":{"start":{"line":1147,"column":1},"end":{"line":1147,"column":1}},"children":[{"type":"text","value":"recursive-analysis","position":{"start":{"line":1147,"column":1},"end":{"line":1147,"column":1}},"key":"x3SxJ78rI8"}],"urlSource":"recursive-analysis.md","dataUrl":"/recursive-analysis.json","internal":true,"protocol":"file","key":"xs3FCBaHSl"},{"type":"text","value":" 两个工具辅助排查。","position":{"start":{"line":1147,"column":1},"end":{"line":1147,"column":1}},"key":"XJQ99EtdOL"}],"key":"fbK00sl6WK"},{"type":"paragraph","position":{"start":{"line":1149,"column":1},"end":{"line":1149,"column":1}},"children":[{"type":"text","value":"但两者都不能保证完全无误。","position":{"start":{"line":1149,"column":1},"end":{"line":1149,"column":1}},"key":"M4H5TpLLtr"}],"key":"zh5u2KUUDa"}],"key":"xk9H1QxDld"},{"type":"heading","depth":4,"position":{"start":{"line":1152,"column":1},"end":{"line":1152,"column":1}},"children":[{"type":"text","value":"信号冲突","position":{"start":{"line":1152,"column":1},"end":{"line":1152,"column":1}},"key":"UfwFOXkL38"}],"identifier":"id","label":"信号冲突","html_id":"id-23","implicit":true,"key":"VwXbwaewmh"},{"type":"paragraph","position":{"start":{"line":1154,"column":1},"end":{"line":1154,"column":1}},"children":[{"type":"text","value":"当信号冲突（如 ","position":{"start":{"line":1154,"column":1},"end":{"line":1154,"column":1}},"key":"DDqX8Rvlrg"},{"type":"inlineCode","value":"enter_long","position":{"start":{"line":1154,"column":1},"end":{"line":1154,"column":1}},"key":"GGGkmhVYxz"},{"type":"text","value":" 和 ","position":{"start":{"line":1154,"column":1},"end":{"line":1154,"column":1}},"key":"ETfbzRbOgv"},{"type":"inlineCode","value":"exit_long","position":{"start":{"line":1154,"column":1},"end":{"line":1154,"column":1}},"key":"OCTNjZ4PxT"},{"type":"text","value":" 同时为 1）时，freqtrade 会忽略入场信号，避免刚进场就立刻出场。","position":{"start":{"line":1154,"column":1},"end":{"line":1154,"column":1}},"key":"xSKcRRHC0Z"}],"key":"Nij3UKYVyb"},{"type":"paragraph","position":{"start":{"line":1156,"column":1},"end":{"line":1156,"column":1}},"children":[{"type":"text","value":"规则如下，若 3 个信号中有多个为 1，则忽略入场：","position":{"start":{"line":1156,"column":1},"end":{"line":1156,"column":1}},"key":"qgWZW47KiN"}],"key":"aCvBhSqkqt"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1158,"column":1},"end":{"line":1160,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1158,"column":1},"end":{"line":1158,"column":1}},"children":[{"type":"inlineCode","value":"enter_long","position":{"start":{"line":1158,"column":1},"end":{"line":1158,"column":1}},"key":"XYV3sRf4v3"},{"type":"text","value":" -> ","position":{"start":{"line":1158,"column":1},"end":{"line":1158,"column":1}},"key":"Cdq42QRfVM"},{"type":"inlineCode","value":"exit_long","position":{"start":{"line":1158,"column":1},"end":{"line":1158,"column":1}},"key":"RovyDi5EUW"},{"type":"text","value":", ","position":{"start":{"line":1158,"column":1},"end":{"line":1158,"column":1}},"key":"nHDhWXdE3M"},{"type":"inlineCode","value":"enter_short","position":{"start":{"line":1158,"column":1},"end":{"line":1158,"column":1}},"key":"kvSB51v3Y6"}],"key":"fbXldB3isb"},{"type":"listItem","spread":true,"position":{"start":{"line":1159,"column":1},"end":{"line":1160,"column":1}},"children":[{"type":"inlineCode","value":"enter_short","position":{"start":{"line":1159,"column":1},"end":{"line":1159,"column":1}},"key":"rZhrhMdbAr"},{"type":"text","value":" -> ","position":{"start":{"line":1159,"column":1},"end":{"line":1159,"column":1}},"key":"EampOL2qRz"},{"type":"inlineCode","value":"exit_short","position":{"start":{"line":1159,"column":1},"end":{"line":1159,"column":1}},"key":"D8H1XZcjmq"},{"type":"text","value":", ","position":{"start":{"line":1159,"column":1},"end":{"line":1159,"column":1}},"key":"bWsYGmw85M"},{"type":"inlineCode","value":"enter_long","position":{"start":{"line":1159,"column":1},"end":{"line":1159,"column":1}},"key":"U4lXUgkI9t"}],"key":"o24spcjIhU"}],"key":"PhhwYMz8Ua"},{"type":"heading","depth":3,"position":{"start":{"line":1161,"column":1},"end":{"line":1161,"column":1}},"children":[{"type":"text","value":"更多策略思路","position":{"start":{"line":1161,"column":1},"end":{"line":1161,"column":1}},"key":"E9mIWPPjXX"}],"identifier":"id","label":"更多策略思路","html_id":"id-24","implicit":true,"key":"UqdDBKRKNx"},{"type":"paragraph","position":{"start":{"line":1163,"column":1},"end":{"line":1163,"column":1}},"children":[{"type":"text","value":"如需更多策略思路，请访问 ","position":{"start":{"line":1163,"column":1},"end":{"line":1163,"column":1}},"key":"rtLJucUozr"},{"type":"link","url":"https://github.com/freqtrade/freqtrade-strategies","position":{"start":{"line":1163,"column":1},"end":{"line":1163,"column":1}},"children":[{"type":"text","value":"策略仓库","position":{"start":{"line":1163,"column":1},"end":{"line":1163,"column":1}},"key":"T4lHvJ18Az"}],"urlSource":"https://github.com/freqtrade/freqtrade-strategies","error":true,"key":"l44G01OvcQ"},{"type":"text","value":"。可作为学习参考，实际效果取决于市场、交易对等。请务必先回测，再 dry-run，谨慎实盘。","position":{"start":{"line":1163,"column":1},"end":{"line":1163,"column":1}},"key":"w6NfUoMMGy"}],"key":"fzdiMe5k3v"},{"type":"paragraph","position":{"start":{"line":1165,"column":1},"end":{"line":1165,"column":1}},"children":[{"type":"text","value":"欢迎参考、改编，也欢迎向仓库提交新策略 PR。","position":{"start":{"line":1165,"column":1},"end":{"line":1165,"column":1}},"key":"bhQpoV7bTo"}],"key":"BFOZ1YEFTS"},{"type":"heading","depth":3,"position":{"start":{"line":1167,"column":1},"end":{"line":1167,"column":1}},"children":[{"type":"text","value":"下一步","position":{"start":{"line":1167,"column":1},"end":{"line":1167,"column":1}},"key":"IY0VJ5x2ZF"}],"identifier":"id","label":"下一步","html_id":"id-25","implicit":true,"key":"vZcwBpQSOw"},{"type":"paragraph","position":{"start":{"line":1169,"column":1},"end":{"line":1169,"column":1}},"children":[{"type":"text","value":"现在你已经有了完美的策略，下一步请学习","position":{"start":{"line":1169,"column":1},"end":{"line":1169,"column":1}},"key":"IjJJC3r1ne"},{"type":"link","url":"/backtesting","position":{"start":{"line":1169,"column":1},"end":{"line":1169,"column":1}},"children":[{"type":"text","value":"如何回测","position":{"start":{"line":1169,"column":1},"end":{"line":1169,"column":1}},"key":"LPgYG1F0rP"}],"urlSource":"backtesting.md","dataUrl":"/backtesting.json","internal":true,"protocol":"file","key":"of4js9lDHh"},{"type":"text","value":"。","position":{"start":{"line":1169,"column":1},"end":{"line":1169,"column":1}},"key":"vQNap9WaaA"}],"key":"stfU6BEKSO"}],"key":"ZhTRIzV1VA"}],"key":"Wr2wtyfmiK"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Freqtrade 策略开发指南","short_title":"策略开发指南","url":"/strategy-101","group":"安装"},"next":{"title":"策略回调指南","short_title":"策略回调","url":"/strategy-callbacks","group":"安装"}}},"domain":"http://localhost:3001"}