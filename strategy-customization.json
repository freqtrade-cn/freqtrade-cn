{"version":2,"kind":"Article","sha256":"24b1a0fb6cfda330b5d66717675e86f534b0d9715510089a4f992feda16b8af4","slug":"strategy-customization","location":"/strategy-customization.md","dependencies":[],"frontmatter":{"title":"策略自定义指南","description":"本文档介绍如何在 Freqtrade 中自定义交易策略,包括添加新指标、设置交易规则等内容。","short_title":"策略自定义","subtitle":"如何开发自己的交易策略","tags":["策略开发","自定义","指标","交易规则","编程"],"subject":"Freqtrade 策略开发","authors":[{"id":"Freqtrade","name":"Freqtrade"}],"github":"https://github.com/freqtrade-cn/docs_zh-CN","keywords":["Freqtrade","中文文档","交易机器人","量化交易","加密货币","数字货币","区块链","人工智能","机器学习"],"edit_url":"https://github.com/freqtrade-cn/docs_zh-CN/blob/main/strategy-customization.md","exports":[{"format":"md","filename":"strategy-customization.md","url":"/build/strategy-customizati-3765b0778011f76034060803b1ac7ecc.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"策略自定义","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"Eoga8smLQy"}],"identifier":"id","label":"策略自定义","html_id":"id","implicit":true,"key":"JIjUd5nHOP"},{"type":"paragraph","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"本页将介绍如何自定义你的策略、添加新指标以及设置交易规则。","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"kpaXDmhzO4"}],"key":"yhOCJHl9WD"},{"type":"paragraph","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"如果你还没有了解过，建议先阅读：","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"nKzAudfN2g"}],"key":"iaYzs7HUq7"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":24,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"link","url":"/strategy-101","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"Freqtrade 策略 101","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"tBKF8gXrmZ"}],"urlSource":"strategy-101.md","dataUrl":"/strategy-101.json","internal":true,"protocol":"file","key":"giMzXQYEOl"},{"type":"text","value":"，快速入门策略开发","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"WIjCar1Rjk"}],"key":"xG6flXr0tA"},{"type":"listItem","spread":true,"position":{"start":{"line":25,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"link","url":"/bot-basics","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"Freqtrade 机器人基础","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"xlijJWnTXt"}],"urlSource":"bot-basics.md","dataUrl":"/bot-basics.json","internal":true,"protocol":"file","key":"EF9sXaM5fH"},{"type":"text","value":"，了解机器人整体运行机制","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"AjIPl25DbD"}],"key":"V0iCfgFq64"}],"key":"uMcYGhI1jK"},{"type":"heading","depth":3,"position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"开发你自己的策略","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"KTBgltZFas"}],"identifier":"id","label":"开发你自己的策略","html_id":"id-1","implicit":true,"key":"mLtmbbEP9b"},{"type":"paragraph","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"text","value":"机器人自带了一个默认策略文件。","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"kK2Uu9l2qs"}],"key":"NJaUB6fkZR"},{"type":"paragraph","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"text","value":"此外，","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"YTr5fUOJPL"},{"type":"link","url":"https://github.com/freqtrade/freqtrade-strategies","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"text","value":"策略仓库","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"NT31scTFPX"}],"urlSource":"https://github.com/freqtrade/freqtrade-strategies","error":true,"key":"fAAtEDMtdb"},{"type":"text","value":"中还提供了其他策略。","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"M2o8JeG8T8"}],"key":"XsDD0Idz2t"},{"type":"paragraph","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"text","value":"不过你很可能有自己的策略想法。本文档旨在帮助你将想法转化为可运行的策略。","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"SmSTaWz2hK"}],"key":"zpFL6MYN3L"},{"type":"heading","depth":4,"position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"text","value":"生成策略模板","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"XesJhj2zA5"}],"identifier":"id","label":"生成策略模板","html_id":"id-2","implicit":true,"key":"YkMiPCAzM3"},{"type":"paragraph","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"text","value":"你可以通过以下命令快速开始：","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"J7LEH1a6UR"}],"key":"P6dn1M4oUg"},{"type":"code","lang":"bash","value":"freqtrade new-strategy --strategy AwesomeStrategy","position":{"start":{"line":39,"column":1},"end":{"line":41,"column":1}},"key":"YQyE7OXmtU"},{"type":"paragraph","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"children":[{"type":"text","value":"这会基于模板创建一个名为 ","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"VKpL4jNfMZ"},{"type":"inlineCode","value":"AwesomeStrategy","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"boR5HwSJUS"},{"type":"text","value":" 的新策略，文件路径为 ","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"o80APQEThw"},{"type":"inlineCode","value":"user_data/strategies/AwesomeStrategy.py","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"opser7z85Q"},{"type":"text","value":"。","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"XgZG7h7vyR"}],"key":"OIOOpbRn2a"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"名称区别","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"key":"k9dTgFFkfV"}],"key":"jwL5uDPUjj"},{"type":"paragraph","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"children":[{"type":"text","value":"策略的","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"qcI4GnJxHR"},{"type":"emphasis","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"children":[{"type":"text","value":"名称","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"A3lyvOR8wG"}],"key":"Yhwd0iqtmf"},{"type":"text","value":"和文件名是有区别的。大多数命令中，Freqtrade 使用的是","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"nz1YL7emAV"},{"type":"emphasis","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"children":[{"type":"text","value":"策略类名","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"m5HNUo7EHT"}],"key":"ciBAF1Tf5h"},{"type":"text","value":"，而不是文件名。","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"QQPjogq87N"}],"key":"qNcWizT98A"},{"type":"paragraph","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"children":[{"type":"inlineCode","value":"new-strategy","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"VRxHwadomm"},{"type":"text","value":" 命令生成的示例策略并不会直接盈利。","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"exf3bK6KNN"}],"key":"d3sJDU7eJm"}],"key":"cn4hVxoNuN"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"不同模板级别","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"key":"ezN54C0lM0"}],"key":"rBKv1c680J"},{"type":"paragraph","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"children":[{"type":"inlineCode","value":"freqtrade new-strategy","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"key":"hHup0156hs"},{"type":"text","value":" 有一个额外参数 ","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"key":"VLPqyOnIBu"},{"type":"inlineCode","value":"--template","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"key":"CYXBIVw08n"},{"type":"text","value":"，可控制生成策略的复杂程度。用 ","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"key":"LaGtCE1UNN"},{"type":"inlineCode","value":"--template minimal","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"key":"WRds1Zbpld"},{"type":"text","value":" 可获得一个空白策略，无任何指标示例；用 ","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"key":"CvSPNdfLGJ"},{"type":"inlineCode","value":"--template advanced","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"key":"BauGBwJ3kn"},{"type":"text","value":" 可获得包含更多复杂特性的模板。","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"key":"gIAs9F3wj9"}],"key":"Kk2ts1BcWb"}],"key":"howEkdGPPs"},{"type":"heading","depth":4,"position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"children":[{"type":"text","value":"策略结构剖析","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"key":"a8wcGDH761"}],"identifier":"id","label":"策略结构剖析","html_id":"id-3","implicit":true,"key":"SSH8E8yID5"},{"type":"paragraph","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"children":[{"type":"text","value":"一个策略文件包含构建策略逻辑所需的全部信息：","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"kPlLWFJA9n"}],"key":"fFDvEpTEbl"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":59,"column":1},"end":{"line":73,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"children":[{"type":"text","value":"K线数据（OHLCV 格式）","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"key":"iNB1TTyFKX"}],"key":"TnE36eeB1t"},{"type":"listItem","spread":true,"position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"children":[{"type":"text","value":"各类指标","position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"key":"BfIDSIjaT2"}],"key":"uBLc2DJQgc"},{"type":"listItem","spread":true,"position":{"start":{"line":61,"column":1},"end":{"line":62,"column":1}},"children":[{"type":"text","value":"入场逻辑","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"kMQ3nAaItM"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"children":[{"type":"text","value":"信号","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"SY9nsuvR5Z"}],"key":"XhBYRIXN7f"}],"key":"SlqVdvik3F"}],"key":"Z5vED1yRX6"},{"type":"listItem","spread":true,"position":{"start":{"line":63,"column":1},"end":{"line":66,"column":1}},"children":[{"type":"text","value":"出场逻辑","position":{"start":{"line":63,"column":1},"end":{"line":63,"column":1}},"key":"oyQuhhqTl2"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":64,"column":1},"end":{"line":66,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"children":[{"type":"text","value":"信号","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"key":"ZLo3qgwTCs"}],"key":"pyz0byA61i"},{"type":"listItem","spread":true,"position":{"start":{"line":65,"column":1},"end":{"line":65,"column":1}},"children":[{"type":"text","value":"最小收益率（ROI）","position":{"start":{"line":65,"column":1},"end":{"line":65,"column":1}},"key":"RHaNzL5XdI"}],"key":"sFfXBy3wbd"},{"type":"listItem","spread":true,"position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"children":[{"type":"text","value":"回调函数（自定义函数）","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"key":"St8sQuSxWk"}],"key":"WTAwkyWZkc"}],"key":"TUyyqPC9QJ"}],"key":"SK0XQX0BvS"},{"type":"listItem","spread":true,"position":{"start":{"line":67,"column":1},"end":{"line":70,"column":1}},"children":[{"type":"text","value":"止损","position":{"start":{"line":67,"column":1},"end":{"line":67,"column":1}},"key":"Vlbkff7sIa"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":68,"column":1},"end":{"line":70,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"children":[{"type":"text","value":"固定/绝对止损","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"PQ9C3DyDSs"}],"key":"dnoqVEMZpb"},{"type":"listItem","spread":true,"position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"children":[{"type":"text","value":"跟踪止损","position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"key":"Y9FMl94FmG"}],"key":"XbnWGRG9uv"},{"type":"listItem","spread":true,"position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"children":[{"type":"text","value":"回调函数（自定义函数）","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"ivepdsuWH4"}],"key":"mOiDnxqu59"}],"key":"XCzR3m8fxZ"}],"key":"gWY2fFIXsE"},{"type":"listItem","spread":true,"position":{"start":{"line":71,"column":1},"end":{"line":71,"column":1}},"children":[{"type":"text","value":"定价（可选）","position":{"start":{"line":71,"column":1},"end":{"line":71,"column":1}},"key":"adPrDn5jYX"}],"key":"Zx4yKLBSwH"},{"type":"listItem","spread":true,"position":{"start":{"line":72,"column":1},"end":{"line":73,"column":1}},"children":[{"type":"text","value":"持仓调整（可选）","position":{"start":{"line":72,"column":1},"end":{"line":72,"column":1}},"key":"peTVLwKlmZ"}],"key":"k7REYU2YdG"}],"key":"muFdyjV1W8"},{"type":"paragraph","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"children":[{"type":"text","value":"机器人自带一个名为 ","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"key":"xOVTIIMfER"},{"type":"inlineCode","value":"SampleStrategy","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"key":"BrzdeQ6dyT"},{"type":"text","value":" 的示例策略，可作为参考：","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"key":"rwE3ToW7v5"},{"type":"inlineCode","value":"user_data/strategies/sample_strategy.py","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"key":"xOqu22qluj"},{"type":"text","value":"。","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"key":"b4woWVgJaZ"}],"key":"ZqFx6WV4em"},{"type":"paragraph","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"children":[{"type":"text","value":"你可以用参数 ","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"vPlzpUIVjX"},{"type":"inlineCode","value":"--strategy SampleStrategy","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"jWtOgLMApc"},{"type":"text","value":" 进行测试。注意这里用的是策略类名，而不是文件名。","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"kjZ0bNXi3R"}],"key":"qfkTkLRoCC"},{"type":"paragraph","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"children":[{"type":"text","value":"此外，还有一个名为 ","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"rlFDKAvcWK"},{"type":"inlineCode","value":"INTERFACE_VERSION","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"N0IMvOtUyT"},{"type":"text","value":" 的属性，用于定义策略接口的版本。当前版本为 ","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"wD6PptkmSD"},{"type":"inlineCode","value":"3","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"oe4Wqtzrvd"},{"type":"text","value":"，如果未在策略中显式设置，则默认为 ","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"PD0YrsxSIx"},{"type":"inlineCode","value":"3","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"ybPOjClifX"},{"type":"text","value":"。","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"WFgZ6xxBtU"}],"key":"hjxQexXD26"},{"type":"paragraph","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"children":[{"type":"text","value":"你可能会看到旧策略设置为接口版本 ","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"key":"ZHte9iaR9x"},{"type":"inlineCode","value":"2","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"key":"MsW55yT1hC"},{"type":"text","value":"，未来版本会要求升级到 ","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"key":"txQdWyu9ZF"},{"type":"inlineCode","value":"v3","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"key":"N1WQIGyiu9"},{"type":"text","value":"。","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"key":"GdzGEfLGO2"}],"key":"LkKiDr2CeR"},{"type":"paragraph","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"children":[{"type":"text","value":"用 ","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"key":"TfOWNs7qGu"},{"type":"inlineCode","value":"trade","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"key":"d2RUF7Vz6n"},{"type":"text","value":" 命令即可启动机器人进入 ","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"key":"nlTPM6O4eW"},{"type":"inlineCode","value":"dry","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"key":"AiAS4lqBQX"},{"type":"text","value":" 或 ","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"key":"YFnMwXoLmd"},{"type":"inlineCode","value":"live","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"key":"c5bsnGpIij"},{"type":"text","value":" 模式：","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"key":"RGO4azRVfA"}],"key":"SSuLBPuitP"},{"type":"code","lang":"bash","value":"freqtrade trade --strategy AwesomeStrategy","position":{"start":{"line":84,"column":1},"end":{"line":86,"column":1}},"key":"KKzoEgoCIs"},{"type":"heading","depth":4,"position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"children":[{"type":"text","value":"机器人运行模式","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"key":"DDa4U3n43t"}],"identifier":"id","label":"机器人运行模式","html_id":"id-4","implicit":true,"key":"HNJbavKtYm"},{"type":"paragraph","position":{"start":{"line":90,"column":1},"end":{"line":90,"column":1}},"children":[{"type":"text","value":"Freqtrade 策略可在 ","position":{"start":{"line":90,"column":1},"end":{"line":90,"column":1}},"key":"E09Lb96s4S"},{"type":"inlineCode","value":"5","position":{"start":{"line":90,"column":1},"end":{"line":90,"column":1}},"key":"mKNo57z6Iz"},{"type":"text","value":" 种主要模式下被机器人处理：","position":{"start":{"line":90,"column":1},"end":{"line":90,"column":1}},"key":"YJKgguJN2C"}],"key":"VG1DXgcJgd"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":92,"column":1},"end":{"line":97,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":92,"column":1},"end":{"line":92,"column":1}},"children":[{"type":"text","value":"回测（backtesting）","position":{"start":{"line":92,"column":1},"end":{"line":92,"column":1}},"key":"KVTqlnldxz"}],"key":"eCvl6r1s3z"},{"type":"listItem","spread":true,"position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"children":[{"type":"text","value":"超参优化（hyperopting）","position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"key":"rzvsV3OoTA"}],"key":"EmsvpWzNIN"},{"type":"listItem","spread":true,"position":{"start":{"line":94,"column":1},"end":{"line":94,"column":1}},"children":[{"type":"text","value":"模拟盘（dry/forward testing）","position":{"start":{"line":94,"column":1},"end":{"line":94,"column":1}},"key":"ntSyyRizsL"}],"key":"uCltWkIATF"},{"type":"listItem","spread":true,"position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"children":[{"type":"text","value":"实盘（live）","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"ljR9KXM3U2"}],"key":"LSPHDOnPzO"},{"type":"listItem","spread":true,"position":{"start":{"line":96,"column":1},"end":{"line":97,"column":1}},"children":[{"type":"text","value":"FreqAI（本页不涉及）","position":{"start":{"line":96,"column":1},"end":{"line":96,"column":1}},"key":"oPheIeRAJP"}],"key":"uwGBOjJoOk"}],"key":"JfpYa3Sf5j"},{"type":"paragraph","position":{"start":{"line":98,"column":1},"end":{"line":98,"column":1}},"children":[{"type":"text","value":"关于如何设置 ","position":{"start":{"line":98,"column":1},"end":{"line":98,"column":1}},"key":"dIMEP0oi8u"},{"type":"inlineCode","value":"dry","position":{"start":{"line":98,"column":1},"end":{"line":98,"column":1}},"key":"wAZB1cyFgu"},{"type":"text","value":" 或 ","position":{"start":{"line":98,"column":1},"end":{"line":98,"column":1}},"key":"dta5HNTRx6"},{"type":"inlineCode","value":"live","position":{"start":{"line":98,"column":1},"end":{"line":98,"column":1}},"key":"okEVlHnoUO"},{"type":"text","value":" 模式，请查阅","position":{"start":{"line":98,"column":1},"end":{"line":98,"column":1}},"key":"hBB9wFr878"},{"type":"crossReference","url":"/configuration","position":{"start":{"line":98,"column":1},"end":{"line":98,"column":1}},"children":[{"type":"text","value":"配置文档","position":{"start":{"line":98,"column":1},"end":{"line":98,"column":1}},"key":"FrV2Zgxz23"}],"urlSource":"configuration.md#dry-run-live-mode","dataUrl":"/configuration.json","identifier":"dry-run-live-mode","label":"dry-run-live-mode","remote":true,"protocol":"file","kind":"heading","template":"{name}","resolved":true,"html_id":"dry-run-live-mode","key":"eE8eig5JRP"},{"type":"text","value":"。","position":{"start":{"line":98,"column":1},"end":{"line":98,"column":1}},"key":"rQHnPzl825"}],"key":"c4ihVb3EqQ"},{"type":"paragraph","position":{"start":{"line":100,"column":1},"end":{"line":100,"column":1}},"children":[{"type":"strong","position":{"start":{"line":100,"column":1},"end":{"line":100,"column":1}},"children":[{"type":"text","value":"测试时请始终使用 dry 模式，这样可以在不冒资金风险的情况下了解策略实际表现。","position":{"start":{"line":100,"column":1},"end":{"line":100,"column":1}},"key":"IgSyuuR6Mg"}],"key":"i0OTPmpLp1"}],"key":"QqZQOkVTcl"},{"type":"heading","depth":3,"position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"children":[{"type":"text","value":"深入剖析","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"key":"cSUwGKw3hg"}],"identifier":"id","label":"深入剖析","html_id":"id-5","implicit":true,"key":"GjJpVQQm9j"},{"type":"paragraph","position":{"start":{"line":104,"column":1},"end":{"line":104,"column":1}},"children":[{"type":"strong","position":{"start":{"line":104,"column":1},"end":{"line":104,"column":1}},"children":[{"type":"text","value":"以下内容将以 ","position":{"start":{"line":104,"column":1},"end":{"line":104,"column":1}},"key":"kvHzk0sMIm"},{"type":"link","url":"https://github.com/freqtrade/freqtrade/blob/develop/freqtrade/templates/sample_strategy.py","position":{"start":{"line":104,"column":1},"end":{"line":104,"column":1}},"children":[{"type":"text","value":"user​_data​/strategies​/sample​_strategy​.py","position":{"start":{"line":104,"column":1},"end":{"line":104,"column":1}},"key":"LmyaeWEfGP"}],"urlSource":"https://github.com/freqtrade/freqtrade/blob/develop/freqtrade/templates/sample_strategy.py","data":{"kind":"file","org":"freqtrade","repo":"freqtrade","reference":"develop","file":"freqtrade/templates/sample_strategy.py","raw":"https://raw.githubusercontent.com/freqtrade/freqtrade/develop/freqtrade/templates/sample_strategy.py"},"internal":false,"protocol":"github","key":"z1Y8Wa1JTV"},{"type":"text","value":" 为参考。","position":{"start":{"line":104,"column":1},"end":{"line":104,"column":1}},"key":"l4TbLCGCcb"}],"key":"q5DyTBZuYt"}],"key":"YxVqIAtL6I"},{"type":"admonition","kind":"caution","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"策略与回测","position":{"start":{"line":106,"column":1},"end":{"line":106,"column":1}},"key":"oHT3UXd6jI"}],"key":"zGTXryR5nK"},{"type":"paragraph","position":{"start":{"line":107,"column":1},"end":{"line":107,"column":1}},"children":[{"type":"text","value":"为避免回测与 dry/live 模式下出现问题和意外差异，请注意回测时 ","position":{"start":{"line":107,"column":1},"end":{"line":107,"column":1}},"key":"fy5ufLQmQD"},{"type":"inlineCode","value":"populate_*()","position":{"start":{"line":107,"column":1},"end":{"line":107,"column":1}},"key":"QFwmnRhYj5"},{"type":"text","value":" 方法会一次性传入完整时间区间。","position":{"start":{"line":107,"column":1},"end":{"line":107,"column":1}},"key":"iT9alembWZ"}],"key":"LGwIr17U36"},{"type":"paragraph","position":{"start":{"line":109,"column":1},"end":{"line":109,"column":1}},"children":[{"type":"text","value":"因此建议使用向量化操作（针对整个 dataframe，而非循环），避免用 ","position":{"start":{"line":109,"column":1},"end":{"line":109,"column":1}},"key":"MoL15fRNUq"},{"type":"inlineCode","value":"df.iloc[-1]","position":{"start":{"line":109,"column":1},"end":{"line":109,"column":1}},"key":"xiAjH8j6l0"},{"type":"text","value":"，而应用 ","position":{"start":{"line":109,"column":1},"end":{"line":109,"column":1}},"key":"SdesqjnFKE"},{"type":"inlineCode","value":"df.shift()","position":{"start":{"line":109,"column":1},"end":{"line":109,"column":1}},"key":"WlfztiOhoC"},{"type":"text","value":" 获取前一根K线。","position":{"start":{"line":109,"column":1},"end":{"line":109,"column":1}},"key":"PsihYj9dFK"}],"key":"FMdHPMsWz5"}],"key":"pzQ7DfS62l"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"警惕未来数据","position":{"start":{"line":112,"column":1},"end":{"line":112,"column":1}},"key":"IK44pfzw4q"}],"key":"Bjhr3DuhtW"},{"type":"paragraph","position":{"start":{"line":113,"column":1},"end":{"line":113,"column":1}},"children":[{"type":"text","value":"回测时 ","position":{"start":{"line":113,"column":1},"end":{"line":113,"column":1}},"key":"K5kIkr18UC"},{"type":"inlineCode","value":"populate_*()","position":{"start":{"line":113,"column":1},"end":{"line":113,"column":1}},"key":"NMQJC5EUyA"},{"type":"text","value":" 方法会传入完整时间区间，策略作者需确保不使用未来数据。","position":{"start":{"line":113,"column":1},"end":{"line":113,"column":1}},"key":"K34SDEMyoR"}],"key":"kuR725HpJT"},{"type":"paragraph","position":{"start":{"line":115,"column":1},"end":{"line":115,"column":1}},"children":[{"type":"text","value":"常见错误模式见文档后面的","position":{"start":{"line":115,"column":1},"end":{"line":115,"column":1}},"key":"VFwGRCCxMc"},{"type":"crossReference","position":{"start":{"line":115,"column":1},"end":{"line":115,"column":1}},"children":[{"type":"text","value":"常见错误","position":{"start":{"line":115,"column":1},"end":{"line":115,"column":1}},"key":"ovAXrMEQWR"}],"identifier":"common-mistakes-when-developing-strategies","label":"common-mistakes-when-developing-strategies","kind":"heading","template":"{name}","resolved":true,"html_id":"common-mistakes-when-developing-strategies","key":"lbjMeK6MZh"},{"type":"text","value":"章节。","position":{"start":{"line":115,"column":1},"end":{"line":115,"column":1}},"key":"P5eldM0TR4"}],"key":"RpyltxJuES"}],"key":"gyKVAy14kK"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"前视与递归分析","position":{"start":{"line":118,"column":1},"end":{"line":118,"column":1}},"key":"Hx3bmHF0sh"}],"key":"bsL0DFUISK"},{"type":"paragraph","position":{"start":{"line":119,"column":1},"end":{"line":119,"column":1}},"children":[{"type":"text","value":"Freqtrade 提供了两条命令帮助检测常见的前视（未来数据）和递归偏差（指标值方差）问题。在 dry/live 前，建议先用 ","position":{"start":{"line":119,"column":1},"end":{"line":119,"column":1}},"key":"ZvUtNy3jaJ"},{"type":"link","url":"/lookahead-analysis","position":{"start":{"line":119,"column":1},"end":{"line":119,"column":1}},"children":[{"type":"text","value":"lookahead","position":{"start":{"line":119,"column":1},"end":{"line":119,"column":1}},"key":"BqZNt9BKJb"}],"urlSource":"lookahead-analysis.md","dataUrl":"/lookahead-analysis.json","internal":true,"protocol":"file","key":"OLTwD1QcVW"},{"type":"text","value":" 和 ","position":{"start":{"line":119,"column":1},"end":{"line":119,"column":1}},"key":"PEcvxB9Qxs"},{"type":"link","url":"/recursive-analysis","position":{"start":{"line":119,"column":1},"end":{"line":119,"column":1}},"children":[{"type":"text","value":"recursive","position":{"start":{"line":119,"column":1},"end":{"line":119,"column":1}},"key":"BeeTQzq1AX"}],"urlSource":"recursive-analysis.md","dataUrl":"/recursive-analysis.json","internal":true,"protocol":"file","key":"RZaYEIUsSm"},{"type":"text","value":" 工具分析。","position":{"start":{"line":119,"column":1},"end":{"line":119,"column":1}},"key":"spsejztHx8"}],"key":"ApXU9O8ktc"}],"key":"HzHN8SAlCF"},{"type":"heading","depth":4,"position":{"start":{"line":122,"column":1},"end":{"line":122,"column":1}},"children":[{"type":"text","value":"DataFrame","position":{"start":{"line":122,"column":1},"end":{"line":122,"column":1}},"key":"NMjAYtDa8i"}],"identifier":"dataframe","label":"DataFrame","html_id":"dataframe","implicit":true,"key":"eCB0D4ebxX"},{"type":"paragraph","position":{"start":{"line":124,"column":1},"end":{"line":125,"column":1}},"children":[{"type":"text","value":"Freqtrade 使用 ","position":{"start":{"line":124,"column":1},"end":{"line":124,"column":1}},"key":"i6GWsrx8yl"},{"type":"link","url":"https://pandas.pydata.org/","position":{"start":{"line":124,"column":1},"end":{"line":124,"column":1}},"children":[{"type":"text","value":"pandas","position":{"start":{"line":124,"column":1},"end":{"line":124,"column":1}},"key":"O319nxaUxE"}],"urlSource":"https://pandas.pydata.org/","key":"l6nA4bInDS"},{"type":"text","value":" 存储/提供 K 线（OHLCV）数据。\nPandas 是处理表格数据的强大库。","position":{"start":{"line":124,"column":1},"end":{"line":124,"column":1}},"key":"eBiGjlxdW0"}],"key":"dGk5qaeRfq"},{"type":"paragraph","position":{"start":{"line":127,"column":1},"end":{"line":127,"column":1}},"children":[{"type":"text","value":"DataFrame 的每一行对应一根K线，最新的完整K线总是排在最后（按日期排序）。","position":{"start":{"line":127,"column":1},"end":{"line":127,"column":1}},"key":"RL30raNRD3"}],"key":"rwTadTa93f"},{"type":"paragraph","position":{"start":{"line":129,"column":1},"end":{"line":129,"column":1}},"children":[{"type":"text","value":"用 pandas 的 ","position":{"start":{"line":129,"column":1},"end":{"line":129,"column":1}},"key":"eRBx1LNfv3"},{"type":"inlineCode","value":"head()","position":{"start":{"line":129,"column":1},"end":{"line":129,"column":1}},"key":"w7FyOiBcIM"},{"type":"text","value":" 查看前几行：","position":{"start":{"line":129,"column":1},"end":{"line":129,"column":1}},"key":"hBTGDb7QSv"}],"key":"CFmcdaj8Cx"},{"type":"code","lang":"output","value":"> dataframe.head()\n                       date      open      high       low     close     volume\n0 2021-11-09 23:25:00+00:00  67279.67  67321.84  67255.01  67300.97   44.62253\n1 2021-11-09 23:30:00+00:00  67300.97  67301.34  67183.03  67187.01   61.38076\n2 2021-11-09 23:35:00+00:00  67187.02  67187.02  67031.93  67123.81  113.42728\n3 2021-11-09 23:40:00+00:00  67123.80  67222.40  67080.33  67160.48   78.96008\n4 2021-11-09 23:45:00+00:00  67160.48  67160.48  66901.26  66943.37  111.39292","position":{"start":{"line":131,"column":1},"end":{"line":139,"column":1}},"key":"ereLyCpspc"},{"type":"paragraph","position":{"start":{"line":141,"column":1},"end":{"line":141,"column":1}},"children":[{"type":"text","value":"DataFrame 是一个表格，列不是单一值，而是一组数据。因此，像下面这样直接用 Python 比较会报错：","position":{"start":{"line":141,"column":1},"end":{"line":141,"column":1}},"key":"bQeUCmxcNo"}],"key":"Bc0anWMsgZ"},{"type":"code","lang":"python","value":"    if dataframe['rsi'] > 30:\n        dataframe['enter_long'] = 1","position":{"start":{"line":143,"column":1},"end":{"line":146,"column":1}},"key":"ihsL3MPVip"},{"type":"paragraph","position":{"start":{"line":148,"column":1},"end":{"line":148,"column":1}},"children":[{"type":"text","value":"上述写法会报错：","position":{"start":{"line":148,"column":1},"end":{"line":148,"column":1}},"key":"VgOtIM25b4"},{"type":"inlineCode","value":"The truth value of a Series is ambiguous [...]","position":{"start":{"line":148,"column":1},"end":{"line":148,"column":1}},"key":"O1UgvbqUkc"},{"type":"text","value":"。","position":{"start":{"line":148,"column":1},"end":{"line":148,"column":1}},"key":"nBRuzXnsFb"}],"key":"gPirEPcRj3"},{"type":"paragraph","position":{"start":{"line":150,"column":1},"end":{"line":150,"column":1}},"children":[{"type":"text","value":"应改为 pandas 向量化写法，对整个 dataframe 执行操作：","position":{"start":{"line":150,"column":1},"end":{"line":150,"column":1}},"key":"czxqmwA5Fe"}],"key":"WjR7mEmV9M"},{"type":"code","lang":"python","value":"    dataframe.loc[\n        (dataframe['rsi'] > 30)\n    , 'enter_long'] = 1","position":{"start":{"line":152,"column":1},"end":{"line":156,"column":1}},"key":"HW0qlWQZjS"},{"type":"paragraph","position":{"start":{"line":158,"column":1},"end":{"line":158,"column":1}},"children":[{"type":"text","value":"这样会在 RSI 大于 30 时，为新列 ","position":{"start":{"line":158,"column":1},"end":{"line":158,"column":1}},"key":"CMd1flXFRp"},{"type":"inlineCode","value":"enter_long","position":{"start":{"line":158,"column":1},"end":{"line":158,"column":1}},"key":"XUxvc3nkDc"},{"type":"text","value":" 赋值 1。","position":{"start":{"line":158,"column":1},"end":{"line":158,"column":1}},"key":"ZviSUqywCF"}],"key":"UNCH4zzByW"},{"type":"paragraph","position":{"start":{"line":160,"column":1},"end":{"line":160,"column":1}},"children":[{"type":"text","value":"Freqtrade 会用这个新列作为入场信号，假定下一根K线开盘时开仓。","position":{"start":{"line":160,"column":1},"end":{"line":160,"column":1}},"key":"DWuhrAsVsy"}],"key":"sNcRvIheaq"},{"type":"paragraph","position":{"start":{"line":162,"column":1},"end":{"line":162,"column":1}},"children":[{"type":"text","value":"Pandas 支持高效的向量化计算，建议尽量避免循环，直接用向量化方法。","position":{"start":{"line":162,"column":1},"end":{"line":162,"column":1}},"key":"pk54eXgBUg"}],"key":"wDscT74itp"},{"type":"paragraph","position":{"start":{"line":164,"column":1},"end":{"line":164,"column":1}},"children":[{"type":"text","value":"向量化操作会对整列数据进行计算，比逐行循环快得多。","position":{"start":{"line":164,"column":1},"end":{"line":164,"column":1}},"key":"gx0mVsHVfU"}],"key":"oMaDMNiiaq"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"信号 vs 交易","position":{"start":{"line":166,"column":1},"end":{"line":166,"column":1}},"key":"E2AFAk9MGB"}],"key":"AdwrisYMXV"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":168,"column":1},"end":{"line":169,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":168,"column":1},"end":{"line":168,"column":1}},"children":[{"type":"text","value":"信号由指标在K线收盘时生成，表示有意愿开仓。","position":{"start":{"line":168,"column":1},"end":{"line":168,"column":1}},"key":"LSwpuDLObb"}],"key":"xXHm921vk0"},{"type":"listItem","spread":true,"position":{"start":{"line":169,"column":1},"end":{"line":169,"column":1}},"children":[{"type":"text","value":"交易是在实际下单（实盘时在交易所），会尽量在下一根K线开盘时成交。","position":{"start":{"line":169,"column":1},"end":{"line":169,"column":1}},"key":"U6GDIWrmot"}],"key":"ZYIGjbzv5e"}],"key":"CnbEB1txbL"}],"key":"HHYEN0dmLF"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"交易下单假设","position":{"start":{"line":173,"column":1},"end":{"line":173,"column":1}},"key":"uVF8F3el7G"}],"key":"Bq3zwh2KBQ"},{"type":"paragraph","position":{"start":{"line":175,"column":1},"end":{"line":175,"column":1}},"children":[{"type":"text","value":"回测时，信号在K线收盘时生成，交易在下一根K线开盘时执行。","position":{"start":{"line":175,"column":1},"end":{"line":175,"column":1}},"key":"atO90K2Upv"}],"key":"jNreliVGm8"},{"type":"paragraph","position":{"start":{"line":177,"column":1},"end":{"line":177,"column":1}},"children":[{"type":"text","value":"dry/live 模式下，因需先分析所有交易对 dataframe，再处理下单，可能有延迟。建议减少交易对数量，并用高主频 CPU。","position":{"start":{"line":177,"column":1},"end":{"line":177,"column":1}},"key":"LybWb4j3Vp"}],"key":"maQpFfESSC"}],"key":"LZZvpfaGej"},{"type":"heading","depth":5,"position":{"start":{"line":181,"column":1},"end":{"line":181,"column":1}},"children":[{"type":"text","value":"为什么看不到\"实时\"K线数据？","position":{"start":{"line":181,"column":1},"end":{"line":181,"column":1}},"key":"KQj7u1CWVP"}],"identifier":"id-k","label":"为什么看不到\"实时\"K线数据？","html_id":"id-k","implicit":true,"key":"v4bjUbgR1M"},{"type":"paragraph","position":{"start":{"line":183,"column":1},"end":{"line":183,"column":1}},"children":[{"type":"text","value":"Freqtrade 不会在 dataframe 中存储未完成/未收盘的K线。","position":{"start":{"line":183,"column":1},"end":{"line":183,"column":1}},"key":"kV37RNyu6y"}],"key":"ZP7TdHD3zx"},{"type":"paragraph","position":{"start":{"line":185,"column":1},"end":{"line":185,"column":1}},"children":[{"type":"text","value":"用未完成数据做决策叫\"重绘\"，有些平台允许，但 Freqtrade 不支持。只有完整K线数据可用。","position":{"start":{"line":185,"column":1},"end":{"line":185,"column":1}},"key":"E2aaPJwhFf"}],"key":"Mx9SqEhEXS"},{"type":"heading","depth":4,"position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"children":[{"type":"text","value":"自定义指标","position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"key":"uNlvxNu9AG"}],"identifier":"id","label":"自定义指标","html_id":"id-6","implicit":true,"key":"tVF7PIcRuW"},{"type":"paragraph","position":{"start":{"line":189,"column":1},"end":{"line":189,"column":1}},"children":[{"type":"text","value":"入场和出场信号需要用到指标。你可以在策略文件的 ","position":{"start":{"line":189,"column":1},"end":{"line":189,"column":1}},"key":"lNztBumEdy"},{"type":"inlineCode","value":"populate_indicators()","position":{"start":{"line":189,"column":1},"end":{"line":189,"column":1}},"key":"KzkwPde8Go"},{"type":"text","value":" 方法中添加更多指标。","position":{"start":{"line":189,"column":1},"end":{"line":189,"column":1}},"key":"psG1btJPea"}],"key":"IQ88TEZmi6"},{"type":"paragraph","position":{"start":{"line":191,"column":1},"end":{"line":191,"column":1}},"children":[{"type":"text","value":"只应添加在 ","position":{"start":{"line":191,"column":1},"end":{"line":191,"column":1}},"key":"Ag2OjFqvsw"},{"type":"inlineCode","value":"populate_entry_trend()","position":{"start":{"line":191,"column":1},"end":{"line":191,"column":1}},"key":"VzHcCf6hAI"},{"type":"text","value":"、","position":{"start":{"line":191,"column":1},"end":{"line":191,"column":1}},"key":"pTf6B53QDD"},{"type":"inlineCode","value":"populate_exit_trend()","position":{"start":{"line":191,"column":1},"end":{"line":191,"column":1}},"key":"Klzt0kFPrP"},{"type":"text","value":" 或用于生成其他指标的指标，否则会影响性能。","position":{"start":{"line":191,"column":1},"end":{"line":191,"column":1}},"key":"mdUDrimBXO"}],"key":"ZNppAKmhEk"},{"type":"paragraph","position":{"start":{"line":193,"column":1},"end":{"line":193,"column":1}},"children":[{"type":"text","value":"务必返回 dataframe，且不要删除/修改 “open”, “high”, “low”, “close”, “volume” 这几列，否则会导致异常。","position":{"start":{"line":193,"column":1},"end":{"line":193,"column":1}},"key":"iX2hpXJ2Z0"}],"key":"if0Bttyu5R"},{"type":"paragraph","position":{"start":{"line":195,"column":1},"end":{"line":195,"column":1}},"children":[{"type":"text","value":"示例：","position":{"start":{"line":195,"column":1},"end":{"line":195,"column":1}},"key":"qWNRRH3s5i"}],"key":"lpQBtW73Ud"},{"type":"code","lang":"python","value":"def populate_indicators(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n    \"\"\"\n    为给定 DataFrame 添加多种技术指标\n\n    性能提示：为获得最佳性能，请只用你策略或超参优化用到的指标，否则会浪费内存和 CPU。\n    :param dataframe: 交易所数据 DataFrame\n    :param metadata: 额外信息，如当前交易对\n    :return: 包含所有策略所需指标的 DataFrame\n    \"\"\"\n    dataframe['sar'] = ta.SAR(dataframe)\n    dataframe['adx'] = ta.ADX(dataframe)\n    stoch = ta.STOCHF(dataframe)\n    dataframe['fastd'] = stoch['fastd']\n    dataframe['fastk'] = stoch['fastk']\n    dataframe['bb_lower'] = ta.BBANDS(dataframe, nbdevup=2, nbdevdn=2)['lowerband']\n    dataframe['sma'] = ta.SMA(dataframe, timeperiod=40)\n    dataframe['tema'] = ta.TEMA(dataframe, timeperiod=9)\n    dataframe['mfi'] = ta.MFI(dataframe)\n    dataframe['rsi'] = ta.RSI(dataframe)\n    dataframe['ema5'] = ta.EMA(dataframe, timeperiod=5)\n    dataframe['ema10'] = ta.EMA(dataframe, timeperiod=10)\n    dataframe['ema50'] = ta.EMA(dataframe, timeperiod=50)\n    dataframe['ema100'] = ta.EMA(dataframe, timeperiod=100)\n    dataframe['ao'] = awesome_oscillator(dataframe)\n    macd = ta.MACD(dataframe)\n    dataframe['macd'] = macd['macd']\n    dataframe['macdsignal'] = macd['macdsignal']\n    dataframe['macdhist'] = macd['macdhist']\n    hilbert = ta.HT_SINE(dataframe)\n    dataframe['htsine'] = hilbert['sine']\n    dataframe['htleadsine'] = hilbert['leadsine']\n    dataframe['plus_dm'] = ta.PLUS_DM(dataframe)\n    dataframe['plus_di'] = ta.PLUS_DI(dataframe)\n    dataframe['minus_dm'] = ta.MINUS_DM(dataframe)\n    dataframe['minus_di'] = ta.MINUS_DI(dataframe)\n\n    # 记得始终返回 dataframe\n    return dataframe","position":{"start":{"line":197,"column":1},"end":{"line":236,"column":1}},"key":"wZVJ3jrJXk"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"想要更多指标示例？","position":{"start":{"line":238,"column":1},"end":{"line":238,"column":1}},"key":"U6BWbjVKqn"}],"key":"ZTX1cRYhOk"},{"type":"paragraph","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"children":[{"type":"text","value":"请参考 ","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"zdgXaX6tRi"},{"type":"link","url":"https://github.com/freqtrade/freqtrade/blob/develop/freqtrade/templates/sample_strategy.py","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"children":[{"type":"text","value":"user​_data​/strategies​/sample​_strategy​.py","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"RdjSBaZQpc"}],"urlSource":"https://github.com/freqtrade/freqtrade/blob/develop/freqtrade/templates/sample_strategy.py","data":{"kind":"file","org":"freqtrade","repo":"freqtrade","reference":"develop","file":"freqtrade/templates/sample_strategy.py","raw":"https://raw.githubusercontent.com/freqtrade/freqtrade/develop/freqtrade/templates/sample_strategy.py"},"internal":false,"protocol":"github","key":"MVOZmitnhh"},{"type":"text","value":"，取消注释你需要的指标。","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"ualYEuU1T7"}],"key":"ZqAWTkkmlr"}],"key":"B07Yido5fe"},{"type":"heading","depth":5,"position":{"start":{"line":242,"column":1},"end":{"line":242,"column":1}},"children":[{"type":"text","value":"指标库","position":{"start":{"line":242,"column":1},"end":{"line":242,"column":1}},"key":"Asvb2YeYxP"}],"identifier":"id","label":"指标库","html_id":"id-7","implicit":true,"key":"BZhjDBrRmT"},{"type":"paragraph","position":{"start":{"line":244,"column":1},"end":{"line":244,"column":1}},"children":[{"type":"text","value":"Freqtrade 默认安装了以下技术指标库：","position":{"start":{"line":244,"column":1},"end":{"line":244,"column":1}},"key":"YyEKzrb10w"}],"key":"JpmOXqbXlS"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":246,"column":1},"end":{"line":249,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":246,"column":1},"end":{"line":246,"column":1}},"children":[{"type":"link","url":"https://ta-lib.github.io/ta-lib-python/","position":{"start":{"line":246,"column":1},"end":{"line":246,"column":1}},"children":[{"type":"text","value":"ta-lib","position":{"start":{"line":246,"column":1},"end":{"line":246,"column":1}},"key":"tECjHxTnSZ"}],"urlSource":"https://ta-lib.github.io/ta-lib-python/","key":"jwLemufsGc"}],"key":"EOifsS7DMh"},{"type":"listItem","spread":true,"position":{"start":{"line":247,"column":1},"end":{"line":247,"column":1}},"children":[{"type":"link","url":"https://twopirllc.github.io/pandas-ta/","position":{"start":{"line":247,"column":1},"end":{"line":247,"column":1}},"children":[{"type":"text","value":"pandas-ta","position":{"start":{"line":247,"column":1},"end":{"line":247,"column":1}},"key":"oGFMi2tHRp"}],"urlSource":"https://twopirllc.github.io/pandas-ta/","key":"bNlxvR8edG"}],"key":"fc9GIuGKIF"},{"type":"listItem","spread":true,"position":{"start":{"line":248,"column":1},"end":{"line":249,"column":1}},"children":[{"type":"link","url":"https://technical.freqtrade.io","position":{"start":{"line":248,"column":1},"end":{"line":248,"column":1}},"children":[{"type":"text","value":"technical","position":{"start":{"line":248,"column":1},"end":{"line":248,"column":1}},"key":"rTv6I0rKPj"}],"urlSource":"https://technical.freqtrade.io","key":"IYDMOEej5K"}],"key":"e5ps4ZBS11"}],"key":"WpXF4TiO1I"},{"type":"paragraph","position":{"start":{"line":250,"column":1},"end":{"line":250,"column":1}},"children":[{"type":"text","value":"如有需要可安装其他技术指标库，或自行编写自定义指标。","position":{"start":{"line":250,"column":1},"end":{"line":250,"column":1}},"key":"bbvkmRdomI"}],"key":"fMhhirXrb2"},{"type":"heading","depth":4,"position":{"start":{"line":254,"column":1},"end":{"line":254,"column":1}},"children":[{"type":"text","value":"策略启动期","position":{"start":{"line":254,"column":1},"end":{"line":254,"column":1}},"key":"vyH1ehCAK3"}],"label":"strategy-startup-period","identifier":"strategy-startup-period","html_id":"strategy-startup-period","key":"ljYsocjqrC"},{"type":"paragraph","position":{"start":{"line":256,"column":1},"end":{"line":256,"column":1}},"children":[{"type":"text","value":"部分指标在启动初期因数据不足会出现 NaN 或计算不准确。Freqtrade 无法自动判断不稳定期长度，会直接用 dataframe 中的指标值。","position":{"start":{"line":256,"column":1},"end":{"line":256,"column":1}},"key":"s0bYW8U9Nn"}],"key":"nR6MEZz7sq"},{"type":"paragraph","position":{"start":{"line":258,"column":1},"end":{"line":258,"column":1}},"children":[{"type":"text","value":"为此，策略可设置 ","position":{"start":{"line":258,"column":1},"end":{"line":258,"column":1}},"key":"YCtm8ZZe8R"},{"type":"inlineCode","value":"startup_candle_count","position":{"start":{"line":258,"column":1},"end":{"line":258,"column":1}},"key":"IIHVlOSDq6"},{"type":"text","value":" 属性。","position":{"start":{"line":258,"column":1},"end":{"line":258,"column":1}},"key":"nBKxarMIX4"}],"key":"AuqBHbiXaW"},{"type":"paragraph","position":{"start":{"line":260,"column":1},"end":{"line":260,"column":1}},"children":[{"type":"text","value":"该值应设为策略中所有指标所需的最大历史K线数。若用到高阶时间周期 informative pair，","position":{"start":{"line":260,"column":1},"end":{"line":260,"column":1}},"key":"Ovr2td7WFz"},{"type":"inlineCode","value":"startup_candle_count","position":{"start":{"line":260,"column":1},"end":{"line":260,"column":1}},"key":"poHwkJn9Ig"},{"type":"text","value":" 也无需改变，只需用最大周期。","position":{"start":{"line":260,"column":1},"end":{"line":260,"column":1}},"key":"TBCIn7rCrI"}],"key":"w1tkfMCZQi"},{"type":"paragraph","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"children":[{"type":"text","value":"可用 ","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"key":"QBKBokzCO8"},{"type":"link","url":"/recursive-analysis","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"children":[{"type":"text","value":"recursive-analysis","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"key":"eTrzsFDPyz"}],"urlSource":"recursive-analysis.md","dataUrl":"/recursive-analysis.json","internal":true,"protocol":"file","key":"VGSTKjzS4X"},{"type":"text","value":" 检查合适的 ","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"key":"jSljR0hgTa"},{"type":"inlineCode","value":"startup_candle_count","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"key":"c4ZcgDHTc1"},{"type":"text","value":"。当递归分析显示方差为 0% 时，说明历史数据已足够。","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"key":"WB0mvRWuXv"}],"key":"WEck7jaVn1"},{"type":"paragraph","position":{"start":{"line":264,"column":1},"end":{"line":264,"column":1}},"children":[{"type":"text","value":"如本例策略用到 ema100，则应设为 400（","position":{"start":{"line":264,"column":1},"end":{"line":264,"column":1}},"key":"Hf27zQFMgv"},{"type":"inlineCode","value":"startup_candle_count = 400","position":{"start":{"line":264,"column":1},"end":{"line":264,"column":1}},"key":"i72GGuz7o6"},{"type":"text","value":"），以保证 ema100 计算准确。","position":{"start":{"line":264,"column":1},"end":{"line":264,"column":1}},"key":"dk3Z8K2fZ1"}],"key":"X24Kdpeb5V"},{"type":"code","lang":"python","value":"    dataframe['ema100'] = ta.EMA(dataframe, timeperiod=100)","position":{"start":{"line":266,"column":1},"end":{"line":268,"column":1}},"key":"H55NyvX65N"},{"type":"paragraph","position":{"start":{"line":270,"column":1},"end":{"line":270,"column":1}},"children":[{"type":"text","value":"告知机器人所需历史长度后，回测和超参优化可从指定时间点开始。","position":{"start":{"line":270,"column":1},"end":{"line":270,"column":1}},"key":"nEgo5B75yL"}],"key":"LZEJGhkRV4"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"多次获取 OHLCV 的警告","position":{"start":{"line":272,"column":1},"end":{"line":272,"column":1}},"key":"zVxkuvMKSo"}],"key":"BeqUKkslIE"},{"type":"paragraph","position":{"start":{"line":273,"column":1},"end":{"line":273,"column":1}},"children":[{"type":"text","value":"若收到 ","position":{"start":{"line":273,"column":1},"end":{"line":273,"column":1}},"key":"soLERAiB8S"},{"type":"inlineCode","value":"WARNING - Using 3 calls to get OHLCV...","position":{"start":{"line":273,"column":1},"end":{"line":273,"column":1}},"key":"c5Xd6MKuD0"},{"type":"text","value":"，请考虑是否真的需要这么多历史数据。过多会导致多次网络请求，拖慢机器人刷新速度。","position":{"start":{"line":273,"column":1},"end":{"line":273,"column":1}},"key":"FG9bVEzxMK"}],"key":"cYRZlt5M9L"},{"type":"paragraph","position":{"start":{"line":275,"column":1},"end":{"line":275,"column":1}},"children":[{"type":"text","value":"最多允许 5 次请求，避免过载。","position":{"start":{"line":275,"column":1},"end":{"line":275,"column":1}},"key":"OtwnfzOPta"}],"key":"PLWz0nyzo9"}],"key":"JhU5RVG7Kg"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"GUWQZ5fs3D"}],"key":"iw92na7py4"},{"type":"paragraph","position":{"start":{"line":279,"column":1},"end":{"line":279,"column":1}},"children":[{"type":"inlineCode","value":"startup_candle_count","position":{"start":{"line":279,"column":1},"end":{"line":279,"column":1}},"key":"a9KWLAhCP0"},{"type":"text","value":" 应小于 ","position":{"start":{"line":279,"column":1},"end":{"line":279,"column":1}},"key":"JTvEZwZVJG"},{"type":"inlineCode","value":"ohlcv_candle_limit * 5","position":{"start":{"line":279,"column":1},"end":{"line":279,"column":1}},"key":"cfmmtE7nAW"},{"type":"text","value":"（大多数交易所为 500 * 5），Dry-Run/Live 模式下只会有这么多K线。","position":{"start":{"line":279,"column":1},"end":{"line":279,"column":1}},"key":"s1QkoIrLvc"}],"key":"BzYE4Zm0k5"}],"key":"Y9yGiV76Op"},{"type":"heading","depth":5,"position":{"start":{"line":282,"column":1},"end":{"line":282,"column":1}},"children":[{"type":"text","value":"示例","position":{"start":{"line":282,"column":1},"end":{"line":282,"column":1}},"key":"sjxKjbmIsm"}],"identifier":"id","label":"示例","html_id":"id-8","implicit":true,"key":"lip3NHCCf9"},{"type":"paragraph","position":{"start":{"line":284,"column":1},"end":{"line":284,"column":1}},"children":[{"type":"text","value":"假设用 EMA100 策略回测 2019 年 1 月的 5m K 线：","position":{"start":{"line":284,"column":1},"end":{"line":284,"column":1}},"key":"KW8yre2AF1"}],"key":"tFIlSm9BON"},{"type":"code","lang":"bash","value":"freqtrade backtesting --timerange 20190101-20190201 --timeframe 5m","position":{"start":{"line":286,"column":1},"end":{"line":288,"column":1}},"key":"Upl1xm9rcb"},{"type":"paragraph","position":{"start":{"line":290,"column":1},"end":{"line":290,"column":1}},"children":[{"type":"text","value":"若 ","position":{"start":{"line":290,"column":1},"end":{"line":290,"column":1}},"key":"DGYd6TBOj1"},{"type":"inlineCode","value":"startup_candle_count","position":{"start":{"line":290,"column":1},"end":{"line":290,"column":1}},"key":"ikCt3PmDGm"},{"type":"text","value":" 设为 400，回测会自动加载 400 根K线的历史数据，即从 ","position":{"start":{"line":290,"column":1},"end":{"line":290,"column":1}},"key":"OYsrKIuOFC"},{"type":"inlineCode","value":"20190101 - (400 * 5m)","position":{"start":{"line":290,"column":1},"end":{"line":290,"column":1}},"key":"OsATxLdu4m"},{"type":"text","value":"，约等于 2018-12-30 11:40:00。","position":{"start":{"line":290,"column":1},"end":{"line":290,"column":1}},"key":"jVkmtLpci3"}],"key":"VFKEi2NgFV"},{"type":"paragraph","position":{"start":{"line":292,"column":1},"end":{"line":292,"column":1}},"children":[{"type":"text","value":"若有该数据，指标会用扩展时间段计算，启动期（到 2019-01-01 00:00:00）会被剔除。","position":{"start":{"line":292,"column":1},"end":{"line":292,"column":1}},"key":"OnsIYFBNSN"}],"key":"UdyUbnDKDO"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"启动期数据不可用","position":{"start":{"line":294,"column":1},"end":{"line":294,"column":1}},"key":"xQJbhtH80q"}],"key":"Z80lu12msH"},{"type":"paragraph","position":{"start":{"line":295,"column":1},"end":{"line":295,"column":1}},"children":[{"type":"text","value":"若历史数据不足，回测会自动调整起始时间。例如本例会从 2019-01-02 09:20:00 开始。","position":{"start":{"line":295,"column":1},"end":{"line":295,"column":1}},"key":"JP81Zwb58T"}],"key":"akENZtyg75"}],"key":"V1p5tY4RIp"},{"type":"heading","depth":4,"position":{"start":{"line":298,"column":1},"end":{"line":298,"column":1}},"children":[{"type":"text","value":"入场信号规则","position":{"start":{"line":298,"column":1},"end":{"line":298,"column":1}},"key":"NHjAsag6YO"}],"identifier":"id","label":"入场信号规则","html_id":"id-9","implicit":true,"key":"Qlh2OEnqlK"},{"type":"paragraph","position":{"start":{"line":300,"column":1},"end":{"line":300,"column":1}},"children":[{"type":"text","value":"编辑策略文件中的 ","position":{"start":{"line":300,"column":1},"end":{"line":300,"column":1}},"key":"I5P9OFhkru"},{"type":"inlineCode","value":"populate_entry_trend()","position":{"start":{"line":300,"column":1},"end":{"line":300,"column":1}},"key":"G9TSFQ8DX5"},{"type":"text","value":" 方法，更新入场逻辑。","position":{"start":{"line":300,"column":1},"end":{"line":300,"column":1}},"key":"ws2dMO4CR5"}],"key":"iWIy12PTTE"},{"type":"paragraph","position":{"start":{"line":302,"column":1},"end":{"line":302,"column":1}},"children":[{"type":"text","value":"务必返回 dataframe，且不要删除/修改 “open”, “high”, “low”, “close”, “volume” 这几列，否则会导致异常。","position":{"start":{"line":302,"column":1},"end":{"line":302,"column":1}},"key":"zVfBEvb1rv"}],"key":"Ys3JCoZfaF"},{"type":"paragraph","position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"children":[{"type":"text","value":"该方法还需定义新列 ","position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"key":"NJdl5bv5GL"},{"type":"inlineCode","value":"enter_long","position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"key":"WalNmj4x9f"},{"type":"text","value":"（做空为 ","position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"key":"v61aNxc4xh"},{"type":"inlineCode","value":"enter_short","position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"key":"HBLISONgzY"},{"type":"text","value":"），入场时为 1，无操作为 0。即使只做空也必须设置 ","position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"key":"RWpKXj9oCq"},{"type":"inlineCode","value":"enter_long","position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"key":"E6bapRie31"},{"type":"text","value":"。","position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"key":"zAck8pvKMp"}],"key":"zkcRQAvxci"},{"type":"paragraph","position":{"start":{"line":306,"column":1},"end":{"line":306,"column":1}},"children":[{"type":"text","value":"可用 ","position":{"start":{"line":306,"column":1},"end":{"line":306,"column":1}},"key":"iqJv4dn7ez"},{"type":"inlineCode","value":"enter_tag","position":{"start":{"line":306,"column":1},"end":{"line":306,"column":1}},"key":"f6FIG8TCqN"},{"type":"text","value":" 列为信号命名，便于后续调试和分析。","position":{"start":{"line":306,"column":1},"end":{"line":306,"column":1}},"key":"wHTBfeiKqi"}],"key":"zeI3Zhxawx"},{"type":"paragraph","position":{"start":{"line":308,"column":1},"end":{"line":308,"column":1}},"children":[{"type":"text","value":"示例（来自 sample_strategy.py）：","position":{"start":{"line":308,"column":1},"end":{"line":308,"column":1}},"key":"WoMQQPym1d"}],"key":"QHiSP6EeKa"},{"type":"code","lang":"python","value":"def populate_entry_trend(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n    \"\"\"\n    基于技术指标，为给定 dataframe 生成买入信号\n    :param dataframe: 已填充指标的 DataFrame\n    :param metadata: 额外信息，如当前交易对\n    :return: 包含买入信号的 DataFrame\n    \"\"\"\n    dataframe.loc[\n        (\n            (qtpylib.crossed_above(dataframe['rsi'], 30)) &  # RSI 上穿 30\n            (dataframe['tema'] <= dataframe['bb_middleband']) &  # 条件\n            (dataframe['tema'] > dataframe['tema'].shift(1)) &  # 条件\n            (dataframe['volume'] > 0)  # 确保有成交量\n        ),\n        ['enter_long', 'enter_tag']] = (1, 'rsi_cross')\n\n    return dataframe","position":{"start":{"line":310,"column":1},"end":{"line":328,"column":1}},"key":"Tor2eRqiXq"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"做空信号","position":{"start":{"line":330,"column":1},"end":{"line":330,"column":1}},"key":"ek2GdKlCLD"}],"key":"WTpHW6fsOd"},{"type":"paragraph","position":{"start":{"line":331,"column":1},"end":{"line":333,"column":1}},"children":[{"type":"text","value":"做空可通过设置 ","position":{"start":{"line":331,"column":1},"end":{"line":331,"column":1}},"key":"QPkOhEdBDo"},{"type":"inlineCode","value":"enter_short","position":{"start":{"line":331,"column":1},"end":{"line":331,"column":1}},"key":"t3qo22pvIO"},{"type":"text","value":"（对应多头的 ","position":{"start":{"line":331,"column":1},"end":{"line":331,"column":1}},"key":"ajltOk13DD"},{"type":"inlineCode","value":"enter_long","position":{"start":{"line":331,"column":1},"end":{"line":331,"column":1}},"key":"t5TSz0FMh1"},{"type":"text","value":"）实现。\n","position":{"start":{"line":331,"column":1},"end":{"line":331,"column":1}},"key":"QuvVpvVU2J"},{"type":"inlineCode","value":"enter_tag","position":{"start":{"line":331,"column":1},"end":{"line":331,"column":1}},"key":"NkPimBF38M"},{"type":"text","value":" 列用法相同。\n做空需交易所和市场支持！如需做空，务必设置 ","position":{"start":{"line":331,"column":1},"end":{"line":331,"column":1}},"key":"VN8DaiGCMf"},{"type":"link","url":"#can-short","position":{"start":{"line":331,"column":1},"end":{"line":331,"column":1}},"children":[{"type":"inlineCode","value":"can_short","position":{"start":{"line":331,"column":1},"end":{"line":331,"column":1}},"key":"TWI5cECA0h"}],"urlSource":"#can-short","key":"U74qOXwZom"},{"type":"text","value":" 为 True。","position":{"start":{"line":331,"column":1},"end":{"line":331,"column":1}},"key":"TdzaRlp101"}],"key":"XnQe0W8xF8"},{"type":"code","lang":"python","value":"# 支持多空\ncan_short = True\n\ndef populate_entry_trend(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n    dataframe.loc[\n        (\n            (qtpylib.crossed_above(dataframe['rsi'], 30)) &\n            (dataframe['tema'] <= dataframe['bb_middleband']) &\n            (dataframe['tema'] > dataframe['tema'].shift(1)) &\n            (dataframe['volume'] > 0)\n        ),\n        ['enter_long', 'enter_tag']] = (1, 'rsi_cross')\n\n    dataframe.loc[\n        (\n            (qtpylib.crossed_below(dataframe['rsi'], 70)) &\n            (dataframe['tema'] > dataframe['bb_middleband']) &\n            (dataframe['tema'] < dataframe['tema'].shift(1)) &\n            (dataframe['volume'] > 0)\n        ),\n        ['enter_short', 'enter_tag']] = (1, 'rsi_cross')\n\n    return dataframe","position":{"start":{"line":335,"column":1},"end":{"line":359,"column":1}},"key":"nNHnZVV4ds"}],"key":"ftK8KJU4v7"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Tip","key":"H4ugF3U0yT"}],"key":"ZmITOE3PFw"},{"type":"paragraph","position":{"start":{"line":364,"column":1},"end":{"line":364,"column":1}},"children":[{"type":"text","value":"买入需要有卖方，因此需 ","position":{"start":{"line":364,"column":1},"end":{"line":364,"column":1}},"key":"owZwA22Ot1"},{"type":"inlineCode","value":"dataframe['volume'] > 0","position":{"start":{"line":364,"column":1},"end":{"line":364,"column":1}},"key":"HicDSZ3kRQ"},{"type":"text","value":"，避免在无成交量时买入/卖出。","position":{"start":{"line":364,"column":1},"end":{"line":364,"column":1}},"key":"hJX1uqAmZA"}],"key":"vKPdqMsqEf"}],"key":"PYX9zLBfwi"},{"type":"heading","depth":4,"position":{"start":{"line":367,"column":1},"end":{"line":367,"column":1}},"children":[{"type":"text","value":"出场信号规则","position":{"start":{"line":367,"column":1},"end":{"line":367,"column":1}},"key":"s5B9Sl9rqh"}],"identifier":"id","label":"出场信号规则","html_id":"id-10","implicit":true,"key":"Q5is4noRLU"},{"type":"paragraph","position":{"start":{"line":369,"column":1},"end":{"line":369,"column":1}},"children":[{"type":"text","value":"编辑策略文件中的 ","position":{"start":{"line":369,"column":1},"end":{"line":369,"column":1}},"key":"M5KwwOpIDM"},{"type":"inlineCode","value":"populate_exit_trend()","position":{"start":{"line":369,"column":1},"end":{"line":369,"column":1}},"key":"Ln53EOAjfH"},{"type":"text","value":" 方法，更新出场逻辑。","position":{"start":{"line":369,"column":1},"end":{"line":369,"column":1}},"key":"GEoGNQQMwn"}],"key":"FPbQWpyOy3"},{"type":"paragraph","position":{"start":{"line":371,"column":1},"end":{"line":371,"column":1}},"children":[{"type":"text","value":"可通过在配置或策略中设置 ","position":{"start":{"line":371,"column":1},"end":{"line":371,"column":1}},"key":"egyXWdWo0i"},{"type":"inlineCode","value":"use_exit_signal","position":{"start":{"line":371,"column":1},"end":{"line":371,"column":1}},"key":"NglJ0FL7ZK"},{"type":"text","value":" 为 false 禁用出场信号。","position":{"start":{"line":371,"column":1},"end":{"line":371,"column":1}},"key":"d6on6cEUcL"}],"key":"rGWSuiBRaB"},{"type":"paragraph","position":{"start":{"line":373,"column":1},"end":{"line":373,"column":1}},"children":[{"type":"inlineCode","value":"use_exit_signal","position":{"start":{"line":373,"column":1},"end":{"line":373,"column":1}},"key":"OIXNS3UE11"},{"type":"text","value":" 不影响","position":{"start":{"line":373,"column":1},"end":{"line":373,"column":1}},"key":"GYk6gTgZQT"},{"type":"crossReference","position":{"start":{"line":373,"column":1},"end":{"line":373,"column":1}},"children":[{"type":"text","value":"信号冲突规则","position":{"start":{"line":373,"column":1},"end":{"line":373,"column":1}},"key":"ZVevijZnqV"}],"identifier":"colliding-signals","label":"colliding-signals","kind":"heading","template":"{name}","resolved":true,"html_id":"colliding-signals","key":"abuZZODach"},{"type":"text","value":"，后者仍然生效，可能阻止入场。","position":{"start":{"line":373,"column":1},"end":{"line":373,"column":1}},"key":"a6HL4zkg5B"}],"key":"bphg9pRPvG"},{"type":"paragraph","position":{"start":{"line":375,"column":1},"end":{"line":375,"column":1}},"children":[{"type":"text","value":"务必返回 dataframe，且不要删除/修改 “open”, “high”, “low”, “close”, “volume” 这几列，否则会导致异常。","position":{"start":{"line":375,"column":1},"end":{"line":375,"column":1}},"key":"Mw0btjci9Z"}],"key":"ylPwZZdjqI"},{"type":"paragraph","position":{"start":{"line":377,"column":1},"end":{"line":377,"column":1}},"children":[{"type":"text","value":"该方法还需定义新列 ","position":{"start":{"line":377,"column":1},"end":{"line":377,"column":1}},"key":"NIw6tp0tUv"},{"type":"inlineCode","value":"exit_long","position":{"start":{"line":377,"column":1},"end":{"line":377,"column":1}},"key":"QWdGyQOGqW"},{"type":"text","value":"（做空为 ","position":{"start":{"line":377,"column":1},"end":{"line":377,"column":1}},"key":"VUwzTJ7EDb"},{"type":"inlineCode","value":"exit_short","position":{"start":{"line":377,"column":1},"end":{"line":377,"column":1}},"key":"SsojZR4UwH"},{"type":"text","value":"），出场时为 1，无操作为 0。","position":{"start":{"line":377,"column":1},"end":{"line":377,"column":1}},"key":"q4qhwEtZnZ"}],"key":"kfDpx4HryV"},{"type":"paragraph","position":{"start":{"line":379,"column":1},"end":{"line":379,"column":1}},"children":[{"type":"text","value":"可用 ","position":{"start":{"line":379,"column":1},"end":{"line":379,"column":1}},"key":"FgG8FySnyG"},{"type":"inlineCode","value":"exit_tag","position":{"start":{"line":379,"column":1},"end":{"line":379,"column":1}},"key":"flfSNOy0DG"},{"type":"text","value":" 列为信号命名，便于后续调试和分析。","position":{"start":{"line":379,"column":1},"end":{"line":379,"column":1}},"key":"VNpAqLvdTc"}],"key":"RY1CLqJpwp"},{"type":"paragraph","position":{"start":{"line":381,"column":1},"end":{"line":381,"column":1}},"children":[{"type":"text","value":"示例（来自 sample_strategy.py）：","position":{"start":{"line":381,"column":1},"end":{"line":381,"column":1}},"key":"O2fQ2FoYg5"}],"key":"ohV9qCS1SL"},{"type":"code","lang":"python","value":"def populate_exit_trend(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n    \"\"\"\n    基于技术指标，为给定 dataframe 生成卖出信号\n    :param dataframe: 已填充指标的 DataFrame\n    :param metadata: 额外信息，如当前交易对\n    :return: 包含卖出信号的 DataFrame\n    \"\"\"\n    dataframe.loc[\n        (\n            (qtpylib.crossed_above(dataframe['rsi'], 70)) &  # RSI 上穿 70\n            (dataframe['tema'] > dataframe['bb_middleband']) &  # 条件\n            (dataframe['tema'] < dataframe['tema'].shift(1)) &  # 条件\n            (dataframe['volume'] > 0)  # 确保有成交量\n        ),\n        ['exit_long', 'exit_tag']] = (1, 'rsi_too_high')\n    return dataframe","position":{"start":{"line":383,"column":1},"end":{"line":400,"column":1}},"key":"pgv9eigrjK"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"做空平仓","position":{"start":{"line":402,"column":1},"end":{"line":402,"column":1}},"key":"fl58KLKASm"}],"key":"IgPUkwC4Ov"},{"type":"paragraph","position":{"start":{"line":403,"column":1},"end":{"line":403,"column":1}},"children":[{"type":"text","value":"做空平仓可通过设置 ","position":{"start":{"line":403,"column":1},"end":{"line":403,"column":1}},"key":"It4pL6D1bi"},{"type":"inlineCode","value":"exit_short","position":{"start":{"line":403,"column":1},"end":{"line":403,"column":1}},"key":"Z9se41C8T3"},{"type":"text","value":"（对应多头的 ","position":{"start":{"line":403,"column":1},"end":{"line":403,"column":1}},"key":"WAmQmSzI2V"},{"type":"inlineCode","value":"exit_long","position":{"start":{"line":403,"column":1},"end":{"line":403,"column":1}},"key":"zD58Wpz7EI"},{"type":"text","value":"）实现。","position":{"start":{"line":403,"column":1},"end":{"line":403,"column":1}},"key":"OPiCq9esin"}],"key":"SqgwqL7ELt"},{"type":"paragraph","position":{"start":{"line":405,"column":1},"end":{"line":405,"column":1}},"children":[{"type":"inlineCode","value":"exit_tag","position":{"start":{"line":405,"column":1},"end":{"line":405,"column":1}},"key":"CZOerJ2nwr"},{"type":"text","value":" 列用法相同。","position":{"start":{"line":405,"column":1},"end":{"line":405,"column":1}},"key":"xKpHr4i8dq"}],"key":"TrAyDSI1B9"},{"type":"paragraph","position":{"start":{"line":407,"column":1},"end":{"line":407,"column":1}},"children":[{"type":"text","value":"做空需交易所和市场支持！如需做空，务必设置 ","position":{"start":{"line":407,"column":1},"end":{"line":407,"column":1}},"key":"rMskFEaPfu"},{"type":"link","url":"#can-short","position":{"start":{"line":407,"column":1},"end":{"line":407,"column":1}},"children":[{"type":"inlineCode","value":"can_short","position":{"start":{"line":407,"column":1},"end":{"line":407,"column":1}},"key":"veLNIgTst9"}],"urlSource":"#can-short","key":"Sdwjw7GykJ"},{"type":"text","value":" 为 True。","position":{"start":{"line":407,"column":1},"end":{"line":407,"column":1}},"key":"t7paycSKVb"}],"key":"XZCU8ob06x"},{"type":"code","lang":"python","value":"    # 支持多空\n    can_short = True\n\n    def populate_exit_trend(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n        dataframe.loc[\n            (\n                (qtpylib.crossed_above(dataframe['rsi'], 70)) &\n                (dataframe['tema'] > dataframe['bb_middleband']) &\n                (dataframe['tema'] < dataframe['tema'].shift(1)) &\n                (dataframe['volume'] > 0)\n            ),\n            ['exit_long', 'exit_tag']] = (1, 'rsi_too_high')\n        dataframe.loc[\n            (\n                (qtpylib.crossed_below(dataframe['rsi'], 30)) &\n                (dataframe['tema'] < dataframe['bb_middleband']) &\n                (dataframe['tema'] > dataframe['tema'].shift(1)) &\n                (dataframe['volume'] > 0)\n            ),\n            ['exit_short', 'exit_tag']] = (1, 'rsi_too_low')\n        return dataframe","position":{"start":{"line":409,"column":1},"end":{"line":431,"column":1}},"key":"n9C8P5JkDI"}],"key":"OgYiz6DLAP"},{"type":"heading","depth":4,"position":{"start":{"line":435,"column":1},"end":{"line":435,"column":1}},"children":[{"type":"text","value":"最小收益率（ROI）","position":{"start":{"line":435,"column":1},"end":{"line":435,"column":1}},"key":"iwsztWiITT"}],"identifier":"id-roi","label":"最小收益率（ROI）","html_id":"id-roi","implicit":true,"key":"fcDDdy9BIT"},{"type":"paragraph","position":{"start":{"line":437,"column":1},"end":{"line":437,"column":1}},"children":[{"type":"inlineCode","value":"minimal_roi","position":{"start":{"line":437,"column":1},"end":{"line":437,"column":1}},"key":"V6m4LTwIji"},{"type":"text","value":" 策略变量定义了交易在退出前应达到的最小收益率，与出场信号无关。","position":{"start":{"line":437,"column":1},"end":{"line":437,"column":1}},"key":"CbdiJvwR81"}],"key":"PTYuFsLvTl"},{"type":"paragraph","position":{"start":{"line":439,"column":1},"end":{"line":439,"column":1}},"children":[{"type":"text","value":"格式如下，是一个 python 字典，键为开仓后经过的分钟数，值为百分比：","position":{"start":{"line":439,"column":1},"end":{"line":439,"column":1}},"key":"fxKAvPkHqs"}],"key":"e75ckul3I6"},{"type":"code","lang":"python","value":"minimal_roi = {\n    \"40\": 0.0,\n    \"30\": 0.01,\n    \"20\": 0.02,\n    \"0\": 0.04\n}","position":{"start":{"line":441,"column":1},"end":{"line":448,"column":1}},"key":"olBMmwMD54"},{"type":"paragraph","position":{"start":{"line":450,"column":1},"end":{"line":450,"column":1}},"children":[{"type":"text","value":"上述配置含义：","position":{"start":{"line":450,"column":1},"end":{"line":450,"column":1}},"key":"YhYUYu3otf"}],"key":"aqvfFM3lXs"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":452,"column":1},"end":{"line":456,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":452,"column":1},"end":{"line":452,"column":1}},"children":[{"type":"text","value":"达到 4% 盈利时退出","position":{"start":{"line":452,"column":1},"end":{"line":452,"column":1}},"key":"BqdIvA5gzF"}],"key":"reKAoIvOJL"},{"type":"listItem","spread":true,"position":{"start":{"line":453,"column":1},"end":{"line":453,"column":1}},"children":[{"type":"text","value":"20 分钟后达到 2% 盈利时退出","position":{"start":{"line":453,"column":1},"end":{"line":453,"column":1}},"key":"Ng2lLhYIiR"}],"key":"gGUvNNuICw"},{"type":"listItem","spread":true,"position":{"start":{"line":454,"column":1},"end":{"line":454,"column":1}},"children":[{"type":"text","value":"30 分钟后达到 1% 盈利时退出","position":{"start":{"line":454,"column":1},"end":{"line":454,"column":1}},"key":"vOKLYjpeFd"}],"key":"hQPoGjAVsG"},{"type":"listItem","spread":true,"position":{"start":{"line":455,"column":1},"end":{"line":456,"column":1}},"children":[{"type":"text","value":"40 分钟后只要不亏损就退出","position":{"start":{"line":455,"column":1},"end":{"line":455,"column":1}},"key":"hQlpZ39mNe"}],"key":"BdiY5AHKBc"}],"key":"R19emHYxpc"},{"type":"paragraph","position":{"start":{"line":457,"column":1},"end":{"line":457,"column":1}},"children":[{"type":"text","value":"计算时包含手续费。","position":{"start":{"line":457,"column":1},"end":{"line":457,"column":1}},"key":"ibOPMD0Nhr"}],"key":"TEknPIBV4f"},{"type":"heading","depth":5,"position":{"start":{"line":459,"column":1},"end":{"line":459,"column":1}},"children":[{"type":"text","value":"禁用最小 ROI","position":{"start":{"line":459,"column":1},"end":{"line":459,"column":1}},"key":"JNV8JQzwY9"}],"identifier":"id-roi","label":"禁用最小 ROI","html_id":"id-roi-1","implicit":true,"key":"m32EzU3XRc"},{"type":"paragraph","position":{"start":{"line":461,"column":1},"end":{"line":461,"column":1}},"children":[{"type":"text","value":"如需完全禁用 ROI，将其设为空字典：","position":{"start":{"line":461,"column":1},"end":{"line":461,"column":1}},"key":"JCbDxtFds3"}],"key":"jIq8d81rCM"},{"type":"code","lang":"python","value":"minimal_roi = {}","position":{"start":{"line":463,"column":1},"end":{"line":465,"column":1}},"key":"SwVshjIZXi"},{"type":"heading","depth":5,"position":{"start":{"line":467,"column":1},"end":{"line":467,"column":1}},"children":[{"type":"text","value":"ROI 中用计算表达式","position":{"start":{"line":467,"column":1},"end":{"line":467,"column":1}},"key":"ozErWol59K"}],"identifier":"roi","label":"ROI 中用计算表达式","html_id":"roi","implicit":true,"key":"SI7Undo3ki"},{"type":"paragraph","position":{"start":{"line":469,"column":1},"end":{"line":469,"column":1}},"children":[{"type":"text","value":"如需按K线周期（timeframe）设置时间，可用如下写法：","position":{"start":{"line":469,"column":1},"end":{"line":469,"column":1}},"key":"uIkdK5GxBE"}],"key":"Mhd9doEEib"},{"type":"code","lang":"python","value":"from freqtrade.exchange import timeframe_to_minutes\n\nclass AwesomeStrategy(IStrategy):\n\n    timeframe = \"1d\"\n    timeframe_mins = timeframe_to_minutes(timeframe)\n    minimal_roi = {\n        \"0\": 0.05,                      # 前 3 根 K 线 5%\n        str(timeframe_mins * 3): 0.02,  # 3 根 K 线后 2%\n        str(timeframe_mins * 6): 0.01,  # 6 根 K 线后 1%\n    }","position":{"start":{"line":471,"column":1},"end":{"line":483,"column":1}},"key":"XmwxRFNSgQ"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"未立即成交的订单","position":{"start":{"line":485,"column":1},"end":{"line":485,"column":1}},"key":"kjoiQt2UGJ"}],"key":"TEtvFQn9eA"},{"type":"paragraph","position":{"start":{"line":486,"column":1},"end":{"line":486,"column":1}},"children":[{"type":"inlineCode","value":"minimal_roi","position":{"start":{"line":486,"column":1},"end":{"line":486,"column":1}},"key":"gb2tQ4DA3d"},{"type":"text","value":" 以 ","position":{"start":{"line":486,"column":1},"end":{"line":486,"column":1}},"key":"GlsFSNIY0f"},{"type":"inlineCode","value":"trade.open_date","position":{"start":{"line":486,"column":1},"end":{"line":486,"column":1}},"key":"F3P9dqGyAJ"},{"type":"text","value":" 为基准，即首次下单时间。","position":{"start":{"line":486,"column":1},"end":{"line":486,"column":1}},"key":"rcQKcjRZ3P"}],"key":"hqKjy6JpZq"},{"type":"paragraph","position":{"start":{"line":488,"column":1},"end":{"line":488,"column":1}},"children":[{"type":"text","value":"对于未立即成交的限价单（如用 ","position":{"start":{"line":488,"column":1},"end":{"line":488,"column":1}},"key":"YNUE7KDyli"},{"type":"inlineCode","value":"custom_entry_price()","position":{"start":{"line":488,"column":1},"end":{"line":488,"column":1}},"key":"symLx87DAc"},{"type":"text","value":"），或用 ","position":{"start":{"line":488,"column":1},"end":{"line":488,"column":1}},"key":"G68Zrzu5gg"},{"type":"inlineCode","value":"adjust_entry_price()","position":{"start":{"line":488,"column":1},"end":{"line":488,"column":1}},"key":"QBiRUEyAkW"},{"type":"text","value":" 调整价格的情况，时间仍以首次下单为准。","position":{"start":{"line":488,"column":1},"end":{"line":488,"column":1}},"key":"tpy0TwII2X"}],"key":"mZYS3RWthE"}],"key":"Rri0w1UIqU"},{"type":"heading","depth":4,"position":{"start":{"line":491,"column":1},"end":{"line":491,"column":1}},"children":[{"type":"text","value":"止损","position":{"start":{"line":491,"column":1},"end":{"line":491,"column":1}},"key":"O1Iu3T1eBQ"}],"identifier":"id","label":"止损","html_id":"id-11","implicit":true,"key":"IjiE3BKjEp"},{"type":"paragraph","position":{"start":{"line":493,"column":1},"end":{"line":493,"column":1}},"children":[{"type":"text","value":"强烈建议设置止损，以保护资金免受极端行情影响。","position":{"start":{"line":493,"column":1},"end":{"line":493,"column":1}},"key":"VV9FUyrc7c"}],"key":"GCYPExfLs1"},{"type":"paragraph","position":{"start":{"line":495,"column":1},"end":{"line":495,"column":1}},"children":[{"type":"text","value":"如设置 10% 止损：","position":{"start":{"line":495,"column":1},"end":{"line":495,"column":1}},"key":"dbGY1ERq8c"}],"key":"pg8pGKzIJX"},{"type":"code","lang":"python","value":"stoploss = -0.10","position":{"start":{"line":497,"column":1},"end":{"line":499,"column":1}},"key":"FvjcfShLHv"},{"type":"paragraph","position":{"start":{"line":501,"column":1},"end":{"line":501,"column":1}},"children":[{"type":"text","value":"更多止损功能详见","position":{"start":{"line":501,"column":1},"end":{"line":501,"column":1}},"key":"ntJsP9hGGM"},{"type":"link","url":"/stoploss","position":{"start":{"line":501,"column":1},"end":{"line":501,"column":1}},"children":[{"type":"text","value":"止损专页","position":{"start":{"line":501,"column":1},"end":{"line":501,"column":1}},"key":"bCRFSwr9y4"}],"urlSource":"stoploss.md","dataUrl":"/stoploss.json","internal":true,"protocol":"file","key":"XKCapTVfur"},{"type":"text","value":"。","position":{"start":{"line":501,"column":1},"end":{"line":501,"column":1}},"key":"ee5QgPZokd"}],"key":"CvhhDVNP8t"},{"type":"heading","depth":4,"position":{"start":{"line":503,"column":1},"end":{"line":503,"column":1}},"children":[{"type":"text","value":"时间周期（Timeframe）","position":{"start":{"line":503,"column":1},"end":{"line":503,"column":1}},"key":"amqOJEalbE"}],"identifier":"id-timeframe","label":"时间周期（Timeframe）","html_id":"id-timeframe","implicit":true,"key":"rnJI0xNRq5"},{"type":"paragraph","position":{"start":{"line":505,"column":1},"end":{"line":505,"column":1}},"children":[{"type":"text","value":"即策略用的K线周期。","position":{"start":{"line":505,"column":1},"end":{"line":505,"column":1}},"key":"kV9XU1B7zm"}],"key":"DzNz5IaJxv"},{"type":"paragraph","position":{"start":{"line":507,"column":1},"end":{"line":507,"column":1}},"children":[{"type":"text","value":"常见值有 “1m”、“5m”、“15m”、“1h”，也可用交易所支持的其他周期。","position":{"start":{"line":507,"column":1},"end":{"line":507,"column":1}},"key":"hGTZ5WsvRm"}],"key":"Bo6jtaT2jH"},{"type":"paragraph","position":{"start":{"line":509,"column":1},"end":{"line":509,"column":1}},"children":[{"type":"text","value":"同一入场/出场信号在不同周期下效果可能完全不同。","position":{"start":{"line":509,"column":1},"end":{"line":509,"column":1}},"key":"JbH8IQa63F"}],"key":"AzzPpLHb7p"},{"type":"paragraph","position":{"start":{"line":511,"column":1},"end":{"line":511,"column":1}},"children":[{"type":"text","value":"在策略方法中可通过 ","position":{"start":{"line":511,"column":1},"end":{"line":511,"column":1}},"key":"HrKXuDzeS6"},{"type":"inlineCode","value":"self.timeframe","position":{"start":{"line":511,"column":1},"end":{"line":511,"column":1}},"key":"gqnNVgxGPe"},{"type":"text","value":" 访问。","position":{"start":{"line":511,"column":1},"end":{"line":511,"column":1}},"key":"Deg8LOgTXH"}],"key":"NvRRzl489B"},{"type":"heading","depth":4,"position":{"start":{"line":513,"column":1},"end":{"line":513,"column":1}},"children":[{"type":"text","value":"是否支持做空","position":{"start":{"line":513,"column":1},"end":{"line":513,"column":1}},"key":"FvOlX94p6d"}],"identifier":"id","label":"是否支持做空","html_id":"id-12","implicit":true,"key":"zYZLHZ4vaT"},{"type":"paragraph","position":{"start":{"line":515,"column":1},"end":{"line":515,"column":1}},"children":[{"type":"text","value":"如需在合约市场做空，需设置 ","position":{"start":{"line":515,"column":1},"end":{"line":515,"column":1}},"key":"lznOH1JMZW"},{"type":"inlineCode","value":"can_short = True","position":{"start":{"line":515,"column":1},"end":{"line":515,"column":1}},"key":"HW1BNYQ0HK"},{"type":"text","value":"。","position":{"start":{"line":515,"column":1},"end":{"line":515,"column":1}},"key":"yQyXUkPhqt"}],"key":"xBAMgZ06Lo"},{"type":"paragraph","position":{"start":{"line":517,"column":1},"end":{"line":517,"column":1}},"children":[{"type":"text","value":"启用后，策略在现货市场会加载失败。","position":{"start":{"line":517,"column":1},"end":{"line":517,"column":1}},"key":"J36gfMv7zj"}],"key":"NcuwUyMbkd"},{"type":"paragraph","position":{"start":{"line":519,"column":1},"end":{"line":519,"column":1}},"children":[{"type":"text","value":"如 ","position":{"start":{"line":519,"column":1},"end":{"line":519,"column":1}},"key":"CKekkumWV5"},{"type":"inlineCode","value":"enter_short","position":{"start":{"line":519,"column":1},"end":{"line":519,"column":1}},"key":"zERd36tLNN"},{"type":"text","value":" 列有 1，但 ","position":{"start":{"line":519,"column":1},"end":{"line":519,"column":1}},"key":"X0YTJSpBE2"},{"type":"inlineCode","value":"can_short = False","position":{"start":{"line":519,"column":1},"end":{"line":519,"column":1}},"key":"wG8CKFZHQL"},{"type":"text","value":"（默认），则即使配置了合约市场也不会做空。","position":{"start":{"line":519,"column":1},"end":{"line":519,"column":1}},"key":"H0z1VtVeAE"}],"key":"roQArv8Vk7"},{"type":"heading","depth":4,"position":{"start":{"line":521,"column":1},"end":{"line":521,"column":1}},"children":[{"type":"text","value":"Metadata 字典","position":{"start":{"line":521,"column":1},"end":{"line":521,"column":1}},"key":"Fg9AWwLzuI"}],"identifier":"metadata","label":"Metadata 字典","html_id":"metadata","implicit":true,"key":"ndRg582mSf"},{"type":"paragraph","position":{"start":{"line":523,"column":1},"end":{"line":524,"column":1}},"children":[{"type":"inlineCode","value":"metadata","position":{"start":{"line":523,"column":1},"end":{"line":523,"column":1}},"key":"XFjCAkJY5q"},{"type":"text","value":" 字典（","position":{"start":{"line":523,"column":1},"end":{"line":523,"column":1}},"key":"ugfO5qTV7Y"},{"type":"inlineCode","value":"populate_entry_trend","position":{"start":{"line":523,"column":1},"end":{"line":523,"column":1}},"key":"igAVSmJEMo"},{"type":"text","value":"、","position":{"start":{"line":523,"column":1},"end":{"line":523,"column":1}},"key":"xvBlY84g4a"},{"type":"inlineCode","value":"populate_exit_trend","position":{"start":{"line":523,"column":1},"end":{"line":523,"column":1}},"key":"pGofkTsSRd"},{"type":"text","value":"、","position":{"start":{"line":523,"column":1},"end":{"line":523,"column":1}},"key":"vB0sBmFWTa"},{"type":"inlineCode","value":"populate_indicators","position":{"start":{"line":523,"column":1},"end":{"line":523,"column":1}},"key":"kU8tEsPoYR"},{"type":"text","value":" 可用）包含额外信息。\n目前有 ","position":{"start":{"line":523,"column":1},"end":{"line":523,"column":1}},"key":"l510Ge7wPk"},{"type":"inlineCode","value":"pair","position":{"start":{"line":523,"column":1},"end":{"line":523,"column":1}},"key":"g3J7ld3CO0"},{"type":"text","value":"，可通过 ","position":{"start":{"line":523,"column":1},"end":{"line":523,"column":1}},"key":"UcbU2V0FxO"},{"type":"inlineCode","value":"metadata['pair']","position":{"start":{"line":523,"column":1},"end":{"line":523,"column":1}},"key":"CFQ9FEkMoE"},{"type":"text","value":" 获取，如 ","position":{"start":{"line":523,"column":1},"end":{"line":523,"column":1}},"key":"sx9SSgdnqc"},{"type":"inlineCode","value":"XRP/BTC","position":{"start":{"line":523,"column":1},"end":{"line":523,"column":1}},"key":"B5YFqdb9K2"},{"type":"text","value":"（合约市场为 ","position":{"start":{"line":523,"column":1},"end":{"line":523,"column":1}},"key":"JIE9fHesEk"},{"type":"inlineCode","value":"XRP/BTC:BTC","position":{"start":{"line":523,"column":1},"end":{"line":523,"column":1}},"key":"pzKL60lpOf"},{"type":"text","value":"）。","position":{"start":{"line":523,"column":1},"end":{"line":523,"column":1}},"key":"gHXLqWJ1I6"}],"key":"xy3HeVNYgU"},{"type":"paragraph","position":{"start":{"line":526,"column":1},"end":{"line":526,"column":1}},"children":[{"type":"text","value":"metadata 不应被修改，也不会在策略函数间持久化。","position":{"start":{"line":526,"column":1},"end":{"line":526,"column":1}},"key":"PxpLLureIc"}],"key":"dV7aGbSwaL"},{"type":"paragraph","position":{"start":{"line":528,"column":1},"end":{"line":528,"column":1}},"children":[{"type":"text","value":"如需持久化信息，请查阅","position":{"start":{"line":528,"column":1},"end":{"line":528,"column":1}},"key":"NYWKFTYDsx"},{"type":"crossReference","url":"/strategy-advanced","position":{"start":{"line":528,"column":1},"end":{"line":528,"column":1}},"children":[{"type":"text","value":"信息存储","position":{"start":{"line":528,"column":1},"end":{"line":528,"column":1}},"key":"Tu9uMpiUMD"}],"urlSource":"strategy-advanced.md#storing-information-persistent","dataUrl":"/strategy-advanced.json","identifier":"storing-information-persistent","label":"storing-information-persistent","remote":true,"protocol":"file","key":"YZKHSoiF1H"},{"type":"text","value":"。","position":{"start":{"line":528,"column":1},"end":{"line":528,"column":1}},"key":"AQntWjvFnJ"}],"key":"QqU6gS0FHt"},{"type":"include","file":"includes/strategy-imports.md","literal":false,"lang":"markdown","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"策略所需的导入","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DjpfGhPjj6"}],"identifier":"id","label":"策略所需的导入","html_id":"id-13","implicit":true,"key":"HXnnQTRfui"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"在创建策略时，你需要导入必要的模块和类。以下是一个策略所需的导入：","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"r5rXEcNFdB"}],"key":"k0UpeOzdxg"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"默认情况下，我们建议使用以下导入作为策略的基础：\n这将涵盖 freqtrade 功能所需的所有导入。\n当然，你可以根据需要添加更多导入。","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"MOYabdinVk"}],"key":"vfxx8m7uIR"},{"type":"code","lang":"python","value":"# flake8: noqa: F401\n# isort: skip_file\n# --- Do not remove these imports ---\nimport numpy as np\nimport pandas as pd\nfrom datetime import datetime, timedelta, timezone\nfrom pandas import DataFrame\nfrom typing import Dict, Optional, Union, Tuple\n\nfrom freqtrade.strategy import (\n    IStrategy,\n    Trade, \n    Order,\n    PairLocks,\n    informative,  # @informative decorator\n    # Hyperopt Parameters\n    BooleanParameter,\n    CategoricalParameter,\n    DecimalParameter,\n    IntParameter,\n    RealParameter,\n    # timeframe helpers\n    timeframe_to_minutes,\n    timeframe_to_next_date,\n    timeframe_to_prev_date,\n    # Strategy helper functions\n    merge_informative_pair,\n    stoploss_from_absolute,\n    stoploss_from_open,\n)\n\n# --------------------------------\n# Add your lib to import here\nimport talib.abstract as ta\nfrom technical import qtpylib","position":{"start":{"line":9,"column":1},"end":{"line":45,"column":1}},"key":"IfZgZsWyLK"}],"key":"jh687BlSeu"},{"type":"heading","depth":3,"position":{"start":{"line":533,"column":1},"end":{"line":533,"column":1}},"children":[{"type":"text","value":"策略文件加载","position":{"start":{"line":533,"column":1},"end":{"line":533,"column":1}},"key":"roIWu65QDJ"}],"identifier":"id","label":"策略文件加载","html_id":"id-14","implicit":true,"key":"tQ0900s288"},{"type":"paragraph","position":{"start":{"line":535,"column":1},"end":{"line":535,"column":1}},"children":[{"type":"text","value":"默认情况下，freqtrade 会尝试从 ","position":{"start":{"line":535,"column":1},"end":{"line":535,"column":1}},"key":"n1FmkFxUpo"},{"type":"inlineCode","value":"userdir","position":{"start":{"line":535,"column":1},"end":{"line":535,"column":1}},"key":"xA6Qg5PwmW"},{"type":"text","value":"（默认 ","position":{"start":{"line":535,"column":1},"end":{"line":535,"column":1}},"key":"SEXFyUhlci"},{"type":"inlineCode","value":"user_data/strategies","position":{"start":{"line":535,"column":1},"end":{"line":535,"column":1}},"key":"iXLmbwjCXe"},{"type":"text","value":"）下所有 ","position":{"start":{"line":535,"column":1},"end":{"line":535,"column":1}},"key":"Egz491sP22"},{"type":"inlineCode","value":".py","position":{"start":{"line":535,"column":1},"end":{"line":535,"column":1}},"key":"YSIbAzbsEx"},{"type":"text","value":" 文件加载策略。","position":{"start":{"line":535,"column":1},"end":{"line":535,"column":1}},"key":"Q6puzGRNj9"}],"key":"iRilIRysJk"},{"type":"paragraph","position":{"start":{"line":537,"column":1},"end":{"line":537,"column":1}},"children":[{"type":"text","value":"假设你的策略叫 ","position":{"start":{"line":537,"column":1},"end":{"line":537,"column":1}},"key":"Dy0xmaKkjE"},{"type":"inlineCode","value":"AwesomeStrategy","position":{"start":{"line":537,"column":1},"end":{"line":537,"column":1}},"key":"SZb6BfYh9L"},{"type":"text","value":"，文件为 ","position":{"start":{"line":537,"column":1},"end":{"line":537,"column":1}},"key":"tCmfJj09HX"},{"type":"inlineCode","value":"user_data/strategies/AwesomeStrategy.py","position":{"start":{"line":537,"column":1},"end":{"line":537,"column":1}},"key":"beJcoJBybD"},{"type":"text","value":"，可用如下命令 dry（或 live，视配置而定）运行：","position":{"start":{"line":537,"column":1},"end":{"line":537,"column":1}},"key":"jUpRJLBZ5s"}],"key":"bJh9SXp7xh"},{"type":"code","lang":"bash","value":"freqtrade trade --strategy AwesomeStrategy","position":{"start":{"line":539,"column":1},"end":{"line":541,"column":1}},"key":"WPLbngG3xu"},{"type":"paragraph","position":{"start":{"line":543,"column":1},"end":{"line":543,"column":1}},"children":[{"type":"text","value":"注意这里用的是类名，不是文件名。","position":{"start":{"line":543,"column":1},"end":{"line":543,"column":1}},"key":"eCEDFxhUSa"}],"key":"q0I52stFNu"},{"type":"paragraph","position":{"start":{"line":545,"column":1},"end":{"line":545,"column":1}},"children":[{"type":"text","value":"用 ","position":{"start":{"line":545,"column":1},"end":{"line":545,"column":1}},"key":"v4wc81KY36"},{"type":"inlineCode","value":"freqtrade list-strategies","position":{"start":{"line":545,"column":1},"end":{"line":545,"column":1}},"key":"hX7Rlm5shB"},{"type":"text","value":" 可查看所有可加载的策略（正确目录下的所有策略）。会有\"状态\"字段，提示潜在问题。","position":{"start":{"line":545,"column":1},"end":{"line":545,"column":1}},"key":"t6Ocaw4Si3"}],"key":"kGUNoismpo"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"自定义策略目录","position":{"start":{"line":547,"column":1},"end":{"line":547,"column":1}},"key":"YCo8CHmyGd"}],"key":"wOA7WpNWvA"},{"type":"paragraph","position":{"start":{"line":548,"column":1},"end":{"line":548,"column":1}},"children":[{"type":"text","value":"可用 ","position":{"start":{"line":548,"column":1},"end":{"line":548,"column":1}},"key":"rBooEfuQZM"},{"type":"inlineCode","value":"--strategy-path user_data/otherPath","position":{"start":{"line":548,"column":1},"end":{"line":548,"column":1}},"key":"azlsYibXSI"},{"type":"text","value":" 指定其他目录。所有需用策略的命令均支持此参数。","position":{"start":{"line":548,"column":1},"end":{"line":548,"column":1}},"key":"LOzKflpmEU"}],"key":"x6Zs4YJHjw"}],"key":"Gkq22zwdfB"},{"type":"heading","depth":3,"position":{"start":{"line":553,"column":1},"end":{"line":553,"column":1}},"children":[{"type":"text","value":"辅助交易对（Informative Pairs）","position":{"start":{"line":553,"column":1},"end":{"line":553,"column":1}},"key":"yuWzbm4Bj5"}],"label":"informative-pairs","identifier":"informative-pairs","html_id":"informative-pairs","key":"UEu2oqCMnK"},{"type":"heading","depth":4,"position":{"start":{"line":557,"column":1},"end":{"line":557,"column":1}},"children":[{"type":"text","value":"获取非交易对的数据","position":{"start":{"line":557,"column":1},"end":{"line":557,"column":1}},"key":"ogMQiz5hfU"}],"label":"get-data-for-non-tradeable-pairs","identifier":"get-data-for-non-tradeable-pairs","html_id":"get-data-for-non-tradeable-pairs","key":"ZAQucRBsri"},{"type":"paragraph","position":{"start":{"line":559,"column":1},"end":{"line":559,"column":1}},"children":[{"type":"text","value":"有些策略需要参考更大周期的其他交易对数据。","position":{"start":{"line":559,"column":1},"end":{"line":559,"column":1}},"key":"GiKagsS8jl"}],"key":"WHInDZiKj6"},{"type":"paragraph","position":{"start":{"line":561,"column":1},"end":{"line":561,"column":1}},"children":[{"type":"text","value":"这些辅助对的 OHLCV 数据会在常规白名单刷新时一并下载，可通过 ","position":{"start":{"line":561,"column":1},"end":{"line":561,"column":1}},"key":"lDoeEp2set"},{"type":"inlineCode","value":"DataProvider","position":{"start":{"line":561,"column":1},"end":{"line":561,"column":1}},"key":"bemPAoEqCn"},{"type":"text","value":" 获取。","position":{"start":{"line":561,"column":1},"end":{"line":561,"column":1}},"key":"RZ9NyyX6VZ"}],"key":"V42Hbo615j"},{"type":"paragraph","position":{"start":{"line":563,"column":1},"end":{"line":563,"column":1}},"children":[{"type":"text","value":"这些对","position":{"start":{"line":563,"column":1},"end":{"line":563,"column":1}},"key":"HiIR0PVJNp"},{"type":"strong","position":{"start":{"line":563,"column":1},"end":{"line":563,"column":1}},"children":[{"type":"text","value":"不会","position":{"start":{"line":563,"column":1},"end":{"line":563,"column":1}},"key":"QtF4vWmK7o"}],"key":"jgWr0g9INn"},{"type":"text","value":"被交易，除非也在白名单或被动态白名单（如 ","position":{"start":{"line":563,"column":1},"end":{"line":563,"column":1}},"key":"tlvCkXNgvB"},{"type":"inlineCode","value":"VolumePairlist","position":{"start":{"line":563,"column":1},"end":{"line":563,"column":1}},"key":"ZXhssfeu85"},{"type":"text","value":"）选中。","position":{"start":{"line":563,"column":1},"end":{"line":563,"column":1}},"key":"oYi32SZkI4"}],"key":"EgJ9tvf6lv"},{"type":"paragraph","position":{"start":{"line":565,"column":1},"end":{"line":565,"column":1}},"children":[{"type":"text","value":"需用元组指定，格式为 ","position":{"start":{"line":565,"column":1},"end":{"line":565,"column":1}},"key":"Pp3gWFZxw6"},{"type":"inlineCode","value":"(\"pair\", \"timeframe\")","position":{"start":{"line":565,"column":1},"end":{"line":565,"column":1}},"key":"XgYq4BQ6er"},{"type":"text","value":"，第一个为交易对，第二个为周期。","position":{"start":{"line":565,"column":1},"end":{"line":565,"column":1}},"key":"HD9l3iF5rM"}],"key":"FE7zXo5f1r"},{"type":"paragraph","position":{"start":{"line":567,"column":1},"end":{"line":567,"column":1}},"children":[{"type":"text","value":"示例：","position":{"start":{"line":567,"column":1},"end":{"line":567,"column":1}},"key":"R8650FEJyc"}],"key":"LEdIoqK6Wi"},{"type":"code","lang":"python","value":"def informative_pairs(self):\n    return [(\"ETH/USDT\", \"5m\"),\n            (\"BTC/TUSD\", \"15m\"),\n            ]","position":{"start":{"line":569,"column":1},"end":{"line":574,"column":1}},"key":"zRMo3gBKPs"},{"type":"paragraph","position":{"start":{"line":576,"column":1},"end":{"line":576,"column":1}},"children":[{"type":"text","value":"完整示例见","position":{"start":{"line":576,"column":1},"end":{"line":576,"column":1}},"key":"zqAG4E2S40"},{"type":"crossReference","position":{"start":{"line":576,"column":1},"end":{"line":576,"column":1}},"children":[{"type":"text","value":"DataProvider 部分","position":{"start":{"line":576,"column":1},"end":{"line":576,"column":1}},"key":"IudDmCpm5b"}],"identifier":"complete-dataprovider-sample","label":"complete-dataprovider-sample","kind":"heading","template":"{name}","resolved":true,"html_id":"complete-dataprovider-sample","key":"u84E1voGU2"},{"type":"text","value":"。","position":{"start":{"line":576,"column":1},"end":{"line":576,"column":1}},"key":"TBVjs0qgmZ"}],"key":"Kec88ZzDbR"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"gfJSAnrfsy"}],"key":"aLBePfbzoz"},{"type":"paragraph","position":{"start":{"line":579,"column":1},"end":{"line":579,"column":1}},"children":[{"type":"text","value":"这些对会随白名单刷新，建议列表不要太长。","position":{"start":{"line":579,"column":1},"end":{"line":579,"column":1}},"key":"dkMBpNvfFL"}],"key":"sDhLdrxAMY"},{"type":"paragraph","position":{"start":{"line":581,"column":1},"end":{"line":581,"column":1}},"children":[{"type":"text","value":"只要交易所支持，所有周期和对都可用。","position":{"start":{"line":581,"column":1},"end":{"line":581,"column":1}},"key":"eufhjiRL26"}],"key":"SzPL8lcZhQ"},{"type":"paragraph","position":{"start":{"line":583,"column":1},"end":{"line":583,"column":1}},"children":[{"type":"text","value":"但建议尽量用重采样方式获取大周期，避免请求过多被封。","position":{"start":{"line":583,"column":1},"end":{"line":583,"column":1}},"key":"ndVwgy18Sz"}],"key":"w9HH6xkKpq"}],"key":"ztCU2HvY6i"},{"type":"admonition","kind":"attention","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"其他K线类型","position":{"start":{"line":586,"column":1},"end":{"line":586,"column":1}},"key":"txx2N5x3pN"}],"key":"xJ8jOqhc9A"},{"type":"paragraph","position":{"start":{"line":587,"column":1},"end":{"line":587,"column":1}},"children":[{"type":"text","value":"informative_pairs 还可加第三个元素，显式指定K线类型。","position":{"start":{"line":587,"column":1},"end":{"line":587,"column":1}},"key":"g5SWn3OxNw"}],"key":"fmU3XW2i3K"},{"type":"paragraph","position":{"start":{"line":589,"column":1},"end":{"line":589,"column":1}},"children":[{"type":"text","value":"可用性取决于交易模式和交易所。一般现货对不能用于合约市场，反之亦然。","position":{"start":{"line":589,"column":1},"end":{"line":589,"column":1}},"key":"seLHvcIWpe"}],"key":"jRM9xVoyDc"},{"type":"paragraph","position":{"start":{"line":591,"column":1},"end":{"line":591,"column":1}},"children":[{"type":"text","value":"详情见交易所文档。","position":{"start":{"line":591,"column":1},"end":{"line":591,"column":1}},"key":"rBN9Dt41PV"}],"key":"wLJfHQR6eO"}],"key":"WpM4e9Yfub"},{"type":"code","lang":"python","value":"    def informative_pairs(self):\n        return [\n            (\"ETH/USDT\", \"5m\", \"\"),   # 默认 K 线类型，随 trading_mode 变化（推荐）\n            (\"ETH/USDT\", \"5m\", \"spot\"),   # 强制用现货 K 线（仅现货机器人）\n            (\"BTC/TUSD\", \"15m\", \"futures\"),  # 用合约 K 线（仅合约机器人）\n            (\"BTC/TUSD\", \"15m\", \"mark\"),  # 用标记 K 线（仅合约机器人）\n        ]","position":{"start":{"line":594,"column":1},"end":{"line":602,"column":1}},"key":"t3pLvbnpGm"},{"type":"heading","depth":4,"position":{"start":{"line":604,"column":1},"end":{"line":604,"column":1}},"children":[{"type":"text","value":"Informative pairs 装饰器（","position":{"start":{"line":604,"column":1},"end":{"line":604,"column":1}},"key":"Eih4Ef9Les"},{"type":"inlineCode","value":"@informative()","position":{"start":{"line":604,"column":1},"end":{"line":604,"column":1}},"key":"fGxMVQhpGP"},{"type":"text","value":"）","position":{"start":{"line":604,"column":1},"end":{"line":604,"column":1}},"key":"nskA8wQ9wT"}],"identifier":"informative-pairs-informative","label":"Informative pairs 装饰器（@informative()）","html_id":"informative-pairs-informative","implicit":true,"key":"RsWCVJhsX6"},{"type":"paragraph","position":{"start":{"line":606,"column":1},"end":{"line":606,"column":1}},"children":[{"type":"text","value":"可用 ","position":{"start":{"line":606,"column":1},"end":{"line":606,"column":1}},"key":"g1nwKaYQF5"},{"type":"inlineCode","value":"@informative","position":{"start":{"line":606,"column":1},"end":{"line":606,"column":1}},"key":"LHEP3oCywb"},{"type":"text","value":" 装饰器快速定义 informative pair。所有被装饰的 ","position":{"start":{"line":606,"column":1},"end":{"line":606,"column":1}},"key":"AInJzDCFLd"},{"type":"inlineCode","value":"populate_indicators_*","position":{"start":{"line":606,"column":1},"end":{"line":606,"column":1}},"key":"DH8colWBWs"},{"type":"text","value":" 方法独立运行，不能访问其他 informative pair 的数据。但所有 informative dataframe 会合并传递给主 ","position":{"start":{"line":606,"column":1},"end":{"line":606,"column":1}},"key":"BuaxgEAErY"},{"type":"inlineCode","value":"populate_indicators()","position":{"start":{"line":606,"column":1},"end":{"line":606,"column":1}},"key":"m5XAIJlw60"},{"type":"text","value":"。","position":{"start":{"line":606,"column":1},"end":{"line":606,"column":1}},"key":"N0irdxEIjx"}],"key":"sZ71bWkRvk"},{"type":"admonition","kind":"caution","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Caution","key":"jBqEylM6bE"}],"key":"zEZbzVCpQQ"},{"type":"paragraph","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"children":[{"type":"text","value":"若需用一个 informative pair 的数据生成另一个 informative pair，请勿用 ","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"key":"EYsItSSaZ4"},{"type":"inlineCode","value":"@informative","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"key":"WmrtjRG75g"},{"type":"text","value":" 装饰器，而应手动定义 informative pair，见","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"key":"X466ub6irS"},{"type":"crossReference","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"children":[{"type":"text","value":"DataProvider 部分","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"key":"vNqdRz8mn4"}],"identifier":"complete-dataprovider-sample","label":"complete-dataprovider-sample","kind":"heading","template":"{name}","resolved":true,"html_id":"complete-dataprovider-sample","key":"p2ojDs83im"},{"type":"text","value":"。","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"key":"DHybTsFRRU"}],"key":"yPde7Rmftx"}],"key":"jf03JPAIfW"},{"type":"paragraph","position":{"start":{"line":612,"column":1},"end":{"line":612,"column":1}},"children":[{"type":"text","value":"超参优化时，hyperoptable 参数不支持 ","position":{"start":{"line":612,"column":1},"end":{"line":612,"column":1}},"key":"MjatRYCVbo"},{"type":"inlineCode","value":".value","position":{"start":{"line":612,"column":1},"end":{"line":612,"column":1}},"key":"BXAbD0Cgh1"},{"type":"text","value":"，请用 ","position":{"start":{"line":612,"column":1},"end":{"line":612,"column":1}},"key":"gdmQWvm5o8"},{"type":"inlineCode","value":".range","position":{"start":{"line":612,"column":1},"end":{"line":612,"column":1}},"key":"m9ydgvo4Pr"},{"type":"text","value":"。见","position":{"start":{"line":612,"column":1},"end":{"line":612,"column":1}},"key":"bCyMGsWEHN"},{"type":"crossReference","url":"/hyperopt","position":{"start":{"line":612,"column":1},"end":{"line":612,"column":1}},"children":[{"type":"text","value":"优化指标参数","position":{"start":{"line":612,"column":1},"end":{"line":612,"column":1}},"key":"sP2hkB9cqg"}],"urlSource":"hyperopt.md#optimizing-an-indicator-parameter","dataUrl":"/hyperopt.json","identifier":"optimizing-an-indicator-parameter","label":"optimizing-an-indicator-parameter","remote":true,"protocol":"file","key":"SnaAWNtdx5"},{"type":"text","value":"。","position":{"start":{"line":612,"column":1},"end":{"line":612,"column":1}},"key":"ajbATFQmQZ"}],"key":"dWwGb1mPDs"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"完整文档","position":{"start":{"line":614,"column":1},"end":{"line":614,"column":1}},"key":"k9kLnvUoKs"}],"key":"zXGjIepY0P"},{"type":"code","lang":"python","value":"    def informative(\n        timeframe: str,\n        asset: str = \"\",\n        fmt: str | Callable[[Any], str] | None = None,\n        *,\n        candle_type: CandleType | str | None = None,\n        ffill: bool = True,\n    ) -> Callable[[PopulateIndicators], PopulateIndicators]:\n        \"\"\"\n        用于 populate_indicators_Nn(self, dataframe, metadata) 的装饰器，定义 informative 指标。\n        \n        用法示例：\n\n            @informative('1h')\n            def populate_indicators_1h(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n                dataframe['rsi'] = ta.RSI(dataframe, timeperiod=14)\n                return dataframe\n\n        :param timeframe: 辅助K线周期，必须大于等于主策略周期。\n        :param asset: 辅助资产，如 BTC、BTC/USDT、ETH/BTC。不指定则用当前对。支持格式化字符串。\n        :param fmt: 列名格式（str）或格式化函数。默认：\n        * {base}_{quote}_{column}_{timeframe}（指定 asset 时）\n        * {column}_{timeframe}（未指定 asset 时）\n        支持变量：{base}、{BASE}、{quote}、{QUOTE}、{asset}、{column}、{timeframe}\n        :param ffill: informative pair 合并后是否前向填充。\n        :param candle_type: '', mark, index, premiumIndex, funding_rate\n        \"\"\"","position":{"start":{"line":616,"column":1},"end":{"line":644,"column":1}},"key":"R5WSNPqj6w"}],"key":"VbCSiAxQ5T"},{"type":"admonition","kind":"hint","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"快速定义 informative pair","position":{"start":{"line":648,"column":1},"end":{"line":648,"column":1}},"key":"geqSlUJu6v"}],"key":"bMgdw72A5S"},{"type":"paragraph","position":{"start":{"line":650,"column":1},"end":{"line":650,"column":1}},"children":[{"type":"text","value":"大多数情况下无需用 ","position":{"start":{"line":650,"column":1},"end":{"line":650,"column":1}},"key":"TgrM0XnmHt"},{"type":"inlineCode","value":"merge_informative_pair()","position":{"start":{"line":650,"column":1},"end":{"line":650,"column":1}},"key":"sclIK1RRE3"},{"type":"text","value":"，可直接用装饰器：","position":{"start":{"line":650,"column":1},"end":{"line":650,"column":1}},"key":"dndI6UYdwO"}],"key":"Oi3vjlivuu"},{"type":"code","lang":"python","value":"\n    from datetime import datetime\n    from freqtrade.persistence import Trade\n    from freqtrade.strategy import IStrategy, informative\n\n    class AwesomeStrategy(IStrategy):\n        \n        # 可省略 informative_pairs 方法\n\n        # 为每个对定义高阶周期 informative pair。可叠加装饰器。\n        @informative('30m')\n        @informative('1h')\n        def populate_indicators_1h(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n            dataframe['rsi'] = ta.RSI(dataframe, timeperiod=14)\n            return dataframe\n\n        # 定义 BTC/STAKE informative pair。可用 {stake} 占位符。最终列名如 'btc_usdt_rsi_1h'。\n        @informative('1h', 'BTC/{stake}')\n        def populate_indicators_btc_1h(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n            dataframe['rsi'] = ta.RSI(dataframe, timeperiod=14)\n            return dataframe\n\n        # 定义 BTC/ETH informative pair。需指定 quote。最终列名如 'eth_btc_rsi_1h'。\n        @informative('1h', 'ETH/BTC')\n        def populate_indicators_eth_btc_1h(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n            dataframe['rsi'] = ta.RSI(dataframe, timeperiod=14)\n            return dataframe\n    \n        # 可自定义列名格式\n        @informative('1h', 'BTC/{stake}', '{column}_{timeframe}')\n        def populate_indicators_btc_1h_2(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n            dataframe['rsi_upper'] = ta.RSI(dataframe, timeperiod=14)\n            return dataframe\n    \n        def populate_indicators(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n            dataframe['rsi'] = ta.RSI(dataframe, timeperiod=14)\n            dataframe['rsi_less'] = dataframe['rsi'] < dataframe['rsi_1h']\n            return dataframe","position":{"start":{"line":652,"column":1},"end":{"line":691,"column":1}},"key":"hEuceugcsV"}],"key":"Hn8oY8I3Jj"},{"type":"admonition","kind":"attention","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Attention","key":"TUY9jxIWMw"}],"key":"UksgeTfpqa"},{"type":"paragraph","position":{"start":{"line":696,"column":1},"end":{"line":696,"column":1}},"children":[{"type":"text","value":"访问其他对的 informative dataframe 时建议用字符串格式化，便于后续更换 stake 货币。","position":{"start":{"line":696,"column":1},"end":{"line":696,"column":1}},"key":"YmHAwZ7wM3"}],"key":"kwMmzjzXpd"},{"type":"code","lang":"python","value":"    def populate_entry_trend(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n        stake = self.config['stake_currency']\n        dataframe.loc[\n            (\n                (dataframe[f'btc_{stake}_rsi_1h'] < 35)\n                &\n                (dataframe['volume'] > 0)\n            ),\n            ['enter_long', 'enter_tag']] = (1, 'buy_signal_rsi')\n    \n        return dataframe","position":{"start":{"line":698,"column":1},"end":{"line":710,"column":1}},"key":"mfKP1SFkiJ"},{"type":"paragraph","position":{"start":{"line":712,"column":1},"end":{"line":712,"column":1}},"children":[{"type":"text","value":"或用列重命名去除 stake 货币：","position":{"start":{"line":712,"column":1},"end":{"line":712,"column":1}},"key":"tttqVfZg7t"},{"type":"inlineCode","value":"@informative('1h', 'BTC/{stake}', fmt='{base}_{column}_{timeframe}')","position":{"start":{"line":712,"column":1},"end":{"line":712,"column":1}},"key":"nrML0SbKHZ"},{"type":"text","value":"。","position":{"start":{"line":712,"column":1},"end":{"line":712,"column":1}},"key":"J5gfKQJoJM"}],"key":"vtrBh8Y2Zc"}],"key":"FNJYl39h3F"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"方法名重复","position":{"start":{"line":715,"column":1},"end":{"line":715,"column":1}},"key":"yl1t7wnhTv"}],"key":"BFhVtEQlOP"},{"type":"paragraph","position":{"start":{"line":717,"column":1},"end":{"line":717,"column":1}},"children":[{"type":"text","value":"被 ","position":{"start":{"line":717,"column":1},"end":{"line":717,"column":1}},"key":"Fv1AcYJH2a"},{"type":"inlineCode","value":"@informative()","position":{"start":{"line":717,"column":1},"end":{"line":717,"column":1}},"key":"DQHNN96SgB"},{"type":"text","value":" 装饰的方法名必须唯一！重复会覆盖前面的定义且无报错，导致部分指标不可用。请仔细检查方法名。","position":{"start":{"line":717,"column":1},"end":{"line":717,"column":1}},"key":"dOz0Wft3uW"}],"key":"hlcchIKNYr"}],"key":"MuQu8UMZGD"},{"type":"heading","depth":4,"position":{"start":{"line":720,"column":1},"end":{"line":720,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":720,"column":1},"end":{"line":720,"column":1}},"children":[{"type":"text","value":"merge_informative_pair()","position":{"start":{"line":720,"column":1},"end":{"line":720,"column":1}},"key":"x1iCT8DU8r"}],"key":"PLRleDQ9JP"}],"identifier":"merge-informative-pair","label":"merge_informative_pair()","html_id":"merge-informative-pair","implicit":true,"key":"gsGWxZyyDl"},{"type":"paragraph","position":{"start":{"line":722,"column":1},"end":{"line":722,"column":1}},"children":[{"type":"text","value":"该方法可安全、无前视偏差地将 informative pair 合并到主 dataframe。","position":{"start":{"line":722,"column":1},"end":{"line":722,"column":1}},"key":"iRtrVYSISU"}],"key":"ffVtNZkB46"},{"type":"paragraph","position":{"start":{"line":724,"column":1},"end":{"line":724,"column":1}},"children":[{"type":"text","value":"功能：","position":{"start":{"line":724,"column":1},"end":{"line":724,"column":1}},"key":"v2lwqBTOTs"}],"key":"V4jdv84aGH"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":726,"column":1},"end":{"line":729,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":726,"column":1},"end":{"line":726,"column":1}},"children":[{"type":"text","value":"列重命名，避免冲突","position":{"start":{"line":726,"column":1},"end":{"line":726,"column":1}},"key":"dsf8bPPYJE"}],"key":"cVai1CswXy"},{"type":"listItem","spread":true,"position":{"start":{"line":727,"column":1},"end":{"line":727,"column":1}},"children":[{"type":"text","value":"无前视偏差合并","position":{"start":{"line":727,"column":1},"end":{"line":727,"column":1}},"key":"nbdl47L7qe"}],"key":"oCgN1OyZz9"},{"type":"listItem","spread":true,"position":{"start":{"line":728,"column":1},"end":{"line":729,"column":1}},"children":[{"type":"text","value":"可选前向填充","position":{"start":{"line":728,"column":1},"end":{"line":728,"column":1}},"key":"Tz5ugH3aPb"}],"key":"DAcJch6tsL"}],"key":"I0J4zSLJhk"},{"type":"paragraph","position":{"start":{"line":730,"column":1},"end":{"line":730,"column":1}},"children":[{"type":"text","value":"完整示例见","position":{"start":{"line":730,"column":1},"end":{"line":730,"column":1}},"key":"T8UFL86W4n"},{"type":"crossReference","position":{"start":{"line":730,"column":1},"end":{"line":730,"column":1}},"children":[{"type":"text","value":"完整数据提供者示例","position":{"start":{"line":730,"column":1},"end":{"line":730,"column":1}},"key":"nCqIx7L4Iy"}],"identifier":"complete-dataprovider-sample","label":"complete-dataprovider-sample","kind":"heading","template":"{name}","resolved":true,"html_id":"complete-dataprovider-sample","key":"fvjuJoDeao"},{"type":"text","value":"。","position":{"start":{"line":730,"column":1},"end":{"line":730,"column":1}},"key":"eLnNu3m6xs"}],"key":"SyA3E5l0oC"},{"type":"paragraph","position":{"start":{"line":732,"column":1},"end":{"line":732,"column":1}},"children":[{"type":"text","value":"所有 informative dataframe 列会以新名字出现在主 dataframe：","position":{"start":{"line":732,"column":1},"end":{"line":732,"column":1}},"key":"uXL0NAR0uy"}],"key":"RqCPQVJvyN"},{"type":"admonition","kind":"important","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"列重命名","position":{"start":{"line":734,"column":1},"end":{"line":734,"column":1}},"key":"wwhypr0Ozv"}],"key":"T4zaV8uye9"},{"type":"paragraph","position":{"start":{"line":736,"column":1},"end":{"line":736,"column":1}},"children":[{"type":"text","value":"假设 ","position":{"start":{"line":736,"column":1},"end":{"line":736,"column":1}},"key":"qDXxDlDgJl"},{"type":"inlineCode","value":"inf_tf = '1d'","position":{"start":{"line":736,"column":1},"end":{"line":736,"column":1}},"key":"B1oNAVlSeS"},{"type":"text","value":"，合并后列名如下：","position":{"start":{"line":736,"column":1},"end":{"line":736,"column":1}},"key":"iNHtYWMm3m"}],"key":"M62lHOSZD1"},{"type":"code","lang":"python","value":"    'date', 'open', 'high', 'low', 'close', 'rsi'                     # 原 dataframe\n    'date_1d', 'open_1d', 'high_1d', 'low_1d', 'close_1d', 'rsi_1d'   # informative dataframe","position":{"start":{"line":738,"column":1},"end":{"line":741,"column":1}},"key":"W4Gc3WLpF1"}],"key":"EAfCzPsAuW"},{"type":"admonition","kind":"important","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"1h 列重命名","position":{"start":{"line":745,"column":1},"end":{"line":745,"column":1}},"key":"z9I14cvQtt"}],"key":"rEJCZiiN7B"},{"type":"paragraph","position":{"start":{"line":747,"column":1},"end":{"line":747,"column":1}},"children":[{"type":"text","value":"假设 ","position":{"start":{"line":747,"column":1},"end":{"line":747,"column":1}},"key":"MwBan5nHP1"},{"type":"inlineCode","value":"inf_tf = '1h'","position":{"start":{"line":747,"column":1},"end":{"line":747,"column":1}},"key":"T8hMHlUdX5"},{"type":"text","value":"，合并后列名如下：","position":{"start":{"line":747,"column":1},"end":{"line":747,"column":1}},"key":"XQqvisDo0o"}],"key":"Cn1ENV5qqo"},{"type":"code","lang":"python","value":"    'date', 'open', 'high', 'low', 'close', 'rsi'                     # 原 dataframe\n    'date_1h', 'open_1h', 'high_1h', 'low_1h', 'close_1h', 'rsi_1h'   # informative dataframe","position":{"start":{"line":749,"column":1},"end":{"line":752,"column":1}},"key":"UtIBRzVY8s"}],"key":"rQH64axQUv"},{"type":"admonition","kind":"important","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"自定义实现","position":{"start":{"line":756,"column":1},"end":{"line":756,"column":1}},"key":"bNuIELOA8e"}],"key":"zSSzmNUjWV"},{"type":"paragraph","position":{"start":{"line":757,"column":1},"end":{"line":757,"column":1}},"children":[{"type":"text","value":"可自定义实现如下：","position":{"start":{"line":757,"column":1},"end":{"line":757,"column":1}},"key":"X9xrRpQDed"}],"key":"LqztRHntCa"},{"type":"code","lang":"python","value":"    # 日期右移 1 根K线\n    # This is necessary since the data is always the \"open date\"\n    # and a 15m candle starting at 12:15 should not know the close of the 1h candle from 12:00 to 13:00\n    minutes = timeframe_to_minutes(inf_tf)\n    # Only do this if the timeframes are different:\n    informative['date_merge'] = informative[\"date\"] + pd.to_timedelta(minutes, 'm')\n\n    # Rename columns to be unique\n    informative.columns = [f\"{col}_{inf_tf}\" for col in informative.columns]\n    # Assuming inf_tf = '1d' - then the columns will now be:\n    # date_1d, open_1d, high_1d, low_1d, close_1d, rsi_1d\n\n    # Combine the 2 dataframes\n    # all indicators on the informative sample MUST be calculated before this point\n    dataframe = pd.merge(dataframe, informative, left_on='date', right_on=f'date_merge_{inf_tf}', how='left')\n    # FFill to have the 1d value available in every row throughout the day.\n    # Without this, comparisons would only work once per day.\n    dataframe = dataframe.ffill()","position":{"start":{"line":759,"column":1},"end":{"line":778,"column":1}},"key":"pNUf6Ghc2m"}],"key":"zyMtRuQbY5"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"informative 周期 < 主周期","position":{"start":{"line":781,"column":1},"end":{"line":781,"column":1}},"key":"ipvM9bOITU"}],"key":"uSg9vmlbxU"},{"type":"paragraph","position":{"start":{"line":782,"column":1},"end":{"line":782,"column":1}},"children":[{"type":"text","value":"用本方法时，不建议 informative 周期小于主 dataframe 周期，否则无法利用更多细节。若需用更细粒度信息，需用更高级方法（超出本文档范围）。","position":{"start":{"line":782,"column":1},"end":{"line":782,"column":1}},"key":"bHjl5XtcID"}],"key":"NOnRTgzvsi"}],"key":"d4W6OCzwgM"},{"type":"heading","depth":3,"position":{"start":{"line":785,"column":1},"end":{"line":785,"column":1}},"children":[{"type":"text","value":"额外数据（DataProvider）","position":{"start":{"line":785,"column":1},"end":{"line":785,"column":1}},"key":"MO9smfJKoW"}],"identifier":"id-dataprovider","label":"额外数据（DataProvider）","html_id":"id-dataprovider","implicit":true,"key":"NEjkwb7hju"},{"type":"paragraph","position":{"start":{"line":787,"column":1},"end":{"line":787,"column":1}},"children":[{"type":"text","value":"策略可通过 ","position":{"start":{"line":787,"column":1},"end":{"line":787,"column":1}},"key":"leoHSyIC3b"},{"type":"inlineCode","value":"DataProvider","position":{"start":{"line":787,"column":1},"end":{"line":787,"column":1}},"key":"x5GiYa54aj"},{"type":"text","value":" 获取更多数据。","position":{"start":{"line":787,"column":1},"end":{"line":787,"column":1}},"key":"UMSkcLA3vy"}],"key":"V9ojg2IQGc"},{"type":"paragraph","position":{"start":{"line":789,"column":1},"end":{"line":789,"column":1}},"children":[{"type":"text","value":"所有方法失败时返回 None，不抛异常。","position":{"start":{"line":789,"column":1},"end":{"line":789,"column":1}},"key":"C9rculTueJ"}],"key":"xbwxzwoohb"},{"type":"paragraph","position":{"start":{"line":791,"column":1},"end":{"line":791,"column":1}},"children":[{"type":"text","value":"请根据运行模式选择合适方法（见下文示例）。","position":{"start":{"line":791,"column":1},"end":{"line":791,"column":1}},"key":"CmrhhmViv7"}],"key":"q32u5ZBvEu"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"超参优化限制","position":{"start":{"line":793,"column":1},"end":{"line":793,"column":1}},"key":"fW2BjO3IWd"}],"key":"n4My2tKav9"},{"type":"paragraph","position":{"start":{"line":794,"column":1},"end":{"line":794,"column":1}},"children":[{"type":"text","value":"DataProvider 在超参优化时可用，但仅限于策略内的 ","position":{"start":{"line":794,"column":1},"end":{"line":794,"column":1}},"key":"rG4WfnCL0o"},{"type":"inlineCode","value":"populate_indicators()","position":{"start":{"line":794,"column":1},"end":{"line":794,"column":1}},"key":"D81YXBlL4N"},{"type":"text","value":"，不可用于超参优化类文件。","position":{"start":{"line":794,"column":1},"end":{"line":794,"column":1}},"key":"CBfA8ztRNY"}],"key":"iHuqnjPpW2"},{"type":"paragraph","position":{"start":{"line":796,"column":1},"end":{"line":796,"column":1}},"children":[{"type":"text","value":"也不可用于 ","position":{"start":{"line":796,"column":1},"end":{"line":796,"column":1}},"key":"tHN0UHzLLX"},{"type":"inlineCode","value":"populate_entry_trend()","position":{"start":{"line":796,"column":1},"end":{"line":796,"column":1}},"key":"ernmHm81Ql"},{"type":"text","value":" 和 ","position":{"start":{"line":796,"column":1},"end":{"line":796,"column":1}},"key":"UWWhl8mgmK"},{"type":"inlineCode","value":"populate_exit_trend()","position":{"start":{"line":796,"column":1},"end":{"line":796,"column":1}},"key":"GhKLCUj4sx"},{"type":"text","value":"。","position":{"start":{"line":796,"column":1},"end":{"line":796,"column":1}},"key":"VrOsZTrLm0"}],"key":"v2sbzlunLl"}],"key":"h1BnLqERmK"},{"type":"heading","depth":4,"position":{"start":{"line":799,"column":1},"end":{"line":799,"column":1}},"children":[{"type":"text","value":"DataProvider 可用方法","position":{"start":{"line":799,"column":1},"end":{"line":799,"column":1}},"key":"kSX3itVbl4"}],"identifier":"dataprovider","label":"DataProvider 可用方法","html_id":"dataprovider","implicit":true,"key":"oNQMT32htO"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":801,"column":1},"end":{"line":811,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":801,"column":1},"end":{"line":801,"column":1}},"children":[{"type":"link","url":"#available_pairs","position":{"start":{"line":801,"column":1},"end":{"line":801,"column":1}},"children":[{"type":"inlineCode","value":"available_pairs","position":{"start":{"line":801,"column":1},"end":{"line":801,"column":1}},"key":"EGR1zfGeIg"}],"urlSource":"#available_pairs","key":"En4stk6Z1H"},{"type":"text","value":" - 返回缓存的所有对及其周期（pair, timeframe）元组","position":{"start":{"line":801,"column":1},"end":{"line":801,"column":1}},"key":"iGifKP2bZ4"}],"key":"TwgBZx9U5r"},{"type":"listItem","spread":true,"position":{"start":{"line":802,"column":1},"end":{"line":802,"column":1}},"children":[{"type":"link","url":"#current_whitelist","position":{"start":{"line":802,"column":1},"end":{"line":802,"column":1}},"children":[{"type":"inlineCode","value":"current_whitelist()","position":{"start":{"line":802,"column":1},"end":{"line":802,"column":1}},"key":"h3kCC2QP0g"}],"urlSource":"#current_whitelist","key":"ZaWmls9AqH"},{"type":"text","value":" - 返回当前白名单对列表，适合动态白名单（如 VolumePairlist）","position":{"start":{"line":802,"column":1},"end":{"line":802,"column":1}},"key":"abqt2yLYDP"}],"key":"vOBt7dExkT"},{"type":"listItem","spread":true,"position":{"start":{"line":803,"column":1},"end":{"line":803,"column":1}},"children":[{"type":"link","url":"#get_pair_dataframepair-timeframe","position":{"start":{"line":803,"column":1},"end":{"line":803,"column":1}},"children":[{"type":"inlineCode","value":"get_pair_dataframe(pair, timeframe)","position":{"start":{"line":803,"column":1},"end":{"line":803,"column":1}},"key":"HTPgFaZOG3"}],"urlSource":"#get_pair_dataframepair-timeframe","key":"ulbQlQgwxZ"},{"type":"text","value":" - 通用方法，回测时返回历史数据，dry/live 时返回缓存数据","position":{"start":{"line":803,"column":1},"end":{"line":803,"column":1}},"key":"MadAsDR7We"}],"key":"nOw4YU28Yt"},{"type":"listItem","spread":true,"position":{"start":{"line":804,"column":1},"end":{"line":804,"column":1}},"children":[{"type":"link","url":"#get_analyzed_dataframepair-timeframe","position":{"start":{"line":804,"column":1},"end":{"line":804,"column":1}},"children":[{"type":"inlineCode","value":"get_analyzed_dataframe(pair, timeframe)","position":{"start":{"line":804,"column":1},"end":{"line":804,"column":1}},"key":"cM5XSaZpcu"}],"urlSource":"#get_analyzed_dataframepair-timeframe","key":"VKDjoh2HSg"},{"type":"text","value":" - 返回分析后的 dataframe 及最新分析时间","position":{"start":{"line":804,"column":1},"end":{"line":804,"column":1}},"key":"DPKTFqtNs3"}],"key":"BC3IDUfKv3"},{"type":"listItem","spread":true,"position":{"start":{"line":805,"column":1},"end":{"line":805,"column":1}},"children":[{"type":"inlineCode","value":"historic_ohlcv(pair, timeframe)","position":{"start":{"line":805,"column":1},"end":{"line":805,"column":1}},"key":"hyO3Gxo8SY"},{"type":"text","value":" - 返回磁盘上的历史数据","position":{"start":{"line":805,"column":1},"end":{"line":805,"column":1}},"key":"rX1fDEN6JD"}],"key":"B3wVfyDNiU"},{"type":"listItem","spread":true,"position":{"start":{"line":806,"column":1},"end":{"line":806,"column":1}},"children":[{"type":"inlineCode","value":"market(pair)","position":{"start":{"line":806,"column":1},"end":{"line":806,"column":1}},"key":"yqz7y4tdbZ"},{"type":"text","value":" - 返回交易对市场数据（手续费、限额、精度、活跃标志等）","position":{"start":{"line":806,"column":1},"end":{"line":806,"column":1}},"key":"coUQNVFEkr"}],"key":"JZ2r5EeOcw"},{"type":"listItem","spread":true,"position":{"start":{"line":807,"column":1},"end":{"line":807,"column":1}},"children":[{"type":"inlineCode","value":"ohlcv(pair, timeframe)","position":{"start":{"line":807,"column":1},"end":{"line":807,"column":1}},"key":"Cm52AQ8kY4"},{"type":"text","value":" - 返回当前缓存的K线数据","position":{"start":{"line":807,"column":1},"end":{"line":807,"column":1}},"key":"VdMpnkHYWO"}],"key":"lF4nW3cT4o"},{"type":"listItem","spread":true,"position":{"start":{"line":808,"column":1},"end":{"line":808,"column":1}},"children":[{"type":"link","url":"#orderbookpair-maximum","position":{"start":{"line":808,"column":1},"end":{"line":808,"column":1}},"children":[{"type":"inlineCode","value":"orderbook(pair, maximum)","position":{"start":{"line":808,"column":1},"end":{"line":808,"column":1}},"key":"PD4000PpkC"}],"urlSource":"#orderbookpair-maximum","key":"WjjNU1ow9x"},{"type":"text","value":" - 返回最新 orderbook 数据（bids/asks）","position":{"start":{"line":808,"column":1},"end":{"line":808,"column":1}},"key":"R8HTy6vju9"}],"key":"pO2SdtzZkV"},{"type":"listItem","spread":true,"position":{"start":{"line":809,"column":1},"end":{"line":809,"column":1}},"children":[{"type":"link","url":"#tickerpair","position":{"start":{"line":809,"column":1},"end":{"line":809,"column":1}},"children":[{"type":"inlineCode","value":"ticker(pair)","position":{"start":{"line":809,"column":1},"end":{"line":809,"column":1}},"key":"ROAxyLFIgg"}],"urlSource":"#tickerpair","key":"jZqGMch2mQ"},{"type":"text","value":" - 返回当前 ticker 数据","position":{"start":{"line":809,"column":1},"end":{"line":809,"column":1}},"key":"zRrk0LZnYN"}],"key":"qeLCM8fF80"},{"type":"listItem","spread":true,"position":{"start":{"line":810,"column":1},"end":{"line":811,"column":1}},"children":[{"type":"inlineCode","value":"runmode","position":{"start":{"line":810,"column":1},"end":{"line":810,"column":1}},"key":"shNE3zGGYE"},{"type":"text","value":" - 当前运行模式","position":{"start":{"line":810,"column":1},"end":{"line":810,"column":1}},"key":"uKrpyuju7u"}],"key":"hnwJEgCRgE"}],"key":"xmFPEKnC5s"},{"type":"heading","depth":4,"position":{"start":{"line":812,"column":1},"end":{"line":812,"column":1}},"children":[{"type":"text","value":"示例用法","position":{"start":{"line":812,"column":1},"end":{"line":812,"column":1}},"key":"HN9rq49OC4"}],"identifier":"id","label":"示例用法","html_id":"id-15","implicit":true,"key":"DftJ8gse5B"},{"type":"heading","depth":4,"position":{"start":{"line":814,"column":1},"end":{"line":814,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":814,"column":1},"end":{"line":814,"column":1}},"children":[{"type":"text","value":"available_pairs","position":{"start":{"line":814,"column":1},"end":{"line":814,"column":1}},"key":"d7veVTBSQA"}],"key":"zlFjy4bXNK"}],"identifier":"available-pairs","label":"available_pairs","html_id":"available-pairs","implicit":true,"key":"Jjhrg0PNFD"},{"type":"code","lang":"python","value":"for pair, timeframe in self.dp.available_pairs:\n    print(f\"available {pair}, {timeframe}\")","position":{"start":{"line":816,"column":1},"end":{"line":819,"column":1}},"key":"C4UJAlxCuF"},{"type":"heading","depth":4,"position":{"start":{"line":821,"column":1},"end":{"line":821,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":821,"column":1},"end":{"line":821,"column":1}},"children":[{"type":"text","value":"current_whitelist()","position":{"start":{"line":821,"column":1},"end":{"line":821,"column":1}},"key":"qq77RFOuq2"}],"key":"ZCcYk848rX"}],"identifier":"current-whitelist","label":"current_whitelist()","html_id":"current-whitelist","implicit":true,"key":"WXatqSd5a2"},{"type":"paragraph","position":{"start":{"line":823,"column":1},"end":{"line":823,"column":1}},"children":[{"type":"text","value":"假设你开发了一个用 ","position":{"start":{"line":823,"column":1},"end":{"line":823,"column":1}},"key":"zVq1nmGW23"},{"type":"inlineCode","value":"5m","position":{"start":{"line":823,"column":1},"end":{"line":823,"column":1}},"key":"Si8zybUxwC"},{"type":"text","value":" 周期、用 ","position":{"start":{"line":823,"column":1},"end":{"line":823,"column":1}},"key":"TvhxJ254lq"},{"type":"inlineCode","value":"1d","position":{"start":{"line":823,"column":1},"end":{"line":823,"column":1}},"key":"EUbAvpkAtv"},{"type":"text","value":" 周期信号的策略，且用 VolumePairList 动态选前 10 个交易对。","position":{"start":{"line":823,"column":1},"end":{"line":823,"column":1}},"key":"ZzFrnFwIcU"}],"key":"h3Ovc4jFyJ"},{"type":"paragraph","position":{"start":{"line":825,"column":1},"end":{"line":825,"column":1}},"children":[{"type":"text","value":"策略逻辑如下：","position":{"start":{"line":825,"column":1},"end":{"line":825,"column":1}},"key":"GH9dEOQ4YW"}],"key":"XscaVKCMCS"},{"type":"paragraph","position":{"start":{"line":827,"column":1},"end":{"line":827,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":827,"column":1},"end":{"line":827,"column":1}},"children":[{"type":"text","value":"每 5 分钟扫描前 10 个交易对，用 14 日 RSI 生成信号。","position":{"start":{"line":827,"column":1},"end":{"line":827,"column":1}},"key":"kf89U4GiAz"}],"key":"fQu5L0ydoV"}],"key":"uOR9GSZ6iy"},{"type":"paragraph","position":{"start":{"line":829,"column":1},"end":{"line":829,"column":1}},"children":[{"type":"text","value":"因数据有限，无法用 5m K 线重采样成日线。大多数交易所只给 500-1000 根K线，约等于 1.74 天。我们需要至少 14 天！","position":{"start":{"line":829,"column":1},"end":{"line":829,"column":1}},"key":"yU7RTBHbDn"}],"key":"iHIViyW2kk"},{"type":"paragraph","position":{"start":{"line":831,"column":1},"end":{"line":831,"column":1}},"children":[{"type":"text","value":"因此需用 informative pair，且因白名单动态变化，不知用哪些对！","position":{"start":{"line":831,"column":1},"end":{"line":831,"column":1}},"key":"r2IKi0oyny"}],"key":"si1y3uaszv"},{"type":"paragraph","position":{"start":{"line":833,"column":1},"end":{"line":833,"column":1}},"children":[{"type":"text","value":"此时可用 ","position":{"start":{"line":833,"column":1},"end":{"line":833,"column":1}},"key":"QzbzWzOUGF"},{"type":"inlineCode","value":"self.dp.current_whitelist()","position":{"start":{"line":833,"column":1},"end":{"line":833,"column":1}},"key":"oJv3MMnRuD"},{"type":"text","value":" 获取当前白名单对。","position":{"start":{"line":833,"column":1},"end":{"line":833,"column":1}},"key":"qZXmJ5xt9X"}],"key":"ZFdyBJmKPq"},{"type":"code","lang":"python","value":"    def informative_pairs(self):\n\n        # 获取白名单所有对\n        pairs = self.dp.current_whitelist()\n        # 为每个对分配周期\n        informative_pairs = [(pair, '1d') for pair in pairs]\n        return informative_pairs","position":{"start":{"line":835,"column":1},"end":{"line":843,"column":1}},"key":"L1wV4amWGd"},{"type":"admonition","kind":"caution","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"current_whitelist 用于绘图","position":{"start":{"line":845,"column":1},"end":{"line":845,"column":1}},"key":"WaAAM9nQDs"}],"key":"tKU1gRYGwE"},{"type":"paragraph","position":{"start":{"line":846,"column":1},"end":{"line":846,"column":1}},"children":[{"type":"text","value":"current_whitelist 不支持 ","position":{"start":{"line":846,"column":1},"end":{"line":846,"column":1}},"key":"LEqaEwXVlX"},{"type":"inlineCode","value":"plot-dataframe","position":{"start":{"line":846,"column":1},"end":{"line":846,"column":1}},"key":"v1DMc5A1c8"},{"type":"text","value":"，也不支持 FreqUI 可视化（webserver 模式），因 webserver 配置无需白名单。","position":{"start":{"line":846,"column":1},"end":{"line":846,"column":1}},"key":"SpPWPJt201"}],"key":"T8D2wW8Rte"}],"key":"sNfrhfMQru"},{"type":"heading","depth":4,"position":{"start":{"line":849,"column":1},"end":{"line":849,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":849,"column":1},"end":{"line":849,"column":1}},"children":[{"type":"text","value":"get_pair_dataframe(pair, timeframe)","position":{"start":{"line":849,"column":1},"end":{"line":849,"column":1}},"key":"UAXxGTv4Oh"}],"key":"hnLepNc7QL"}],"identifier":"get-pair-dataframe-pair-timeframe","label":"get_pair_dataframe(pair, timeframe)","html_id":"get-pair-dataframe-pair-timeframe","implicit":true,"key":"PpfpDJLnmz"},{"type":"code","lang":"python","value":"# 获取第一个 informative pair 的K线数据\ninf_pair, inf_timeframe = self.informative_pairs()[0]\ninformative = self.dp.get_pair_dataframe(pair=inf_pair,\n                                         timeframe=inf_timeframe)","position":{"start":{"line":851,"column":1},"end":{"line":856,"column":1}},"key":"vHSnZipQPK"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"回测注意","position":{"start":{"line":858,"column":1},"end":{"line":858,"column":1}},"key":"vxgBEI2aGR"}],"key":"iG419RGAVk"},{"type":"paragraph","position":{"start":{"line":859,"column":1},"end":{"line":859,"column":1}},"children":[{"type":"text","value":"回测时，","position":{"start":{"line":859,"column":1},"end":{"line":859,"column":1}},"key":"nRr8i4geSu"},{"type":"inlineCode","value":"dp.get_pair_dataframe()","position":{"start":{"line":859,"column":1},"end":{"line":859,"column":1}},"key":"Bw7YixT3cR"},{"type":"text","value":" 在 ","position":{"start":{"line":859,"column":1},"end":{"line":859,"column":1}},"key":"MBWSnFPQqM"},{"type":"inlineCode","value":"populate_*()","position":{"start":{"line":859,"column":1},"end":{"line":859,"column":1}},"key":"VJNOI7yXdH"},{"type":"text","value":" 方法中返回完整时间区间。请勿\"看未来\"，否则 dry/live 时会有意外。","position":{"start":{"line":859,"column":1},"end":{"line":859,"column":1}},"key":"FD80vuS7v1"}],"key":"V0emoIyMDE"},{"type":"paragraph","position":{"start":{"line":861,"column":1},"end":{"line":861,"column":1}},"children":[{"type":"text","value":"在 ","position":{"start":{"line":861,"column":1},"end":{"line":861,"column":1}},"key":"juuO70z1eV"},{"type":"link","url":"/strategy-callbacks","position":{"start":{"line":861,"column":1},"end":{"line":861,"column":1}},"children":[{"type":"text","value":"回调函数","position":{"start":{"line":861,"column":1},"end":{"line":861,"column":1}},"key":"fvP50oeROd"}],"urlSource":"strategy-callbacks.md","dataUrl":"/strategy-callbacks.json","internal":true,"protocol":"file","key":"jKhzdWMA1N"},{"type":"text","value":" 中，则只返回当前（模拟）K线前的数据。","position":{"start":{"line":861,"column":1},"end":{"line":861,"column":1}},"key":"SyecpvXmMy"}],"key":"neRuDFkzpI"}],"key":"YsTsxiSRQ1"},{"type":"heading","depth":4,"position":{"start":{"line":864,"column":1},"end":{"line":864,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":864,"column":1},"end":{"line":864,"column":1}},"children":[{"type":"text","value":"get_analyzed_dataframe(pair, timeframe)","position":{"start":{"line":864,"column":1},"end":{"line":864,"column":1}},"key":"e7pBkhgQBs"}],"key":"n46fSPb7eU"}],"identifier":"get-analyzed-dataframe-pair-timeframe","label":"get_analyzed_dataframe(pair, timeframe)","html_id":"get-analyzed-dataframe-pair-timeframe","implicit":true,"key":"UP4sII3HWZ"},{"type":"paragraph","position":{"start":{"line":866,"column":1},"end":{"line":866,"column":1}},"children":[{"type":"text","value":"该方法供 freqtrade 内部用来判断最后信号，也可在特定回调中用来获取触发操作的信号（见","position":{"start":{"line":866,"column":1},"end":{"line":866,"column":1}},"key":"juwGX61zoz"},{"type":"link","url":"/strategy-advanced","position":{"start":{"line":866,"column":1},"end":{"line":866,"column":1}},"children":[{"type":"text","value":"高级策略文档","position":{"start":{"line":866,"column":1},"end":{"line":866,"column":1}},"key":"XXKfXsKmDy"}],"urlSource":"strategy-advanced.md","dataUrl":"/strategy-advanced.json","internal":true,"protocol":"file","key":"dWMCBp92bh"},{"type":"text","value":"）。","position":{"start":{"line":866,"column":1},"end":{"line":866,"column":1}},"key":"wq0rP8hSdO"}],"key":"YNL3Ob9CvZ"},{"type":"code","lang":"python","value":"# 获取当前 dataframe\ndataframe, last_updated = self.dp.get_analyzed_dataframe(pair=metadata['pair'],\n                                                         timeframe=self.timeframe)","position":{"start":{"line":868,"column":1},"end":{"line":872,"column":1}},"key":"U5S9Xy1hK8"},{"type":"admonition","kind":"caution","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"无数据","position":{"start":{"line":874,"column":1},"end":{"line":874,"column":1}},"key":"wfjsOKLq2h"}],"key":"Cd0kw5SZ56"},{"type":"paragraph","position":{"start":{"line":875,"column":1},"end":{"line":875,"column":1}},"children":[{"type":"text","value":"若请求的对未缓存，返回空 dataframe。可用 ","position":{"start":{"line":875,"column":1},"end":{"line":875,"column":1}},"key":"ZKcQ3ImvzS"},{"type":"inlineCode","value":"if dataframe.empty:","position":{"start":{"line":875,"column":1},"end":{"line":875,"column":1}},"key":"hYNR2ncTlU"},{"type":"text","value":" 检查。","position":{"start":{"line":875,"column":1},"end":{"line":875,"column":1}},"key":"mqTZwDVbdM"}],"key":"lg1lmu5nra"}],"key":"QVY4Zwm5tr"},{"type":"heading","depth":4,"position":{"start":{"line":878,"column":1},"end":{"line":878,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":878,"column":1},"end":{"line":878,"column":1}},"children":[{"type":"text","value":"orderbook(pair, maximum)","position":{"start":{"line":878,"column":1},"end":{"line":878,"column":1}},"key":"cRBRytBwpS"}],"key":"lBzlT4uqqe"}],"identifier":"orderbook-pair-maximum","label":"orderbook(pair, maximum)","html_id":"orderbook-pair-maximum","implicit":true,"key":"Zp9lFkOaTz"},{"type":"code","lang":"python","value":"if self.dp.runmode.value in ('live', 'dry_run'):\n    ob = self.dp.orderbook(metadata['pair'], 1)\n    dataframe['best_bid'] = ob['bids'][0][0]\n    dataframe['best_ask'] = ob['asks'][0][0]","position":{"start":{"line":880,"column":1},"end":{"line":885,"column":1}},"key":"QSJKxyvQXO"},{"type":"paragraph","position":{"start":{"line":887,"column":1},"end":{"line":887,"column":1}},"children":[{"type":"text","value":"orderbook 结构与 ","position":{"start":{"line":887,"column":1},"end":{"line":887,"column":1}},"key":"pTF75vs854"},{"type":"link","url":"https://github.com/ccxt/ccxt/wiki/Manual#order-book-structure","position":{"start":{"line":887,"column":1},"end":{"line":887,"column":1}},"children":[{"type":"text","value":"ccxt","position":{"start":{"line":887,"column":1},"end":{"line":887,"column":1}},"key":"Nbb7luEcFk"}],"urlSource":"https://github.com/ccxt/ccxt/wiki/Manual#order-book-structure","error":true,"key":"rghmve7NZQ"},{"type":"text","value":" 一致：","position":{"start":{"line":887,"column":1},"end":{"line":887,"column":1}},"key":"nl30Zl0Wty"}],"key":"sPfvANYSsW"},{"type":"code","lang":"js","value":"{\n    'bids': [\n        [ price, amount ],\n        ...\n    ],\n    'asks': [\n        [ price, amount ],\n        ...\n    ],\n}","position":{"start":{"line":889,"column":1},"end":{"line":900,"column":1}},"key":"srOfx9yR7e"},{"type":"paragraph","position":{"start":{"line":902,"column":1},"end":{"line":902,"column":1}},"children":[{"type":"text","value":"用 ","position":{"start":{"line":902,"column":1},"end":{"line":902,"column":1}},"key":"GcqZ3CqWG9"},{"type":"inlineCode","value":"ob['bids'][0][0]","position":{"start":{"line":902,"column":1},"end":{"line":902,"column":1}},"key":"OKsd7d95iv"},{"type":"text","value":" 可取最优买价，","position":{"start":{"line":902,"column":1},"end":{"line":902,"column":1}},"key":"qPpsxV6E93"},{"type":"inlineCode","value":"ob['bids'][0][1]","position":{"start":{"line":902,"column":1},"end":{"line":902,"column":1}},"key":"IBY66gBeW3"},{"type":"text","value":" 为该价位数量。","position":{"start":{"line":902,"column":1},"end":{"line":902,"column":1}},"key":"CZ3vu07YOm"}],"key":"lHNsuDdbdH"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"回测注意","position":{"start":{"line":904,"column":1},"end":{"line":904,"column":1}},"key":"MaCNYNcUni"}],"key":"zOFskRXNW1"},{"type":"paragraph","position":{"start":{"line":905,"column":1},"end":{"line":905,"column":1}},"children":[{"type":"text","value":"订单簿不是历史数据的一部分，这意味着如果使用此方法，回测和超参数优化将无法正常工作，因为该方法将返回最新值。","position":{"start":{"line":905,"column":1},"end":{"line":905,"column":1}},"key":"fyeIHPmqRD"}],"key":"vrkDARVlu9"}],"key":"DxoFIUlpU5"},{"type":"heading","depth":4,"position":{"start":{"line":908,"column":1},"end":{"line":908,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":908,"column":1},"end":{"line":908,"column":1}},"children":[{"type":"text","value":"ticker(pair)","position":{"start":{"line":908,"column":1},"end":{"line":908,"column":1}},"key":"C24w07X4q3"}],"key":"KdXzLu5kDQ"}],"identifier":"ticker-pair","label":"ticker(pair)","html_id":"ticker-pair","implicit":true,"key":"GwQtrTlwg1"},{"type":"code","lang":"python","value":"if self.dp.runmode.value in ('live', 'dry_run'):\n    ticker = self.dp.ticker(metadata['pair'])\n    dataframe['last_price'] = ticker['last']\n    dataframe['volume24h'] = ticker['quoteVolume']\n    dataframe['vwap'] = ticker['vwap']","position":{"start":{"line":910,"column":1},"end":{"line":916,"column":1}},"key":"qdZirEZzs8"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"JALdc9VBA4"}],"key":"wHTdkDQY7t"},{"type":"paragraph","position":{"start":{"line":919,"column":1},"end":{"line":919,"column":1}},"children":[{"type":"text","value":"虽然 ticker 数据结构是 ccxt 统一接口的一部分，但不同交易所返回的值可能会有所不同。例如，许多交易所不返回 ","position":{"start":{"line":919,"column":1},"end":{"line":919,"column":1}},"key":"alzv4wXfLt"},{"type":"inlineCode","value":"vwap","position":{"start":{"line":919,"column":1},"end":{"line":919,"column":1}},"key":"xieuNZAkUJ"},{"type":"text","value":" 值，一些交易所并不总是填充 ","position":{"start":{"line":919,"column":1},"end":{"line":919,"column":1}},"key":"oVTSSTEGBt"},{"type":"inlineCode","value":"last","position":{"start":{"line":919,"column":1},"end":{"line":919,"column":1}},"key":"YbBTZ1RUtX"},{"type":"text","value":" 字段（所以它可能为 None）等。因此，您需要仔细验证从交易所返回的 ticker 数据，并添加适当的错误处理/默认值。","position":{"start":{"line":919,"column":1},"end":{"line":919,"column":1}},"key":"yfDBebISsU"}],"key":"walzGypqWX"}],"key":"r5C5cMX4KW"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"回测警告","position":{"start":{"line":922,"column":1},"end":{"line":922,"column":1}},"key":"ZENvSusjyO"}],"key":"IUSQr1ogDz"},{"type":"paragraph","position":{"start":{"line":923,"column":1},"end":{"line":923,"column":1}},"children":[{"type":"text","value":"此方法将始终返回最新/实时值。因此，在回测/超参数优化期间使用而不检查运行模式将导致错误的结果，例如，您的整个 dataframe 将在所有行中包含相同的单个值。","position":{"start":{"line":923,"column":1},"end":{"line":923,"column":1}},"key":"nGoYxOA1jg"}],"key":"eRnsH6HiPX"}],"key":"OEQVqP7jO5"},{"type":"heading","depth":4,"position":{"start":{"line":926,"column":1},"end":{"line":926,"column":1}},"children":[{"type":"text","value":"发送通知","position":{"start":{"line":926,"column":1},"end":{"line":926,"column":1}},"key":"bjNb4pHC0k"}],"identifier":"id","label":"发送通知","html_id":"id-16","implicit":true,"key":"ecuzsUP7nb"},{"type":"paragraph","position":{"start":{"line":928,"column":1},"end":{"line":929,"column":1}},"children":[{"type":"text","value":"dataprovider 的 ","position":{"start":{"line":928,"column":1},"end":{"line":928,"column":1}},"key":"HROBQ0s9xv"},{"type":"inlineCode","value":".send_msg()","position":{"start":{"line":928,"column":1},"end":{"line":928,"column":1}},"key":"lSqi4nnYmm"},{"type":"text","value":" 可在策略中发送自定义通知。\n相同的通知在每个蜡烛图期间只会发送一次，除非第二个参数（","position":{"start":{"line":928,"column":1},"end":{"line":928,"column":1}},"key":"T29rs62kd6"},{"type":"inlineCode","value":"always_send","position":{"start":{"line":928,"column":1},"end":{"line":928,"column":1}},"key":"CJOOnuLan0"},{"type":"text","value":"）设置为 True。","position":{"start":{"line":928,"column":1},"end":{"line":928,"column":1}},"key":"ZY4ljNAUKz"}],"key":"gd2xi2byYu"},{"type":"code","lang":"python","value":"    self.dp.send_msg(f\"{metadata['pair']} just got hot!\")\n\n    # 强制发送此通知，避免缓存（请阅读下面的警告！）\n    self.dp.send_msg(f\"{metadata['pair']} just got hot!\", always_send=True)","position":{"start":{"line":931,"column":1},"end":{"line":936,"column":1}},"key":"vnb1P9amRE"},{"type":"paragraph","position":{"start":{"line":938,"column":1},"end":{"line":938,"column":1}},"children":[{"type":"text","value":"通知只会在交易模式（实盘/模拟盘）中发送 - 因此可以在回测中无条件调用此方法。","position":{"start":{"line":938,"column":1},"end":{"line":938,"column":1}},"key":"I4W8iTgeDM"}],"key":"HyHUxdLVMP"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"消息轰炸","position":{"start":{"line":940,"column":1},"end":{"line":940,"column":1}},"key":"F2GjwU0Pip"}],"key":"RPZY1iP06B"},{"type":"paragraph","position":{"start":{"line":941,"column":1},"end":{"line":941,"column":1}},"children":[{"type":"text","value":"通过在此方法中设置 ","position":{"start":{"line":941,"column":1},"end":{"line":941,"column":1}},"key":"Di29hoN8cl"},{"type":"inlineCode","value":"always_send=True","position":{"start":{"line":941,"column":1},"end":{"line":941,"column":1}},"key":"sO4C6pSNCj"},{"type":"text","value":"，您可能会给自己发送大量消息。请谨慎使用此功能，并且只在您知道不会在整个蜡烛图期间频繁触发的情况下使用，以避免每5秒就收到一条消息。","position":{"start":{"line":941,"column":1},"end":{"line":941,"column":1}},"key":"tY7pgHjj1m"}],"key":"XxcTKl9r6k"}],"key":"hLoXzmTnN5"},{"type":"heading","depth":4,"position":{"start":{"line":946,"column":1},"end":{"line":946,"column":1}},"children":[{"type":"text","value":"完整 DataProvider 示例","position":{"start":{"line":946,"column":1},"end":{"line":946,"column":1}},"key":"AO7Y0aEKyv"}],"label":"complete-dataprovider-sample","identifier":"complete-dataprovider-sample","html_id":"complete-dataprovider-sample","key":"T8hjCAxkHF"},{"type":"code","lang":"python","value":"from freqtrade.strategy import IStrategy, merge_informative_pair\nfrom pandas import DataFrame\n\nclass SampleStrategy(IStrategy):\n    # 策略初始化...\n\n    timeframe = '5m'\n\n    # ...\n\n    def informative_pairs(self):\n\n        # 获取白名单所有对\n        pairs = self.dp.current_whitelist()\n        # 为每个对分配周期\n        informative_pairs = [(pair, '1d') for pair in pairs]\n        # 可选：添加静态对\n        informative_pairs += [(\"ETH/USDT\", \"5m\"),\n                              (\"BTC/TUSD\", \"15m\"),\n                            ]\n        return informative_pairs\n\n    def populate_indicators(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n        if not self.dp:\n            # DataProvider 不可用时不做任何操作\n            return dataframe\n\n        inf_tf = '1d'\n        # 获取信息对\n        informative = self.dp.get_pair_dataframe(pair=metadata['pair'], timeframe=inf_tf)\n        # 获取14天RSI\n        informative['rsi'] = ta.RSI(informative, timeperiod=14)\n\n        # 使用辅助函数 merge_informative_pair 安全地合并交易对\n        # 自动重命名列并合并较短时间周期的 dataframe 和较长时间周期的信息对\n        # 使用 ffill 使1天的值在一天中的每一行都可用\n        # 如果没有这个，原始数据框和信息对的列之间的比较每天只能进行一次\n        # 此方法的完整文档，见下文\n        dataframe = merge_informative_pair(dataframe, informative, self.timeframe, inf_tf, ffill=True)\n\n        # 计算原始数据框的RSI（5分钟时间周期）\n        dataframe['rsi'] = ta.RSI(dataframe, timeperiod=14)\n\n        # 其他操作\n        # ...\n\n        return dataframe\n\n    def populate_entry_trend(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n\n        dataframe.loc[\n            (\n                (qtpylib.crossed_above(dataframe['rsi'], 30)) &  # RSI 上穿 30\n                (dataframe['rsi_1d'] < 30) &                     # 日线 RSI < 30\n                (dataframe['volume'] > 0)                        # 有成交量\n            ),\n            ['enter_long', 'enter_tag']] = (1, 'rsi_cross')\n","position":{"start":{"line":948,"column":1},"end":{"line":1007,"column":1}},"key":"fVOj3X9rQf"},{"type":"thematicBreak","position":{"start":{"line":1009,"column":1},"end":{"line":1009,"column":1}},"key":"gFOo9veuID"},{"type":"heading","depth":3,"position":{"start":{"line":1011,"column":1},"end":{"line":1011,"column":1}},"children":[{"type":"text","value":"额外数据（钱包 Wallets）","position":{"start":{"line":1011,"column":1},"end":{"line":1011,"column":1}},"key":"muh7wR30vO"}],"identifier":"id-wallets","label":"额外数据（钱包 Wallets）","html_id":"id-wallets","implicit":true,"key":"FxL3ktz4xx"},{"type":"paragraph","position":{"start":{"line":1013,"column":1},"end":{"line":1013,"column":1}},"children":[{"type":"text","value":"策略可通过 ","position":{"start":{"line":1013,"column":1},"end":{"line":1013,"column":1}},"key":"hvrOMjZfh1"},{"type":"inlineCode","value":"wallets","position":{"start":{"line":1013,"column":1},"end":{"line":1013,"column":1}},"key":"tqBUNGSWF4"},{"type":"text","value":" 对象获取当前钱包/账户余额。","position":{"start":{"line":1013,"column":1},"end":{"line":1013,"column":1}},"key":"zNHhP45EOu"}],"key":"Y3CAvJZT2Z"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"回测/超参优化","position":{"start":{"line":1015,"column":1},"end":{"line":1015,"column":1}},"key":"OepevvZ4pd"}],"key":"XpCUImnHpx"},{"type":"paragraph","position":{"start":{"line":1016,"column":1},"end":{"line":1016,"column":1}},"children":[{"type":"text","value":"Wallets 在不同函数中表现不同。","position":{"start":{"line":1016,"column":1},"end":{"line":1016,"column":1}},"key":"h3VF0CDs0V"}],"key":"CRCsUizrHs"},{"type":"paragraph","position":{"start":{"line":1018,"column":1},"end":{"line":1018,"column":1}},"children":[{"type":"text","value":"在 ","position":{"start":{"line":1018,"column":1},"end":{"line":1018,"column":1}},"key":"kJ8C3qerGT"},{"type":"inlineCode","value":"populate_*()","position":{"start":{"line":1018,"column":1},"end":{"line":1018,"column":1}},"key":"JEDdDWugKr"},{"type":"text","value":" 方法中，返回完整钱包。","position":{"start":{"line":1018,"column":1},"end":{"line":1018,"column":1}},"key":"szDKfZ0kze"}],"key":"hCDZboXr6u"},{"type":"paragraph","position":{"start":{"line":1020,"column":1},"end":{"line":1020,"column":1}},"children":[{"type":"text","value":"在 ","position":{"start":{"line":1020,"column":1},"end":{"line":1020,"column":1}},"key":"h9VEQgeqQL"},{"type":"link","url":"/strategy-callbacks","position":{"start":{"line":1020,"column":1},"end":{"line":1020,"column":1}},"children":[{"type":"text","value":"回调函数","position":{"start":{"line":1020,"column":1},"end":{"line":1020,"column":1}},"key":"EWhheBcIr3"}],"urlSource":"strategy-callbacks.md","dataUrl":"/strategy-callbacks.json","internal":true,"protocol":"file","key":"RyAKqjuzW2"},{"type":"text","value":" 中，返回当前模拟钱包状态。","position":{"start":{"line":1020,"column":1},"end":{"line":1020,"column":1}},"key":"mGMPqid2k8"}],"key":"c7eqXEP3aq"}],"key":"mStl8XAZIk"},{"type":"paragraph","position":{"start":{"line":1023,"column":1},"end":{"line":1023,"column":1}},"children":[{"type":"text","value":"调用前请检查 ","position":{"start":{"line":1023,"column":1},"end":{"line":1023,"column":1}},"key":"o5j0HpcpZU"},{"type":"inlineCode","value":"wallets","position":{"start":{"line":1023,"column":1},"end":{"line":1023,"column":1}},"key":"GbKoNpDTnE"},{"type":"text","value":" 是否可用，避免回测时报错。","position":{"start":{"line":1023,"column":1},"end":{"line":1023,"column":1}},"key":"XOhxM5XlIo"}],"key":"wW380ZuqqI"},{"type":"code","lang":"python","value":"if self.wallets:\n    free_eth = self.wallets.get_free('ETH')\n    used_eth = self.wallets.get_used('ETH')\n    total_eth = self.wallets.get_total('ETH')","position":{"start":{"line":1025,"column":1},"end":{"line":1030,"column":1}},"key":"kgXvFa0DoV"},{"type":"heading","depth":4,"position":{"start":{"line":1032,"column":1},"end":{"line":1032,"column":1}},"children":[{"type":"text","value":"Wallets 可用方法","position":{"start":{"line":1032,"column":1},"end":{"line":1032,"column":1}},"key":"mr3tkwxika"}],"identifier":"wallets","label":"Wallets 可用方法","html_id":"wallets","implicit":true,"key":"JiVxrTrUfm"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1034,"column":1},"end":{"line":1037,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1034,"column":1},"end":{"line":1034,"column":1}},"children":[{"type":"inlineCode","value":"get_free(asset)","position":{"start":{"line":1034,"column":1},"end":{"line":1034,"column":1}},"key":"O4QQ2NPyK3"},{"type":"text","value":" - 当前可用余额","position":{"start":{"line":1034,"column":1},"end":{"line":1034,"column":1}},"key":"SdQPrMRN4X"}],"key":"xuoJ970DSs"},{"type":"listItem","spread":true,"position":{"start":{"line":1035,"column":1},"end":{"line":1035,"column":1}},"children":[{"type":"inlineCode","value":"get_used(asset)","position":{"start":{"line":1035,"column":1},"end":{"line":1035,"column":1}},"key":"k6S8mEKLN9"},{"type":"text","value":" - 当前被占用余额（挂单）","position":{"start":{"line":1035,"column":1},"end":{"line":1035,"column":1}},"key":"iv2fy4NAe2"}],"key":"f5rcL7PtAm"},{"type":"listItem","spread":true,"position":{"start":{"line":1036,"column":1},"end":{"line":1037,"column":1}},"children":[{"type":"inlineCode","value":"get_total(asset)","position":{"start":{"line":1036,"column":1},"end":{"line":1036,"column":1}},"key":"e3ur1Xhnsg"},{"type":"text","value":" - 总余额（前两者之和）","position":{"start":{"line":1036,"column":1},"end":{"line":1036,"column":1}},"key":"sDNE7fIXW9"}],"key":"GJ8H1ReErP"}],"key":"a48hN6atFh"},{"type":"thematicBreak","position":{"start":{"line":1038,"column":1},"end":{"line":1038,"column":1}},"key":"VACqXzPdF3"},{"type":"heading","depth":3,"position":{"start":{"line":1040,"column":1},"end":{"line":1040,"column":1}},"children":[{"type":"text","value":"额外数据（交易记录 Trades）","position":{"start":{"line":1040,"column":1},"end":{"line":1040,"column":1}},"key":"J8Wg02HyuS"}],"identifier":"id-trades","label":"额外数据（交易记录 Trades）","html_id":"id-trades","implicit":true,"key":"RNARVjQIfQ"},{"type":"paragraph","position":{"start":{"line":1042,"column":1},"end":{"line":1042,"column":1}},"children":[{"type":"text","value":"可在策略中通过数据库查询历史交易。","position":{"start":{"line":1042,"column":1},"end":{"line":1042,"column":1}},"key":"ViFHA2U0cR"}],"key":"gsXxsKcvaa"},{"type":"paragraph","position":{"start":{"line":1044,"column":1},"end":{"line":1044,"column":1}},"children":[{"type":"text","value":"在文件顶部，导入所需对象：","position":{"start":{"line":1044,"column":1},"end":{"line":1044,"column":1}},"key":"bEFvRRIMT2"}],"key":"xrhbX5lDBW"},{"type":"code","lang":"python","value":"from freqtrade.persistence import Trade","position":{"start":{"line":1046,"column":1},"end":{"line":1048,"column":1}},"key":"AmXiRylyLr"},{"type":"paragraph","position":{"start":{"line":1050,"column":1},"end":{"line":1050,"column":1}},"children":[{"type":"text","value":"以下示例查询当天当前对的已平仓交易（可加其他过滤条件）：","position":{"start":{"line":1050,"column":1},"end":{"line":1050,"column":1}},"key":"FRQacWmZsk"}],"key":"wEijHVXJF8"},{"type":"code","lang":"python","value":"trades = Trade.get_trades_proxy(pair=metadata['pair'],\n                                open_date=datetime.now(timezone.utc) - timedelta(days=1),\n                                is_open=False,\n            ]).order_by(Trade.close_date).all()\n# 汇总该交易对的利润\ncurdayprofit = sum(trade.close_profit for trade in trades)","position":{"start":{"line":1052,"column":1},"end":{"line":1059,"column":1}},"key":"VcOKNMNw4r"},{"type":"paragraph","position":{"start":{"line":1061,"column":1},"end":{"line":1061,"column":1}},"children":[{"type":"text","value":"更多方法请查阅 ","position":{"start":{"line":1061,"column":1},"end":{"line":1061,"column":1}},"key":"jHuIl8QYdR"},{"type":"link","url":"/trade-object","position":{"start":{"line":1061,"column":1},"end":{"line":1061,"column":1}},"children":[{"type":"text","value":"Trade 对象","position":{"start":{"line":1061,"column":1},"end":{"line":1061,"column":1}},"key":"w0ndE48SUI"}],"urlSource":"trade-object.md","dataUrl":"/trade-object.json","internal":true,"protocol":"file","key":"JwE2EXkDbL"},{"type":"text","value":" 文档。","position":{"start":{"line":1061,"column":1},"end":{"line":1061,"column":1}},"key":"clifAywsqf"}],"key":"xLLScRXC1Q"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"zsteZ9QDU5"}],"key":"l27MhJHfLA"},{"type":"paragraph","position":{"start":{"line":1064,"column":1},"end":{"line":1064,"column":1}},"children":[{"type":"text","value":"回测/超参优化时，","position":{"start":{"line":1064,"column":1},"end":{"line":1064,"column":1}},"key":"PAmctuoKm0"},{"type":"inlineCode","value":"populate_*","position":{"start":{"line":1064,"column":1},"end":{"line":1064,"column":1}},"key":"gIO3eN5IeQ"},{"type":"text","value":" 方法中无法获取交易历史，结果为空。","position":{"start":{"line":1064,"column":1},"end":{"line":1064,"column":1}},"key":"pPfDLLO9SX"}],"key":"eELa5d2N8E"}],"key":"B9zVyUl0ab"},{"type":"heading","depth":3,"position":{"start":{"line":1067,"column":1},"end":{"line":1067,"column":1}},"children":[{"type":"text","value":"阻止特定对交易","position":{"start":{"line":1067,"column":1},"end":{"line":1067,"column":1}},"key":"o3bKGM3jhl"}],"identifier":"id","label":"阻止特定对交易","html_id":"id-17","implicit":true,"key":"WoVJAF3dYP"},{"type":"paragraph","position":{"start":{"line":1069,"column":1},"end":{"line":1069,"column":1}},"children":[{"type":"text","value":"Freqtrade 会在某对平仓后自动锁定该对至当前K线结束，防止同一K线内频繁交易。","position":{"start":{"line":1069,"column":1},"end":{"line":1069,"column":1}},"key":"gLc6l7LuZm"}],"key":"BsMLGI5R5O"},{"type":"paragraph","position":{"start":{"line":1071,"column":1},"end":{"line":1071,"column":1}},"children":[{"type":"text","value":"锁定对时会提示 ","position":{"start":{"line":1071,"column":1},"end":{"line":1071,"column":1}},"key":"sAReyfQAbd"},{"type":"inlineCode","value":"Pair <pair> is currently locked.","position":{"start":{"line":1071,"column":1},"end":{"line":1071,"column":1}},"key":"I35GEIO7XE"},{"type":"text","value":"。","position":{"start":{"line":1071,"column":1},"end":{"line":1071,"column":1}},"key":"hFl9qAhrRE"}],"key":"UiwitIzDj0"},{"type":"heading","depth":4,"position":{"start":{"line":1073,"column":1},"end":{"line":1073,"column":1}},"children":[{"type":"text","value":"在策略中锁定对","position":{"start":{"line":1073,"column":1},"end":{"line":1073,"column":1}},"key":"NoJ0ZlqWbS"}],"identifier":"id","label":"在策略中锁定对","html_id":"id-18","implicit":true,"key":"LAJ5DxVxu3"},{"type":"paragraph","position":{"start":{"line":1075,"column":1},"end":{"line":1075,"column":1}},"children":[{"type":"text","value":"有时希望在特定事件后锁定某对（如连续亏损）。","position":{"start":{"line":1075,"column":1},"end":{"line":1075,"column":1}},"key":"CXzEsH7bEl"}],"key":"txWjOJLKnI"},{"type":"paragraph","position":{"start":{"line":1077,"column":1},"end":{"line":1077,"column":1}},"children":[{"type":"text","value":"可用 ","position":{"start":{"line":1077,"column":1},"end":{"line":1077,"column":1}},"key":"wfUPK1s8Gr"},{"type":"inlineCode","value":"self.lock_pair(pair, until, [reason])","position":{"start":{"line":1077,"column":1},"end":{"line":1077,"column":1}},"key":"Xwr0ZsAx0a"},{"type":"text","value":" 实现，","position":{"start":{"line":1077,"column":1},"end":{"line":1077,"column":1}},"key":"rslXEE4q35"},{"type":"inlineCode","value":"until","position":{"start":{"line":1077,"column":1},"end":{"line":1077,"column":1}},"key":"vpaCMnjoYQ"},{"type":"text","value":" 为未来时间点，","position":{"start":{"line":1077,"column":1},"end":{"line":1077,"column":1}},"key":"Cu66wtAmen"},{"type":"inlineCode","value":"reason","position":{"start":{"line":1077,"column":1},"end":{"line":1077,"column":1}},"key":"xQ0eBzB95s"},{"type":"text","value":" 为可选说明。","position":{"start":{"line":1077,"column":1},"end":{"line":1077,"column":1}},"key":"SLdwPmQ9Sg"}],"key":"ggx3QITquE"},{"type":"paragraph","position":{"start":{"line":1079,"column":1},"end":{"line":1079,"column":1}},"children":[{"type":"text","value":"可用 ","position":{"start":{"line":1079,"column":1},"end":{"line":1079,"column":1}},"key":"HDOuYDVNOo"},{"type":"inlineCode","value":"self.unlock_pair(pair)","position":{"start":{"line":1079,"column":1},"end":{"line":1079,"column":1}},"key":"YJ1zeb3mcj"},{"type":"text","value":" 或 ","position":{"start":{"line":1079,"column":1},"end":{"line":1079,"column":1}},"key":"hwRHwPQzGK"},{"type":"inlineCode","value":"self.unlock_reason(<reason>)","position":{"start":{"line":1079,"column":1},"end":{"line":1079,"column":1}},"key":"oXh7DeLZI0"},{"type":"text","value":" 手动解锁，后者会解锁所有因该原因锁定的对。","position":{"start":{"line":1079,"column":1},"end":{"line":1079,"column":1}},"key":"fx0T98ZKTV"}],"key":"krT4KxGudn"},{"type":"paragraph","position":{"start":{"line":1081,"column":1},"end":{"line":1081,"column":1}},"children":[{"type":"text","value":"用 ","position":{"start":{"line":1081,"column":1},"end":{"line":1081,"column":1}},"key":"Mub6lmG6Uw"},{"type":"inlineCode","value":"self.is_pair_locked(pair)","position":{"start":{"line":1081,"column":1},"end":{"line":1081,"column":1}},"key":"PhcdQUTQrF"},{"type":"text","value":" 检查对是否被锁定。","position":{"start":{"line":1081,"column":1},"end":{"line":1081,"column":1}},"key":"hEEr29fkph"}],"key":"BAHnvruYb8"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"kEwl1luHSV"}],"key":"c4omGZJnco"},{"type":"paragraph","position":{"start":{"line":1084,"column":1},"end":{"line":1084,"column":1}},"children":[{"type":"text","value":"锁定会自动延长到下一个K线结束。如 5m 周期，锁到 10:18 会延长到 10:20。","position":{"start":{"line":1084,"column":1},"end":{"line":1084,"column":1}},"key":"HEO6dObUaZ"}],"key":"pARbuE7zsM"}],"key":"onkpMgqE4t"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"iIugnmF4CW"}],"key":"Bm8ySoWYAx"},{"type":"paragraph","position":{"start":{"line":1088,"column":1},"end":{"line":1088,"column":1}},"children":[{"type":"text","value":"手动锁定仅在实盘/模拟盘可用，回测时仅保护机制可锁定。","position":{"start":{"line":1088,"column":1},"end":{"line":1088,"column":1}},"key":"eBZjXZyqPw"}],"key":"DpVk4GGPo8"}],"key":"dCIwUaIFZ9"},{"type":"heading","depth":5,"position":{"start":{"line":1091,"column":1},"end":{"line":1091,"column":1}},"children":[{"type":"text","value":"锁定对示例","position":{"start":{"line":1091,"column":1},"end":{"line":1091,"column":1}},"key":"nzHNwDCdNW"}],"identifier":"id","label":"锁定对示例","html_id":"id-19","implicit":true,"key":"Wf62WR0Ndp"},{"type":"code","lang":"python","value":"from freqtrade.persistence import Trade\nfrom datetime import timedelta, datetime, timezone\n# 放在策略文件顶部\n# --------\n\n# 在 populate_indicators 或 populate_entry_trend 中：\nif self.config['runmode'].value in ('live', 'dry_run'):\n    # 查询近两天已平仓交易\n    trades = Trade.get_trades_proxy(\n        pair=metadata['pair'], is_open=False, \n        open_date=datetime.now(timezone.utc) - timedelta(days=2))\n    # 分析是否需要锁定\n    sumprofit = sum(trade.close_profit for trade in trades)\n    if sumprofit < 0:\n        # 锁定 12 小时\n        self.lock_pair(metadata['pair'], until=datetime.now(timezone.utc) + timedelta(hours=12))","position":{"start":{"line":1093,"column":1},"end":{"line":1110,"column":1}},"key":"gFjYEQqoYi"},{"type":"heading","depth":3,"position":{"start":{"line":1112,"column":1},"end":{"line":1112,"column":1}},"children":[{"type":"text","value":"打印主 dataframe","position":{"start":{"line":1112,"column":1},"end":{"line":1112,"column":1}},"key":"buN29teXSC"}],"identifier":"id-dataframe","label":"打印主 dataframe","html_id":"id-dataframe","implicit":true,"key":"O2o0orcrsK"},{"type":"paragraph","position":{"start":{"line":1114,"column":1},"end":{"line":1114,"column":1}},"children":[{"type":"text","value":"可在 ","position":{"start":{"line":1114,"column":1},"end":{"line":1114,"column":1}},"key":"q8CSCG5EpP"},{"type":"inlineCode","value":"populate_entry_trend()","position":{"start":{"line":1114,"column":1},"end":{"line":1114,"column":1}},"key":"U1RsU5RBrS"},{"type":"text","value":" 或 ","position":{"start":{"line":1114,"column":1},"end":{"line":1114,"column":1}},"key":"rhQLjEWn5L"},{"type":"inlineCode","value":"populate_exit_trend()","position":{"start":{"line":1114,"column":1},"end":{"line":1114,"column":1}},"key":"fEYNaXLhva"},{"type":"text","value":" 中打印当前主 dataframe，便于调试。","position":{"start":{"line":1114,"column":1},"end":{"line":1114,"column":1}},"key":"TmhKtpTmHF"}],"key":"s6JX882o1D"},{"type":"code","lang":"python","value":"def populate_entry_trend(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n    dataframe.loc[\n        (\n            #>> 你的条件 <<<\n        ),\n        ['enter_long', 'enter_tag']] = (1, 'somestring')\n\n    # 打印分析的对\n    print(f\"result for {metadata['pair']}\")\n\n    # 打印最后 5 行\n    print(dataframe.tail())\n\n    return dataframe","position":{"start":{"line":1116,"column":1},"end":{"line":1131,"column":1}},"key":"y0uD6r9JXk"},{"type":"paragraph","position":{"start":{"line":1133,"column":1},"end":{"line":1133,"column":1}},"children":[{"type":"text","value":"如需打印更多行可用 ","position":{"start":{"line":1133,"column":1},"end":{"line":1133,"column":1}},"key":"Wt3eCtRv3X"},{"type":"inlineCode","value":"print(dataframe)","position":{"start":{"line":1133,"column":1},"end":{"line":1133,"column":1}},"key":"FtdrYljQS4"},{"type":"text","value":"，但不建议，否则每对每 5 秒会输出约 500 行。","position":{"start":{"line":1133,"column":1},"end":{"line":1133,"column":1}},"key":"kwReO7WdwS"}],"key":"ONpqp8oBz9"},{"type":"heading","depth":3,"position":{"start":{"line":1135,"column":1},"end":{"line":1135,"column":1}},"children":[{"type":"text","value":"开发策略时的常见错误","position":{"start":{"line":1135,"column":1},"end":{"line":1135,"column":1}},"key":"HelJ2n2sg5"}],"identifier":"id","label":"开发策略时的常见错误","html_id":"id-20","implicit":true,"key":"KmnrCDEgvO"},{"type":"heading","depth":4,"position":{"start":{"line":1139,"column":1},"end":{"line":1139,"column":1}},"children":[{"type":"text","value":"回测时\"看未来\"","position":{"start":{"line":1139,"column":1},"end":{"line":1139,"column":1}},"key":"Ri1xNTwU9E"}],"label":"common-mistakes-when-developing-strategies","identifier":"common-mistakes-when-developing-strategies","html_id":"common-mistakes-when-developing-strategies","key":"HTYKHzj0As"},{"type":"paragraph","position":{"start":{"line":1141,"column":1},"end":{"line":1141,"column":1}},"children":[{"type":"text","value":"回测为提升性能会一次性分析整个 dataframe。策略作者需确保不\"看未来\"，即不使用 dry/live 时不可用的数据。","position":{"start":{"line":1141,"column":1},"end":{"line":1141,"column":1}},"key":"Yl0ros7qYq"}],"key":"dZNxk5nMKM"},{"type":"paragraph","position":{"start":{"line":1143,"column":1},"end":{"line":1143,"column":1}},"children":[{"type":"text","value":"这是常见痛点，易导致回测与 dry/live 巨大差异。看未来的策略回测时表现极佳，实盘却很差。","position":{"start":{"line":1143,"column":1},"end":{"line":1143,"column":1}},"key":"BxFRGXhZhH"}],"key":"wVBSDAlQtG"},{"type":"paragraph","position":{"start":{"line":1145,"column":1},"end":{"line":1145,"column":1}},"children":[{"type":"text","value":"常见错误包括：","position":{"start":{"line":1145,"column":1},"end":{"line":1145,"column":1}},"key":"uNLRkEklCV"}],"key":"R2PSq68VdS"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1147,"column":1},"end":{"line":1152,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1147,"column":1},"end":{"line":1147,"column":1}},"children":[{"type":"text","value":"不要用 ","position":{"start":{"line":1147,"column":1},"end":{"line":1147,"column":1}},"key":"hyH3BdDVgw"},{"type":"inlineCode","value":"shift(-1)","position":{"start":{"line":1147,"column":1},"end":{"line":1147,"column":1}},"key":"lIvcEd6Qii"},{"type":"text","value":" 或负数，这会用到未来数据","position":{"start":{"line":1147,"column":1},"end":{"line":1147,"column":1}},"key":"StbxDTrAxj"}],"key":"P31VkoZ1VQ"},{"type":"listItem","spread":true,"position":{"start":{"line":1148,"column":1},"end":{"line":1148,"column":1}},"children":[{"type":"text","value":"不要在 ","position":{"start":{"line":1148,"column":1},"end":{"line":1148,"column":1}},"key":"ttejS433A4"},{"type":"inlineCode","value":"populate_","position":{"start":{"line":1148,"column":1},"end":{"line":1148,"column":1}},"key":"vXMM4s3jpL"},{"type":"text","value":" 函数中用 ","position":{"start":{"line":1148,"column":1},"end":{"line":1148,"column":1}},"key":"HFrhKzzz4q"},{"type":"inlineCode","value":".iloc[-1]","position":{"start":{"line":1148,"column":1},"end":{"line":1148,"column":1}},"key":"tqlUKv63O2"},{"type":"text","value":" 或其他绝对位置，dry-run 和回测时表现不同。回调函数中可安全用 iloc","position":{"start":{"line":1148,"column":1},"end":{"line":1148,"column":1}},"key":"a7EYqth5K7"}],"key":"VYYxrbwn2M"},{"type":"listItem","spread":true,"position":{"start":{"line":1149,"column":1},"end":{"line":1149,"column":1}},"children":[{"type":"text","value":"不要用 ","position":{"start":{"line":1149,"column":1},"end":{"line":1149,"column":1}},"key":"lxkxhVAx7J"},{"type":"inlineCode","value":"dataframe['mean_volume'] = dataframe['volume'].mean()","position":{"start":{"line":1149,"column":1},"end":{"line":1149,"column":1}},"key":"CDEexWsH6w"},{"type":"text","value":" 这类全列函数，回测时会用到未来数据。应用 rolling() 计算，如 ","position":{"start":{"line":1149,"column":1},"end":{"line":1149,"column":1}},"key":"h06FSiGf5J"},{"type":"inlineCode","value":"dataframe['volume'].rolling(<window>).mean()","position":{"start":{"line":1149,"column":1},"end":{"line":1149,"column":1}},"key":"ApHAaxhARG"}],"key":"i9GbtBdTg3"},{"type":"listItem","spread":true,"position":{"start":{"line":1150,"column":1},"end":{"line":1150,"column":1}},"children":[{"type":"text","value":"不要用 ","position":{"start":{"line":1150,"column":1},"end":{"line":1150,"column":1}},"key":"DDEPm7OSuh"},{"type":"inlineCode","value":".resample('1h')","position":{"start":{"line":1150,"column":1},"end":{"line":1150,"column":1}},"key":"GPdd59SsCE"},{"type":"text","value":"，这会用左边界，应用 ","position":{"start":{"line":1150,"column":1},"end":{"line":1150,"column":1}},"key":"AlgG3Atp8M"},{"type":"inlineCode","value":".resample('1h', label='right')","position":{"start":{"line":1150,"column":1},"end":{"line":1150,"column":1}},"key":"nojDVpmAeF"}],"key":"Au1HT3HwPC"},{"type":"listItem","spread":true,"position":{"start":{"line":1151,"column":1},"end":{"line":1152,"column":1}},"children":[{"type":"text","value":"不要用 ","position":{"start":{"line":1151,"column":1},"end":{"line":1151,"column":1}},"key":"I5L5j5dwsY"},{"type":"inlineCode","value":".merge()","position":{"start":{"line":1151,"column":1},"end":{"line":1151,"column":1}},"key":"dU7sTFVm6o"},{"type":"text","value":" 合并大周期到小周期，应用 ","position":{"start":{"line":1151,"column":1},"end":{"line":1151,"column":1}},"key":"XGnoaavBpG"},{"type":"crossReference","position":{"start":{"line":1151,"column":1},"end":{"line":1151,"column":1}},"children":[{"type":"text","value":"informative pair","position":{"start":{"line":1151,"column":1},"end":{"line":1151,"column":1}},"key":"Xy5tUszWi7"}],"identifier":"informative-pairs","label":"informative-pairs","kind":"heading","template":"{name}","resolved":true,"html_id":"informative-pairs","key":"WS1Wm9hcAw"},{"type":"text","value":" 工具。普通 merge 会有前视偏差","position":{"start":{"line":1151,"column":1},"end":{"line":1151,"column":1}},"key":"hsnvtmMy4G"}],"key":"EVTdI4X6MA"}],"key":"UZ0eroywAZ"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"如何发现问题","position":{"start":{"line":1153,"column":1},"end":{"line":1153,"column":1}},"key":"bJZTat9apB"}],"key":"XEqsqsI6pc"},{"type":"paragraph","position":{"start":{"line":1154,"column":1},"end":{"line":1154,"column":1}},"children":[{"type":"text","value":"建议用 ","position":{"start":{"line":1154,"column":1},"end":{"line":1154,"column":1}},"key":"WqESsKGZPf"},{"type":"link","url":"/lookahead-analysis","position":{"start":{"line":1154,"column":1},"end":{"line":1154,"column":1}},"children":[{"type":"text","value":"lookahead-analysis","position":{"start":{"line":1154,"column":1},"end":{"line":1154,"column":1}},"key":"ils8DtlaBG"}],"urlSource":"lookahead-analysis.md","dataUrl":"/lookahead-analysis.json","internal":true,"protocol":"file","key":"aKrMrx7FT1"},{"type":"text","value":" 和 ","position":{"start":{"line":1154,"column":1},"end":{"line":1154,"column":1}},"key":"WvDjha5Niz"},{"type":"link","url":"/recursive-analysis","position":{"start":{"line":1154,"column":1},"end":{"line":1154,"column":1}},"children":[{"type":"text","value":"recursive-analysis","position":{"start":{"line":1154,"column":1},"end":{"line":1154,"column":1}},"key":"PB60a8kUpB"}],"urlSource":"recursive-analysis.md","dataUrl":"/recursive-analysis.json","internal":true,"protocol":"file","key":"NabiOiAwV7"},{"type":"text","value":" 两个工具辅助排查。","position":{"start":{"line":1154,"column":1},"end":{"line":1154,"column":1}},"key":"dLEdT0Qfqp"}],"key":"bwk9u2Qire"},{"type":"paragraph","position":{"start":{"line":1156,"column":1},"end":{"line":1156,"column":1}},"children":[{"type":"text","value":"但两者都不能保证完全无误。","position":{"start":{"line":1156,"column":1},"end":{"line":1156,"column":1}},"key":"MBR1BJVawa"}],"key":"JpEGpXJrJK"}],"key":"PN9WfPFh8S"},{"type":"heading","depth":4,"position":{"start":{"line":1161,"column":1},"end":{"line":1161,"column":1}},"children":[{"type":"text","value":"信号冲突","position":{"start":{"line":1161,"column":1},"end":{"line":1161,"column":1}},"key":"AA0P7l70af"}],"label":"colliding-signals","identifier":"colliding-signals","html_id":"colliding-signals","key":"a7VGyrQz9j"},{"type":"paragraph","position":{"start":{"line":1163,"column":1},"end":{"line":1163,"column":1}},"children":[{"type":"text","value":"当信号冲突（如 ","position":{"start":{"line":1163,"column":1},"end":{"line":1163,"column":1}},"key":"iOzYbFL7gU"},{"type":"inlineCode","value":"enter_long","position":{"start":{"line":1163,"column":1},"end":{"line":1163,"column":1}},"key":"hpKAT8gZAJ"},{"type":"text","value":" 和 ","position":{"start":{"line":1163,"column":1},"end":{"line":1163,"column":1}},"key":"YzvTOQPGoP"},{"type":"inlineCode","value":"exit_long","position":{"start":{"line":1163,"column":1},"end":{"line":1163,"column":1}},"key":"e4GuaYmueI"},{"type":"text","value":" 同时为 1）时，freqtrade 会忽略入场信号，避免刚进场就立刻出场。","position":{"start":{"line":1163,"column":1},"end":{"line":1163,"column":1}},"key":"eqxRdooMry"}],"key":"y3QR7hdkrI"},{"type":"paragraph","position":{"start":{"line":1165,"column":1},"end":{"line":1165,"column":1}},"children":[{"type":"text","value":"规则如下，若 3 个信号中有多个为 1，则忽略入场：","position":{"start":{"line":1165,"column":1},"end":{"line":1165,"column":1}},"key":"fCyBBxHVJh"}],"key":"MrHPYYZaUS"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1167,"column":1},"end":{"line":1169,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1167,"column":1},"end":{"line":1167,"column":1}},"children":[{"type":"inlineCode","value":"enter_long","position":{"start":{"line":1167,"column":1},"end":{"line":1167,"column":1}},"key":"YBa1NEuwmW"},{"type":"text","value":" -> ","position":{"start":{"line":1167,"column":1},"end":{"line":1167,"column":1}},"key":"eggRnytBTF"},{"type":"inlineCode","value":"exit_long","position":{"start":{"line":1167,"column":1},"end":{"line":1167,"column":1}},"key":"YhTkoIckUY"},{"type":"text","value":", ","position":{"start":{"line":1167,"column":1},"end":{"line":1167,"column":1}},"key":"RJRfothWdK"},{"type":"inlineCode","value":"enter_short","position":{"start":{"line":1167,"column":1},"end":{"line":1167,"column":1}},"key":"nKIxdYPk2w"}],"key":"r7070OGYx1"},{"type":"listItem","spread":true,"position":{"start":{"line":1168,"column":1},"end":{"line":1169,"column":1}},"children":[{"type":"inlineCode","value":"enter_short","position":{"start":{"line":1168,"column":1},"end":{"line":1168,"column":1}},"key":"y0vnt2CHVG"},{"type":"text","value":" -> ","position":{"start":{"line":1168,"column":1},"end":{"line":1168,"column":1}},"key":"bqjVnLVz8b"},{"type":"inlineCode","value":"exit_short","position":{"start":{"line":1168,"column":1},"end":{"line":1168,"column":1}},"key":"nJLugzYxDn"},{"type":"text","value":", ","position":{"start":{"line":1168,"column":1},"end":{"line":1168,"column":1}},"key":"Bvt5DDcPb9"},{"type":"inlineCode","value":"enter_long","position":{"start":{"line":1168,"column":1},"end":{"line":1168,"column":1}},"key":"asXfYqLuQ3"}],"key":"G05kzQQsdJ"}],"key":"b6CI6gLlw0"},{"type":"heading","depth":3,"position":{"start":{"line":1170,"column":1},"end":{"line":1170,"column":1}},"children":[{"type":"text","value":"更多策略思路","position":{"start":{"line":1170,"column":1},"end":{"line":1170,"column":1}},"key":"QfwPO8DWw0"}],"identifier":"id","label":"更多策略思路","html_id":"id-21","implicit":true,"key":"YSg0muafNC"},{"type":"paragraph","position":{"start":{"line":1172,"column":1},"end":{"line":1172,"column":1}},"children":[{"type":"text","value":"如需更多策略思路，请访问 ","position":{"start":{"line":1172,"column":1},"end":{"line":1172,"column":1}},"key":"oKyrUCThfb"},{"type":"link","url":"https://github.com/freqtrade/freqtrade-strategies","position":{"start":{"line":1172,"column":1},"end":{"line":1172,"column":1}},"children":[{"type":"text","value":"策略仓库","position":{"start":{"line":1172,"column":1},"end":{"line":1172,"column":1}},"key":"atbH1RCD5I"}],"urlSource":"https://github.com/freqtrade/freqtrade-strategies","error":true,"key":"WSHtHAnRJQ"},{"type":"text","value":"。可作为学习参考，实际效果取决于市场、交易对等。请务必先回测，再 dry-run，谨慎实盘。","position":{"start":{"line":1172,"column":1},"end":{"line":1172,"column":1}},"key":"DJVApZe09H"}],"key":"hEQJepNVNp"},{"type":"paragraph","position":{"start":{"line":1174,"column":1},"end":{"line":1174,"column":1}},"children":[{"type":"text","value":"欢迎参考、改编，也欢迎向仓库提交新策略 PR。","position":{"start":{"line":1174,"column":1},"end":{"line":1174,"column":1}},"key":"x4g7dXzoZD"}],"key":"pla1DzNoTy"},{"type":"heading","depth":3,"position":{"start":{"line":1176,"column":1},"end":{"line":1176,"column":1}},"children":[{"type":"text","value":"下一步,回测","position":{"start":{"line":1176,"column":1},"end":{"line":1176,"column":1}},"key":"ZdnSZcUJHj"}],"identifier":"id","label":"下一步,回测","html_id":"id-22","implicit":true,"key":"rZyAFzdVTV"},{"type":"paragraph","position":{"start":{"line":1178,"column":1},"end":{"line":1178,"column":1}},"children":[{"type":"text","value":"现在你已经有了完美的策略，下一步请学习","position":{"start":{"line":1178,"column":1},"end":{"line":1178,"column":1}},"key":"t59DmsuFtf"},{"type":"link","url":"/backtesting","position":{"start":{"line":1178,"column":1},"end":{"line":1178,"column":1}},"children":[{"type":"text","value":"如何回测","position":{"start":{"line":1178,"column":1},"end":{"line":1178,"column":1}},"key":"H4nUDl05nB"}],"urlSource":"backtesting.md","dataUrl":"/backtesting.json","internal":true,"protocol":"file","key":"oTXFWFPhBA"},{"type":"text","value":"。","position":{"start":{"line":1178,"column":1},"end":{"line":1178,"column":1}},"key":"Yl3QCRUfUw"}],"key":"F9CvRxAHr6"}],"key":"o5W0xqoeDs"}],"key":"wN5Gl73H9L"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Freqtrade 策略开发指南","short_title":"策略开发指南","url":"/strategy-101","group":"安装"},"next":{"title":"策略回调指南","short_title":"策略回调","url":"/strategy-callbacks","group":"安装"}}},"domain":"http://localhost:3002"}