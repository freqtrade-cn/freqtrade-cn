<!DOCTYPE html><html lang="en" class="" style="scroll-padding:60px"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>策略回调指南 - Freqtrade 中文文档</title><meta property="og:title" content="策略回调指南 - Freqtrade 中文文档"/><meta name="generator" content="mystmd"/><meta name="description" content="本文档详细介绍了 Freqtrade 交易机器人中可用的各种策略回调函数,包括它们的用途、调用时机以及使用方法。"/><meta property="og:description" content="本文档详细介绍了 Freqtrade 交易机器人中可用的各种策略回调函数,包括它们的用途、调用时机以及使用方法。"/><meta name="keywords" content="Freqtrade, 中文文档, 交易机器人, 量化交易, 加密货币, 数字货币, 区块链, 人工智能, 机器学习"/><meta name="image" content="/build/freqUI-chart-annotat-6ca425e986932e863842497203176546.webp"/><meta property="og:image" content="/build/freqUI-chart-annotat-6ca425e986932e863842497203176546.webp"/><link rel="stylesheet" href="/build/_assets/app-5WKS5EPQ.css"/><link rel="stylesheet" href="/build/_assets/thebe-core-VKVHG5VY.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jupyter-matplotlib@0.11.3/css/mpl_widget.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous"/><link rel="icon" href="/favicon.ico"/><link rel="stylesheet" href="/myst-theme.css"/><script>
  const savedTheme = localStorage.getItem("myst:theme");
  const theme = window.matchMedia("(prefers-color-scheme: light)").matches ? 'light' : 'dark';
  const classes = document.documentElement.classList;
  const hasAnyTheme = classes.contains('light') || classes.contains('dark');
  if (!hasAnyTheme) classes.add(savedTheme ?? theme);
</script></head><body class="m-0 transition-colors duration-500 bg-white dark:bg-stone-900"><div class="fixed top-1 left-1 h-[0px] w-[0px] focus-within:z-40 focus-within:h-auto focus-within:w-auto bg-white overflow-hidden focus-within:p-2 focus-within:ring-1" aria-label="skip to content options"><a href="#skip-to-frontmatter" class="block px-2 py-1 text-black underline">Skip to article frontmatter</a><a href="#skip-to-article" class="block px-2 py-1 text-black underline">Skip to article content</a></div><div class="bg-white/80 backdrop-blur dark:bg-stone-900/80 shadow dark:shadow-stone-700 p-3 md:px-8 sticky w-screen top-0 z-30 h-[60px]"><nav class="flex items-center justify-between flex-nowrap max-w-[1440px] mx-auto"><div class="flex flex-row xl:min-w-[19.5rem] mr-2 sm:mr-7 justify-start items-center shrink-0"><div class="block xl:hidden"><button class="flex items-center border-stone-400 text-stone-800 hover:text-stone-900 dark:text-stone-200 hover:dark:text-stone-100"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="m-1"><path fill-rule="evenodd" d="M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd"></path></svg><span class="sr-only">Open Menu</span></button></div><a class="flex items-center ml-3 dark:text-white w-fit md:ml-5 xl:ml-7" href="/"><span class="text-md sm:text-xl tracking-tight sm:mr-5">Freqtrade 中文文档</span></a></div><div class="flex items-center flex-grow w-auto"><div class="flex-grow hidden text-md lg:block"><div class="relative inline-block mx-2 grow-0" data-headlessui-state=""><div class="inline-block"><button class="inline-flex items-center justify-center w-full py-1 mx-2 font-medium rounded-md text-md text-stone-900 dark:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-opacity-75" id="headlessui-menu-button-:R2j4op:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span>Freqtrade 官方</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="ml-2 -mr-1 text-violet-200 hover:text-violet-100"><path fill-rule="evenodd" d="M12.53 16.28a.75.75 0 0 1-1.06 0l-7.5-7.5a.75.75 0 0 1 1.06-1.06L12 14.69l6.97-6.97a.75.75 0 1 1 1.06 1.06l-7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div></div><div class="relative inline-block mx-2 grow-0"><a href="https://github.com/freqtrade-cn/freqtrade" target="_blank" rel="noopener noreferrer" class="inline-flex items-center justify-center w-full mx-2 py-1 text-md font-medium dark:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-opacity-75">Freqtrade-CN GitHub</a></div></div><div class="flex-grow block"></div><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R74op:" data-state="closed" class="flex items-center h-10 aspect-square sm:w-64 text-left text-gray-400 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 hover:ring-blue-500 dark:hover:ring-blue-500 hover:border-blue-500 dark:hover:border-blue-500"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="p-2.5 h-10 w-10 aspect-square"><path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z" clip-rule="evenodd"></path></svg><span class="hidden sm:block grow">Search</span><div aria-hidden="true" class="items-center hidden mx-1 font-mono text-sm text-gray-400 sm:flex gap-x-1"><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none hide-mac">CTRL</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none show-mac">⌘</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none ">K</kbd><script>
;(() => {
const script = document.currentScript;
const root = script.parentElement;

const isMac = /mac/i.test(
      window.navigator.userAgentData?.platform ?? window.navigator.userAgent,
    );
root.querySelectorAll(".hide-mac").forEach(node => {node.classList.add(isMac ? "hidden" : "block")});
root.querySelectorAll(".show-mac").forEach(node => {node.classList.add(!isMac ? "hidden" : "block")});
})()</script></div></button><button class="theme rounded-full aspect-square border border-stone-700 dark:border-white hover:bg-neutral-100 border-solid overflow-hidden text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 w-8 h-8 mx-3" title="Toggle theme between light and dark mode" aria-label="Toggle theme between light and dark mode"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="h-full w-full p-0.5 hidden dark:block"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.7-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z" clip-rule="evenodd"></path></svg><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="h-full w-full p-0.5 dark:hidden"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"></path></svg></button><div class="block sm:hidden"></div><div class="hidden sm:block"></div></div></nav></div><div class="fixed xl:article-grid grid-gap xl:w-screen xl:pointer-events-none overflow-auto max-xl:min-w-[300px] hidden z-10" style="top:60px"><div class="pointer-events-auto xl:col-margin-left flex-col overflow-hidden hidden xl:flex"><div class="flex-grow py-6 overflow-y-auto primary-scrollbar"><nav aria-label="Navigation" class="overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px] lg:hidden"><div class="w-full px-1 dark:text-white font-medium"><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a class="py-2 grow" href="/">Freqtrade 官方</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rap8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rap8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><a href="https://github.com/freqtrade-cn/freqtrade" target="_blank" rel="noopener noreferrer" class="p-2 my-1 rounded-lg hover:bg-slate-300/30 block break-words focus:outline outline-blue-200 outline-2 rounded">Freqtrade-CN GitHub</a></div></nav><div class="my-3 border-b-2 lg:hidden"></div><nav aria-label="Table of Contents" class="flex-grow overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px]"><div class="w-full px-1 dark:text-white"><a title="Freqtrade 中文文档" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30 font-bold" href="/">Freqtrade 中文文档</a><a title="Freqtrade 术语词典" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/terms">术语词典</a><a title="使用 Docker 运行 Freqtrade" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/docker-quickstart">Docker 快速入门</a><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="安装" class="block break-words rounded py-2 grow cursor-pointer">安装</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R16p8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R16p8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><a title="Freqtrade 基础" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/bot-basics">基础指南</a><a title="配置 Freqtrade" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/configuration">配置</a><a title="Freqtrade 策略开发指南" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/strategy-101">策略开发指南</a><a title="策略自定义指南" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/strategy-customization">策略自定义</a><a title="策略回调指南" aria-current="page" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg bg-blue-300/30 active" href="/strategy-callbacks">策略回调</a><a title="止损配置指南" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/stoploss">止损</a><a title="插件体系" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/plugins">插件体系</a><a title="机器人使用指南" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/bot-usage">机器人使用</a><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="机器人控制和管理" class="block break-words rounded py-2 grow cursor-pointer">机器人控制和管理</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R3ep8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R3ep8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><a title="数据下载" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/data-download">数据下载</a><a title="回测" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/backtesting">回测</a><a title="Hyperopt 超参数优化指南" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/hyperopt">Hyperopt 指南</a><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="FreqAI" class="block break-words rounded py-2 grow cursor-pointer">FreqAI</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R4ep8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R4ep8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><a title="使用杠杆交易" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/leverage">使用杠杆交易</a><a title="实用工具命令指南" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/utils">实用工具指南</a><a title="绘图" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/plotting">绘图</a><a title="交易所特定说明" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/exchanges">交易所说明</a><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="数据分析" class="block break-words rounded py-2 grow cursor-pointer">数据分析</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R5mp8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R5mp8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="高级话题" class="block break-words rounded py-2 grow cursor-pointer">高级话题</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R5up8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R5up8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><a title="Freqtrade 常见问题" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/faq">FAQ</a><a title="策略迁移指南" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/strategy-migration">策略迁移</a><a title="更新指南" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/updating">更新指南</a><a title="Commands" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/commands">Commands</a><a title="已弃用功能" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/deprecated">已弃用功能</a><a title="开发者指南" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/developer">开发者指南</a><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Commands" class="block break-words rounded py-2 grow cursor-pointer">Commands</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R7mp8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R7mp8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div></div></nav></div><div class="flex-none py-6 transition-all duration-700 translate-y-6 opacity-0"><a class="flex mx-auto text-gray-700 w-fit hover:text-blue-700 dark:text-gray-200 dark:hover:text-blue-400" href="https://github.com/freqtrade-cn/docs_zh-CN" target="_blank" rel="noreferrer"><span class="self-center text-sm">Made with love by Freqtrade-CN🏅🏅</span></a></div></div></div><main class="article-grid grid-gap"><article class="article-grid subgrid-gap col-screen article content"><div class="hidden"></div><div id="skip-to-frontmatter" aria-label="article frontmatter" class="mb-8 pt-9"><div class="flex items-center h-6 mb-5 text-sm font-light"><div class="flex-none pr-2 smallcaps">Freqtrade 策略回调文档</div><div class="flex-grow"></div><a href="https://github.com/freqtrade-cn/docs_zh-CN" title="GitHub Repository: freqtrade-cn/docs_zh-CN" target="_blank" rel="noopener noreferrer" class="text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="inline-block mr-1 opacity-60 hover:opacity-100"><path d="M12 2.5c-5.4 0-9.8 4.4-9.8 9.7 0 4.3 2.8 8 6.7 9.2.5.1.7-.2.7-.5v-1.8c-2.4.5-3.1-.6-3.3-1.1-.1-.3-.6-1.1-1-1.4-.3-.2-.8-.6 0-.6s1.3.7 1.5 1c.9 1.5 2.3 1.1 2.8.8.1-.6.3-1.1.6-1.3-2.2-.2-4.4-1.1-4.4-4.8 0-1.1.4-1.9 1-2.6-.1-.2-.4-1.2.1-2.6 0 0 .8-.3 2.7 1 .8-.2 1.6-.3 2.4-.3.8 0 1.7.1 2.4.3 1.9-1.3 2.7-1 2.7-1 .5 1.3.2 2.3.1 2.6.6.7 1 1.5 1 2.6 0 3.7-2.3 4.6-4.4 4.8.4.3.7.9.7 1.8V21c0 .3.2.6.7.5 3.9-1.3 6.6-4.9 6.6-9.2 0-5.4-4.4-9.8-9.8-9.8z"></path></svg></a><a href="https://github.com/freqtrade-cn/docs_zh-CN/blob/main/strategy-callbacks.md" title="Edit This Page" target="_blank" rel="noopener noreferrer" class="text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="inline-block mr-1 opacity-60 hover:opacity-100"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg></a><div class="relative flex inline-block mx-1 grow-0" data-headlessui-state=""><button class="relative ml-2 -mr-1" id="headlessui-menu-button-:Rs8top:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Downloads</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem"><title>Download</title><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg></button></div></div><h1 class="mb-0">策略回调指南</h1><p class="mt-2 mb-0 lead text-zinc-600 dark:text-zinc-400">策略回调函数的完整概述</p><header class="mt-4 not-prose"><div><span class="font-semibold text-sm inline-block"><button class="focus:shadow-[0_0_0_2px] focus:shadow-black outline-none hover:underline" aria-label="Author Details" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R78top:" data-state="closed">Freqtrade</button></span></div></header></div><div class="block my-10 lg:sticky lg:z-10 lg:h-0 lg:pt-0 lg:my-0 lg:ml-10 lg:col-margin-right" style="top:60px"><nav></nav></div><div id="skip-to-article"></div><h2 id="id" class="relative group"><span class="heading-text">策略回调</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>虽然主要的策略函数（<code>populate_indicators()</code>, <code>populate_entry_trend()</code>, <code>populate_exit_trend()</code>) ）应以向量化方式使用，并且只会在<span data-state="closed"><a class="hover-link" href="/bot-basics#backtesting-hyperopt-execution-logic">回测时调用一次</a></span>，但回调函数会在&quot;需要时&quot;被调用。</p><p>因此，你应避免在回调中进行繁重的计算，以免在操作过程中造成延迟。</p><p>根据所用回调的不同，它们可能在进入/退出交易时调用，或在交易期间多次调用。
当前可用的回调有：</p><ul><li><span data-state="closed"><a href="#bot-start" class="hover-link">机器人启动 <code>bot_start()</code></a></span></li><li><span data-state="closed"><a href="#bot-loop-start" class="hover-link">机器人循环开始 <code>bot_loop_start()</code></a></span></li><li><span data-state="closed"><a href="#stake-size-management" class="hover-link">仓位大小管理 <code>custom_stake_amount()</code></a></span></li><li><span data-state="closed"><a href="#custom-exit-signal" class="hover-link">自定义退出信号 <code>custom_exit()</code></a></span></li><li><span data-state="closed"><a href="#custom-stoploss" class="hover-link">自定义止损 <code>custom_stoploss()</code></a></span></li><li><a target="_blank" rel="noreferrer" href="#custom-order-price-rules" class=""><code>custom_entry_price()</code> 和 <code>custom_exit_price()</code></a></li><li><a target="_blank" rel="noreferrer" href="#custom-order-timeout-rules" class=""><code>check_entry_timeout()</code> 和 <code>check_exit_timeout()</code></a></li><li><a target="_blank" rel="noreferrer" href="#trade-entry-buy-order-confirmation" class=""><code>confirm_trade_entry()</code></a></li><li><a target="_blank" rel="noreferrer" href="#trade-exit-sell-order-confirmation" class=""><code>confirm_trade_exit()</code></a></li><li><span data-state="closed"><a href="#adjust-trade-position" class="hover-link"><code>adjust_trade_position()</code></a></span></li><li><a target="_blank" rel="noreferrer" href="#adjust-entry-price" class=""><code>adjust_entry_price()</code></a></li><li><a target="_blank" rel="noreferrer" href="#leverage-callback" class=""><code>leverage()</code></a></li><li><a target="_blank" rel="noreferrer" href="#order-filled-callback" class=""><code>order_filled()</code></a></li></ul><aside class="myst-admonition myst-admonition-tip my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-green-600"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-green-600 bg-green-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-green-600"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">回调调用顺序</div></div><div class="myst-admonition-body px-4 py-1"><p>你可以在 <span data-state="closed"><a class="hover-link" href="/bot-basics#bot-execution-logic">bot-basics</a></span> 中找到回调的调用顺序</p></div></aside><h3 id="id-1" class="relative group"><span class="heading-text">策略所需的导入</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-1" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>在创建策略时，你需要导入必要的模块和类。以下是一个策略所需的导入：</p><p>默认情况下，我们建议使用以下导入作为策略的基础：
这将涵盖 freqtrade 功能所需的所有导入。
当然，你可以根据需要添加更多导入。</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># flake8: noqa: F401
# isort: skip_file
# --- Do not remove these imports ---
import numpy as np
import pandas as pd
from datetime import datetime, timedelta, timezone
from pandas import DataFrame
from typing import Dict, Optional, Union, Tuple

from freqtrade.strategy import (
    IStrategy,
    Trade, 
    Order,
    PairLocks,
    informative,  # @informative decorator
    # Hyperopt Parameters
    BooleanParameter,
    CategoricalParameter,
    DecimalParameter,
    IntParameter,
    RealParameter,
    # timeframe helpers
    timeframe_to_minutes,
    timeframe_to_next_date,
    timeframe_to_prev_date,
    # Strategy helper functions
    merge_informative_pair,
    stoploss_from_absolute,
    stoploss_from_open,
)

# --------------------------------
# Add your lib to import here
import talib.abstract as ta
from technical import qtpylib</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><h3 id="id-2" class="relative group"><span class="heading-text">退出逻辑比较</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-2" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Freqtrade 允许你的策略使用基于信号或基于回调的函数来实现不同的退出逻辑。
本节旨在比较每个不同的函数，帮助你选择最适合你需求的方案。</p><ul><li><p><strong><code>populate_exit_trend()</code></strong> - 使用主数据框架中的指标进行向量化的基于信号的退出逻辑</p><ul><li><p>✅ <strong>使用场景</strong>：基于指标或其他可以向量化计算的数据定义退出信号。</p></li><li><p>🚫 <strong>不适用场景</strong>：为每个单独的交易自定义退出条件，或需要交易数据来做出退出决定时。</p></li></ul></li><li><p><strong><code>custom_exit()</code></strong> - 自定义退出逻辑，将立即完全退出交易，在每次机器人循环迭代时对每个开放交易调用，直到交易关闭。</p><ul><li><p>✅ <strong>使用场景</strong>：为每个单独的交易指定退出条件（包括使用 <code>adjust_trade_position()</code> 的任何额外调整订单），或需要交易数据来做出退出决定时，例如使用利润数据来退出。</p></li><li><p>🚫 <strong>不适用场景</strong>：当你想使用向量化的基于指标的数据退出时（改用 <code>populate_exit_trend()</code> 信号），或作为 <code>custom_stoploss()</code> 的替代，并且要注意回测中基于速率的退出可能不准确。</p></li></ul></li><li><p><strong><code>custom_stoploss()</code></strong> - 自定义追踪止损，在每次迭代时对每个开放交易调用，直到交易关闭。这里返回的值也用于<span data-state="closed"><a class="hover-link" href="/stoploss">交易所止损</a></span>。</p><ul><li><p>✅ <strong>使用场景</strong>：自定义止损逻辑，根据交易数据或其他条件设置动态止损。</p></li><li><p>🚫 <strong>不适用场景</strong>：基于特定条件立即退出交易。使用 <code>custom_exit()</code> 来实现这个目的。</p></li></ul></li><li><p><strong><code>custom_roi()</code></strong> - 自定义 ROI，在每次迭代时对每个开放交易调用，直到交易关闭。</p><ul><li><p>✅ <strong>使用场景</strong>：指定最小 ROI 阈值（“止盈”），根据利润或其他条件在交易持续时间内某个时间点以这个 ROI 水平退出交易。</p></li><li><p>🚫 <strong>不适用场景</strong>：基于特定条件立即退出交易。使用 <code>custom_exit()</code>。</p></li><li><p>🚫 <strong>不适用场景</strong>：静态 ROI。使用 <code>minimal_roi</code>。</p></li></ul></li></ul><h3 id="bot-start" class="relative group"><span class="heading-text">机器人启动</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#bot-start" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>一个简单的回调，在策略加载时只调用一次。
这可用于执行只需执行一次的操作，并在数据供应商 (dataprovider) 和钱包设置后运行。</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">import requests

class AwesomeStrategy(IStrategy):

    # ... populate_* methods

    def bot_start(self, **kwargs) -&gt; None:
        &quot;&quot;&quot;
        Called only once after bot instantiation.
        :param **kwargs: Ensure to keep this here so updates to this won&#x27;t break your strategy.
        &quot;&quot;&quot;
        if self.config[&quot;runmode&quot;].value in (&quot;live&quot;, &quot;dry_run&quot;):
            # Assign this to the class by using self.*
            # can then be used by populate_* methods
            self.custom_remote_data = requests.get(&quot;https://some_remote_source.example.com&quot;)
</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>在 hyperopt 时，这个回调只会在启动时运行一次。</p><h3 id="bot-loop-start" class="relative group"><span class="heading-text">机器人循环开始</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#bot-loop-start" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>一个简单的回调，在每次机器人节流循环开始时调用一次（在 dry/live 模式下大约每 5 秒，除非另有配置），或在回测/hyperopt 模式下每根 K 线调用一次。
这可用于执行与交易对无关的计算（适用于所有交易对）、加载外部数据等。</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Default imports
import requests

class AwesomeStrategy(IStrategy):

    # ... populate_* methods

    def bot_loop_start(self, current_time: datetime, **kwargs) -&gt; None:
        &quot;&quot;&quot;
        Called at the start of the bot iteration (one loop).
        Might be used to perform pair-independent tasks
        (e.g. gather some remote resource for comparison)
        :param current_time: datetime object, containing the current datetime
        :param **kwargs: Ensure to keep this here so updates to this won&#x27;t break your strategy.
        &quot;&quot;&quot;
        if self.config[&quot;runmode&quot;].value in (&quot;live&quot;, &quot;dry_run&quot;):
            # Assign this to the class by using self.*
            # can then be used by populate_* methods
            self.remote_data = requests.get(&quot;https://some_remote_source.example.com&quot;)
</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><h3 id="stake-size-management" class="relative group"><span class="heading-text">仓位大小管理</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#stake-size-management" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>在进入交易前调用，使你可以在下新单时管理仓位大小。</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Default imports

class AwesomeStrategy(IStrategy):
    def custom_stake_amount(self, pair: str, current_time: datetime, current_rate: float,
                            proposed_stake: float, min_stake: float | None, max_stake: float,
                            leverage: float, entry_tag: str | None, side: str,
                            **kwargs) -&gt; float:

        dataframe, _ = self.dp.get_analyzed_dataframe(pair=pair, timeframe=self.timeframe)
        current_candle = dataframe.iloc[-1].squeeze()

        if current_candle[&quot;fastk_rsi_1h&quot;] &gt; current_candle[&quot;fastd_rsi_1h&quot;]:
            if self.config[&quot;stake_amount&quot;] == &quot;unlimited&quot;:
                # Use entire available wallet during favorable conditions when in compounding mode.
                return max_stake
            else:
                # Compound profits during favorable conditions instead of using a static stake.
                return self.wallets.get_total_stake_amount() / self.config[&quot;max_open_trades&quot;]

        # Use default stake amount.
        return proposed_stake</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>如果你的代码抛出异常，Freqtrade 会回退到 <code>proposed_stake</code> 的值。异常本身会被记录。</p><aside class="myst-admonition myst-admonition-tip my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-green-600"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-green-600 bg-green-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-green-600"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Tip</div></div><div class="myst-admonition-body px-4 py-1"><p>你不必确保 <code>min_stake &lt;= returned_value &lt;= max_stake</code>。交易会成功，因为返回值会被限制在支持的范围内，并且此操作会被记录。</p></div></aside><aside class="myst-admonition myst-admonition-tip my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-green-600"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-green-600 bg-green-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-green-600"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Tip</div></div><div class="myst-admonition-body px-4 py-1"><p>返回 <code>0</code> 或 <code>None</code> 会阻止下单。</p></div></aside><h3 id="custom-exit-signal" class="relative group"><span class="heading-text">自定义退出信号</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#custom-exit-signal" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>在每次节流迭代（大约每 5 秒）时对开放交易调用，直到交易关闭。</p><p>允许定义自定义退出信号，指示应关闭指定仓位（完全退出）。这在需要为每个单独的交易自定义退出条件，或者需要交易数据来做出退出决定时非常有用。</p><p>例如，你可以使用 <code>custom_exit()</code> 实现 1:2 的风险回报比。</p><p>不过，使用 <code>custom_exit()</code> 信号代替止损 <em>不推荐</em>。在这方面，它不如使用 <code>custom_stoploss()</code> 有效，后者还允许你在交易所保持止损。</p><aside class="myst-admonition myst-admonition-note my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-blue-500"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-blue-600 bg-blue-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-blue-600"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Note</div></div><div class="myst-admonition-body px-4 py-1"><p>从此方法返回一个（非空）<code>string</code> 或 <code>True</code> 等同于在指定时间设置退出信号。如果已经设置了退出信号，或者退出信号被禁用（<code>use_exit_signal=False</code>），则不会调用此方法。<code>string</code> 的最大长度为 64 个字符。超过此限制将导致消息被截断为 64 个字符。</p><p><code>custom_exit()</code> 将忽略 <code>exit_profit_only</code>，并且除非 <code>use_exit_signal=False</code>，否则始终会被调用，即使有新的进入信号。</p></div></aside><p>一个示例，说明如何根据当前利润使用不同的指标，并退出已开放超过一天的交易：</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Default imports

class AwesomeStrategy(IStrategy):
    def custom_exit(self, pair: str, trade: Trade, current_time: datetime, current_rate: float,
                    current_profit: float, **kwargs):
        dataframe, _ = self.dp.get_analyzed_dataframe(pair, self.timeframe)
        last_candle = dataframe.iloc[-1].squeeze()

        # Above 20% profit, sell when rsi &lt; 80
        if current_profit &gt; 0.2:
            if last_candle[&quot;rsi&quot;] &lt; 80:
                return &quot;rsi_below_80&quot;

        # Between 2% and 10%, sell if EMA-long above EMA-short
        if 0.02 &lt; current_profit &lt; 0.1:
            if last_candle[&quot;emalong&quot;] &gt; last_candle[&quot;emashort&quot;]:
                return &quot;ema_long_below_80&quot;

        # Sell any positions at a loss if they are held for more than one day.
        if current_profit &lt; 0.0 and (current_time - trade.open_date_utc).days &gt;= 1:
            return &quot;unclog&quot;</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>请参阅 <span data-state="closed"><a class="hover-link" href="/strategy-advanced">Dataframe 访问</a></span> 以获取有关在策略回调中使用 dataframe 的更多信息。</p><h3 id="custom-stoploss" class="relative group"><span class="heading-text">自定义止损</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#custom-stoploss" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>在每次迭代（大约每 5 秒）时对开放交易调用，直到交易关闭。</p><p>必须通过在策略对象上设置 <code>use_custom_stoploss=True</code> 来启用自定义止损方法。</p><p>止损价格只能向上移动 - 如果从 <code>custom_stoploss</code> 返回的止损值会导致止损价格低于之前设置的价格，则会被忽略。传统的 <code>stoploss</code> 值作为绝对下限，并将作为初始止损（在此方法首次为交易调用之前），并且仍然是强制性的。</p><p>由于自定义止损作为常规、变化的止损，其行为类似于 <code>trailing_stop</code> - 因此，由于此原因退出的交易将具有 <code>&quot;trailing_stop_loss&quot;</code> 的退出原因。</p><p>该方法必须返回一个止损值（浮点数/数字），作为当前价格的百分比。</p><p>例如，如果 <code>current_rate</code> 是 200 美元，则返回 <code>0.02</code> 将设置止损价格比当前价格低 2%，即 196 美元。</p><p>在回测期间，<code>current_rate</code>（和 <code>current_profit</code>）是针对 K 线的高点（或空头交易的低点）提供的，而最终的止损是针对 K 线的低点（或空头交易的高点）进行评估的。</p><p>返回值的绝对值被使用（符号被忽略），因此返回 <code>0.05</code> 或 <code>-0.05</code> 具有相同的结果，即止损比当前价格低 5%。
返回 <code>None</code> 将被解释为&quot;不希望更改&quot;，并且是当你不想修改止损时的唯一安全返回方式。
<code>NaN</code> 和 <code>inf</code> 值被视为无效，并将被忽略（与 <code>None</code> 相同）。</p><p>交易所上的止损与 <code>trailing_stop</code> 类似，并且交易所上的止损会根据 <code>stoploss_on_exchange_interval</code> 进行更新（<span data-state="closed"><a class="hover-link" href="/stoploss">有关交易所止损的更多详细信息</a></span>）。</p><p>如果你在期货市场上，请注意 <span data-state="closed"><a class="hover-link" href="/stoploss">止损和杠杆</a></span> 部分，因为从 <code>custom_stoploss</code> 返回的止损值是该交易的风险，而不是相对价格变动。</p><aside class="myst-admonition myst-admonition-important my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-blue-500"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-blue-600 bg-blue-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-blue-600"><path fill-rule="evenodd" d="M14.615 1.595a.75.75 0 0 1 .359.852L12.982 9.75h7.268a.75.75 0 0 1 .548 1.262l-10.5 11.25a.75.75 0 0 1-1.272-.71l1.992-7.302H3.75a.75.75 0 0 1-.548-1.262l10.5-11.25a.75.75 0 0 1 .913-.143Z" clip-rule="evenodd"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">使用日期</div></div><div class="myst-admonition-body px-4 py-1"><p>所有基于时间的计算都应基于 <code>current_time</code> - 不鼓励使用 <code>datetime.now()</code> 或 <code>datetime.utcnow()</code>，因为这会影响回测支持。</p></div></aside><aside class="myst-admonition myst-admonition-tip my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-green-600"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-green-600 bg-green-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-green-600"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">追踪止损</div></div><div class="myst-admonition-body px-4 py-1"><p>在使用自定义止损值时，建议禁用 <code>trailing_stop</code>。两者可以协同工作，但你可能会遇到追踪止损将价格推高，而你的自定义函数不希望这种情况，导致冲突行为。</p></div></aside><h4 id="id-3" class="relative group"><span class="heading-text">调整止损后调整仓位</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-3" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><p>根据你的策略，你可能需要在 <span data-state="closed"><a href="#adjust-trade-position" class="hover-link">仓位调整</a></span> 后调整止损的方向。
为此，freqtrade 将在订单成交后额外调用 <code>after_fill=True</code>，这将允许策略在任意方向移动止损（也可以扩大止损与当前价格之间的差距，这在其他情况下是禁止的）。</p><aside class="myst-admonition myst-admonition-important my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-blue-500"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-blue-600 bg-blue-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-blue-600"><path fill-rule="evenodd" d="M14.615 1.595a.75.75 0 0 1 .359.852L12.982 9.75h7.268a.75.75 0 0 1 .548 1.262l-10.5 11.25a.75.75 0 0 1-1.272-.71l1.992-7.302H3.75a.75.75 0 0 1-.548-1.262l10.5-11.25a.75.75 0 0 1 .913-.143Z" clip-rule="evenodd"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">向后兼容性</div></div><div class="myst-admonition-body px-4 py-1"><p>只有在你的 <code>custom_stoploss</code> 函数定义中包含 <code>after_fill</code> 参数时，才会进行此调用。</p><p>因此，这不会影响（也不会让现有运行的策略感到意外）。</p></div></aside><h4 id="id-4" class="relative group"><span class="heading-text">自定义止损示例</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-4" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><p>下一节将展示一些使用自定义止损函数的示例。
当然，还有更多可能性，所有示例都可以随意组合。</p><h5 id="id-5" class="relative group"><span class="heading-text">通过自定义止损实现追踪止损</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-5" title="Link to this Section" aria-label="Link to this Section">¶</a></h5><p>要模拟 4% 的常规追踪止损（在达到的最高价格后追踪 4%），你可以使用以下非常简单的方法：</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Default imports

class AwesomeStrategy(IStrategy):

    # ... populate_* 方法

    use_custom_stoploss = True

    def custom_stoploss(self, pair: str, trade: Trade, current_time: datetime,
                        current_rate: float, current_profit: float, after_fill: bool, 
                        **kwargs) -&gt; float | None:
        &quot;&quot;&quot;
        自定义止损逻辑，返回相对于 current_rate 的新距离（作为比率）。
        例如，返回 -0.05 将创建一个比 current_rate 低 5% 的止损。
        自定义止损绝不能低于 self.stoploss，后者作为硬性最大损失。

        完整文档请访问 https://www.freqtrade.io/en/latest/strategy-advanced/

        如果策略未实现，则返回初始止损值。
        仅在 use_custom_stoploss 设置为 True 时调用。

        :param pair: 当前分析的交易对
        :param trade: 交易对象。
        :param current_time: 当前时间的 datetime 对象
        :param current_rate: 基于 exit_pricing 中的定价设置计算的比率。
        :param current_profit: 当前利润（作为比率），基于 current_rate 计算。
        :param after_fill: 如果止损在订单成交后调用，则为 True。
        :param **kwargs: 保持此参数，以免未来更新破坏你的策略。
        :return float: 相对于 current_rate 的新止损值
        &quot;&quot;&quot;
        return -0.04 * trade.leverage</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><h5 id="id-6" class="relative group"><span class="heading-text">基于时间的追踪止损</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-6" title="Link to this Section" aria-label="Link to this Section">¶</a></h5><p>在前 60 分钟内使用初始止损，之后更改为 10% 的追踪止损，并在 2 小时（120 分钟）后使用 5% 的追踪止损。</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Default imports

class AwesomeStrategy(IStrategy):

    # ... populate_* 方法

    use_custom_stoploss = True

    def custom_stoploss(self, pair: str, trade: Trade, current_time: datetime,
                        current_rate: float, current_profit: float, after_fill: bool, 
                        **kwargs) -&gt; float | None:

        # 确保最长的间隔在前 - 这些条件从上到下评估。
        if current_time - timedelta(minutes=120) &gt; trade.open_date_utc:
            return -0.05 * trade.leverage
        elif current_time - timedelta(minutes=60) &gt; trade.open_date_utc:
            return -0.10 * trade.leverage
        return None</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><h5 id="id-7" class="relative group"><span class="heading-text">基于时间的追踪止损，带有成交后调整</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-7" title="Link to this Section" aria-label="Link to this Section">¶</a></h5><p>在前 60 分钟内使用初始止损，之后更改为 10% 的追踪止损，并在 2 小时（120 分钟）后使用 5% 的追踪止损。
如果额外订单成交，将止损设置为新 <code>open_rate</code> 下方 10%（<a target="_blank" rel="noreferrer" href="#position-adjust-calculations" class="">所有入场的平均值</a>）。</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Default imports

class AwesomeStrategy(IStrategy):

    # ... populate_* 方法

    use_custom_stoploss = True

    def custom_stoploss(self, pair: str, trade: Trade, current_time: datetime,
                        current_rate: float, current_profit: float, after_fill: bool, 
                        **kwargs) -&gt; float | None:

        if after_fill: 
            # 在额外订单后，从新开仓率下方 10% 的止损开始
            return stoploss_from_open(0.10, current_profit, is_short=trade.is_short, leverage=trade.leverage)
        # 确保最长的间隔在前 - 这些条件从上到下评估。
        if current_time - timedelta(minutes=120) &gt; trade.open_date_utc:
            return -0.05 * trade.leverage
        elif current_time - timedelta(minutes=60) &gt; trade.open_date_utc:
            return -0.10 * trade.leverage
        return None</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><h5 id="id-8" class="relative group"><span class="heading-text">每个交易对不同的止损</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-8" title="Link to this Section" aria-label="Link to this Section">¶</a></h5><p>根据交易对使用不同的止损。</p><p>在此示例中，我们将为 <code>ETH/BTC</code> 和 <code>XRP/BTC</code> 使用 10% 的追踪止损，为 <code>LTC/BTC</code> 使用 5% 的追踪止损，并为所有其他交易对使用 15% 的追踪止损。</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Default imports

class AwesomeStrategy(IStrategy):

    # ... populate_* 方法

    use_custom_stoploss = True

    def custom_stoploss(self, pair: str, trade: Trade, current_time: datetime,
                        current_rate: float, current_profit: float, after_fill: bool,
                        **kwargs) -&gt; float | None:

        if pair in (&quot;ETH/BTC&quot;, &quot;XRP/BTC&quot;):
            return -0.10 * trade.leverage
        elif pair in (&quot;LTC/BTC&quot;):
            return -0.05 * trade.leverage
        return -0.15 * trade.leverage</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><h5 id="id-9" class="relative group"><span class="heading-text">带正偏移的追踪止损</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-9" title="Link to this Section" aria-label="Link to this Section">¶</a></h5><p>在利润超过 4% 之前使用初始止损，然后使用当前利润的 50% 作为追踪止损，最小为 2.5%，最大为 5%。</p><p>请注意，止损只能增加，低于当前止损的值将被忽略。</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Default imports

class AwesomeStrategy(IStrategy):

    # ... populate_* 方法

    use_custom_stoploss = True

    def custom_stoploss(self, pair: str, trade: Trade, current_time: datetime,
                        current_rate: float, current_profit: float, after_fill: bool,
                        **kwargs) -&gt; float | None:

        if current_profit &lt; 0.04:
            return None # 返回 None 以继续使用初始止损

        # 达到所需偏移后，允许止损追踪一半的利润
        desired_stoploss = current_profit / 2

        # 使用最小 2.5% 和最大 5%
        return max(min(desired_stoploss, 0.05), 0.025) * trade.leverage</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><h5 id="id-10" class="relative group"><span class="heading-text">阶梯式止损</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-10" title="Link to this Section" aria-label="Link to this Section">¶</a></h5><p>此示例不是连续追踪当前价格，而是根据当前利润设置固定的止损价格水平。</p><ul><li>在达到 20% 利润之前使用常规止损</li><li>一旦利润 &gt; 20% - 将止损设置为开仓价格上方 7%。</li><li>一旦利润 &gt; 25% - 将止损设置为开仓价格上方 15%。</li><li>一旦利润 &gt; 40% - 将止损设置为开仓价格上方 25%。</li></ul><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Default imports

class AwesomeStrategy(IStrategy):

    # ... populate_* methods

    use_custom_stoploss = True

    def custom_stoploss(self, pair: str, trade: Trade, current_time: datetime,
                        current_rate: float, current_profit: float, after_fill: bool,
                        **kwargs) -&gt; float | None:

        # evaluate highest to lowest, so that highest possible stop is used
        if current_profit &gt; 0.40:
            return stoploss_from_open(0.25, current_profit, is_short=trade.is_short, leverage=trade.leverage)
        elif current_profit &gt; 0.25:
            return stoploss_from_open(0.15, current_profit, is_short=trade.is_short, leverage=trade.leverage)
        elif current_profit &gt; 0.20:
            return stoploss_from_open(0.07, current_profit, is_short=trade.is_short, leverage=trade.leverage)

        # return maximum stoploss value, keeping current stoploss price unchanged
        return None</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><h5 id="id-11" class="relative group"><span class="heading-text">使用数据框架中的指标实现自定义止损示例</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-11" title="Link to this Section" aria-label="Link to this Section">¶</a></h5><p>绝对止损值可以从存储在数据框架中的指标派生。此示例使用价格下方的抛物线 SAR 作为止损。</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Default imports

class AwesomeStrategy(IStrategy):

    def populate_indicators(self, dataframe: DataFrame, metadata: dict) -&gt; DataFrame:
        # &lt;...&gt;
        dataframe[&quot;sar&quot;] = ta.SAR(dataframe)

    use_custom_stoploss = True

    def custom_stoploss(self, pair: str, trade: Trade, current_time: datetime,
                        current_rate: float, current_profit: float, after_fill: bool,
                        **kwargs) -&gt; float | None:

        dataframe, _ = self.dp.get_analyzed_dataframe(pair, self.timeframe)
        last_candle = dataframe.iloc[-1].squeeze()

        # Use parabolic sar as absolute stoploss price
        stoploss_price = last_candle[&quot;sar&quot;]

        # Convert absolute price to percentage relative to current_rate
        if stoploss_price &lt; current_rate:
            return stoploss_from_absolute(stoploss_price, current_rate, is_short=trade.is_short)

        # return maximum stoploss value, keeping current stoploss price unchanged
        return None</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>有关在策略回调中使用数据框架的更多信息，请参见<span data-state="closed"><a class="hover-link" href="/strategy-advanced">数据框架访问</a></span>。</p><h4 id="id-12" class="relative group"><span class="heading-text">止损计算的常用辅助函数</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-12" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><h5 id="id-13" class="relative group"><span class="heading-text">相对于开仓价格的止损</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-13" title="Link to this Section" aria-label="Link to this Section">¶</a></h5><p>从 <code>custom_stoploss()</code> 返回的止损值必须指定相对于 <code>current_rate</code> 的百分比，但有时你可能想要指定相对于_开仓_价格的止损。
<code>stoploss_from_open()</code> 是一个辅助函数，用于计算可以从 <code>custom_stoploss</code> 返回的止损值，该值将等同于开仓点上方所需的交易利润。</p><aside class="myst-admonition myst-admonition-hint my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-green-600"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-green-600 bg-green-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-green-600"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">从自定义止损函数返回相对于开仓价格的止损</div></div><div class="myst-admonition-body px-4 py-1"><p>假设开仓价格为 $100，<code>current_price</code> 为 $121（<code>current_profit</code> 将为 <code>0.21</code>）。</p><p>如果我们想要在开仓价格上方 7% 设置止损价格，我们可以调用 <code>stoploss_from_open(0.07, current_profit, False)</code>，它将返回 <code>0.1157024793</code>。$121 下方 11.57% 是 $107，这与 $100 上方 7% 相同。</p><p>此函数会考虑杠杆 - 所以在 10 倍杠杆下，实际止损将是 $100 上方 0.7%（0.7% * 10x = 7%）。</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Default imports

class AwesomeStrategy(IStrategy):

    # ... populate_* methods

    use_custom_stoploss = True

    def custom_stoploss(self, pair: str, trade: Trade, current_time: datetime,
                        current_rate: float, current_profit: float, after_fill: bool,
                        **kwargs) -&gt; float | None:

        # once the profit has risen above 10%, keep the stoploss at 7% above the open price
        if current_profit &gt; 0.10:
            return stoploss_from_open(0.07, current_profit, is_short=trade.is_short, leverage=trade.leverage)

        return 1
</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>完整示例可以在文档的<span data-state="closed"><a class="hover-link" href="/strategy-callbacks#custom-stoploss">自定义止损</a></span>部分找到。</p></div></aside><aside class="myst-admonition myst-admonition-note my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-blue-500"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-blue-600 bg-blue-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-blue-600"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Note</div></div><div class="myst-admonition-body px-4 py-1"><p>向 <code>stoploss_from_open()</code> 提供无效输入可能会产生&quot;CustomStoploss 函数未返回有效止损&quot;警告。
如果 <code>current_profit</code> 参数低于指定的 <code>open_relative_stop</code>，这种情况可能会发生。当交易关闭被 <code>confirm_trade_exit()</code> 方法阻止时，可能会出现这种情况。可以通过在 <code>confirm_trade_exit()</code> 中检查 <code>exit_reason</code> 来永不阻止止损卖出，或者使用 <code>return stoploss_from_open(...) or 1</code> 惯用法来解决警告，这将在 <code>current_profit &lt; open_relative_stop</code> 时请求不更改止损。</p></div></aside><h5 id="id-14" class="relative group"><span class="heading-text">从绝对价格计算止损百分比</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-14" title="Link to this Section" aria-label="Link to this Section">¶</a></h5><p>从 <code>custom_stoploss()</code> 返回的止损值始终指定相对于 <code>current_rate</code> 的百分比。为了在指定的绝对价格水平设置止损，我们需要使用 <code>stop_rate</code> 来计算相对于 <code>current_rate</code> 的百分比，这将给出与从开仓价格指定百分比相同的结果。</p><p>辅助函数 <code>stoploss_from_absolute()</code> 可用于将绝对价格转换为可以从 <code>custom_stoploss()</code> 返回的当前价格相对止损。</p><aside class="myst-admonition myst-admonition-hint my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-green-600"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-green-600 bg-green-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-green-600"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">从自定义止损函数返回使用绝对价格的止损</div></div><div class="myst-admonition-body px-4 py-1"><p>如果我们想要在当前价格下方 2xATR 追踪止损价格，我们可以调用 <code>stoploss_from_absolute(current_rate + (side * candle[&quot;atr&quot;] * 2), current_rate=current_rate, is_short=trade.is_short, leverage=trade.leverage)</code>。
对于期货，我们需要调整方向（向上或向下）以及调整杠杆，因为 <span data-state="closed"><a class="hover-link" href="/strategy-callbacks#custom-stoploss"><code>custom_stoploss</code></a></span> 回调返回的是<span data-state="closed"><a class="hover-link" href="/stoploss">&quot;此交易的风险&quot;</a></span> - 而不是相对价格变动。</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Default imports

class AwesomeStrategy(IStrategy):

    use_custom_stoploss = True

    def populate_indicators(self, dataframe: DataFrame, metadata: dict) -&gt; DataFrame:
        dataframe[&quot;atr&quot;] = ta.ATR(dataframe, timeperiod=14)
        return dataframe

    def custom_stoploss(self, pair: str, trade: Trade, current_time: datetime,
                        current_rate: float, current_profit: float, after_fill: bool,
                        **kwargs) -&gt; float | None:
        dataframe, _ = self.dp.get_analyzed_dataframe(pair, self.timeframe)
        trade_date = timeframe_to_prev_date(self.timeframe, trade.open_date_utc)
        candle = dataframe.iloc[-1].squeeze()
        side = 1 if trade.is_short else -1
        return stoploss_from_absolute(current_rate + (side * candle[&quot;atr&quot;] * 2), 
                                        current_rate=current_rate, 
                                        is_short=trade.is_short,
                                        leverage=trade.leverage)
</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div></div></aside><hr class="py-2 my-5 translate-y-2"/><h3 id="id-roi" class="relative group"><span class="heading-text">自定义 ROI</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-roi" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>对开放交易每次迭代（大约每 5 秒）调用，直到交易关闭。</p><p>必须通过在策略对象上设置 <code>use_custom_roi=True</code> 来启用自定义 ROI 方法的使用。</p><p>此方法允许你定义退出交易的自定义最小 ROI 阈值，以比率表示（例如，<code>0.05</code> 表示 5% 利润）。如果同时定义了 <code>minimal_roi</code> 和 <code>custom_roi</code>，则较低的阈值将触发退出。例如，如果 <code>minimal_roi</code> 设置为 <code>{&quot;0&quot;: 0.10}</code>（0 分钟时为 10%）且 <code>custom_roi</code> 返回 <code>0.05</code>，则当利润达到 5% 时交易将退出。同样，如果 <code>custom_roi</code> 返回 <code>0.10</code> 且 <code>minimal_roi</code> 设置为 <code>{&quot;0&quot;: 0.05}</code>（0 分钟时为 5%），则当利润达到 5% 时交易将关闭。</p><p>该方法必须返回一个表示新 ROI 阈值的浮点数比率，或返回 <code>None</code> 以回退到 <code>minimal_roi</code> 逻辑。返回 <code>NaN</code> 或 <code>inf</code> 值被视为无效，将被视为 <code>None</code>，导致机器人使用 <code>minimal_roi</code> 配置。</p><h4 id="id-roi-1" class="relative group"><span class="heading-text">自定义 ROI 示例</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-roi-1" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><p>以下示例说明如何使用 <code>custom_roi</code> 函数实现不同的 ROI 逻辑。</p><h5 id="id-roi-2" class="relative group"><span class="heading-text">按交易方向自定义 ROI</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-roi-2" title="Link to this Section" aria-label="Link to this Section">¶</a></h5><p>根据 <code>side</code> 使用不同的 ROI 阈值。在此示例中，多头入场为 5%，空头入场为 2%。</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Default imports

class AwesomeStrategy(IStrategy):

    use_custom_roi = True

    # ... populate_* methods

    def custom_roi(self, pair: str, trade: Trade, current_time: datetime, trade_duration: int,
                   entry_tag: str | None, side: str, **kwargs) -&gt; float | None:
        &quot;&quot;&quot;
        自定义 ROI 逻辑，返回新的最小 ROI 阈值（以比率表示，例如 0.05 表示 +5%）。
        仅在 use_custom_roi 设置为 True 时调用。

        如果与 minimal_roi 同时使用，当达到较低的阈值时将触发退出。
        示例：如果 minimal_roi = {&quot;0&quot;: 0.01} 且 custom_roi 返回 0.05，
        当利润达到 5% 时将触发退出。

        :param pair: 当前分析的交易对。
        :param trade: 交易对象。
        :param current_time: datetime 对象，包含当前日期时间。
        :param trade_duration: 当前交易持续时间（分钟）。
        :param entry_tag: 如果买入信号提供了可选的 entry_tag（buy_tag）。
        :param side: &#x27;long&#x27; 或 &#x27;short&#x27; - 表示当前交易的方向。
        :param **kwargs: 确保保留此参数，以便更新不会破坏你的策略。
        :return float: 新的 ROI 值（比率），或 None 以回退到 minimal_roi 逻辑。
        &quot;&quot;&quot;
        return 0.05 if side == &quot;long&quot; else 0.02</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><h5 id="id-roi-3" class="relative group"><span class="heading-text">按交易对自定义 ROI</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-roi-3" title="Link to this Section" aria-label="Link to this Section">¶</a></h5><p>根据 <code>pair</code> 使用不同的 ROI 阈值。</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Default imports

class AwesomeStrategy(IStrategy):

    use_custom_roi = True

    # ... populate_* methods

    def custom_roi(self, pair: str, trade: Trade, current_time: datetime, trade_duration: int,
                   entry_tag: str | None, side: str, **kwargs) -&gt; float | None:

        stake = trade.stake_currency
        roi_map = {
            f&quot;BTC/{stake}&quot;: 0.02, # BTC 为 2%
            f&quot;ETH/{stake}&quot;: 0.03, # ETH 为 3%
            f&quot;XRP/{stake}&quot;: 0.04, # XRP 为 4%
        }

        return roi_map.get(pair, 0.01) # 其他交易对为 1%</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><h5 id="id-roi-4" class="relative group"><span class="heading-text">按入场标签自定义 ROI</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-roi-4" title="Link to this Section" aria-label="Link to this Section">¶</a></h5><p>根据买入信号提供的 <code>entry_tag</code> 使用不同的 ROI 阈值。</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Default imports

class AwesomeStrategy(IStrategy):

    use_custom_roi = True

    # ... populate_* methods

    def custom_roi(self, pair: str, trade: Trade, current_time: datetime, trade_duration: int,
                   entry_tag: str | None, side: str, **kwargs) -&gt; float | None:

        roi_by_tag = {
            &quot;breakout&quot;: 0.08,       # 如果标签是 &quot;breakout&quot; 则为 8%
            &quot;rsi_overbought&quot;: 0.05, # 如果标签是 &quot;rsi_overbought&quot; 则为 5%
            &quot;mean_reversion&quot;: 0.03, # 如果标签是 &quot;mean_reversion&quot; 则为 3%
        }

        return roi_by_tag.get(entry_tag, 0.01)  # 如果标签未知则为 1%</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><h5 id="id-atr-roi" class="relative group"><span class="heading-text">基于 ATR 的自定义 ROI</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-atr-roi" title="Link to this Section" aria-label="Link to this Section">¶</a></h5><p>ROI 值可以从存储在数据框架中的指标派生。此示例使用 ATR 比率作为 ROI。</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Default imports
# &lt;...&gt;
import talib.abstract as ta

class AwesomeStrategy(IStrategy):

    use_custom_roi = True

    def populate_indicators(self, dataframe: DataFrame, metadata: dict) -&gt; DataFrame:
        # &lt;...&gt;
        dataframe[&quot;atr&quot;] = ta.ATR(dataframe, timeperiod=10)

    def custom_roi(self, pair: str, trade: Trade, current_time: datetime, trade_duration: int,
                   entry_tag: str | None, side: str, **kwargs) -&gt; float | None:

        dataframe, _ = self.dp.get_analyzed_dataframe(pair, self.timeframe)
        last_candle = dataframe.iloc[-1].squeeze()
        atr_ratio = last_candle[&quot;atr&quot;] / last_candle[&quot;close&quot;]

        return atr_ratio # 返回 ATR 值作为比率</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><hr class="py-2 my-5 translate-y-2"/><h3 id="id-15" class="relative group"><span class="heading-text">自定义订单价格规则</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-15" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>默认情况下，freqtrade 使用订单簿自动设置订单价格（<span data-state="closed"><a class="hover-link" href="/configuration">相关文档</a></span>），你也可以选择基于你的策略创建自定义订单价格。</p><p>你可以通过在策略文件中创建 <code>custom_entry_price()</code> 函数自定义入场价格，以及 <code>custom_exit_price()</code> 函数自定义出场价格。</p><p>每个方法都会在向交易所下单前被调用。</p><aside class="myst-admonition myst-admonition-tip my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-green-600"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-green-600 bg-green-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-green-600"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Tip</div></div><div class="myst-admonition-body px-4 py-1"><p>如果你的自定义定价函数返回 None 或无效值，价格将回退到 <code>proposed_rate</code>，即基于常规定价配置的价格。</p><p>使用 custom_entry_price 时，Trade 对象会在与该交易相关的第一个入场订单创建时可用，对于第一次入场，<code>trade</code> 参数值为 <code>None</code>。</p></div></aside><h4 id="id-16" class="relative group"><span class="heading-text">自定义订单入场和出场价格示例</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-16" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Default imports

class AwesomeStrategy(IStrategy):

    # ... populate_* methods

    def custom_entry_price(self, pair: str, trade: Trade | None, current_time: datetime, proposed_rate: float,
                           entry_tag: str | None, side: str, **kwargs) -&gt; float:

        dataframe, last_updated = self.dp.get_analyzed_dataframe(pair=pair,
                                                                timeframe=self.timeframe)
        new_entryprice = dataframe[&quot;bollinger_10_lowerband&quot;].iat[-1]

        return new_entryprice

    def custom_exit_price(self, pair: str, trade: Trade,
                          current_time: datetime, proposed_rate: float,
                          current_profit: float, exit_tag: str | None, **kwargs) -&gt; float:

        dataframe, last_updated = self.dp.get_analyzed_dataframe(pair=pair,
                                                                timeframe=self.timeframe)
        new_exitprice = dataframe[&quot;bollinger_10_upperband&quot;].iat[-1]

        return new_exitprice
</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><aside class="myst-admonition myst-admonition-warning my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-amber-600"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-amber-600 bg-amber-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-amber-600"><path fill-rule="evenodd" d="M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clip-rule="evenodd"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Warning</div></div><div class="myst-admonition-body px-4 py-1"><p>修改入场和出场价格仅适用于限价单。根据选择的价格，这可能导致大量未成交订单。默认情况下，当前价格与自定义价格之间的最大允许距离为 2%，该值可通过配置中的 <code>custom_price_max_distance_ratio</code> 参数更改。</p><p><strong>示例</strong>：</p><p>如果 new_entryprice 是 97，proposed_rate 是 100，<code>custom_price_max_distance_ratio</code> 设置为 2%，则保留的有效自定义入场价格将是 98，比当前（建议）价格低 2%。</p></div></aside><aside class="myst-admonition myst-admonition-warning my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-amber-600"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-amber-600 bg-amber-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-amber-600"><path fill-rule="evenodd" d="M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clip-rule="evenodd"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">回测</div></div><div class="myst-admonition-body px-4 py-1"><p>自定义价格在回测中受支持（自 2021.12 起），如果价格落在 K 线的最高/最低范围内，订单将会成交。</p><p>未能立即成交的订单将受到常规超时处理，这会在每根（详细）K 线发生一次。</p><p><code>custom_exit_price()</code> 仅针对类型为 exit_signal、自定义退出和部分退出的卖出调用。所有其他退出类型将使用常规回测价格。</p></div></aside><hr class="py-2 my-5 translate-y-2"/><h3 id="id-17" class="relative group"><span class="heading-text">自定义订单超时规则</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-17" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>简单的、基于时间的订单超时可以通过策略或在配置的 <code>unfilledtimeout</code> 部分进行配置。</p><p>然而，freqtrade 还为两种订单类型提供了自定义回调，允许你基于自定义标准决定订单是否超时。</p><aside class="myst-admonition myst-admonition-note my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-blue-500"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-blue-600 bg-blue-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-blue-600"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Note</div></div><div class="myst-admonition-body px-4 py-1"><p>回测会在订单价格落在 K 线的最高/最低范围内时成交订单。</p><p>以下回调将针对不会立即成交的订单（使用自定义定价）在每个（详细）K 线调用一次。</p></div></aside><h4 id="id-18" class="relative group"><span class="heading-text">自定义订单超时示例</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-18" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><p>对每个未成交订单调用，直到订单成交或取消。</p><p><code>check_entry_timeout()</code> 用于交易入场，而 <code>check_exit_timeout()</code> 用于交易出场订单。</p><p>下面是一个简单的示例，它根据资产价格应用不同的未成交超时。</p><p>它对高价资产应用较短的超时，而对低价币种允许更长的成交时间。</p><p>函数必须返回 <code>True</code>（取消订单）或 <code>False</code>（保持订单活跃）。</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Default imports

class AwesomeStrategy(IStrategy):

    # ... populate_* methods

    # 设置 unfilledtimeout 为 25 小时，因为下面的最大超时是 24 小时。
    unfilledtimeout = {
        &quot;entry&quot;: 60 * 25,
        &quot;exit&quot;: 60 * 25
    }

    def check_entry_timeout(self, pair: str, trade: Trade, order: Order,
                            current_time: datetime, **kwargs) -&gt; bool:
        if trade.open_rate &gt; 100 and trade.open_date_utc &lt; current_time - timedelta(minutes=5):
            return True
        elif trade.open_rate &gt; 10 and trade.open_date_utc &lt; current_time - timedelta(minutes=3):
            return True
        elif trade.open_rate &lt; 1 and trade.open_date_utc &lt; current_time - timedelta(hours=24):
           return True
        return False


    def check_exit_timeout(self, pair: str, trade: Trade, order: Order,
                           current_time: datetime, **kwargs) -&gt; bool:
        if trade.open_rate &gt; 100 and trade.open_date_utc &lt; current_time - timedelta(minutes=5):
            return True
        elif trade.open_rate &gt; 10 and trade.open_date_utc &lt; current_time - timedelta(minutes=3):
            return True
        elif trade.open_rate &lt; 1 and trade.open_date_utc &lt; current_time - timedelta(hours=24):
           return True
        return False</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><aside class="myst-admonition myst-admonition-warning my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-amber-600"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-amber-600 bg-amber-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-amber-600"><path fill-rule="evenodd" d="M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clip-rule="evenodd"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Warning</div></div><div class="myst-admonition-body px-4 py-1"><p>对于上面的示例，<code>unfilledtimeout</code> 必须设置为大于 24 小时的值，否则该类型的超时将首先应用。</p></div></aside><h4 id="id-19" class="relative group"><span class="heading-text">自定义订单超时示例（使用额外数据）</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-19" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Default imports

class AwesomeStrategy(IStrategy):

    # ... populate_* methods

    # 设置 unfilledtimeout 为 25 小时，因为下面的最大超时是 24 小时。
    unfilledtimeout = {
        &quot;entry&quot;: 60 * 25,
        &quot;exit&quot;: 60 * 25
    }

    def check_entry_timeout(self, pair: str, trade: Trade, order: Order,
                            current_time: datetime, **kwargs) -&gt; bool:
        ob = self.dp.orderbook(pair, 1)
        current_price = ob[&quot;bids&quot;][0][0]
        # 如果价格比订单价格高出 2% 以上，取消买单。
        if current_price &gt; order.price * 1.02:
            return True
        return False


    def check_exit_timeout(self, pair: str, trade: Trade, order: Order,
                           current_time: datetime, **kwargs) -&gt; bool:
        ob = self.dp.orderbook(pair, 1)
        current_price = ob[&quot;asks&quot;][0][0]
        # 如果价格比订单价格低 2% 以上，取消卖单。
        if current_price &lt; order.price * 0.98:
            return True
        return False</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><hr class="py-2 my-5 translate-y-2"/><h3 id="id-20" class="relative group"><span class="heading-text">机器人订单确认</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-20" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>确认交易入场/出场。
这些是在订单下单之前最后调用的方法。</p><h4 id="id-21" class="relative group"><span class="heading-text">交易入场（买单）确认</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-21" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><p><code>confirm_trade_entry()</code> 可用于在最后一刻中止交易入场（可能是因为价格不符合预期）。</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Default imports

class AwesomeStrategy(IStrategy):

    # ... populate_* methods

    def confirm_trade_entry(self, pair: str, order_type: str, amount: float, rate: float,
                            time_in_force: str, current_time: datetime, entry_tag: str | None,
                            side: str, **kwargs) -&gt; bool:
        &quot;&quot;&quot;
        Called right before placing a entry order.
        Timing for this function is critical, so avoid doing heavy computations or
        network requests in this method.

        For full documentation please go to https://www.freqtrade.io/en/latest/strategy-advanced/

        When not implemented by a strategy, returns True (always confirming).

        :param pair: Pair that&#x27;s about to be bought/shorted.
        :param order_type: Order type (as configured in order_types). usually limit or market.
        :param amount: Amount in target (base) currency that&#x27;s going to be traded.
        :param rate: Rate that&#x27;s going to be used when using limit orders 
                     or current rate for market orders.
        :param time_in_force: Time in force. Defaults to GTC (Good-til-cancelled).
        :param current_time: datetime object, containing the current datetime
        :param entry_tag: Optional entry_tag (buy_tag) if provided with the buy signal.
        :param side: &quot;long&quot; or &quot;short&quot; - indicating the direction of the proposed trade
        :param **kwargs: Ensure to keep this here so updates to this won&#x27;t break your strategy.
        :return bool: When True is returned, then the buy-order is placed on the exchange.
            False aborts the process
        &quot;&quot;&quot;
        return True
</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><h4 id="id-22" class="relative group"><span class="heading-text">交易出场（卖单）确认</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-22" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><p><code>confirm_trade_exit()</code> 可用于在最后一刻中止交易出场（可能是因为价格不符合预期）。</p><p><code>confirm_trade_exit()</code> 可能会在同一迭代中多次调用同一交易，如果适用不同的退出原因。
退出原因（如果适用）将按以下顺序排列：</p><ul><li><code>exit_signal</code> / <code>custom_exit</code></li><li><code>stop_loss</code></li><li><code>roi</code></li><li><code>trailing_stop_loss</code></li></ul><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Default imports

class AwesomeStrategy(IStrategy):

    # ... populate_* methods

    def confirm_trade_exit(self, pair: str, trade: Trade, order_type: str, amount: float,
                           rate: float, time_in_force: str, exit_reason: str,
                           current_time: datetime, **kwargs) -&gt; bool:
        &quot;&quot;&quot;
        Called right before placing a regular exit order.
        Timing for this function is critical, so avoid doing heavy computations or
        network requests in this method.

        For full documentation please go to https://www.freqtrade.io/en/latest/strategy-advanced/

        When not implemented by a strategy, returns True (always confirming).

        :param pair: Pair for trade that&#x27;s about to be exited.
        :param trade: trade object.
        :param order_type: Order type (as configured in order_types). usually limit or market.
        :param amount: Amount in base currency.
        :param rate: Rate that&#x27;s going to be used when using limit orders
                     or current rate for market orders.
        :param time_in_force: Time in force. Defaults to GTC (Good-til-cancelled).
        :param exit_reason: Exit reason.
            Can be any of [&quot;roi&quot;, &quot;stop_loss&quot;, &quot;stoploss_on_exchange&quot;, &quot;trailing_stop_loss&quot;,
                           &quot;exit_signal&quot;, &quot;force_exit&quot;, &quot;emergency_exit&quot;]
        :param current_time: datetime object, containing the current datetime
        :param **kwargs: Ensure to keep this here so updates to this won&#x27;t break your strategy.
        :return bool: When True, then the exit-order is placed on the exchange.
            False aborts the process
        &quot;&quot;&quot;
        if exit_reason == &quot;force_exit&quot; and trade.calc_profit_ratio(rate) &lt; 0:
            # Reject force-sells with negative profit
            # This is just a sample, please adjust to your needs
            # (this does not necessarily make sense, assuming you know when you&#x27;re force-selling)
            return False
        return True
</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><aside class="myst-admonition myst-admonition-warning my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-amber-600"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-amber-600 bg-amber-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-amber-600"><path fill-rule="evenodd" d="M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clip-rule="evenodd"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Warning</div></div><div class="myst-admonition-body px-4 py-1"><p><code>confirm_trade_exit()</code> 可以阻止止损退出，导致重大损失，因为这将忽略止损退出。</p><p><code>confirm_trade_exit()</code> 不会为清算调用 - 因为清算是由交易所强制执行的，因此无法拒绝。</p></div></aside><h3 id="adjust-trade-position" class="relative group"><span class="heading-text">调整交易仓位</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#adjust-trade-position" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p><code>position_adjustment_enable</code> 策略属性启用了策略中 <code>adjust_trade_position()</code> 回调的使用。
出于性能原因，默认情况下它是禁用的，如果启用，freqtrade 将在启动时显示警告消息。
<code>adjust_trade_position()</code> 可用于执行额外的订单，例如使用 DCA（美元成本平均）管理风险或增加或减少仓位。</p><p>额外订单也会导致额外费用，并且这些订单不计入 <code>max_open_trades</code>。</p><p>当有未成交订单（买单或卖单）等待执行时，也会调用此回调 - 如果数量、价格或方向不同，将取消现有的未成交订单以放置新订单。部分成交的订单也将被取消，并将被回调返回的新数量替换。</p><p><code>adjust_trade_position()</code> 在交易期间非常频繁地被调用，因此你必须尽可能保持实现的性能。</p><p>仓位调整将始终应用于交易的方向，因此正值将始终增加你的仓位（负值将减少你的仓位），无论它是多头还是空头交易。
调整订单可以通过返回一个 2 元素元组来分配标签，第一个元素是调整数量，第二个元素是标签（例如 <code>return 250, &quot;increase_favorable_conditions&quot;</code>）。</p><p>无法修改杠杆，返回的仓位金额假定为应用杠杆之前。</p><p>当前分配给仓位的组合仓位金额保存在 <code>trade.stake_amount</code> 中。因此，<code>trade.stake_amount</code> 将在每次通过 <code>adjust_trade_position()</code> 进行额外入场和部分出场时更新。</p><aside class="myst-admonition myst-admonition-danger my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-red-600"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-red-600 bg-red-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-red-600"><path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clip-rule="evenodd"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">松散逻辑</div></div><div class="myst-admonition-body px-4 py-1"><p>在模拟和实盘运行中，此函数将每 <code>throttle_process_secs</code>（默认为 5 秒）调用一次。如果你有松散的逻辑（例如，如果最后一根 K 线的 RSI 低于 30，则增加仓位），你的机器人将每 5 秒进行一次额外重新入场，直到你用完资金，达到 <code>max_position_adjustment</code> 限制，或者出现 RSI 大于 30 的新 K 线。</p><p>部分出场也可能发生同样的情况。</p><p>因此，请确保有严格的逻辑和/或检查最后成交的订单以及是否已有未成交订单。</p></div></aside><aside class="myst-admonition myst-admonition-warning my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-amber-600"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-amber-600 bg-amber-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-amber-600"><path fill-rule="evenodd" d="M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clip-rule="evenodd"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">多次仓位调整的性能</div></div><div class="myst-admonition-body px-4 py-1"><p>仓位调整可以是增加策略输出的好方法 - 但如果广泛使用此功能，也可能有缺点。</p><p>每个订单将在交易期间附加到交易对象 - 因此增加内存使用。</p><p>因此，不建议使用长时间持续和 10 次甚至 100 次仓位调整的交易，应该定期关闭以避免影响性能。</p></div></aside><aside class="myst-admonition myst-admonition-warning my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-amber-600"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-amber-600 bg-amber-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-amber-600"><path fill-rule="evenodd" d="M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clip-rule="evenodd"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">回测</div></div><div class="myst-admonition-body px-4 py-1"><p>在回测期间，此回调在 <code>timeframe</code> 或 <code>timeframe_detail</code> 中的每根 K 线调用一次，因此运行时性能将受到影响。</p><p>这也可能导致实盘和回测之间的结果不同，因为回测只能在每根 K 线调整一次交易，而实盘可以在每根 K 线多次调整交易。</p></div></aside><h4 id="id-23" class="relative group"><span class="heading-text">增加仓位</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-23" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><p>当需要进行额外入场订单时（即增加仓位——多头为买单，空头为卖单），策略应返回一个介于 <code>min_stake</code> 和 <code>max_stake</code> 之间的正数 <strong>stake_amount</strong>（以仓位货币计价）。</p><p>如果钱包中没有足够的资金（返回值高于 <code>max_stake</code>），则该信号会被忽略。
<code>max_entry_position_adjustment</code> 属性用于限制机器人每笔交易（在首次入场订单之外）可执行的额外入场次数。默认值为 -1，表示机器人对调整入场次数没有限制。</p><p>一旦达到你在 <code>max_entry_position_adjustment</code> 上设置的最大额外入场次数，额外入场将被忽略，但回调仍会被调用以寻找部分出场机会。</p><aside class="myst-admonition myst-admonition-warning my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-amber-600"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-amber-600 bg-amber-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-amber-600"><path fill-rule="evenodd" d="M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clip-rule="evenodd"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">关于仓位大小</div></div><div class="myst-admonition-body px-4 py-1"><p>使用固定仓位大小意味着首次订单将使用该金额，就像没有仓位调整一样。</p><p>如果你希望通过 DCA 进行额外买入，请确保钱包中留有足够的资金。</p><p>对 DCA 订单使用 “unlimited” 仓位金额时，需要你实现 <code>custom_stake_amount()</code> 回调，以避免初始订单占用全部资金。</p></div></aside><h4 id="id-24" class="relative group"><span class="heading-text">减少仓位</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-24" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><p>策略应返回一个负的 stake_amount（以仓位货币计价）用于部分出场。</p><p>返回当前持有的全部仓位（<code>-trade.stake_amount</code>）将导致完全出场。</p><p>返回超过上述值（即剩余 stake_amount 变为负数）将导致机器人忽略该信号。</p><p>对于部分出场，重要的是要知道用于计算部分出场订单币种数量的公式是 <code>部分出场数量 = negative_stake_amount * trade.amount / trade.stake_amount</code>，其中 <code>negative_stake_amount</code> 是 <code>adjust_trade_position</code> 函数返回的值。正如公式所示，该公式与当前仓位盈亏无关，只与 <code>trade.amount</code> 和 <code>trade.stake_amount</code> 有关，这两个值不会受到价格波动影响。</p><p>例如，假设你以 50 的开盘价买入 2 个 SHITCOIN/USDT，意味着该交易的仓位金额为 100 USDT。现在价格涨到 200，你想卖出一半。这时你需要返回 <code>trade.stake_amount</code> 的 -50%（0.5 * 100 USDT），即 -50。机器人会计算需要卖出的数量，即 <code>50 * 2 / 100</code>，等于 1 个 SHITCOIN/USDT。如果你返回 -200（2 * 200 的 50%），机器人会忽略，因为 <code>trade.stake_amount</code> 只有 100 USDT，而你要求卖出 200 USDT，相当于卖出 4 个 SHITCOIN/USDT。</p><p>回到上面的例子，当前价格为 200，你的交易当前 USDT 价值为 400 USDT。假设你想部分卖出 100 USDT，以取回初始投资并将利润留在交易中，希望价格继续上涨。这时你需要先计算要卖出的确切数量。由于你想按当前价格卖出价值 100 USDT 的币，部分卖出的确切数量为 <code>100 * 2 / 400</code>，等于 0.5 个 SHITCOIN/USDT。既然知道了要卖出的数量（0.5），你在 <code>adjust_trade_position</code> 函数中需要返回的值是 <code>-部分出场数量 * trade.stake_amount / trade.amount</code>，即 -25。机器人会卖出 0.5 个 SHITCOIN/USDT，交易中保留 1.5 个。你将从部分出场中获得 100 USDT。</p><aside class="myst-admonition myst-admonition-warning my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-amber-600"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-amber-600 bg-amber-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-amber-600"><path fill-rule="evenodd" d="M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clip-rule="evenodd"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">止损计算</div></div><div class="myst-admonition-body px-4 py-1"><p>止损仍然以初始开仓价为基准计算，而不是均价。</p><p>常规止损规则仍然适用（不能下移止损）。</p><p>虽然 <code>/stopentry</code> 命令会阻止机器人进入新交易，但仓位调整功能会继续在已有交易上买入新订单。</p></div></aside><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Default imports

class DigDeeperStrategy(IStrategy):

    position_adjustment_enable = True

    # Attempts to handle large drops with DCA. High stoploss is required.
    stoploss = -0.30

    # ... populate_* methods

    # Example specific variables
    max_entry_position_adjustment = 3
    # This number is explained a bit further down
    max_dca_multiplier = 5.5

    # This is called when placing the initial order (opening trade)
    def custom_stake_amount(self, pair: str, current_time: datetime, current_rate: float,
                            proposed_stake: float, min_stake: float | None, max_stake: float,
                            leverage: float, entry_tag: str | None, side: str,
                            **kwargs) -&gt; float:

        # We need to leave most of the funds for possible further DCA orders
        # This also applies to fixed stakes
        return proposed_stake / self.max_dca_multiplier

    def adjust_trade_position(self, trade: Trade, current_time: datetime,
                              current_rate: float, current_profit: float,
                              min_stake: float | None, max_stake: float,
                              current_entry_rate: float, current_exit_rate: float,
                              current_entry_profit: float, current_exit_profit: float,
                              **kwargs
                              ) -&gt; float | None | tuple[float | None, str | None]:
        &quot;&quot;&quot;
        Custom trade adjustment logic, returning the stake amount that a trade should be
        increased or decreased.
        This means extra entry or exit orders with additional fees.
        Only called when `position_adjustment_enable` is set to True.

        For full documentation please go to https://www.freqtrade.io/en/latest/strategy-advanced/

        When not implemented by a strategy, returns None

        :param trade: trade object.
        :param current_time: datetime object, containing the current datetime
        :param current_rate: Current entry rate (same as current_entry_profit)
        :param current_profit: Current profit (as ratio), calculated based on current_rate 
                               (same as current_entry_profit).
        :param min_stake: Minimal stake size allowed by exchange (for both entries and exits)
        :param max_stake: Maximum stake allowed (either through balance, or by exchange limits).
        :param current_entry_rate: Current rate using entry pricing.
        :param current_exit_rate: Current rate using exit pricing.
        :param current_entry_profit: Current profit using entry pricing.
        :param current_exit_profit: Current profit using exit pricing.
        :param **kwargs: Ensure to keep this here so updates to this won&#x27;t break your strategy.
        :return float: Stake amount to adjust your trade,
                       Positive values to increase position, Negative values to decrease position.
                       Return None for no action.
                       Optionally, return a tuple with a 2nd element with an order reason
        &quot;&quot;&quot;
        if trade.has_open_orders:
            # Only act if no orders are open
            return

        if current_profit &gt; 0.05 and trade.nr_of_successful_exits == 0:
            # Take half of the profit at +5%
            return -(trade.stake_amount / 2), &quot;half_profit_5%&quot;

        if current_profit &gt; -0.05:
            return None

        # Obtain pair dataframe (just to show how to access it)
        dataframe, _ = self.dp.get_analyzed_dataframe(trade.pair, self.timeframe)
        # Only buy when not actively falling price.
        last_candle = dataframe.iloc[-1].squeeze()
        previous_candle = dataframe.iloc[-2].squeeze()
        if last_candle[&quot;close&quot;] &lt; previous_candle[&quot;close&quot;]:
            return None

        filled_entries = trade.select_filled_orders(trade.entry_side)
        count_of_entries = trade.nr_of_successful_entries
        # Allow up to 3 additional increasingly larger buys (4 in total)
        # Initial buy is 1x
        # If that falls to -5% profit, we buy 1.25x more, average profit should increase to roughly -2.2%
        # If that falls down to -5% again, we buy 1.5x more
        # If that falls once again down to -5%, we buy 1.75x more
        # Total stake for this trade would be 1 + 1.25 + 1.5 + 1.75 = 5.5x of the initial allowed stake.
        # That is why max_dca_multiplier is 5.5
        # Hope you have a deep wallet!
        try:
            # This returns first order stake size
            stake_amount = filled_entries[0].stake_amount_filled
            # This then calculates current safety order size
            stake_amount = stake_amount * (1 + (count_of_entries * 0.25))
            return stake_amount, &quot;1/3rd_increase&quot;
        except Exception as exception:
            return None

        return None
</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><h4 id="id-25" class="relative group"><span class="heading-text">仓位调整计算</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-25" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><ul><li>入场价格使用加权平均计算。</li><li>出场不会影响平均入场价格。</li><li>部分出场的相对利润是相对于此时的平均入场价格。</li><li>最终出场的相对利润是基于总投资资本计算的。（见下面的例子）</li></ul><aside class="myst-admonition myst-admonition-hint my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-green-600"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-green-600 bg-green-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-green-600"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">计算示例</div></div><div class="myst-admonition-body px-4 py-1"><p><em>此示例假设零手续费，且为一个虚拟币的多头仓位。</em></p><ul><li>买入 100@8$</li><li>买入 100@9$ -&gt; 平均价格：8.5$</li><li>卖出 100@10$ -&gt; 平均价格：8.5$，已实现利润 150$，17.65%</li><li>买入 150@11$ -&gt; 平均价格：10$，已实现利润 150$，17.65%</li><li>卖出 100@12$ -&gt; 平均价格：10$，总已实现利润 350$，20%</li><li>卖出 150@14$ -&gt; 平均价格：10$，总已实现利润 950$，40%  &lt;- <em>这将是最后的&quot;出场&quot;消息</em></li></ul><p>这笔交易的总利润是 950$，总投资为 3350$（<code>100@8$ + 100@9$ + 150@11$</code>）。因此，最终相对利润为 28.35%（<code>950 / 3350</code>）。</p></div></aside><h3 id="id-26" class="relative group"><span class="heading-text">调整订单价格</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-26" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>策略开发者可以使用 <code>adjust_order_price()</code> 回调在新K线到达时刷新/替换限价订单。</p><p>除非订单在当前K线内已被（重新）放置，否则此回调在每次迭代时都会被调用一次 - 限制每个订单的最大（重新）放置次数为每根K线一次。</p><p>这也意味着第一次调用将在初始订单放置后的下一根K线开始时进行。</p><p>请注意，<code>custom_entry_price()</code>/<code>custom_exit_price()</code> 仍然是在信号发出时决定初始限价订单价格目标的方法。</p><p>可以通过返回 <code>None</code> 来取消此回调中的订单。</p><p>返回 <code>current_order_rate</code> 将保持订单在交易所&quot;原样&quot;。</p><p>返回任何其他价格将取消现有订单，并替换为新订单。</p><p>如果原始订单的取消失败，则不会替换订单 - 尽管订单很可能已在交易所被取消。如果这种情况发生在初始入场时，将导致订单被删除，而在仓位调整订单中，将导致交易规模保持不变。<br/>如果订单已部分成交，则不会替换订单。但是，如果需要/希望，你可以使用 <span data-state="closed"><a href="#adjust-trade-position" class="hover-link"><code>adjust_trade_position()</code></a></span> 来调整交易规模到预期的仓位大小。</p><aside class="myst-admonition myst-admonition-warning my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-amber-600"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-amber-600 bg-amber-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-amber-600"><path fill-rule="evenodd" d="M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clip-rule="evenodd"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">常规超时</div></div><div class="myst-admonition-body px-4 py-1"><p>入场 <code>unfilledtimeout</code> 机制（以及 <code>check_entry_timeout()</code>/<code>check_exit_timeout()</code>）优先于此回调。</p><p>通过上述方法取消的订单不会调用此回调。请确保更新超时值以符合你的预期。</p></div></aside><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Default imports

class AwesomeStrategy(IStrategy):

    # ... populate_* methods

    def adjust_order_price(
        self,
        trade: Trade,
        order: Order | None,
        pair: str,
        current_time: datetime,
        proposed_rate: float,
        current_order_rate: float,
        entry_tag: str | None,
        side: str,
        is_entry: bool,
        **kwargs,
    ) -&gt; float | None:
        &quot;&quot;&quot;
        Exit and entry order price re-adjustment logic, returning the user desired limit price.
        This only executes when a order was already placed, still open (unfilled fully or partially)
        and not timed out on subsequent candles after entry trigger.

        For full documentation please go to https://www.freqtrade.io/en/latest/strategy-callbacks/

        When not implemented by a strategy, returns current_order_rate as default.
        If current_order_rate is returned then the existing order is maintained.
        If None is returned then order gets canceled but not replaced by a new one.

        :param pair: Pair that&#x27;s currently analyzed
        :param trade: Trade object.
        :param order: Order object
        :param current_time: datetime object, containing the current datetime
        :param proposed_rate: Rate, calculated based on pricing settings in entry_pricing.
        :param current_order_rate: Rate of the existing order in place.
        :param entry_tag: Optional entry_tag (buy_tag) if provided with the buy signal.
        :param side: &#x27;long&#x27; or &#x27;short&#x27; - indicating the direction of the proposed trade
        :param is_entry: True if the order is an entry order, False if it&#x27;s an exit order.
        :param **kwargs: Ensure to keep this here so updates to this won&#x27;t break your strategy.
        :return float or None: New entry price value if provided
        &quot;&quot;&quot;

        # Limit entry orders to use and follow SMA200 as price target for the first 10 minutes since entry trigger for BTC/USDT pair.
        if (
            is_entry
            and pair == &quot;BTC/USDT&quot; 
            and entry_tag == &quot;long_sma200&quot; 
            and side == &quot;long&quot; 
            and (current_time - timedelta(minutes=10)) &lt;= trade.open_date_utc
        ):
            # just cancel the order if it has been filled more than half of the amount
            if order.filled &gt; order.remaining:
                return None
            else:
                dataframe, _ = self.dp.get_analyzed_dataframe(pair=pair, timeframe=self.timeframe)
                current_candle = dataframe.iloc[-1].squeeze()
                # desired price
                return current_candle[&quot;sma_200&quot;]
        # default: maintain existing order
        return current_order_rate</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><aside class="myst-admonition myst-admonition-danger my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-red-600"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-red-600 bg-red-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-red-600"><path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clip-rule="evenodd"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">与 <code>adjust_*_price()</code> 的不兼容性</div></div><div class="myst-admonition-body px-4 py-1"><p>如果你同时实现了 <code>adjust_order_price()</code> 和 <code>adjust_entry_price()</code>/<code>adjust_exit_price()</code>，则只会使用 <code>adjust_order_price()</code>。</p><p>如果你需要调整入场/出场价格，你可以选择在 <code>adjust_order_price()</code> 中实现逻辑，或者使用分开的 <code>adjust_entry_price()</code> / <code>adjust_exit_price()</code> 回调，但不能同时使用两者。</p><p>混合使用这些功能是不支持的，会在机器人启动时引发错误。</p></div></aside><h4 id="id-27" class="relative group"><span class="heading-text">调整入场价格</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-27" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><p>策略开发者可以使用 <code>adjust_entry_price()</code> 回调在新K线到达时刷新/替换入场限价订单。</p><p>这是 <code>adjust_order_price()</code> 的一个子集，仅用于入场订单。</p><p>其余所有行为与 <code>adjust_order_price()</code> 相同。</p><p>交易开始日期（<code>trade.open_date_utc</code>）将保持在第一个订单放置的时间。</p><p>请确保注意这一点 - 并相应地调整其他回调中的逻辑，使用第一个成交订单的日期。</p><h4 id="id-28" class="relative group"><span class="heading-text">调整出场价格</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-28" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><p>策略开发者可以使用 <code>adjust_exit_price()</code> 回调在新K线到达时刷新/替换出场限价订单。</p><p>这是 <code>adjust_order_price()</code> 的一个子集，仅用于出场订单。</p><p>其余所有行为与 <code>adjust_order_price()</code> 相同。</p><h3 id="id-29" class="relative group"><span class="heading-text">杠杆回调</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-29" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>在允许杠杆交易的市场中，此方法必须返回所需的杠杆倍数（默认为 1 -&gt; 无杠杆）。</p><p>假设资金为 500USDT，杠杆倍数为 3 的交易将产生 500 x 3 = 1500 USDT 的仓位。</p><p>超过 <code>max_leverage</code> 的值将被调整为 <code>max_leverage</code>。
对于不支持杠杆的市场/交易所，此方法将被忽略。</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Default imports

class AwesomeStrategy(IStrategy):
    def leverage(self, pair: str, current_time: datetime, current_rate: float,
                 proposed_leverage: float, max_leverage: float, entry_tag: str | None, side: str,
                 **kwargs) -&gt; float:
        &quot;&quot;&quot;
        Customize leverage for each new trade. This method is only called in futures mode.

        :param pair: Pair that&#x27;s currently analyzed
        :param current_time: datetime object, containing the current datetime
        :param current_rate: Rate, calculated based on pricing settings in exit_pricing.
        :param proposed_leverage: A leverage proposed by the bot.
        :param max_leverage: Max leverage allowed on this pair
        :param entry_tag: Optional entry_tag (buy_tag) if provided with the buy signal.
        :param side: &quot;long&quot; or &quot;short&quot; - indicating the direction of the proposed trade
        :return: A leverage amount, which is between 1.0 and max_leverage.
        &quot;&quot;&quot;
        return 1.0</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>所有利润计算都包含杠杆。止损和 ROI 的计算也包含杠杆。</p><p>在 10 倍杠杆下设置 10% 的止损，将在价格下跌 1% 时触发止损。</p><h3 id="id-30" class="relative group"><span class="heading-text">订单成交回调</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-30" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p><code>order_filled()</code> 回调可用于在订单成交后根据当前交易状态执行特定操作。</p><p>它将独立于订单类型（入场、出场、止损或仓位调整）被调用。</p><p>假设你的策略需要在开仓时存储该 K 线的最高价，可以通过如下示例所示的回调实现这一点。</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Default imports

class AwesomeStrategy(IStrategy):
    def order_filled(self, pair: str, trade: Trade, order: Order, current_time: datetime, **kwargs) -&gt; None:
        &quot;&quot;&quot;
        Called right after an order fills. 
        Will be called for all order types (entry, exit, stoploss, position adjustment).
        :param pair: Pair for trade
        :param trade: trade object.
        :param order: Order object.
        :param current_time: datetime object, containing the current datetime
        :param **kwargs: Ensure to keep this here so updates to this won&#x27;t break your strategy.
        &quot;&quot;&quot;
        # Obtain pair dataframe (just to show how to access it)
        dataframe, _ = self.dp.get_analyzed_dataframe(trade.pair, self.timeframe)
        last_candle = dataframe.iloc[-1].squeeze()
        
        if (trade.nr_of_successful_entries == 1) and (order.ft_order_side == trade.entry_side):
            trade.set_custom_data(key=&quot;entry_candle_high&quot;, value=last_candle[&quot;high&quot;])

        return None
</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><h3 id="id-31" class="relative group"><span class="heading-text">图表注释回调</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-31" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>每当 freqUI 请求显示图表数据时，都会调用图表注释回调。
此回调在交易周期中没有实际意义，仅用于图表展示。</p><p>策略可以返回一个 <code>AnnotationType</code> 对象列表，这些对象会显示在图表上。
根据返回内容，图表可以显示水平区域、垂直区域或框选区域。</p><p>完整对象如下所示：</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-json" style="white-space:pre">{
    &quot;type&quot;: &quot;area&quot;, // Type of the annotation, currently only &quot;area&quot; is supported
    &quot;start&quot;: &quot;2024-01-01 15:00:00&quot;, // Start date of the area
    &quot;end&quot;: &quot;2024-01-01 16:00:00&quot;,  // End date of the area
    &quot;y_start&quot;: 94000.2,  // Price / y axis value
    &quot;y_end&quot;: 98000, // Price / y axis value
    &quot;color&quot;: &quot;&quot;,
    &quot;label&quot;: &quot;some label&quot;
}</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>下面的示例将在图表上标记第 8 小时和第 15 小时的区域，使用灰色突出显示市场开盘和收盘时间。
这显然是一个非常基础的示例。</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Default imports

class AwesomeStrategy(IStrategy):
    def plot_annotations(
        self, pair: str, start_date: datetime, end_date: datetime, dataframe: DataFrame, **kwargs
    ) -&gt; list[AnnotationType]:
        &quot;&quot;&quot;
        Retrieve area annotations for a chart.
        Must be returned as array, with type, label, color, start, end, y_start, y_end.
        All settings except for type are optional - though it usually makes sense to include either
        &quot;start and end&quot; or &quot;y_start and y_end&quot; for either horizontal or vertical plots
        (or all 4 for boxes).
        :param pair: Pair that&#x27;s currently analyzed
        :param start_date: Start date of the chart data being requested
        :param end_date: End date of the chart data being requested
        :param dataframe: DataFrame with the analyzed data for the chart
        :param **kwargs: Ensure to keep this here so updates to this won&#x27;t break your strategy.
        :return: List of AnnotationType objects
        &quot;&quot;&quot;
        annotations = []
        while start_dt &lt; end_date:
            start_dt += timedelta(hours=1)
            if start_dt.hour in (8, 15):
                annotations.append(
                    {
                        &quot;type&quot;: &quot;area&quot;,
                        &quot;label&quot;: &quot;Trade open and close hours&quot;,
                        &quot;start&quot;: start_dt,
                        &quot;end&quot;: start_dt + timedelta(hours=1),
                        # Omitting y_start and y_end will result in a vertical area spanning the whole height of the main Chart
                        &quot;color&quot;: &quot;rgba(133, 133, 133, 0.4)&quot;,
                    }
                )

        return annotations
</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>所有条目都将被验证，如果不符合预期的模式，将不会被传递给 UI，并且会记录错误。</p><aside class="myst-admonition myst-admonition-warning my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-amber-600"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-amber-600 bg-amber-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-amber-600"><path fill-rule="evenodd" d="M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clip-rule="evenodd"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">过多图片注释</div></div><div class="myst-admonition-body px-4 py-1"><p>使用过多注释可能导致 UI 卡顿，特别是在绘制大量历史数据时。</p><p>请谨慎使用注释功能。</p></div></aside><h4 id="id-32" class="relative group"><span class="heading-text">图表注释示例</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-32" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><p><picture class=""><source srcSet="/build/freqUI-chart-annotat-6ca425e986932e863842497203176546.webp" type="image/webp"/><img id="XXnhglU0sd" style="margin:0 auto" src="/build/freqUI-chart-annotat-6ca425e986932e863842497203176546.png" alt="FreqUI - 图表注释" data-canonical-url="assets/freqUI-chart-annotations-dark.png"/></picture>
<picture class=""><source srcSet="/build/freqUI-chart-annotat-1e4333673f820e578805f2b84b0b8eca.webp" type="image/webp"/><img id="LWWbYJlrIS" style="margin:0 auto" src="/build/freqUI-chart-annotat-1e4333673f820e578805f2b84b0b8eca.png" alt="FreqUI - 图表注释" data-canonical-url="assets/freqUI-chart-annotations-light.png"/></picture></p><aside class="myst-admonition myst-admonition-important my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-blue-500"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-blue-600 bg-blue-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-blue-600"><path fill-rule="evenodd" d="M14.615 1.595a.75.75 0 0 1 .359.852L12.982 9.75h7.268a.75.75 0 0 1 .548 1.262l-10.5 11.25a.75.75 0 0 1-1.272-.71l1.992-7.302H3.75a.75.75 0 0 1-.548-1.262l10.5-11.25a.75.75 0 0 1 .913-.143Z" clip-rule="evenodd"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">上图使用的代码</div></div><div class="myst-admonition-body px-4 py-1"><p>这是一个示例代码，仅供参考。</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Default imports

class AwesomeStrategy(IStrategy):
    def plot_annotations(
        self, pair: str, start_date: datetime, end_date: datetime, dataframe: DataFrame, **kwargs
    ) -&gt; list[AnnotationType]:
        annotations = []
        while start_dt &lt; end_date:
            start_dt += timedelta(hours=1)
            if (start_dt.hour % 4) == 0:
                mark_areas.append(
                    {
                        &quot;type&quot;: &quot;area&quot;,
                        &quot;label&quot;: &quot;4h&quot;,
                        &quot;start&quot;: start_dt,
                        &quot;end&quot;: start_dt + timedelta(hours=1),
                        &quot;color&quot;: &quot;rgba(133, 133, 133, 0.4)&quot;,
                    }
                )
            elif (start_dt.hour % 2) == 0:
            price = dataframe.loc[dataframe[&quot;date&quot;] == start_dt, [&quot;close&quot;]].mean()
                mark_areas.append(
                    {
                        &quot;type&quot;: &quot;area&quot;,
                        &quot;label&quot;: &quot;2h&quot;,
                        &quot;start&quot;: start_dt,
                        &quot;end&quot;: start_dt + timedelta(hours=1),
                        &quot;y_end&quot;: price * 1.01,
                        &quot;y_start&quot;: price * 0.99,
                        &quot;color&quot;: &quot;rgba(0, 255, 0, 0.4)&quot;,
                    }
                )

        return annotations
</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div></div></aside><div></div><div class="flex pt-10 mb-10 space-x-4"><a class="flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700" href="/strategy-customization"><div class="flex h-full align-middle"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="self-center transition-transform group-hover:-translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"></path></svg><div class="flex-grow text-right"><div class="text-xs text-gray-500 dark:text-gray-400">安装</div>策略自定义</div></div></a><a class="flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700" href="/stoploss"><div class="flex h-full align-middle"><div class="flex-grow"><div class="text-xs text-gray-500 dark:text-gray-400">安装</div>止损</div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="self-center transition-transform group-hover:translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"></path></svg></div></a></div></article></main><footer class="article footer article-grid bg-white dark:bg-slate-950 mt-10 shadow-2xl shadow py-10"><div class="" style="text-align:center;padding:20px 0;border-top:1px solid #e5e5e5;color:#666;margin-top:2rem"><p>© 2024 <a target="_blank" rel="noreferrer" href="https://github.com/freqtrade-cn/docs_zh-CN" class="">Freqtrade 中文社区</a> | 基于 <a target="_blank" rel="noreferrer" href="https://www.freqtrade.io" class="">Freqtrade</a> 项目 | 文档由 <a target="_blank" rel="noreferrer" href="https://mystmd.org" class="">MyST</a> 驱动</p><p><a target="_blank" rel="noreferrer" href="https://github.com/freqtrade-cn/docs_zh-CN/issues" class="">报告问题</a> | <a href="https://github.com/freqtrade-cn/docs_zh-CN/blob/main/CONTRIBUTING.md" class="italic" target="_blank" rel="noreferrer" data-state="closed">贡献文档</a> | <a target="_blank" rel="noreferrer" href="https://github.com/freqtrade/freqtrade" class="">Freqtrade GitHub</a></p></div></footer><script>((a,d)=>{if(!window.history.state||!window.history.state.key){let h=Math.random().toString(32).slice(2);window.history.replaceState({key:h},"")}try{let f=JSON.parse(sessionStorage.getItem(a)||"{}")[d||window.history.state.key];typeof f=="number"&&window.scrollTo(0,f)}catch(h){console.error(h),sessionStorage.removeItem(a)}})("positions", null)</script><link rel="modulepreload" href="/build/entry.client-UNPC4GT3.js"/><link rel="modulepreload" href="/build/_shared/chunk-OCTKKCIL.js"/><link rel="modulepreload" href="/build/_shared/chunk-UAI5KRM7.js"/><link rel="modulepreload" href="/build/_shared/chunk-2NH4LW52.js"/><link rel="modulepreload" href="/build/_shared/chunk-LOSAUO4U.js"/><link rel="modulepreload" href="/build/_shared/chunk-HBJK6BW3.js"/><link rel="modulepreload" href="/build/_shared/chunk-HYMQ7M2K.js"/><link rel="modulepreload" href="/build/_shared/chunk-OHOXABTA.js"/><link rel="modulepreload" href="/build/_shared/chunk-OCWQY3HK.js"/><link rel="modulepreload" href="/build/_shared/chunk-C7FW3E47.js"/><link rel="modulepreload" href="/build/_shared/chunk-3CVK3PYF.js"/><link rel="modulepreload" href="/build/_shared/chunk-J6FHCSRC.js"/><link rel="modulepreload" href="/build/_shared/chunk-ND43KHSX.js"/><link rel="modulepreload" href="/build/_shared/chunk-GUCIBHGO.js"/><link rel="modulepreload" href="/build/root-PZGRQ5GW.js"/><link rel="modulepreload" href="/build/_shared/chunk-ESGEJFJ3.js"/><link rel="modulepreload" href="/build/routes/$-IZLSCQFJ.js"/><script>window.__remixContext = {"url":"/strategy-callbacks","state":{"loaderData":{"root":{"config":{"version":2,"myst":"1.6.0","options":{"logo_text":"Freqtrade 中文文档","custom_footer":"Made with love by Freqtrade-CN🏅🏅","footer_url":"https://github.com/freqtrade-cn/docs_zh-CN"},"parts":{"footer":{"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"div","style":{"textAlign":"center","padding":"20px 0","borderTop":"1px solid #e5e5e5","color":"#666","marginTop":"2rem"},"children":[{"type":"paragraph","children":[{"type":"text","value":"© 2024 ","key":"QQzlPO0RhA"},{"type":"link","url":"https://github.com/freqtrade-cn/docs_zh-CN","children":[{"type":"text","value":"Freqtrade 中文社区","key":"ovK9Ng50hh"}],"urlSource":"https://github.com/freqtrade-cn/docs_zh-CN","error":true,"key":"sXUVIOXrYw"},{"type":"text","value":" | 基于 ","key":"BRgZeXiafe"},{"type":"link","url":"https://www.freqtrade.io","children":[{"type":"text","value":"Freqtrade","key":"uvEd6aft53"}],"urlSource":"https://www.freqtrade.io","key":"j0TrCeHDP9"},{"type":"text","value":" 项目 | 文档由 ","key":"SqOStZ9N33"},{"type":"link","url":"https://mystmd.org","children":[{"type":"text","value":"MyST","key":"CN7rEY3DQ5"}],"urlSource":"https://mystmd.org","key":"jLi8R9pI2y"},{"type":"text","value":" 驱动","key":"SGj7Wez9KJ"}],"key":"j0qSBgQgUR"},{"type":"paragraph","children":[{"type":"link","url":"https://github.com/freqtrade-cn/docs_zh-CN/issues","children":[{"type":"text","value":"报告问题","key":"b2ZVmLwho0"}],"urlSource":"https://github.com/freqtrade-cn/docs_zh-CN/issues","error":true,"key":"jhwjWfbVCY"},{"type":"text","value":" | ","key":"eMhROGaxyX"},{"type":"link","url":"https://github.com/freqtrade-cn/docs_zh-CN/blob/main/CONTRIBUTING.md","children":[{"type":"text","value":"贡献文档","key":"knBH8sUKHD"}],"urlSource":"https://github.com/freqtrade-cn/docs_zh-CN/blob/main/CONTRIBUTING.md","data":{"kind":"file","org":"freqtrade-cn","repo":"docs_zh-CN","reference":"main","file":"CONTRIBUTING.md","raw":"https://raw.githubusercontent.com/freqtrade-cn/docs_zh-CN/main/CONTRIBUTING.md"},"internal":false,"protocol":"github","key":"euGq84zTcD"},{"type":"text","value":" | ","key":"GEFIEIK8N8"},{"type":"link","url":"https://github.com/freqtrade/freqtrade","children":[{"type":"text","value":"Freqtrade GitHub","key":"CKA1gOxMDx"}],"urlSource":"https://github.com/freqtrade/freqtrade","error":true,"key":"WJzP18x6ev"}],"key":"XaGrtkcTCX"}],"key":"LRu56rfGTT"}],"key":"wQZ3A7Yq9y"}],"key":"C5ebcDXGaN"},"frontmatter":{"title":"页脚","parts":{},"authors":[{"id":"Freqtrade","name":"Freqtrade"}],"github":"https://github.com/freqtrade-cn/docs_zh-CN","keywords":["Freqtrade","中文文档","交易机器人","量化交易","加密货币","数字货币","区块链","人工智能","机器学习"],"edit_url":"https://github.com/freqtrade-cn/docs_zh-CN/blob/main/footer.md"}}},"nav":[{"title":"Freqtrade 官方","children":[{"title":"Freqtrade 官方文档","url":"https://www.freqtrade.io/en/stable/"},{"title":"Freqtrade GitHub","url":"https://github.com/freqtrade/freqtrade"}]},{"title":"Freqtrade-CN GitHub","url":"https://github.com/freqtrade-cn/freqtrade"}],"actions":[],"projects":[{"title":"Freqtrade 中文文档","description":"Freqtrade 中文文档","authors":[{"id":"Freqtrade","name":"Freqtrade"}],"github":"https://github.com/freqtrade-cn/docs_zh-CN","keywords":["Freqtrade","中文文档","交易机器人","量化交易","加密货币","数字货币","区块链","人工智能","机器学习"],"id":"111d4f50-18b2-4ed2-9189-3954f232e613","toc":[{"file":"index.md"},{"file":"terms.md"},{"file":"docker_quickstart.md"},{"children":[{"file":"installation.md"},{"file":"windows_installation.md"}],"title":"安装"},{"file":"bot-basics.md"},{"file":"configuration.md"},{"file":"strategy-101.md"},{"file":"strategy-customization.md"},{"file":"strategy-callbacks.md"},{"file":"stoploss.md"},{"file":"plugins.md"},{"file":"bot-usage.md"},{"children":[{"file":"telegram-usage.md"},{"file":"freq-ui.md"},{"file":"rest-api.md"},{"file":"webhook-config.md"}],"title":"机器人控制和管理"},{"file":"data-download.md"},{"file":"backtesting.md"},{"file":"hyperopt.md"},{"children":[{"file":"freqai.md"},{"file":"freqai-configuration.md"},{"file":"freqai-parameter-table.md"},{"file":"freqai-feature-engineering.md"},{"file":"freqai-running.md"},{"file":"freqai-reinforcement-learning.md"},{"file":"freqai-developers.md"}],"title":"FreqAI"},{"file":"leverage.md"},{"file":"utils.md"},{"file":"plotting.md"},{"file":"exchanges.md"},{"children":[{"file":"data-analysis.md"},{"file":"strategy_analysis_example.md"},{"file":"advanced-backtesting.md"}],"title":"数据分析"},{"children":[{"file":"advanced-setup.md"},{"file":"trade-object.md"},{"file":"lookahead-analysis.md"},{"file":"recursive-analysis.md"},{"file":"strategy-advanced.md"},{"file":"advanced-hyperopt.md"},{"file":"advanced-orderflow.md"},{"file":"producer-consumer.md"},{"file":"sql_cheatsheet.md"},{"file":"edge.md"}],"title":"高级话题"},{"file":"faq.md"},{"file":"strategy_migration.md"},{"file":"updating.md"},{"file":"commands.md"},{"file":"deprecated.md"},{"file":"developer.md"},{"children":[{"file":"commands/main.md"},{"file":"commands/backtesting-analysis.md"},{"file":"commands/backtesting.md"},{"file":"commands/backtesting-show.md"},{"file":"commands/convert-data.md"},{"file":"commands/convert-db.md"},{"file":"commands/convert-trade-data.md"},{"file":"commands/create-userdir.md"},{"file":"commands/download-data.md"},{"file":"commands/edge.md"},{"file":"commands/hyperopt-list.md"},{"file":"commands/hyperopt.md"},{"file":"commands/hyperopt-show.md"},{"file":"commands/install-ui.md"},{"file":"commands/list-data.md"},{"file":"commands/list-exchanges.md"},{"file":"commands/list-freqaimodels.md"},{"file":"commands/list-hyperoptloss.md"},{"file":"commands/list-markets.md"},{"file":"commands/list-pairs.md"},{"file":"commands/list-strategies.md"},{"file":"commands/list-timeframes.md"},{"file":"commands/lookahead-analysis.md"},{"file":"commands/new-config.md"},{"file":"commands/new-strategy.md"},{"file":"commands/plot-dataframe.md"},{"file":"commands/plot-profit.md"},{"file":"commands/recursive-analysis.md"},{"file":"commands/show-config.md"},{"file":"commands/show-trades.md"},{"file":"commands/strategy-updater.md"},{"file":"commands/test-pairlist.md"},{"file":"commands/trade.md"},{"file":"commands/trades-to-ohlcv.md"},{"file":"commands/webserver.md"}],"title":"Commands"}],"thumbnail":"/build/freqtrade_poweredby-54c1a23e325977ebc310429538f96a71.svg","exports":[],"bibliography":[],"index":"index","pages":[{"slug":"terms","title":"Freqtrade 术语词典","short_title":"术语词典","description":"本文档详细解释了 Freqtrade 和量化交易中的核心术语，为用户提供全面的概念参考。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["术语","概念","词典","参考","量化交易","Freqtrade"],"level":1},{"slug":"docker-quickstart","title":"使用 Docker 运行 Freqtrade","short_title":"Docker 快速入门","description":"了解如何使用 Docker 容器运行和管理 Freqtrade 交易机器人,包括安装、配置和常见问题解决","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["Docker","容器","快速入门","部署"],"level":1},{"level":1,"title":"安装"},{"slug":"installation","title":"安装 Freqtrade","short_title":"安装","description":"了解如何安装和配置 Freqtrade 交易机器人,包括脚本安装、手动安装和 Conda 安装等多种方式","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["安装","配置","指南","入门"],"level":2},{"slug":"windows-installation","title":"Windows 安装指南","short_title":"Windows 安装","description":"本文档详细介绍了如何在 Windows 系统上安装 Freqtrade 交易机器人,包括自动安装和手动安装两种方式。","date":"","thumbnail":"/build/windows_install-36fd100b8143b6955258a9fa59765217.png","thumbnailOptimized":"/build/windows_install-36fd100b8143b6955258a9fa59765217.webp","banner":"","bannerOptimized":"","tags":["Windows","安装","配置","指南"],"level":2},{"slug":"bot-basics","title":"Freqtrade 基础","short_title":"基础指南","description":"本文档介绍了 Freqtrade 的基本术语、概念和执行逻辑,帮助你理解 Freqtrade 的工作原理。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"configuration","title":"配置 Freqtrade","short_title":"配置","description":"了解如何配置 Freqtrade 交易机器人,包括配置文件、环境变量等多种配置方式","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["配置","参数","环境变量","设置"],"level":1},{"slug":"strategy-101","title":"Freqtrade 策略开发指南","short_title":"策略开发指南","description":"本文档介绍了 Freqtrade 策略开发的基础知识,包括必备概念、策略结构以及如何开发自己的交易策略。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"strategy-customization","title":"策略自定义指南","short_title":"策略自定义","description":"本文档介绍如何在 Freqtrade 中自定义交易策略,包括添加新指标、设置交易规则等内容。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["策略开发","自定义","指标","交易规则","编程"],"level":1},{"slug":"strategy-callbacks","title":"策略回调指南","short_title":"策略回调","description":"本文档详细介绍了 Freqtrade 交易机器人中可用的各种策略回调函数,包括它们的用途、调用时机以及使用方法。","date":"","thumbnail":"/build/freqUI-chart-annotat-6ca425e986932e863842497203176546.png","thumbnailOptimized":"/build/freqUI-chart-annotat-6ca425e986932e863842497203176546.webp","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"stoploss","title":"止损配置指南","short_title":"止损","description":"详细介绍 Freqtrade 中的止损功能,包括静态止损、追踪止损等多种止损模式的配置方法。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"plugins","title":"插件体系","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"bot-usage","title":"机器人使用指南","short_title":"机器人使用","description":"本文档介绍了如何启动和运行 FreqTrade 机器人,包括命令行参数、配置文件使用等基本操作说明。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"level":1,"title":"机器人控制和管理"},{"slug":"telegram-usage","title":"Telegram 使用指南","short_title":"Telegram 指南","description":"本文档详细介绍了如何为 Freqtrade 创建和配置 Telegram 机器人，以及如何获取必要的用户 ID 和群组 ID。","date":"","thumbnail":"/build/telegram_forcebuy-73d7978f775ad92a8fe74de0313966a6.png","thumbnailOptimized":"/build/telegram_forcebuy-73d7978f775ad92a8fe74de0313966a6.webp","banner":"","bannerOptimized":"","tags":["Telegram","通知","机器人","配置","消息推送"],"level":2},{"slug":"freq-ui","title":"FreqUI 用户界面","short_title":"FreqUI","description":"FreqUI 是 Freqtrade 的内置 Web 界面,提供了一个现代化的响应式界面来监控和控制您的交易机器人。本文档介绍了如何安装、配置和使用 FreqUI。","date":"","thumbnail":"/build/frequi-login-CORS-li-92549992a8d3a76bc770a0f5b151e366.png","thumbnailOptimized":"/build/frequi-login-CORS-li-92549992a8d3a76bc770a0f5b151e366.webp","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"rest-api","title":"REST API 指南","short_title":"REST API","description":"本文档介绍了 Freqtrade 的 REST API 功能,包括如何配置 API 服务器、安全设置、身份验证以及各种 API 端点的使用方法。","date":"","thumbnail":"/build/frequi_url-75e93be0830e56c293348021fb304d08.png","thumbnailOptimized":"/build/frequi_url-75e93be0830e56c293348021fb304d08.webp","banner":"","bannerOptimized":"","tags":["REST API","接口","配置","安全","自动化"],"level":2},{"slug":"webhook-config","title":"Webhook 配置指南","short_title":"Webhook 指南","description":"Freqtrade 的 Webhook 功能允许您在交易事件发生时发送通知到外部服务。本文档详细介绍了如何配置和使用 Webhook。","date":"","thumbnail":"/build/discord_notification-0536645313306293db781a3e0e0489d8.png","thumbnailOptimized":"/build/discord_notification-0536645313306293db781a3e0e0489d8.webp","banner":"","bannerOptimized":"","tags":["Webhook","通知","外部服务","事件","配置"],"level":2},{"slug":"data-download","title":"数据下载","description":"了解如何使用 Freqtrade 下载历史交易数据，包括 K 线数据、回测数据和超参优化所需数据的下载方法和命令参数说明","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"backtesting","title":"回测","short_title":"回测","description":"了解如何使用 Freqtrade 的回测功能验证和优化你的交易策略,包括回测命令、参数配置和结果分析","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["回测","策略验证","性能分析","历史数据"],"level":1},{"slug":"hyperopt","title":"Hyperopt 超参数优化指南","short_title":"Hyperopt 指南","description":"Hyperopt 是 Freqtrade 中用于自动化策略参数优化的工具,通过搜索最佳参数组合来提升策略性能。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["超参数优化","Hyperopt","策略优化","机器学习","参数调优"],"level":1},{"level":1,"title":"FreqAI"},{"slug":"freqai","title":"Freqai","description":"","date":"","thumbnail":"/build/freqai_doc_logo-3f2859a5a8ebe9e577941dd454c6c5ee.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"freqai-configuration","title":"FreqAI 配置指南","short_title":"FreqAI 配置","description":"本文档详细介绍了如何配置 FreqAI,包括配置文件设置和策略构建。FreqAI 是 Freqtrade 的机器学习框架,可用于构建和训练预测模型。","date":"","thumbnail":"/build/freqai_pytorch-diagr-d0712f166402f727b4f65efd22bf6315.png","thumbnailOptimized":"/build/freqai_pytorch-diagr-d0712f166402f727b4f65efd22bf6315.webp","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"freqai-parameter-table","title":"FreqAI 参数表","short_title":"参数表","description":"本文档详细列出了 FreqAI 的所有配置参数,包括通用配置参数和特征参数,并对每个参数的功能、数据类型和默认值进行了说明。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"freqai-feature-engineering","title":"FreqAI 特征工程指南","short_title":"特征工程","description":"本文档详细介绍了 FreqAI 的特征工程功能,包括如何定义和扩展特征、数据处理管道、异常值检测等内容。这些功能可以帮助用户构建更强大的预测模型。","date":"","thumbnail":"/build/freqai_weight-factor-70f8aa4395fdd17979cf8f96e17171d0.jpg","thumbnailOptimized":"/build/freqai_weight-factor-70f8aa4395fdd17979cf8f96e17171d0.webp","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"freqai-running","title":"FreqAI 运行指南","short_title":"FreqAI 运行","description":"FreqAI 是一个自适应机器学习框架，本文档介绍了如何在实时和回测模式下运行 FreqAI，包括模型训练、部署和管理等内容。","date":"","thumbnail":"/build/freqai_moving-window-05da86a83d6712baee031086385a7735.jpg","thumbnailOptimized":"/build/freqai_moving-window-05da86a83d6712baee031086385a7735.webp","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"freqai-reinforcement-learning","title":"FreqAI 强化学习指南","short_title":"强化学习","description":"本文档详细介绍了 FreqAI 的强化学习功能,包括基本概念、运行方法、环境配置等内容。这些功能可以帮助用户构建和训练强化学习模型进行自动交易。","date":"","thumbnail":"/build/tensorboard-27f8850881840b007f5a56a202abb949.jpg","thumbnailOptimized":"/build/tensorboard-27f8850881840b007f5a56a202abb949.webp","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"freqai-developers","title":"FreqAI 开发者指南","short_title":"FreqAI 开发","description":"本文档详细介绍了 FreqAI 的项目架构、数据处理流程和文件结构,为开发者提供了深入了解 FreqAI 内部工作原理的指南。","date":"","thumbnail":"/build/freqai_algorithm-dia-6d1ac15cf50f9103773ecaea4b8fd261.jpg","thumbnailOptimized":"/build/freqai_algorithm-dia-6d1ac15cf50f9103773ecaea4b8fd261.webp","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"leverage","title":"使用杠杆交易","description":"了解如何在 Freqtrade 中使用杠杆交易,包括做空、保证金和期货交易等高级功能","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"utils","title":"实用工具命令指南","short_title":"实用工具指南","description":"本文档详细介绍了 Freqtrade 中的各种实用工具子命令,包括创建用户目录、配置文件、列出交易所和交易对等功能。","date":"","thumbnail":"/build/show-config-output-2a74674e687e07d8afa7ace1b96df8bb.png","thumbnailOptimized":"/build/show-config-output-2a74674e687e07d8afa7ace1b96df8bb.webp","banner":"","bannerOptimized":"","tags":["工具","命令","配置","策略","交易所"],"level":1},{"slug":"plotting","title":"绘图","short_title":"绘图","description":"了解如何使用 Freqtrade 的绘图功能可视化价格、指标和利润数据,包括安装配置、命令参数和示例","date":"","thumbnail":"/build/plot-dataframe-40c25f36af7de6fc6f078d42ae5f90f5.png","thumbnailOptimized":"/build/plot-dataframe-40c25f36af7de6fc6f078d42ae5f90f5.webp","banner":"","bannerOptimized":"","tags":["绘图","可视化","指标","回测","利润"],"level":1},{"slug":"exchanges","title":"交易所特定说明","short_title":"交易所说明","description":"了解各个交易所的特殊配置和常见问题","date":"","thumbnail":"/build/binance_futures_sett-b4a8da10c6eb01bf904d6fc3533999b6.png","thumbnailOptimized":"/build/binance_futures_sett-b4a8da10c6eb01bf904d6fc3533999b6.webp","banner":"","bannerOptimized":"","tags":["交易所","配置","API","连接","问题解决"],"level":1},{"level":1,"title":"数据分析"},{"slug":"data-analysis","title":"使用 Jupyter 笔记本分析机器人数据","description":"使用 Jupyter 笔记本分析 Freqtrade 机器人的回测结果和交易历史数据","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"strategy-analysis-example","title":"Freqtrade 策略分析示例","short_title":"策略分析示例","description":"本文档介绍如何使用 Freqtrade 提供的工具来分析和调试交易策略,包括数据可视化、回测分析等功能。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"advanced-backtesting","title":"高级回测分析","short_title":"高级回测","description":"本文档介绍了 FreqTrade 的高级回测分析功能,包括买入/卖出标签分析、信号导出等高级特性。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"高级话题"},{"slug":"advanced-setup","title":"高级安装后配置","short_title":"高级安装","description":"本文档介绍了 FreqTrade 安装后可以执行的高级任务和配置选项,包括多实例运行、日志配置等高级特性。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"trade-object","title":"交易对象文档","short_title":"交易对象指南","description":"本文档详细介绍了 Freqtrade 中的交易对象(Trade)，包括其属性、方法以及在策略中的使用方式。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"lookahead-analysis","title":"前瞻性分析指南","short_title":"前瞻性分析","description":"前瞻性分析是一个用于检测和验证交易策略中是否存在前瞻性偏差的工具。本文档详细介绍了如何使用该工具来确保策略的有效性。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"recursive-analysis","title":"递归分析指南","short_title":"递归分析","description":"递归分析是一个用于检测和验证交易策略中是否存在因递归公式导致的不准确性的工具。本文档详细介绍了如何使用该工具来确保策略的有效性。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"strategy-advanced","title":"Freqtrade 高级策略指南","short_title":"高级策略","description":"本文档详细介绍了 Freqtrade 交易机器人的高级策略开发概念,包括持久化存储、回调方法等进阶功能。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"advanced-hyperopt","title":"高级超参数优化","short_title":"高级超参数优化","description":"本文档介绍了 FreqTrade 的高级超参数优化功能,包括自定义损失函数等高级特性。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"advanced-orderflow","title":"高级委托流分析","short_title":"委托流分析","description":"本文档介绍了 FreqTrade 的委托流分析功能,包括如何配置和使用公共成交数据进行高级委托流分析。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"producer-consumer","title":"生产者/消费者模式","short_title":"生产者/消费者","description":"本文档介绍了 Freqtrade 的生产者/消费者模式,包括如何配置多个机器人实例共享计算指标和信号,以及相关的 websocket 设置。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["生产者","消费者","分布式","多实例","WebSocket"],"level":2},{"slug":"sql-cheatsheet","title":"SQL 助手","short_title":"SQL 助手","description":"本文档提供了使用 SQLite 数据库进行查询的详细指南和常用命令参考。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"edge","title":"Edge Positioning - 边缘定位","short_title":"Edge","description":"Edge Positioning 模块使用概率统计来计算交易胜率和风险回报比,从而优化策略的入场点、头寸大小和止损设置。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["Edge","概率","统计","策略优化","风险管理"],"level":2},{"slug":"faq","title":"Freqtrade 常见问题","short_title":"FAQ","description":"本文档回答了关于 Freqtrade 交易机器人的常见问题,包括支持的市场、初学者指南以及常见问题的故障排除。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"strategy-migration","title":"策略迁移指南","short_title":"策略迁移","description":"本文档详细介绍了如何将 Freqtrade V2 策略迁移到 V3，包括接口变更、方法重命名以及新增功能的完整说明。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"updating","title":"更新指南","short_title":"更新指南","description":"本文档详细介绍了如何更新 Freqtrade 的不同安装方式,包括 Docker、安装脚本和原生安装等方法。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"commands","title":"Commands","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"deprecated","title":"已弃用功能","short_title":"已弃用功能","description":"本文档介绍了 FreqTrade 中已弃用和移除的命令行参数、配置参数和机器人功能,帮助用户避免使用不再受支持的特性。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"developer","title":"开发者指南","short_title":"开发者指南","description":"本文档面向 FreqTrade 的开发者,介绍如何为项目做出贡献、配置开发环境、编写测试以及其他开发相关的重要信息。","date":"","thumbnail":"/build/pycharm_debug-7a8a6d1f4a91d643a2d41ff932bf9a82.png","thumbnailOptimized":"/build/pycharm_debug-7a8a6d1f4a91d643a2d41ff932bf9a82.webp","banner":"","bannerOptimized":"","tags":[],"level":1},{"level":1,"title":"Commands"},{"slug":"main","title":"Main","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"backtesting-analysis","title":"Backtesting Analysis","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"backtesting-1","title":"Backtesting","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"backtesting-show","title":"Backtesting Show","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"convert-data","title":"Convert Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"convert-db","title":"Convert Db","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"convert-trade-data","title":"Convert Trade Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"create-userdir","title":"Create Userdir","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"download-data","title":"Download Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"edge-1","title":"Edge","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"hyperopt-list","title":"Hyperopt List","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"hyperopt-1","title":"Hyperopt","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"hyperopt-show","title":"Hyperopt Show","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"install-ui","title":"Install Ui","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"list-data","title":"List Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"list-exchanges","title":"List Exchanges","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"list-freqaimodels","title":"List Freqaimodels","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"list-hyperoptloss","title":"List Hyperoptloss","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"list-markets","title":"List Markets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"list-pairs","title":"List Pairs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"list-strategies","title":"List Strategies","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"list-timeframes","title":"List Timeframes","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"lookahead-analysis-1","title":"Lookahead Analysis","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"new-config","title":"New Config","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"new-strategy","title":"New Strategy","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"plot-dataframe","title":"Plot Dataframe","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"plot-profit","title":"Plot Profit","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"recursive-analysis-1","title":"Recursive Analysis","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"show-config","title":"Show Config","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"show-trades","title":"Show Trades","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"strategy-updater","title":"Strategy Updater","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"test-pairlist","title":"Test Pairlist","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"trade","title":"Trade","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"trades-to-ohlcv","title":"Trades To Ohlcv","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"webserver","title":"Webserver","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"CONTENT_CDN_PORT":"3101","MODE":"static"},"routes/$":{"config":{"version":2,"myst":"1.6.0","options":{"logo_text":"Freqtrade 中文文档","custom_footer":"Made with love by Freqtrade-CN🏅🏅","footer_url":"https://github.com/freqtrade-cn/docs_zh-CN"},"parts":{"footer":{"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"div","style":{"textAlign":"center","padding":"20px 0","borderTop":"1px solid #e5e5e5","color":"#666","marginTop":"2rem"},"children":[{"type":"paragraph","children":[{"type":"text","value":"© 2024 ","key":"QQzlPO0RhA"},{"type":"link","url":"https://github.com/freqtrade-cn/docs_zh-CN","children":[{"type":"text","value":"Freqtrade 中文社区","key":"ovK9Ng50hh"}],"urlSource":"https://github.com/freqtrade-cn/docs_zh-CN","error":true,"key":"sXUVIOXrYw"},{"type":"text","value":" | 基于 ","key":"BRgZeXiafe"},{"type":"link","url":"https://www.freqtrade.io","children":[{"type":"text","value":"Freqtrade","key":"uvEd6aft53"}],"urlSource":"https://www.freqtrade.io","key":"j0TrCeHDP9"},{"type":"text","value":" 项目 | 文档由 ","key":"SqOStZ9N33"},{"type":"link","url":"https://mystmd.org","children":[{"type":"text","value":"MyST","key":"CN7rEY3DQ5"}],"urlSource":"https://mystmd.org","key":"jLi8R9pI2y"},{"type":"text","value":" 驱动","key":"SGj7Wez9KJ"}],"key":"j0qSBgQgUR"},{"type":"paragraph","children":[{"type":"link","url":"https://github.com/freqtrade-cn/docs_zh-CN/issues","children":[{"type":"text","value":"报告问题","key":"b2ZVmLwho0"}],"urlSource":"https://github.com/freqtrade-cn/docs_zh-CN/issues","error":true,"key":"jhwjWfbVCY"},{"type":"text","value":" | ","key":"eMhROGaxyX"},{"type":"link","url":"https://github.com/freqtrade-cn/docs_zh-CN/blob/main/CONTRIBUTING.md","children":[{"type":"text","value":"贡献文档","key":"knBH8sUKHD"}],"urlSource":"https://github.com/freqtrade-cn/docs_zh-CN/blob/main/CONTRIBUTING.md","data":{"kind":"file","org":"freqtrade-cn","repo":"docs_zh-CN","reference":"main","file":"CONTRIBUTING.md","raw":"https://raw.githubusercontent.com/freqtrade-cn/docs_zh-CN/main/CONTRIBUTING.md"},"internal":false,"protocol":"github","key":"euGq84zTcD"},{"type":"text","value":" | ","key":"GEFIEIK8N8"},{"type":"link","url":"https://github.com/freqtrade/freqtrade","children":[{"type":"text","value":"Freqtrade GitHub","key":"CKA1gOxMDx"}],"urlSource":"https://github.com/freqtrade/freqtrade","error":true,"key":"WJzP18x6ev"}],"key":"XaGrtkcTCX"}],"key":"LRu56rfGTT"}],"key":"wQZ3A7Yq9y"}],"key":"C5ebcDXGaN"},"frontmatter":{"title":"页脚","parts":{},"authors":[{"id":"Freqtrade","name":"Freqtrade"}],"github":"https://github.com/freqtrade-cn/docs_zh-CN","keywords":["Freqtrade","中文文档","交易机器人","量化交易","加密货币","数字货币","区块链","人工智能","机器学习"],"edit_url":"https://github.com/freqtrade-cn/docs_zh-CN/blob/main/footer.md"}}},"nav":[{"title":"Freqtrade 官方","children":[{"title":"Freqtrade 官方文档","url":"https://www.freqtrade.io/en/stable/"},{"title":"Freqtrade GitHub","url":"https://github.com/freqtrade/freqtrade"}]},{"title":"Freqtrade-CN GitHub","url":"https://github.com/freqtrade-cn/freqtrade"}],"actions":[],"projects":[{"title":"Freqtrade 中文文档","description":"Freqtrade 中文文档","authors":[{"id":"Freqtrade","name":"Freqtrade"}],"github":"https://github.com/freqtrade-cn/docs_zh-CN","keywords":["Freqtrade","中文文档","交易机器人","量化交易","加密货币","数字货币","区块链","人工智能","机器学习"],"id":"111d4f50-18b2-4ed2-9189-3954f232e613","toc":[{"file":"index.md"},{"file":"terms.md"},{"file":"docker_quickstart.md"},{"children":[{"file":"installation.md"},{"file":"windows_installation.md"}],"title":"安装"},{"file":"bot-basics.md"},{"file":"configuration.md"},{"file":"strategy-101.md"},{"file":"strategy-customization.md"},{"file":"strategy-callbacks.md"},{"file":"stoploss.md"},{"file":"plugins.md"},{"file":"bot-usage.md"},{"children":[{"file":"telegram-usage.md"},{"file":"freq-ui.md"},{"file":"rest-api.md"},{"file":"webhook-config.md"}],"title":"机器人控制和管理"},{"file":"data-download.md"},{"file":"backtesting.md"},{"file":"hyperopt.md"},{"children":[{"file":"freqai.md"},{"file":"freqai-configuration.md"},{"file":"freqai-parameter-table.md"},{"file":"freqai-feature-engineering.md"},{"file":"freqai-running.md"},{"file":"freqai-reinforcement-learning.md"},{"file":"freqai-developers.md"}],"title":"FreqAI"},{"file":"leverage.md"},{"file":"utils.md"},{"file":"plotting.md"},{"file":"exchanges.md"},{"children":[{"file":"data-analysis.md"},{"file":"strategy_analysis_example.md"},{"file":"advanced-backtesting.md"}],"title":"数据分析"},{"children":[{"file":"advanced-setup.md"},{"file":"trade-object.md"},{"file":"lookahead-analysis.md"},{"file":"recursive-analysis.md"},{"file":"strategy-advanced.md"},{"file":"advanced-hyperopt.md"},{"file":"advanced-orderflow.md"},{"file":"producer-consumer.md"},{"file":"sql_cheatsheet.md"},{"file":"edge.md"}],"title":"高级话题"},{"file":"faq.md"},{"file":"strategy_migration.md"},{"file":"updating.md"},{"file":"commands.md"},{"file":"deprecated.md"},{"file":"developer.md"},{"children":[{"file":"commands/main.md"},{"file":"commands/backtesting-analysis.md"},{"file":"commands/backtesting.md"},{"file":"commands/backtesting-show.md"},{"file":"commands/convert-data.md"},{"file":"commands/convert-db.md"},{"file":"commands/convert-trade-data.md"},{"file":"commands/create-userdir.md"},{"file":"commands/download-data.md"},{"file":"commands/edge.md"},{"file":"commands/hyperopt-list.md"},{"file":"commands/hyperopt.md"},{"file":"commands/hyperopt-show.md"},{"file":"commands/install-ui.md"},{"file":"commands/list-data.md"},{"file":"commands/list-exchanges.md"},{"file":"commands/list-freqaimodels.md"},{"file":"commands/list-hyperoptloss.md"},{"file":"commands/list-markets.md"},{"file":"commands/list-pairs.md"},{"file":"commands/list-strategies.md"},{"file":"commands/list-timeframes.md"},{"file":"commands/lookahead-analysis.md"},{"file":"commands/new-config.md"},{"file":"commands/new-strategy.md"},{"file":"commands/plot-dataframe.md"},{"file":"commands/plot-profit.md"},{"file":"commands/recursive-analysis.md"},{"file":"commands/show-config.md"},{"file":"commands/show-trades.md"},{"file":"commands/strategy-updater.md"},{"file":"commands/test-pairlist.md"},{"file":"commands/trade.md"},{"file":"commands/trades-to-ohlcv.md"},{"file":"commands/webserver.md"}],"title":"Commands"}],"thumbnail":"/build/freqtrade_poweredby-54c1a23e325977ebc310429538f96a71.svg","exports":[],"bibliography":[],"index":"index","pages":[{"slug":"terms","title":"Freqtrade 术语词典","short_title":"术语词典","description":"本文档详细解释了 Freqtrade 和量化交易中的核心术语，为用户提供全面的概念参考。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["术语","概念","词典","参考","量化交易","Freqtrade"],"level":1},{"slug":"docker-quickstart","title":"使用 Docker 运行 Freqtrade","short_title":"Docker 快速入门","description":"了解如何使用 Docker 容器运行和管理 Freqtrade 交易机器人,包括安装、配置和常见问题解决","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["Docker","容器","快速入门","部署"],"level":1},{"level":1,"title":"安装"},{"slug":"installation","title":"安装 Freqtrade","short_title":"安装","description":"了解如何安装和配置 Freqtrade 交易机器人,包括脚本安装、手动安装和 Conda 安装等多种方式","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["安装","配置","指南","入门"],"level":2},{"slug":"windows-installation","title":"Windows 安装指南","short_title":"Windows 安装","description":"本文档详细介绍了如何在 Windows 系统上安装 Freqtrade 交易机器人,包括自动安装和手动安装两种方式。","date":"","thumbnail":"/build/windows_install-36fd100b8143b6955258a9fa59765217.png","thumbnailOptimized":"/build/windows_install-36fd100b8143b6955258a9fa59765217.webp","banner":"","bannerOptimized":"","tags":["Windows","安装","配置","指南"],"level":2},{"slug":"bot-basics","title":"Freqtrade 基础","short_title":"基础指南","description":"本文档介绍了 Freqtrade 的基本术语、概念和执行逻辑,帮助你理解 Freqtrade 的工作原理。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"configuration","title":"配置 Freqtrade","short_title":"配置","description":"了解如何配置 Freqtrade 交易机器人,包括配置文件、环境变量等多种配置方式","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["配置","参数","环境变量","设置"],"level":1},{"slug":"strategy-101","title":"Freqtrade 策略开发指南","short_title":"策略开发指南","description":"本文档介绍了 Freqtrade 策略开发的基础知识,包括必备概念、策略结构以及如何开发自己的交易策略。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"strategy-customization","title":"策略自定义指南","short_title":"策略自定义","description":"本文档介绍如何在 Freqtrade 中自定义交易策略,包括添加新指标、设置交易规则等内容。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["策略开发","自定义","指标","交易规则","编程"],"level":1},{"slug":"strategy-callbacks","title":"策略回调指南","short_title":"策略回调","description":"本文档详细介绍了 Freqtrade 交易机器人中可用的各种策略回调函数,包括它们的用途、调用时机以及使用方法。","date":"","thumbnail":"/build/freqUI-chart-annotat-6ca425e986932e863842497203176546.png","thumbnailOptimized":"/build/freqUI-chart-annotat-6ca425e986932e863842497203176546.webp","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"stoploss","title":"止损配置指南","short_title":"止损","description":"详细介绍 Freqtrade 中的止损功能,包括静态止损、追踪止损等多种止损模式的配置方法。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"plugins","title":"插件体系","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"bot-usage","title":"机器人使用指南","short_title":"机器人使用","description":"本文档介绍了如何启动和运行 FreqTrade 机器人,包括命令行参数、配置文件使用等基本操作说明。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"level":1,"title":"机器人控制和管理"},{"slug":"telegram-usage","title":"Telegram 使用指南","short_title":"Telegram 指南","description":"本文档详细介绍了如何为 Freqtrade 创建和配置 Telegram 机器人，以及如何获取必要的用户 ID 和群组 ID。","date":"","thumbnail":"/build/telegram_forcebuy-73d7978f775ad92a8fe74de0313966a6.png","thumbnailOptimized":"/build/telegram_forcebuy-73d7978f775ad92a8fe74de0313966a6.webp","banner":"","bannerOptimized":"","tags":["Telegram","通知","机器人","配置","消息推送"],"level":2},{"slug":"freq-ui","title":"FreqUI 用户界面","short_title":"FreqUI","description":"FreqUI 是 Freqtrade 的内置 Web 界面,提供了一个现代化的响应式界面来监控和控制您的交易机器人。本文档介绍了如何安装、配置和使用 FreqUI。","date":"","thumbnail":"/build/frequi-login-CORS-li-92549992a8d3a76bc770a0f5b151e366.png","thumbnailOptimized":"/build/frequi-login-CORS-li-92549992a8d3a76bc770a0f5b151e366.webp","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"rest-api","title":"REST API 指南","short_title":"REST API","description":"本文档介绍了 Freqtrade 的 REST API 功能,包括如何配置 API 服务器、安全设置、身份验证以及各种 API 端点的使用方法。","date":"","thumbnail":"/build/frequi_url-75e93be0830e56c293348021fb304d08.png","thumbnailOptimized":"/build/frequi_url-75e93be0830e56c293348021fb304d08.webp","banner":"","bannerOptimized":"","tags":["REST API","接口","配置","安全","自动化"],"level":2},{"slug":"webhook-config","title":"Webhook 配置指南","short_title":"Webhook 指南","description":"Freqtrade 的 Webhook 功能允许您在交易事件发生时发送通知到外部服务。本文档详细介绍了如何配置和使用 Webhook。","date":"","thumbnail":"/build/discord_notification-0536645313306293db781a3e0e0489d8.png","thumbnailOptimized":"/build/discord_notification-0536645313306293db781a3e0e0489d8.webp","banner":"","bannerOptimized":"","tags":["Webhook","通知","外部服务","事件","配置"],"level":2},{"slug":"data-download","title":"数据下载","description":"了解如何使用 Freqtrade 下载历史交易数据，包括 K 线数据、回测数据和超参优化所需数据的下载方法和命令参数说明","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"backtesting","title":"回测","short_title":"回测","description":"了解如何使用 Freqtrade 的回测功能验证和优化你的交易策略,包括回测命令、参数配置和结果分析","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["回测","策略验证","性能分析","历史数据"],"level":1},{"slug":"hyperopt","title":"Hyperopt 超参数优化指南","short_title":"Hyperopt 指南","description":"Hyperopt 是 Freqtrade 中用于自动化策略参数优化的工具,通过搜索最佳参数组合来提升策略性能。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["超参数优化","Hyperopt","策略优化","机器学习","参数调优"],"level":1},{"level":1,"title":"FreqAI"},{"slug":"freqai","title":"Freqai","description":"","date":"","thumbnail":"/build/freqai_doc_logo-3f2859a5a8ebe9e577941dd454c6c5ee.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"freqai-configuration","title":"FreqAI 配置指南","short_title":"FreqAI 配置","description":"本文档详细介绍了如何配置 FreqAI,包括配置文件设置和策略构建。FreqAI 是 Freqtrade 的机器学习框架,可用于构建和训练预测模型。","date":"","thumbnail":"/build/freqai_pytorch-diagr-d0712f166402f727b4f65efd22bf6315.png","thumbnailOptimized":"/build/freqai_pytorch-diagr-d0712f166402f727b4f65efd22bf6315.webp","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"freqai-parameter-table","title":"FreqAI 参数表","short_title":"参数表","description":"本文档详细列出了 FreqAI 的所有配置参数,包括通用配置参数和特征参数,并对每个参数的功能、数据类型和默认值进行了说明。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"freqai-feature-engineering","title":"FreqAI 特征工程指南","short_title":"特征工程","description":"本文档详细介绍了 FreqAI 的特征工程功能,包括如何定义和扩展特征、数据处理管道、异常值检测等内容。这些功能可以帮助用户构建更强大的预测模型。","date":"","thumbnail":"/build/freqai_weight-factor-70f8aa4395fdd17979cf8f96e17171d0.jpg","thumbnailOptimized":"/build/freqai_weight-factor-70f8aa4395fdd17979cf8f96e17171d0.webp","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"freqai-running","title":"FreqAI 运行指南","short_title":"FreqAI 运行","description":"FreqAI 是一个自适应机器学习框架，本文档介绍了如何在实时和回测模式下运行 FreqAI，包括模型训练、部署和管理等内容。","date":"","thumbnail":"/build/freqai_moving-window-05da86a83d6712baee031086385a7735.jpg","thumbnailOptimized":"/build/freqai_moving-window-05da86a83d6712baee031086385a7735.webp","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"freqai-reinforcement-learning","title":"FreqAI 强化学习指南","short_title":"强化学习","description":"本文档详细介绍了 FreqAI 的强化学习功能,包括基本概念、运行方法、环境配置等内容。这些功能可以帮助用户构建和训练强化学习模型进行自动交易。","date":"","thumbnail":"/build/tensorboard-27f8850881840b007f5a56a202abb949.jpg","thumbnailOptimized":"/build/tensorboard-27f8850881840b007f5a56a202abb949.webp","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"freqai-developers","title":"FreqAI 开发者指南","short_title":"FreqAI 开发","description":"本文档详细介绍了 FreqAI 的项目架构、数据处理流程和文件结构,为开发者提供了深入了解 FreqAI 内部工作原理的指南。","date":"","thumbnail":"/build/freqai_algorithm-dia-6d1ac15cf50f9103773ecaea4b8fd261.jpg","thumbnailOptimized":"/build/freqai_algorithm-dia-6d1ac15cf50f9103773ecaea4b8fd261.webp","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"leverage","title":"使用杠杆交易","description":"了解如何在 Freqtrade 中使用杠杆交易,包括做空、保证金和期货交易等高级功能","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"utils","title":"实用工具命令指南","short_title":"实用工具指南","description":"本文档详细介绍了 Freqtrade 中的各种实用工具子命令,包括创建用户目录、配置文件、列出交易所和交易对等功能。","date":"","thumbnail":"/build/show-config-output-2a74674e687e07d8afa7ace1b96df8bb.png","thumbnailOptimized":"/build/show-config-output-2a74674e687e07d8afa7ace1b96df8bb.webp","banner":"","bannerOptimized":"","tags":["工具","命令","配置","策略","交易所"],"level":1},{"slug":"plotting","title":"绘图","short_title":"绘图","description":"了解如何使用 Freqtrade 的绘图功能可视化价格、指标和利润数据,包括安装配置、命令参数和示例","date":"","thumbnail":"/build/plot-dataframe-40c25f36af7de6fc6f078d42ae5f90f5.png","thumbnailOptimized":"/build/plot-dataframe-40c25f36af7de6fc6f078d42ae5f90f5.webp","banner":"","bannerOptimized":"","tags":["绘图","可视化","指标","回测","利润"],"level":1},{"slug":"exchanges","title":"交易所特定说明","short_title":"交易所说明","description":"了解各个交易所的特殊配置和常见问题","date":"","thumbnail":"/build/binance_futures_sett-b4a8da10c6eb01bf904d6fc3533999b6.png","thumbnailOptimized":"/build/binance_futures_sett-b4a8da10c6eb01bf904d6fc3533999b6.webp","banner":"","bannerOptimized":"","tags":["交易所","配置","API","连接","问题解决"],"level":1},{"level":1,"title":"数据分析"},{"slug":"data-analysis","title":"使用 Jupyter 笔记本分析机器人数据","description":"使用 Jupyter 笔记本分析 Freqtrade 机器人的回测结果和交易历史数据","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"strategy-analysis-example","title":"Freqtrade 策略分析示例","short_title":"策略分析示例","description":"本文档介绍如何使用 Freqtrade 提供的工具来分析和调试交易策略,包括数据可视化、回测分析等功能。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"advanced-backtesting","title":"高级回测分析","short_title":"高级回测","description":"本文档介绍了 FreqTrade 的高级回测分析功能,包括买入/卖出标签分析、信号导出等高级特性。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"高级话题"},{"slug":"advanced-setup","title":"高级安装后配置","short_title":"高级安装","description":"本文档介绍了 FreqTrade 安装后可以执行的高级任务和配置选项,包括多实例运行、日志配置等高级特性。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"trade-object","title":"交易对象文档","short_title":"交易对象指南","description":"本文档详细介绍了 Freqtrade 中的交易对象(Trade)，包括其属性、方法以及在策略中的使用方式。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"lookahead-analysis","title":"前瞻性分析指南","short_title":"前瞻性分析","description":"前瞻性分析是一个用于检测和验证交易策略中是否存在前瞻性偏差的工具。本文档详细介绍了如何使用该工具来确保策略的有效性。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"recursive-analysis","title":"递归分析指南","short_title":"递归分析","description":"递归分析是一个用于检测和验证交易策略中是否存在因递归公式导致的不准确性的工具。本文档详细介绍了如何使用该工具来确保策略的有效性。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"strategy-advanced","title":"Freqtrade 高级策略指南","short_title":"高级策略","description":"本文档详细介绍了 Freqtrade 交易机器人的高级策略开发概念,包括持久化存储、回调方法等进阶功能。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"advanced-hyperopt","title":"高级超参数优化","short_title":"高级超参数优化","description":"本文档介绍了 FreqTrade 的高级超参数优化功能,包括自定义损失函数等高级特性。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"advanced-orderflow","title":"高级委托流分析","short_title":"委托流分析","description":"本文档介绍了 FreqTrade 的委托流分析功能,包括如何配置和使用公共成交数据进行高级委托流分析。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"producer-consumer","title":"生产者/消费者模式","short_title":"生产者/消费者","description":"本文档介绍了 Freqtrade 的生产者/消费者模式,包括如何配置多个机器人实例共享计算指标和信号,以及相关的 websocket 设置。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["生产者","消费者","分布式","多实例","WebSocket"],"level":2},{"slug":"sql-cheatsheet","title":"SQL 助手","short_title":"SQL 助手","description":"本文档提供了使用 SQLite 数据库进行查询的详细指南和常用命令参考。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"edge","title":"Edge Positioning - 边缘定位","short_title":"Edge","description":"Edge Positioning 模块使用概率统计来计算交易胜率和风险回报比,从而优化策略的入场点、头寸大小和止损设置。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["Edge","概率","统计","策略优化","风险管理"],"level":2},{"slug":"faq","title":"Freqtrade 常见问题","short_title":"FAQ","description":"本文档回答了关于 Freqtrade 交易机器人的常见问题,包括支持的市场、初学者指南以及常见问题的故障排除。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"strategy-migration","title":"策略迁移指南","short_title":"策略迁移","description":"本文档详细介绍了如何将 Freqtrade V2 策略迁移到 V3，包括接口变更、方法重命名以及新增功能的完整说明。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"updating","title":"更新指南","short_title":"更新指南","description":"本文档详细介绍了如何更新 Freqtrade 的不同安装方式,包括 Docker、安装脚本和原生安装等方法。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"commands","title":"Commands","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"deprecated","title":"已弃用功能","short_title":"已弃用功能","description":"本文档介绍了 FreqTrade 中已弃用和移除的命令行参数、配置参数和机器人功能,帮助用户避免使用不再受支持的特性。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"developer","title":"开发者指南","short_title":"开发者指南","description":"本文档面向 FreqTrade 的开发者,介绍如何为项目做出贡献、配置开发环境、编写测试以及其他开发相关的重要信息。","date":"","thumbnail":"/build/pycharm_debug-7a8a6d1f4a91d643a2d41ff932bf9a82.png","thumbnailOptimized":"/build/pycharm_debug-7a8a6d1f4a91d643a2d41ff932bf9a82.webp","banner":"","bannerOptimized":"","tags":[],"level":1},{"level":1,"title":"Commands"},{"slug":"main","title":"Main","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"backtesting-analysis","title":"Backtesting Analysis","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"backtesting-1","title":"Backtesting","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"backtesting-show","title":"Backtesting Show","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"convert-data","title":"Convert Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"convert-db","title":"Convert Db","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"convert-trade-data","title":"Convert Trade Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"create-userdir","title":"Create Userdir","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"download-data","title":"Download Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"edge-1","title":"Edge","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"hyperopt-list","title":"Hyperopt List","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"hyperopt-1","title":"Hyperopt","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"hyperopt-show","title":"Hyperopt Show","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"install-ui","title":"Install Ui","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"list-data","title":"List Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"list-exchanges","title":"List Exchanges","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"list-freqaimodels","title":"List Freqaimodels","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"list-hyperoptloss","title":"List Hyperoptloss","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"list-markets","title":"List Markets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"list-pairs","title":"List Pairs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"list-strategies","title":"List Strategies","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"list-timeframes","title":"List Timeframes","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"lookahead-analysis-1","title":"Lookahead Analysis","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"new-config","title":"New Config","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"new-strategy","title":"New Strategy","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"plot-dataframe","title":"Plot Dataframe","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"plot-profit","title":"Plot Profit","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"recursive-analysis-1","title":"Recursive Analysis","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"show-config","title":"Show Config","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"show-trades","title":"Show Trades","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"strategy-updater","title":"Strategy Updater","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"test-pairlist","title":"Test Pairlist","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"trade","title":"Trade","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"trades-to-ohlcv","title":"Trades To Ohlcv","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"webserver","title":"Webserver","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"page":{"version":2,"kind":"Article","sha256":"9a14779aaf418463b87be0c9c2a5415ccbea6a275ef6d8fc749cf8f1a89e2fe3","slug":"strategy-callbacks","location":"/strategy-callbacks.md","dependencies":[],"frontmatter":{"title":"策略回调指南","description":"本文档详细介绍了 Freqtrade 交易机器人中可用的各种策略回调函数,包括它们的用途、调用时机以及使用方法。","short_title":"策略回调","subtitle":"策略回调函数的完整概述","subject":"Freqtrade 策略回调文档","authors":[{"id":"Freqtrade","name":"Freqtrade"}],"github":"https://github.com/freqtrade-cn/docs_zh-CN","keywords":["Freqtrade","中文文档","交易机器人","量化交易","加密货币","数字货币","区块链","人工智能","机器学习"],"edit_url":"https://github.com/freqtrade-cn/docs_zh-CN/blob/main/strategy-callbacks.md","thumbnail":"/build/freqUI-chart-annotat-6ca425e986932e863842497203176546.png","thumbnailOptimized":"/build/freqUI-chart-annotat-6ca425e986932e863842497203176546.webp","exports":[{"format":"md","filename":"strategy-callbacks.md","url":"/build/strategy-callbacks-f1a21e2c9bbce659468855fbc25863ce.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"策略回调","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"L9tWxFoffa"}],"identifier":"id","label":"策略回调","html_id":"id","implicit":true,"key":"lqrrehEbqB"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"虽然主要的策略函数（","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"ua1LN6nnCy"},{"type":"inlineCode","value":"populate_indicators()","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"ZvS3cufuWn"},{"type":"text","value":", ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"jqom9BluSm"},{"type":"inlineCode","value":"populate_entry_trend()","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"gFS1U4vEuN"},{"type":"text","value":", ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"peLQKLbmMl"},{"type":"inlineCode","value":"populate_exit_trend()","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"zwzx6pOlrq"},{"type":"text","value":") ）应以向量化方式使用，并且只会在","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"i4zWmqvqOs"},{"type":"crossReference","url":"/bot-basics","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"回测时调用一次","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"Qau5TA5vHG"}],"urlSource":"bot-basics.md#backtesting-hyperopt-execution-logic","dataUrl":"/bot-basics.json","identifier":"backtesting-hyperopt-execution-logic","label":"backtesting-hyperopt-execution-logic","remote":true,"protocol":"file","kind":"heading","template":"{name}","resolved":true,"html_id":"backtesting-hyperopt-execution-logic","key":"sWq4768Cmq"},{"type":"text","value":"，但回调函数会在\"需要时\"被调用。","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"mXDKYzv56D"}],"key":"g4klttddHJ"},{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"因此，你应避免在回调中进行繁重的计算，以免在操作过程中造成延迟。","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"x2G1Rzylqw"}],"key":"z6fDtYkAGi"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"根据所用回调的不同，它们可能在进入/退出交易时调用，或在交易期间多次调用。\n当前可用的回调有：","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"U9OjgWxpKi"}],"key":"RDxLWiuOPW"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":18,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"crossReference","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"机器人启动 ","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"JxfMOW5voJ"},{"type":"inlineCode","value":"bot_start()","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"hCLNbK6qnM"}],"identifier":"bot-start","label":"bot-start","kind":"heading","template":"{name}","resolved":true,"html_id":"bot-start","key":"v48O2ZO4MY"}],"key":"P87eJoOvqj"},{"type":"listItem","spread":true,"position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"crossReference","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"机器人循环开始 ","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"ehfv52nMXF"},{"type":"inlineCode","value":"bot_loop_start()","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"Hwjyc3XiUd"}],"identifier":"bot-loop-start","label":"bot-loop-start","kind":"heading","template":"{name}","resolved":true,"html_id":"bot-loop-start","key":"ldY21aSR3O"}],"key":"L9JHflgX8Q"},{"type":"listItem","spread":true,"position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"crossReference","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"仓位大小管理 ","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"xXwZnvekId"},{"type":"inlineCode","value":"custom_stake_amount()","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"B8ndzGCFJv"}],"identifier":"stake-size-management","label":"stake-size-management","kind":"heading","template":"{name}","resolved":true,"html_id":"stake-size-management","key":"HnO11WrzsA"}],"key":"JqGjN7hoQY"},{"type":"listItem","spread":true,"position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"crossReference","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"自定义退出信号 ","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"tcQJnpCk0q"},{"type":"inlineCode","value":"custom_exit()","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"GmA41NJo7z"}],"identifier":"custom-exit-signal","label":"custom-exit-signal","kind":"heading","template":"{name}","resolved":true,"html_id":"custom-exit-signal","key":"ybSqqRQDae"}],"key":"WBqHsI4ahp"},{"type":"listItem","spread":true,"position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"crossReference","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"自定义止损 ","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"M1WJucb0hB"},{"type":"inlineCode","value":"custom_stoploss()","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"RtCubNgq14"}],"identifier":"custom-stoploss","label":"custom-stoploss","kind":"heading","template":"{name}","resolved":true,"html_id":"custom-stoploss","key":"BiWBYZUWsj"}],"key":"BS0TwuKnw2"},{"type":"listItem","spread":true,"position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"link","url":"#custom-order-price-rules","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"inlineCode","value":"custom_entry_price()","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"bZZv0joox4"},{"type":"text","value":" 和 ","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"prDBbEuRnd"},{"type":"inlineCode","value":"custom_exit_price()","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"Y0UGBFM67Z"}],"urlSource":"#custom-order-price-rules","key":"JPasi3ryLA"}],"key":"LhNh7fK4hm"},{"type":"listItem","spread":true,"position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"link","url":"#custom-order-timeout-rules","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"inlineCode","value":"check_entry_timeout()","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"lyb2np6BQf"},{"type":"text","value":" 和 ","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"TJKFSYXnNc"},{"type":"inlineCode","value":"check_exit_timeout()","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"AKN4SoE1bx"}],"urlSource":"#custom-order-timeout-rules","key":"gklX68FWXZ"}],"key":"IISGKRfK3L"},{"type":"listItem","spread":true,"position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"link","url":"#trade-entry-buy-order-confirmation","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"inlineCode","value":"confirm_trade_entry()","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"AbzI7haVno"}],"urlSource":"#trade-entry-buy-order-confirmation","key":"yp3UIyZDqe"}],"key":"a93WfPEDwP"},{"type":"listItem","spread":true,"position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"link","url":"#trade-exit-sell-order-confirmation","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"inlineCode","value":"confirm_trade_exit()","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"RPTVAtqOoa"}],"urlSource":"#trade-exit-sell-order-confirmation","key":"CVFZXnS5D6"}],"key":"MZjRV8wR8b"},{"type":"listItem","spread":true,"position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"crossReference","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"inlineCode","value":"adjust_trade_position()","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"MzC6S6slAG"}],"identifier":"adjust-trade-position","label":"adjust-trade-position","kind":"heading","template":"{name}","resolved":true,"html_id":"adjust-trade-position","key":"Dt4lHrsN2s"}],"key":"Rxi2t9hQvP"},{"type":"listItem","spread":true,"position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"link","url":"#adjust-entry-price","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"inlineCode","value":"adjust_entry_price()","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"nyMWaMqk8Q"}],"urlSource":"#adjust-entry-price","key":"COXb1NQsFR"}],"key":"strJLFk6Hm"},{"type":"listItem","spread":true,"position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"link","url":"#leverage-callback","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"inlineCode","value":"leverage()","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"gFPIqSWOIe"}],"urlSource":"#leverage-callback","key":"WBFEFFi0tk"}],"key":"yv8hNzNHC1"},{"type":"listItem","spread":true,"position":{"start":{"line":30,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"link","url":"#order-filled-callback","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"inlineCode","value":"order_filled()","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"H7FHRNVcdP"}],"urlSource":"#order-filled-callback","key":"Eml3WqAB4X"}],"key":"L4ZBIMKBfO"}],"key":"H3R4G6sMy9"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"回调调用顺序","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"T5Yn70kUEr"}],"key":"UAvZZEgWVL"},{"type":"paragraph","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"text","value":"你可以在 ","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"EonmyJi2Oa"},{"type":"crossReference","url":"/bot-basics","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"text","value":"bot-basics","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"WEVHzvIn7f"}],"urlSource":"bot-basics.md#bot-execution-logic","dataUrl":"/bot-basics.json","identifier":"bot-execution-logic","label":"bot-execution-logic","remote":true,"protocol":"file","kind":"heading","template":"{name}","resolved":true,"html_id":"bot-execution-logic","key":"X8Jhiac8Dq"},{"type":"text","value":" 中找到回调的调用顺序","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"pQLB8tyqq8"}],"key":"CUKDTxKwxl"}],"key":"EMQlxp4V35"},{"type":"include","file":"includes/strategy-imports.md","literal":false,"lang":"markdown","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"策略所需的导入","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ESo1rCJ8AR"}],"identifier":"id","label":"策略所需的导入","html_id":"id-1","implicit":true,"key":"JGGsSS9bax"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"在创建策略时，你需要导入必要的模块和类。以下是一个策略所需的导入：","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"oNd5KcyNh4"}],"key":"X0p5Ts1fgL"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"默认情况下，我们建议使用以下导入作为策略的基础：\n这将涵盖 freqtrade 功能所需的所有导入。\n当然，你可以根据需要添加更多导入。","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"vZT3c0qtjR"}],"key":"UumD8V8bZs"},{"type":"code","lang":"python","value":"# flake8: noqa: F401\n# isort: skip_file\n# --- Do not remove these imports ---\nimport numpy as np\nimport pandas as pd\nfrom datetime import datetime, timedelta, timezone\nfrom pandas import DataFrame\nfrom typing import Dict, Optional, Union, Tuple\n\nfrom freqtrade.strategy import (\n    IStrategy,\n    Trade, \n    Order,\n    PairLocks,\n    informative,  # @informative decorator\n    # Hyperopt Parameters\n    BooleanParameter,\n    CategoricalParameter,\n    DecimalParameter,\n    IntParameter,\n    RealParameter,\n    # timeframe helpers\n    timeframe_to_minutes,\n    timeframe_to_next_date,\n    timeframe_to_prev_date,\n    # Strategy helper functions\n    merge_informative_pair,\n    stoploss_from_absolute,\n    stoploss_from_open,\n)\n\n# --------------------------------\n# Add your lib to import here\nimport talib.abstract as ta\nfrom technical import qtpylib","position":{"start":{"line":9,"column":1},"end":{"line":45,"column":1}},"key":"NtOnwUnKIZ"}],"key":"U8DHb7bcS1"},{"type":"include","file":"includes/strategy-exit-comparisons.md","literal":false,"lang":"markdown","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"退出逻辑比较","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ESx8l4J69H"}],"identifier":"id","label":"退出逻辑比较","html_id":"id-2","implicit":true,"key":"iZcCrUDcHp"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Freqtrade 允许你的策略使用基于信号或基于回调的函数来实现不同的退出逻辑。\n本节旨在比较每个不同的函数，帮助你选择最适合你需求的方案。","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"LJ6amqfojC"}],"key":"BRfxRc7V9M"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":6,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"inlineCode","value":"populate_exit_trend()","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"YbdVPwUWAb"}],"key":"yy50eVd3BT"},{"type":"text","value":" - 使用主数据框架中的指标进行向量化的基于信号的退出逻辑","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"jmNmN0DcqF"}],"key":"DZpC7jIGIO"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":7,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"✅ ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"TrfjTTPmxn"},{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"使用场景","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"MxXW0993Bu"}],"key":"l2WfXAzdTw"},{"type":"text","value":"：基于指标或其他可以向量化计算的数据定义退出信号。","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"U8KwxpK654"}],"key":"tfmWJg6Q2d"}],"key":"Jxpa9W3CGi"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"🚫 ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"XHQrVdy112"},{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"不适用场景","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"PfY9dmAKLD"}],"key":"P3PtTn2Aie"},{"type":"text","value":"：为每个单独的交易自定义退出条件，或需要交易数据来做出退出决定时。","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"z7Te1ag2kw"}],"key":"IankqWQvnv"}],"key":"d3oBTLiJiQ"}],"key":"wpG61Sz3Ln"}],"key":"edt4KyBSIJ"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"strong","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"inlineCode","value":"custom_exit()","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"CIHpESpTSt"}],"key":"ak0mPzscOw"},{"type":"text","value":" - 自定义退出逻辑，将立即完全退出交易，在每次机器人循环迭代时对每个开放交易调用，直到交易关闭。","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"NzbqE5K01W"}],"key":"izNjJ0ErzF"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":12,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"✅ ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"OxySf6316U"},{"type":"strong","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"使用场景","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"Mgte3UqFpg"}],"key":"IkV4iOhsvP"},{"type":"text","value":"：为每个单独的交易指定退出条件（包括使用 ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"DlZnNp2AEz"},{"type":"inlineCode","value":"adjust_trade_position()","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"QUywPui572"},{"type":"text","value":" 的任何额外调整订单），或需要交易数据来做出退出决定时，例如使用利润数据来退出。","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"Qld6g6Rql8"}],"key":"FAjBPLRn2l"}],"key":"BJrPmQYWMr"},{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"🚫 ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"Lig489bXeb"},{"type":"strong","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"不适用场景","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"zIGCdKoAXD"}],"key":"f8LOvRKdXj"},{"type":"text","value":"：当你想使用向量化的基于指标的数据退出时（改用 ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"VXfTYh5W8l"},{"type":"inlineCode","value":"populate_exit_trend()","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"gnkR3vEQoo"},{"type":"text","value":" 信号），或作为 ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"uODfjtBsI5"},{"type":"inlineCode","value":"custom_stoploss()","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"TKNrrFPGlT"},{"type":"text","value":" 的替代，并且要注意回测中基于速率的退出可能不准确。","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"t0rJefGd6h"}],"key":"zRQTwmYFMJ"}],"key":"woWaWpzsPW"}],"key":"SpiFDsHrzv"}],"key":"c9dbxXQGZ3"},{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"strong","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"inlineCode","value":"custom_stoploss()","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"U93u31BBMu"}],"key":"DDOzvUSlId"},{"type":"text","value":" - 自定义追踪止损，在每次迭代时对每个开放交易调用，直到交易关闭。这里返回的值也用于","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"Xjmnldzm7L"},{"type":"crossReference","url":"/stoploss","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"交易所止损","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"JRFryEs7kR"}],"urlSource":"stoploss.md#stop-loss-on-exchangefreqtrade","dataUrl":"/stoploss.json","identifier":"stop-loss-on-exchangefreqtrade","label":"stop-loss-on-exchangefreqtrade","remote":true,"protocol":"file","key":"ywcDd4T4xA"},{"type":"text","value":"。","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"HaslpWQcXw"}],"key":"ix0yk5z4pb"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":17,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"✅ ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"hkKpNE0fG6"},{"type":"strong","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"使用场景","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"lQotFkQAET"}],"key":"swZbKT7yKz"},{"type":"text","value":"：自定义止损逻辑，根据交易数据或其他条件设置动态止损。","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"SGMUCXm6TI"}],"key":"JYaSeDBg5U"}],"key":"jAr2n2mNYg"},{"type":"listItem","spread":true,"position":{"start":{"line":19,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"🚫 ","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"yQn9ouF0qe"},{"type":"strong","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"不适用场景","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"DrtLyBBRmP"}],"key":"JtV3MRuDIb"},{"type":"text","value":"：基于特定条件立即退出交易。使用 ","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"n3iMtoyxcK"},{"type":"inlineCode","value":"custom_exit()","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"YNkkdBlGjH"},{"type":"text","value":" 来实现这个目的。","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"mbgiZrhCFk"}],"key":"dWOupb3JtB"}],"key":"oIctbu3GHm"}],"key":"ebhcRQttk3"}],"key":"k2As6vMRpp"},{"type":"listItem","spread":true,"position":{"start":{"line":21,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"strong","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"inlineCode","value":"custom_roi()","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"kOZdiy3uOP"}],"key":"LNG83LTJ1w"},{"type":"text","value":" - 自定义 ROI，在每次迭代时对每个开放交易调用，直到交易关闭。","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"bYmx1GCmAi"}],"key":"bSBFpM2S2M"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":23,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":23,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"✅ ","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"MdIlsTWlWX"},{"type":"strong","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"使用场景","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"AQ4RAW9vP4"}],"key":"zdVgDcwPrj"},{"type":"text","value":"：指定最小 ROI 阈值（“止盈”），根据利润或其他条件在交易持续时间内某个时间点以这个 ROI 水平退出交易。","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"Q8juv1xD5y"}],"key":"f2rTpkE8Nb"}],"key":"ConrE0PNUF"},{"type":"listItem","spread":true,"position":{"start":{"line":25,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"🚫 ","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"uNbK2P44Xl"},{"type":"strong","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"不适用场景","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"y4awJvCvVH"}],"key":"RNoDQKwqcu"},{"type":"text","value":"：基于特定条件立即退出交易。使用 ","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"AuGNKvlF50"},{"type":"inlineCode","value":"custom_exit()","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"QWjxHlcV1n"},{"type":"text","value":"。","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"TruUWQ7SXC"}],"key":"G4t5M5IZcX"}],"key":"U7trrM5x9b"},{"type":"listItem","spread":true,"position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"🚫 ","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"h7F7qMqEqK"},{"type":"strong","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"不适用场景","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"UcFr3ZTuWc"}],"key":"b58Q6vcD3B"},{"type":"text","value":"：静态 ROI。使用 ","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"ZiEn5a1c9m"},{"type":"inlineCode","value":"minimal_roi","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"DFu4GRyxVr"},{"type":"text","value":"。","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"LQiW342lNA"}],"key":"RwJlliwoMi"}],"key":"HyogKvnZNJ"}],"key":"PSpoAClkF6"}],"key":"j146WVI7HM"}],"key":"LqkjXd9ecB"}],"key":"YN5O1WU432"},{"type":"heading","depth":3,"position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"children":[{"type":"text","value":"机器人启动","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"key":"kWSSU9v9sv"}],"label":"bot-start","identifier":"bot-start","html_id":"bot-start","key":"OPiImXE2aU"},{"type":"paragraph","position":{"start":{"line":46,"column":1},"end":{"line":47,"column":1}},"children":[{"type":"text","value":"一个简单的回调，在策略加载时只调用一次。\n这可用于执行只需执行一次的操作，并在数据供应商 (dataprovider) 和钱包设置后运行。","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"IjETPrfb07"}],"key":"pkZmppcyif"},{"type":"code","lang":"python","value":"import requests\n\nclass AwesomeStrategy(IStrategy):\n\n    # ... populate_* methods\n\n    def bot_start(self, **kwargs) -\u003e None:\n        \"\"\"\n        Called only once after bot instantiation.\n        :param **kwargs: Ensure to keep this here so updates to this won't break your strategy.\n        \"\"\"\n        if self.config[\"runmode\"].value in (\"live\", \"dry_run\"):\n            # Assign this to the class by using self.*\n            # can then be used by populate_* methods\n            self.custom_remote_data = requests.get(\"https://some_remote_source.example.com\")\n","position":{"start":{"line":49,"column":1},"end":{"line":66,"column":1}},"key":"choXxNRXE4"},{"type":"paragraph","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"children":[{"type":"text","value":"在 hyperopt 时，这个回调只会在启动时运行一次。","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"yTjZOqAPJu"}],"key":"DhbToOtEUG"},{"type":"heading","depth":3,"position":{"start":{"line":72,"column":1},"end":{"line":72,"column":1}},"children":[{"type":"text","value":"机器人循环开始","position":{"start":{"line":72,"column":1},"end":{"line":72,"column":1}},"key":"LzmW5nlRfu"}],"label":"bot-loop-start","identifier":"bot-loop-start","html_id":"bot-loop-start","key":"IqjsCfNAnk"},{"type":"paragraph","position":{"start":{"line":74,"column":1},"end":{"line":75,"column":1}},"children":[{"type":"text","value":"一个简单的回调，在每次机器人节流循环开始时调用一次（在 dry/live 模式下大约每 5 秒，除非另有配置），或在回测/hyperopt 模式下每根 K 线调用一次。\n这可用于执行与交易对无关的计算（适用于所有交易对）、加载外部数据等。","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"key":"IEJIuHPTJw"}],"key":"daOUPBOyyl"},{"type":"code","lang":"python","value":"# Default imports\nimport requests\n\nclass AwesomeStrategy(IStrategy):\n\n    # ... populate_* methods\n\n    def bot_loop_start(self, current_time: datetime, **kwargs) -\u003e None:\n        \"\"\"\n        Called at the start of the bot iteration (one loop).\n        Might be used to perform pair-independent tasks\n        (e.g. gather some remote resource for comparison)\n        :param current_time: datetime object, containing the current datetime\n        :param **kwargs: Ensure to keep this here so updates to this won't break your strategy.\n        \"\"\"\n        if self.config[\"runmode\"].value in (\"live\", \"dry_run\"):\n            # Assign this to the class by using self.*\n            # can then be used by populate_* methods\n            self.remote_data = requests.get(\"https://some_remote_source.example.com\")\n","position":{"start":{"line":77,"column":1},"end":{"line":98,"column":1}},"key":"oeCebZwAJ4"},{"type":"heading","depth":3,"position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"children":[{"type":"text","value":"仓位大小管理","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"key":"FSXt61z4tF"}],"label":"stake-size-management","identifier":"stake-size-management","html_id":"stake-size-management","key":"UR5vKMAwA7"},{"type":"paragraph","position":{"start":{"line":104,"column":1},"end":{"line":104,"column":1}},"children":[{"type":"text","value":"在进入交易前调用，使你可以在下新单时管理仓位大小。","position":{"start":{"line":104,"column":1},"end":{"line":104,"column":1}},"key":"MZl7zbBLdN"}],"key":"WkE12whzdT"},{"type":"code","lang":"python","value":"# Default imports\n\nclass AwesomeStrategy(IStrategy):\n    def custom_stake_amount(self, pair: str, current_time: datetime, current_rate: float,\n                            proposed_stake: float, min_stake: float | None, max_stake: float,\n                            leverage: float, entry_tag: str | None, side: str,\n                            **kwargs) -\u003e float:\n\n        dataframe, _ = self.dp.get_analyzed_dataframe(pair=pair, timeframe=self.timeframe)\n        current_candle = dataframe.iloc[-1].squeeze()\n\n        if current_candle[\"fastk_rsi_1h\"] \u003e current_candle[\"fastd_rsi_1h\"]:\n            if self.config[\"stake_amount\"] == \"unlimited\":\n                # Use entire available wallet during favorable conditions when in compounding mode.\n                return max_stake\n            else:\n                # Compound profits during favorable conditions instead of using a static stake.\n                return self.wallets.get_total_stake_amount() / self.config[\"max_open_trades\"]\n\n        # Use default stake amount.\n        return proposed_stake","position":{"start":{"line":106,"column":1},"end":{"line":128,"column":1}},"key":"eKeBpmeKsR"},{"type":"paragraph","position":{"start":{"line":130,"column":1},"end":{"line":130,"column":1}},"children":[{"type":"text","value":"如果你的代码抛出异常，Freqtrade 会回退到 ","position":{"start":{"line":130,"column":1},"end":{"line":130,"column":1}},"key":"jq6WBGxh22"},{"type":"inlineCode","value":"proposed_stake","position":{"start":{"line":130,"column":1},"end":{"line":130,"column":1}},"key":"hC4hRHc93M"},{"type":"text","value":" 的值。异常本身会被记录。","position":{"start":{"line":130,"column":1},"end":{"line":130,"column":1}},"key":"psgiRok24d"}],"key":"VvhgRjO8jb"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Tip","key":"bgjyA6xIYX"}],"key":"UcmWZ5NoiF"},{"type":"paragraph","position":{"start":{"line":133,"column":1},"end":{"line":133,"column":1}},"children":[{"type":"text","value":"你不必确保 ","position":{"start":{"line":133,"column":1},"end":{"line":133,"column":1}},"key":"AyprrNZgu2"},{"type":"inlineCode","value":"min_stake \u003c= returned_value \u003c= max_stake","position":{"start":{"line":133,"column":1},"end":{"line":133,"column":1}},"key":"GEau2FFBdN"},{"type":"text","value":"。交易会成功，因为返回值会被限制在支持的范围内，并且此操作会被记录。","position":{"start":{"line":133,"column":1},"end":{"line":133,"column":1}},"key":"gmHlLLlM9T"}],"key":"x51ryqZhXv"}],"key":"CISMWnvpaA"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Tip","key":"zADV6nbVjb"}],"key":"AtealrevnB"},{"type":"paragraph","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"children":[{"type":"text","value":"返回 ","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"key":"wmBWjACuP0"},{"type":"inlineCode","value":"0","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"key":"GXnbE1xY65"},{"type":"text","value":" 或 ","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"key":"nzCBvgL4yy"},{"type":"inlineCode","value":"None","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"key":"uEpDNaRgM1"},{"type":"text","value":" 会阻止下单。","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"key":"ZPWVZoFyKc"}],"key":"kDjJ82P7yz"}],"key":"D0thUvxuEX"},{"type":"heading","depth":3,"position":{"start":{"line":142,"column":1},"end":{"line":142,"column":1}},"children":[{"type":"text","value":"自定义退出信号","position":{"start":{"line":142,"column":1},"end":{"line":142,"column":1}},"key":"bJZSiAU9RP"}],"label":"custom-exit-signal","identifier":"custom-exit-signal","html_id":"custom-exit-signal","key":"xQEJHESPNg"},{"type":"paragraph","position":{"start":{"line":144,"column":1},"end":{"line":144,"column":1}},"children":[{"type":"text","value":"在每次节流迭代（大约每 5 秒）时对开放交易调用，直到交易关闭。","position":{"start":{"line":144,"column":1},"end":{"line":144,"column":1}},"key":"WKtktSCnzL"}],"key":"HnKfo7ioct"},{"type":"paragraph","position":{"start":{"line":146,"column":1},"end":{"line":146,"column":1}},"children":[{"type":"text","value":"允许定义自定义退出信号，指示应关闭指定仓位（完全退出）。这在需要为每个单独的交易自定义退出条件，或者需要交易数据来做出退出决定时非常有用。","position":{"start":{"line":146,"column":1},"end":{"line":146,"column":1}},"key":"P1M6iprllt"}],"key":"AIDX263EYV"},{"type":"paragraph","position":{"start":{"line":148,"column":1},"end":{"line":148,"column":1}},"children":[{"type":"text","value":"例如，你可以使用 ","position":{"start":{"line":148,"column":1},"end":{"line":148,"column":1}},"key":"Tyq8PjVPkA"},{"type":"inlineCode","value":"custom_exit()","position":{"start":{"line":148,"column":1},"end":{"line":148,"column":1}},"key":"BJEyRVOHpI"},{"type":"text","value":" 实现 1:2 的风险回报比。","position":{"start":{"line":148,"column":1},"end":{"line":148,"column":1}},"key":"JJnkyIZ0EP"}],"key":"XLOLHOIsC9"},{"type":"paragraph","position":{"start":{"line":150,"column":1},"end":{"line":150,"column":1}},"children":[{"type":"text","value":"不过，使用 ","position":{"start":{"line":150,"column":1},"end":{"line":150,"column":1}},"key":"UCKr8WgyYr"},{"type":"inlineCode","value":"custom_exit()","position":{"start":{"line":150,"column":1},"end":{"line":150,"column":1}},"key":"zvmMNY3il3"},{"type":"text","value":" 信号代替止损 ","position":{"start":{"line":150,"column":1},"end":{"line":150,"column":1}},"key":"IBDIEYYhMy"},{"type":"emphasis","position":{"start":{"line":150,"column":1},"end":{"line":150,"column":1}},"children":[{"type":"text","value":"不推荐","position":{"start":{"line":150,"column":1},"end":{"line":150,"column":1}},"key":"wP16hEoKU0"}],"key":"Zo7vXRmZay"},{"type":"text","value":"。在这方面，它不如使用 ","position":{"start":{"line":150,"column":1},"end":{"line":150,"column":1}},"key":"aox01VRHnQ"},{"type":"inlineCode","value":"custom_stoploss()","position":{"start":{"line":150,"column":1},"end":{"line":150,"column":1}},"key":"RKDmsw2r8Y"},{"type":"text","value":" 有效，后者还允许你在交易所保持止损。","position":{"start":{"line":150,"column":1},"end":{"line":150,"column":1}},"key":"RuDw4DoAyH"}],"key":"szvNE0RUx7"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"Z78tzLUZAY"}],"key":"eLzWW6OrkN"},{"type":"paragraph","position":{"start":{"line":153,"column":1},"end":{"line":153,"column":1}},"children":[{"type":"text","value":"从此方法返回一个（非空）","position":{"start":{"line":153,"column":1},"end":{"line":153,"column":1}},"key":"jMvEev65hd"},{"type":"inlineCode","value":"string","position":{"start":{"line":153,"column":1},"end":{"line":153,"column":1}},"key":"e55YR7UNNu"},{"type":"text","value":" 或 ","position":{"start":{"line":153,"column":1},"end":{"line":153,"column":1}},"key":"THqmtc3zO1"},{"type":"inlineCode","value":"True","position":{"start":{"line":153,"column":1},"end":{"line":153,"column":1}},"key":"D7g9afJXKr"},{"type":"text","value":" 等同于在指定时间设置退出信号。如果已经设置了退出信号，或者退出信号被禁用（","position":{"start":{"line":153,"column":1},"end":{"line":153,"column":1}},"key":"MRS69Or99b"},{"type":"inlineCode","value":"use_exit_signal=False","position":{"start":{"line":153,"column":1},"end":{"line":153,"column":1}},"key":"JTplAdlhWk"},{"type":"text","value":"），则不会调用此方法。","position":{"start":{"line":153,"column":1},"end":{"line":153,"column":1}},"key":"Fn4EjJIdQt"},{"type":"inlineCode","value":"string","position":{"start":{"line":153,"column":1},"end":{"line":153,"column":1}},"key":"A2PR1P41od"},{"type":"text","value":" 的最大长度为 64 个字符。超过此限制将导致消息被截断为 64 个字符。","position":{"start":{"line":153,"column":1},"end":{"line":153,"column":1}},"key":"PJW1fUgXk6"}],"key":"CEcV3WpgD2"},{"type":"paragraph","position":{"start":{"line":155,"column":1},"end":{"line":155,"column":1}},"children":[{"type":"inlineCode","value":"custom_exit()","position":{"start":{"line":155,"column":1},"end":{"line":155,"column":1}},"key":"HaVG8uo4oR"},{"type":"text","value":" 将忽略 ","position":{"start":{"line":155,"column":1},"end":{"line":155,"column":1}},"key":"cSpscpTvfh"},{"type":"inlineCode","value":"exit_profit_only","position":{"start":{"line":155,"column":1},"end":{"line":155,"column":1}},"key":"N4XbiTFbDN"},{"type":"text","value":"，并且除非 ","position":{"start":{"line":155,"column":1},"end":{"line":155,"column":1}},"key":"drtI5mtaEN"},{"type":"inlineCode","value":"use_exit_signal=False","position":{"start":{"line":155,"column":1},"end":{"line":155,"column":1}},"key":"fTXSQqwHst"},{"type":"text","value":"，否则始终会被调用，即使有新的进入信号。","position":{"start":{"line":155,"column":1},"end":{"line":155,"column":1}},"key":"e9u8V4AjHq"}],"key":"OWDdev6dPj"}],"key":"Z6gBl5Num5"},{"type":"paragraph","position":{"start":{"line":158,"column":1},"end":{"line":158,"column":1}},"children":[{"type":"text","value":"一个示例，说明如何根据当前利润使用不同的指标，并退出已开放超过一天的交易：","position":{"start":{"line":158,"column":1},"end":{"line":158,"column":1}},"key":"AVoSCzczGh"}],"key":"fbhzGazwsC"},{"type":"code","lang":"python","value":"# Default imports\n\nclass AwesomeStrategy(IStrategy):\n    def custom_exit(self, pair: str, trade: Trade, current_time: datetime, current_rate: float,\n                    current_profit: float, **kwargs):\n        dataframe, _ = self.dp.get_analyzed_dataframe(pair, self.timeframe)\n        last_candle = dataframe.iloc[-1].squeeze()\n\n        # Above 20% profit, sell when rsi \u003c 80\n        if current_profit \u003e 0.2:\n            if last_candle[\"rsi\"] \u003c 80:\n                return \"rsi_below_80\"\n\n        # Between 2% and 10%, sell if EMA-long above EMA-short\n        if 0.02 \u003c current_profit \u003c 0.1:\n            if last_candle[\"emalong\"] \u003e last_candle[\"emashort\"]:\n                return \"ema_long_below_80\"\n\n        # Sell any positions at a loss if they are held for more than one day.\n        if current_profit \u003c 0.0 and (current_time - trade.open_date_utc).days \u003e= 1:\n            return \"unclog\"","position":{"start":{"line":160,"column":1},"end":{"line":182,"column":1}},"key":"T1L6YVlIBP"},{"type":"paragraph","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"children":[{"type":"text","value":"请参阅 ","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"key":"m28qQ8aHs8"},{"type":"crossReference","url":"/strategy-advanced","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"children":[{"type":"text","value":"Dataframe 访问","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"key":"noqJxePGN3"}],"urlSource":"strategy-advanced.md#dataframe-access","dataUrl":"/strategy-advanced.json","identifier":"dataframe-access","label":"dataframe-access","remote":true,"protocol":"file","key":"BMQ2uaij7A"},{"type":"text","value":" 以获取有关在策略回调中使用 dataframe 的更多信息。","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"key":"SK4VMI2oLx"}],"key":"ukfDyRuJXK"},{"type":"heading","depth":3,"position":{"start":{"line":188,"column":1},"end":{"line":188,"column":1}},"children":[{"type":"text","value":"自定义止损","position":{"start":{"line":188,"column":1},"end":{"line":188,"column":1}},"key":"sL8aGLuZKm"}],"label":"custom-stoploss","identifier":"custom-stoploss","html_id":"custom-stoploss","key":"TRuVnW9Avj"},{"type":"paragraph","position":{"start":{"line":190,"column":1},"end":{"line":190,"column":1}},"children":[{"type":"text","value":"在每次迭代（大约每 5 秒）时对开放交易调用，直到交易关闭。","position":{"start":{"line":190,"column":1},"end":{"line":190,"column":1}},"key":"ZqiC6sPZaM"}],"key":"Fq3YXwZtr8"},{"type":"paragraph","position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"children":[{"type":"text","value":"必须通过在策略对象上设置 ","position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"key":"rAXikYBHFF"},{"type":"inlineCode","value":"use_custom_stoploss=True","position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"key":"yXyDux5f9n"},{"type":"text","value":" 来启用自定义止损方法。","position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"key":"CAEpuqauJX"}],"key":"Cr2eurIk3U"},{"type":"paragraph","position":{"start":{"line":194,"column":1},"end":{"line":194,"column":1}},"children":[{"type":"text","value":"止损价格只能向上移动 - 如果从 ","position":{"start":{"line":194,"column":1},"end":{"line":194,"column":1}},"key":"X6muA4KtIp"},{"type":"inlineCode","value":"custom_stoploss","position":{"start":{"line":194,"column":1},"end":{"line":194,"column":1}},"key":"KXDClfTyfU"},{"type":"text","value":" 返回的止损值会导致止损价格低于之前设置的价格，则会被忽略。传统的 ","position":{"start":{"line":194,"column":1},"end":{"line":194,"column":1}},"key":"mdFs3X9gOF"},{"type":"inlineCode","value":"stoploss","position":{"start":{"line":194,"column":1},"end":{"line":194,"column":1}},"key":"thbC9hiSjJ"},{"type":"text","value":" 值作为绝对下限，并将作为初始止损（在此方法首次为交易调用之前），并且仍然是强制性的。","position":{"start":{"line":194,"column":1},"end":{"line":194,"column":1}},"key":"vt8JZWku97"}],"key":"NXhcWdlbXA"},{"type":"paragraph","position":{"start":{"line":196,"column":1},"end":{"line":196,"column":1}},"children":[{"type":"text","value":"由于自定义止损作为常规、变化的止损，其行为类似于 ","position":{"start":{"line":196,"column":1},"end":{"line":196,"column":1}},"key":"fRC7AJbuK0"},{"type":"inlineCode","value":"trailing_stop","position":{"start":{"line":196,"column":1},"end":{"line":196,"column":1}},"key":"uDRKg4DhU7"},{"type":"text","value":" - 因此，由于此原因退出的交易将具有 ","position":{"start":{"line":196,"column":1},"end":{"line":196,"column":1}},"key":"M78MmE00RB"},{"type":"inlineCode","value":"\"trailing_stop_loss\"","position":{"start":{"line":196,"column":1},"end":{"line":196,"column":1}},"key":"A3uZ9M8bsk"},{"type":"text","value":" 的退出原因。","position":{"start":{"line":196,"column":1},"end":{"line":196,"column":1}},"key":"dVWgZN6bp7"}],"key":"C6sOd9HTkm"},{"type":"paragraph","position":{"start":{"line":198,"column":1},"end":{"line":198,"column":1}},"children":[{"type":"text","value":"该方法必须返回一个止损值（浮点数/数字），作为当前价格的百分比。","position":{"start":{"line":198,"column":1},"end":{"line":198,"column":1}},"key":"uTJ8XzAqjl"}],"key":"i6LOU6g5It"},{"type":"paragraph","position":{"start":{"line":200,"column":1},"end":{"line":200,"column":1}},"children":[{"type":"text","value":"例如，如果 ","position":{"start":{"line":200,"column":1},"end":{"line":200,"column":1}},"key":"BROSLLq3MU"},{"type":"inlineCode","value":"current_rate","position":{"start":{"line":200,"column":1},"end":{"line":200,"column":1}},"key":"Ek46GHEsrH"},{"type":"text","value":" 是 200 美元，则返回 ","position":{"start":{"line":200,"column":1},"end":{"line":200,"column":1}},"key":"tdbVxF4ONL"},{"type":"inlineCode","value":"0.02","position":{"start":{"line":200,"column":1},"end":{"line":200,"column":1}},"key":"iA6lu6Ivlw"},{"type":"text","value":" 将设置止损价格比当前价格低 2%，即 196 美元。","position":{"start":{"line":200,"column":1},"end":{"line":200,"column":1}},"key":"LKid8ypKfH"}],"key":"JMWEJkoRZP"},{"type":"paragraph","position":{"start":{"line":202,"column":1},"end":{"line":202,"column":1}},"children":[{"type":"text","value":"在回测期间，","position":{"start":{"line":202,"column":1},"end":{"line":202,"column":1}},"key":"Wy8zMMgL1j"},{"type":"inlineCode","value":"current_rate","position":{"start":{"line":202,"column":1},"end":{"line":202,"column":1}},"key":"ptxtkfMm7p"},{"type":"text","value":"（和 ","position":{"start":{"line":202,"column":1},"end":{"line":202,"column":1}},"key":"nejXDjeKb1"},{"type":"inlineCode","value":"current_profit","position":{"start":{"line":202,"column":1},"end":{"line":202,"column":1}},"key":"kkARga3zeL"},{"type":"text","value":"）是针对 K 线的高点（或空头交易的低点）提供的，而最终的止损是针对 K 线的低点（或空头交易的高点）进行评估的。","position":{"start":{"line":202,"column":1},"end":{"line":202,"column":1}},"key":"sKh2AzdNDx"}],"key":"P8iD6NXiHd"},{"type":"paragraph","position":{"start":{"line":204,"column":1},"end":{"line":206,"column":1}},"children":[{"type":"text","value":"返回值的绝对值被使用（符号被忽略），因此返回 ","position":{"start":{"line":204,"column":1},"end":{"line":204,"column":1}},"key":"U0KLJtfqdf"},{"type":"inlineCode","value":"0.05","position":{"start":{"line":204,"column":1},"end":{"line":204,"column":1}},"key":"SS5Oy1eT89"},{"type":"text","value":" 或 ","position":{"start":{"line":204,"column":1},"end":{"line":204,"column":1}},"key":"WUwQddI3ms"},{"type":"inlineCode","value":"-0.05","position":{"start":{"line":204,"column":1},"end":{"line":204,"column":1}},"key":"vBMbxqRGTJ"},{"type":"text","value":" 具有相同的结果，即止损比当前价格低 5%。\n返回 ","position":{"start":{"line":204,"column":1},"end":{"line":204,"column":1}},"key":"oRm38k7TJc"},{"type":"inlineCode","value":"None","position":{"start":{"line":204,"column":1},"end":{"line":204,"column":1}},"key":"SJ8EzkYPbM"},{"type":"text","value":" 将被解释为\"不希望更改\"，并且是当你不想修改止损时的唯一安全返回方式。\n","position":{"start":{"line":204,"column":1},"end":{"line":204,"column":1}},"key":"rpSgYA9lBh"},{"type":"inlineCode","value":"NaN","position":{"start":{"line":204,"column":1},"end":{"line":204,"column":1}},"key":"jJDkqwYwTz"},{"type":"text","value":" 和 ","position":{"start":{"line":204,"column":1},"end":{"line":204,"column":1}},"key":"dqs4MNk0Cm"},{"type":"inlineCode","value":"inf","position":{"start":{"line":204,"column":1},"end":{"line":204,"column":1}},"key":"XXqds50PFz"},{"type":"text","value":" 值被视为无效，并将被忽略（与 ","position":{"start":{"line":204,"column":1},"end":{"line":204,"column":1}},"key":"RAODxqih7S"},{"type":"inlineCode","value":"None","position":{"start":{"line":204,"column":1},"end":{"line":204,"column":1}},"key":"bXvf8M6tfk"},{"type":"text","value":" 相同）。","position":{"start":{"line":204,"column":1},"end":{"line":204,"column":1}},"key":"n6Oyf0DiC5"}],"key":"NmHKJ4cmKg"},{"type":"paragraph","position":{"start":{"line":208,"column":1},"end":{"line":208,"column":1}},"children":[{"type":"text","value":"交易所上的止损与 ","position":{"start":{"line":208,"column":1},"end":{"line":208,"column":1}},"key":"qsvL4cEKuJ"},{"type":"inlineCode","value":"trailing_stop","position":{"start":{"line":208,"column":1},"end":{"line":208,"column":1}},"key":"tCbfLFGXzC"},{"type":"text","value":" 类似，并且交易所上的止损会根据 ","position":{"start":{"line":208,"column":1},"end":{"line":208,"column":1}},"key":"pvAzWLDpmh"},{"type":"inlineCode","value":"stoploss_on_exchange_interval","position":{"start":{"line":208,"column":1},"end":{"line":208,"column":1}},"key":"A1o3gtYdiL"},{"type":"text","value":" 进行更新（","position":{"start":{"line":208,"column":1},"end":{"line":208,"column":1}},"key":"wZOqY37BZH"},{"type":"crossReference","url":"/stoploss","position":{"start":{"line":208,"column":1},"end":{"line":208,"column":1}},"children":[{"type":"text","value":"有关交易所止损的更多详细信息","position":{"start":{"line":208,"column":1},"end":{"line":208,"column":1}},"key":"rkHfk7naQp"}],"urlSource":"stoploss.md#stop-loss-on-exchangefreqtrade","dataUrl":"/stoploss.json","identifier":"stop-loss-on-exchangefreqtrade","label":"stop-loss-on-exchangefreqtrade","remote":true,"protocol":"file","key":"uld6isUL1H"},{"type":"text","value":"）。","position":{"start":{"line":208,"column":1},"end":{"line":208,"column":1}},"key":"zwXl7Ehg6c"}],"key":"Or4ZpCQl8r"},{"type":"paragraph","position":{"start":{"line":210,"column":1},"end":{"line":210,"column":1}},"children":[{"type":"text","value":"如果你在期货市场上，请注意 ","position":{"start":{"line":210,"column":1},"end":{"line":210,"column":1}},"key":"PXnh3OgqMp"},{"type":"crossReference","url":"/stoploss","position":{"start":{"line":210,"column":1},"end":{"line":210,"column":1}},"children":[{"type":"text","value":"止损和杠杆","position":{"start":{"line":210,"column":1},"end":{"line":210,"column":1}},"key":"vSVjGQMHl3"}],"urlSource":"stoploss.md#stoploss-and-leverage","dataUrl":"/stoploss.json","identifier":"stoploss-and-leverage","label":"stoploss-and-leverage","remote":true,"protocol":"file","key":"gR9yyH6BpZ"},{"type":"text","value":" 部分，因为从 ","position":{"start":{"line":210,"column":1},"end":{"line":210,"column":1}},"key":"ItURJPzNjp"},{"type":"inlineCode","value":"custom_stoploss","position":{"start":{"line":210,"column":1},"end":{"line":210,"column":1}},"key":"FxTeZZkrNB"},{"type":"text","value":" 返回的止损值是该交易的风险，而不是相对价格变动。","position":{"start":{"line":210,"column":1},"end":{"line":210,"column":1}},"key":"vBN6qypULo"}],"key":"bWGsRD6kIL"},{"type":"admonition","kind":"important","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"使用日期","position":{"start":{"line":212,"column":1},"end":{"line":212,"column":1}},"key":"VekmbbILxp"}],"key":"oONW7vENMo"},{"type":"paragraph","position":{"start":{"line":213,"column":1},"end":{"line":213,"column":1}},"children":[{"type":"text","value":"所有基于时间的计算都应基于 ","position":{"start":{"line":213,"column":1},"end":{"line":213,"column":1}},"key":"zxJC7YC477"},{"type":"inlineCode","value":"current_time","position":{"start":{"line":213,"column":1},"end":{"line":213,"column":1}},"key":"k8XqhIrWs3"},{"type":"text","value":" - 不鼓励使用 ","position":{"start":{"line":213,"column":1},"end":{"line":213,"column":1}},"key":"Mgm2Sa1Zbh"},{"type":"inlineCode","value":"datetime.now()","position":{"start":{"line":213,"column":1},"end":{"line":213,"column":1}},"key":"nMjn8NwXzY"},{"type":"text","value":" 或 ","position":{"start":{"line":213,"column":1},"end":{"line":213,"column":1}},"key":"eyGwFPNINs"},{"type":"inlineCode","value":"datetime.utcnow()","position":{"start":{"line":213,"column":1},"end":{"line":213,"column":1}},"key":"x7xwrQIzlR"},{"type":"text","value":"，因为这会影响回测支持。","position":{"start":{"line":213,"column":1},"end":{"line":213,"column":1}},"key":"cgInV6IOjG"}],"key":"YpZLNO0IUz"}],"key":"siGvTcXbMZ"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"追踪止损","position":{"start":{"line":216,"column":1},"end":{"line":216,"column":1}},"key":"SkTszRDKls"}],"key":"Pjws4r6B6H"},{"type":"paragraph","position":{"start":{"line":217,"column":1},"end":{"line":217,"column":1}},"children":[{"type":"text","value":"在使用自定义止损值时，建议禁用 ","position":{"start":{"line":217,"column":1},"end":{"line":217,"column":1}},"key":"V6JnoyhTL1"},{"type":"inlineCode","value":"trailing_stop","position":{"start":{"line":217,"column":1},"end":{"line":217,"column":1}},"key":"W7UTwGRfz8"},{"type":"text","value":"。两者可以协同工作，但你可能会遇到追踪止损将价格推高，而你的自定义函数不希望这种情况，导致冲突行为。","position":{"start":{"line":217,"column":1},"end":{"line":217,"column":1}},"key":"LbEasCQVnc"}],"key":"Hc1omy2r0a"}],"key":"CCR8LTUymV"},{"type":"heading","depth":4,"position":{"start":{"line":220,"column":1},"end":{"line":220,"column":1}},"children":[{"type":"text","value":"调整止损后调整仓位","position":{"start":{"line":220,"column":1},"end":{"line":220,"column":1}},"key":"EItxmyEGir"}],"identifier":"id","label":"调整止损后调整仓位","html_id":"id-3","implicit":true,"key":"NPqrBwVAVr"},{"type":"paragraph","position":{"start":{"line":222,"column":1},"end":{"line":223,"column":1}},"children":[{"type":"text","value":"根据你的策略，你可能需要在 ","position":{"start":{"line":222,"column":1},"end":{"line":222,"column":1}},"key":"yvWJcUtaO8"},{"type":"crossReference","position":{"start":{"line":222,"column":1},"end":{"line":222,"column":1}},"children":[{"type":"text","value":"仓位调整","position":{"start":{"line":222,"column":1},"end":{"line":222,"column":1}},"key":"GXGTLG9cgI"}],"identifier":"adjust-trade-position","label":"adjust-trade-position","kind":"heading","template":"{name}","resolved":true,"html_id":"adjust-trade-position","key":"zBPx317rNo"},{"type":"text","value":" 后调整止损的方向。\n为此，freqtrade 将在订单成交后额外调用 ","position":{"start":{"line":222,"column":1},"end":{"line":222,"column":1}},"key":"AdLy2Ncvvm"},{"type":"inlineCode","value":"after_fill=True","position":{"start":{"line":222,"column":1},"end":{"line":222,"column":1}},"key":"K9pw300H2P"},{"type":"text","value":"，这将允许策略在任意方向移动止损（也可以扩大止损与当前价格之间的差距，这在其他情况下是禁止的）。","position":{"start":{"line":222,"column":1},"end":{"line":222,"column":1}},"key":"wpmzzUjmAR"}],"key":"I19HErHlwU"},{"type":"admonition","kind":"important","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"向后兼容性","position":{"start":{"line":225,"column":1},"end":{"line":225,"column":1}},"key":"NHDDTa8Vqk"}],"key":"EoWj6XIJ7V"},{"type":"paragraph","position":{"start":{"line":226,"column":1},"end":{"line":226,"column":1}},"children":[{"type":"text","value":"只有在你的 ","position":{"start":{"line":226,"column":1},"end":{"line":226,"column":1}},"key":"MgdgAs4sOY"},{"type":"inlineCode","value":"custom_stoploss","position":{"start":{"line":226,"column":1},"end":{"line":226,"column":1}},"key":"rXrLXCtDfa"},{"type":"text","value":" 函数定义中包含 ","position":{"start":{"line":226,"column":1},"end":{"line":226,"column":1}},"key":"mRRfOEnJ0z"},{"type":"inlineCode","value":"after_fill","position":{"start":{"line":226,"column":1},"end":{"line":226,"column":1}},"key":"h17HOFHVEN"},{"type":"text","value":" 参数时，才会进行此调用。","position":{"start":{"line":226,"column":1},"end":{"line":226,"column":1}},"key":"E0RCjFtL6j"}],"key":"c7G7mjItz8"},{"type":"paragraph","position":{"start":{"line":228,"column":1},"end":{"line":228,"column":1}},"children":[{"type":"text","value":"因此，这不会影响（也不会让现有运行的策略感到意外）。","position":{"start":{"line":228,"column":1},"end":{"line":228,"column":1}},"key":"YM9yXkDemM"}],"key":"AfhHTvuBUo"}],"key":"gJTfoCHCwd"},{"type":"heading","depth":4,"position":{"start":{"line":231,"column":1},"end":{"line":231,"column":1}},"children":[{"type":"text","value":"自定义止损示例","position":{"start":{"line":231,"column":1},"end":{"line":231,"column":1}},"key":"uFRVrWB1Mq"}],"identifier":"id","label":"自定义止损示例","html_id":"id-4","implicit":true,"key":"qA7NvWOuWa"},{"type":"paragraph","position":{"start":{"line":233,"column":1},"end":{"line":234,"column":1}},"children":[{"type":"text","value":"下一节将展示一些使用自定义止损函数的示例。\n当然，还有更多可能性，所有示例都可以随意组合。","position":{"start":{"line":233,"column":1},"end":{"line":233,"column":1}},"key":"HOiRu3vb0U"}],"key":"qRnjWhAm9L"},{"type":"heading","depth":5,"position":{"start":{"line":236,"column":1},"end":{"line":236,"column":1}},"children":[{"type":"text","value":"通过自定义止损实现追踪止损","position":{"start":{"line":236,"column":1},"end":{"line":236,"column":1}},"key":"PuPrQXgA19"}],"identifier":"id","label":"通过自定义止损实现追踪止损","html_id":"id-5","implicit":true,"key":"Sc0p9K6Ari"},{"type":"paragraph","position":{"start":{"line":238,"column":1},"end":{"line":238,"column":1}},"children":[{"type":"text","value":"要模拟 4% 的常规追踪止损（在达到的最高价格后追踪 4%），你可以使用以下非常简单的方法：","position":{"start":{"line":238,"column":1},"end":{"line":238,"column":1}},"key":"CBB7k2lxjq"}],"key":"i8ANIMC2PH"},{"type":"code","lang":"python","value":"# Default imports\n\nclass AwesomeStrategy(IStrategy):\n\n    # ... populate_* 方法\n\n    use_custom_stoploss = True\n\n    def custom_stoploss(self, pair: str, trade: Trade, current_time: datetime,\n                        current_rate: float, current_profit: float, after_fill: bool, \n                        **kwargs) -\u003e float | None:\n        \"\"\"\n        自定义止损逻辑，返回相对于 current_rate 的新距离（作为比率）。\n        例如，返回 -0.05 将创建一个比 current_rate 低 5% 的止损。\n        自定义止损绝不能低于 self.stoploss，后者作为硬性最大损失。\n\n        完整文档请访问 https://www.freqtrade.io/en/latest/strategy-advanced/\n\n        如果策略未实现，则返回初始止损值。\n        仅在 use_custom_stoploss 设置为 True 时调用。\n\n        :param pair: 当前分析的交易对\n        :param trade: 交易对象。\n        :param current_time: 当前时间的 datetime 对象\n        :param current_rate: 基于 exit_pricing 中的定价设置计算的比率。\n        :param current_profit: 当前利润（作为比率），基于 current_rate 计算。\n        :param after_fill: 如果止损在订单成交后调用，则为 True。\n        :param **kwargs: 保持此参数，以免未来更新破坏你的策略。\n        :return float: 相对于 current_rate 的新止损值\n        \"\"\"\n        return -0.04 * trade.leverage","position":{"start":{"line":240,"column":1},"end":{"line":272,"column":1}},"key":"F4Hzi66tU1"},{"type":"heading","depth":5,"position":{"start":{"line":274,"column":1},"end":{"line":274,"column":1}},"children":[{"type":"text","value":"基于时间的追踪止损","position":{"start":{"line":274,"column":1},"end":{"line":274,"column":1}},"key":"MKI2ydTd2k"}],"identifier":"id","label":"基于时间的追踪止损","html_id":"id-6","implicit":true,"key":"eMuXbqYIXi"},{"type":"paragraph","position":{"start":{"line":276,"column":1},"end":{"line":276,"column":1}},"children":[{"type":"text","value":"在前 60 分钟内使用初始止损，之后更改为 10% 的追踪止损，并在 2 小时（120 分钟）后使用 5% 的追踪止损。","position":{"start":{"line":276,"column":1},"end":{"line":276,"column":1}},"key":"QJmuSoab1z"}],"key":"YeA0re5moP"},{"type":"code","lang":"python","value":"# Default imports\n\nclass AwesomeStrategy(IStrategy):\n\n    # ... populate_* 方法\n\n    use_custom_stoploss = True\n\n    def custom_stoploss(self, pair: str, trade: Trade, current_time: datetime,\n                        current_rate: float, current_profit: float, after_fill: bool, \n                        **kwargs) -\u003e float | None:\n\n        # 确保最长的间隔在前 - 这些条件从上到下评估。\n        if current_time - timedelta(minutes=120) \u003e trade.open_date_utc:\n            return -0.05 * trade.leverage\n        elif current_time - timedelta(minutes=60) \u003e trade.open_date_utc:\n            return -0.10 * trade.leverage\n        return None","position":{"start":{"line":278,"column":1},"end":{"line":297,"column":1}},"key":"BFYsFKFMOm"},{"type":"heading","depth":5,"position":{"start":{"line":299,"column":1},"end":{"line":299,"column":1}},"children":[{"type":"text","value":"基于时间的追踪止损，带有成交后调整","position":{"start":{"line":299,"column":1},"end":{"line":299,"column":1}},"key":"AKaPLnKOeZ"}],"identifier":"id","label":"基于时间的追踪止损，带有成交后调整","html_id":"id-7","implicit":true,"key":"vQyzQgth9H"},{"type":"paragraph","position":{"start":{"line":301,"column":1},"end":{"line":302,"column":1}},"children":[{"type":"text","value":"在前 60 分钟内使用初始止损，之后更改为 10% 的追踪止损，并在 2 小时（120 分钟）后使用 5% 的追踪止损。\n如果额外订单成交，将止损设置为新 ","position":{"start":{"line":301,"column":1},"end":{"line":301,"column":1}},"key":"o87z2AGCYl"},{"type":"inlineCode","value":"open_rate","position":{"start":{"line":301,"column":1},"end":{"line":301,"column":1}},"key":"sB39nt4GWG"},{"type":"text","value":" 下方 10%（","position":{"start":{"line":301,"column":1},"end":{"line":301,"column":1}},"key":"fd2jHr3aAc"},{"type":"link","url":"#position-adjust-calculations","position":{"start":{"line":301,"column":1},"end":{"line":301,"column":1}},"children":[{"type":"text","value":"所有入场的平均值","position":{"start":{"line":301,"column":1},"end":{"line":301,"column":1}},"key":"mUjXTU9dxh"}],"urlSource":"#position-adjust-calculations","key":"sonxU48Udo"},{"type":"text","value":"）。","position":{"start":{"line":301,"column":1},"end":{"line":301,"column":1}},"key":"HeJcnyDePY"}],"key":"zCYItzXNU7"},{"type":"code","lang":"python","value":"# Default imports\n\nclass AwesomeStrategy(IStrategy):\n\n    # ... populate_* 方法\n\n    use_custom_stoploss = True\n\n    def custom_stoploss(self, pair: str, trade: Trade, current_time: datetime,\n                        current_rate: float, current_profit: float, after_fill: bool, \n                        **kwargs) -\u003e float | None:\n\n        if after_fill: \n            # 在额外订单后，从新开仓率下方 10% 的止损开始\n            return stoploss_from_open(0.10, current_profit, is_short=trade.is_short, leverage=trade.leverage)\n        # 确保最长的间隔在前 - 这些条件从上到下评估。\n        if current_time - timedelta(minutes=120) \u003e trade.open_date_utc:\n            return -0.05 * trade.leverage\n        elif current_time - timedelta(minutes=60) \u003e trade.open_date_utc:\n            return -0.10 * trade.leverage\n        return None","position":{"start":{"line":304,"column":1},"end":{"line":326,"column":1}},"key":"YU0DyxEovW"},{"type":"heading","depth":5,"position":{"start":{"line":328,"column":1},"end":{"line":328,"column":1}},"children":[{"type":"text","value":"每个交易对不同的止损","position":{"start":{"line":328,"column":1},"end":{"line":328,"column":1}},"key":"qtSgHISCwS"}],"identifier":"id","label":"每个交易对不同的止损","html_id":"id-8","implicit":true,"key":"BWm80feCXR"},{"type":"paragraph","position":{"start":{"line":330,"column":1},"end":{"line":330,"column":1}},"children":[{"type":"text","value":"根据交易对使用不同的止损。","position":{"start":{"line":330,"column":1},"end":{"line":330,"column":1}},"key":"r0fDk4VzPf"}],"key":"oMloeBXfjO"},{"type":"paragraph","position":{"start":{"line":332,"column":1},"end":{"line":332,"column":1}},"children":[{"type":"text","value":"在此示例中，我们将为 ","position":{"start":{"line":332,"column":1},"end":{"line":332,"column":1}},"key":"WYt3pQKWYe"},{"type":"inlineCode","value":"ETH/BTC","position":{"start":{"line":332,"column":1},"end":{"line":332,"column":1}},"key":"UaczudeGhK"},{"type":"text","value":" 和 ","position":{"start":{"line":332,"column":1},"end":{"line":332,"column":1}},"key":"wJb3ENwgV7"},{"type":"inlineCode","value":"XRP/BTC","position":{"start":{"line":332,"column":1},"end":{"line":332,"column":1}},"key":"Uz94WVWtYR"},{"type":"text","value":" 使用 10% 的追踪止损，为 ","position":{"start":{"line":332,"column":1},"end":{"line":332,"column":1}},"key":"CdryZaZOIl"},{"type":"inlineCode","value":"LTC/BTC","position":{"start":{"line":332,"column":1},"end":{"line":332,"column":1}},"key":"OaiqDnnjLm"},{"type":"text","value":" 使用 5% 的追踪止损，并为所有其他交易对使用 15% 的追踪止损。","position":{"start":{"line":332,"column":1},"end":{"line":332,"column":1}},"key":"ncAfx6kMA7"}],"key":"Vw7qaYOclJ"},{"type":"code","lang":"python","value":"# Default imports\n\nclass AwesomeStrategy(IStrategy):\n\n    # ... populate_* 方法\n\n    use_custom_stoploss = True\n\n    def custom_stoploss(self, pair: str, trade: Trade, current_time: datetime,\n                        current_rate: float, current_profit: float, after_fill: bool,\n                        **kwargs) -\u003e float | None:\n\n        if pair in (\"ETH/BTC\", \"XRP/BTC\"):\n            return -0.10 * trade.leverage\n        elif pair in (\"LTC/BTC\"):\n            return -0.05 * trade.leverage\n        return -0.15 * trade.leverage","position":{"start":{"line":334,"column":1},"end":{"line":352,"column":1}},"key":"pg6WlnEmzQ"},{"type":"heading","depth":5,"position":{"start":{"line":354,"column":1},"end":{"line":354,"column":1}},"children":[{"type":"text","value":"带正偏移的追踪止损","position":{"start":{"line":354,"column":1},"end":{"line":354,"column":1}},"key":"QndoXYDQy4"}],"identifier":"id","label":"带正偏移的追踪止损","html_id":"id-9","implicit":true,"key":"i8SuxYxh2w"},{"type":"paragraph","position":{"start":{"line":356,"column":1},"end":{"line":356,"column":1}},"children":[{"type":"text","value":"在利润超过 4% 之前使用初始止损，然后使用当前利润的 50% 作为追踪止损，最小为 2.5%，最大为 5%。","position":{"start":{"line":356,"column":1},"end":{"line":356,"column":1}},"key":"Lkd2DmTLv6"}],"key":"vsniTdqA5U"},{"type":"paragraph","position":{"start":{"line":358,"column":1},"end":{"line":358,"column":1}},"children":[{"type":"text","value":"请注意，止损只能增加，低于当前止损的值将被忽略。","position":{"start":{"line":358,"column":1},"end":{"line":358,"column":1}},"key":"D45EUwS25U"}],"key":"dc0pKLLlRy"},{"type":"code","lang":"python","value":"# Default imports\n\nclass AwesomeStrategy(IStrategy):\n\n    # ... populate_* 方法\n\n    use_custom_stoploss = True\n\n    def custom_stoploss(self, pair: str, trade: Trade, current_time: datetime,\n                        current_rate: float, current_profit: float, after_fill: bool,\n                        **kwargs) -\u003e float | None:\n\n        if current_profit \u003c 0.04:\n            return None # 返回 None 以继续使用初始止损\n\n        # 达到所需偏移后，允许止损追踪一半的利润\n        desired_stoploss = current_profit / 2\n\n        # 使用最小 2.5% 和最大 5%\n        return max(min(desired_stoploss, 0.05), 0.025) * trade.leverage","position":{"start":{"line":360,"column":1},"end":{"line":381,"column":1}},"key":"Bj9doqTw0A"},{"type":"heading","depth":5,"position":{"start":{"line":383,"column":1},"end":{"line":383,"column":1}},"children":[{"type":"text","value":"阶梯式止损","position":{"start":{"line":383,"column":1},"end":{"line":383,"column":1}},"key":"Y2lGgG3vCJ"}],"identifier":"id","label":"阶梯式止损","html_id":"id-10","implicit":true,"key":"c3nPnbbxlv"},{"type":"paragraph","position":{"start":{"line":385,"column":1},"end":{"line":385,"column":1}},"children":[{"type":"text","value":"此示例不是连续追踪当前价格，而是根据当前利润设置固定的止损价格水平。","position":{"start":{"line":385,"column":1},"end":{"line":385,"column":1}},"key":"xkdvXrBYeT"}],"key":"TM5O2N35zr"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":387,"column":1},"end":{"line":391,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":387,"column":1},"end":{"line":387,"column":1}},"children":[{"type":"text","value":"在达到 20% 利润之前使用常规止损","position":{"start":{"line":387,"column":1},"end":{"line":387,"column":1}},"key":"CXKuhXN4Lx"}],"key":"HhnI5Uz4h3"},{"type":"listItem","spread":true,"position":{"start":{"line":388,"column":1},"end":{"line":388,"column":1}},"children":[{"type":"text","value":"一旦利润 \u003e 20% - 将止损设置为开仓价格上方 7%。","position":{"start":{"line":388,"column":1},"end":{"line":388,"column":1}},"key":"CfxWtWTuS0"}],"key":"sqEodGJbvA"},{"type":"listItem","spread":true,"position":{"start":{"line":389,"column":1},"end":{"line":389,"column":1}},"children":[{"type":"text","value":"一旦利润 \u003e 25% - 将止损设置为开仓价格上方 15%。","position":{"start":{"line":389,"column":1},"end":{"line":389,"column":1}},"key":"oHRG6l9p8m"}],"key":"DgrZnw7Ham"},{"type":"listItem","spread":true,"position":{"start":{"line":390,"column":1},"end":{"line":391,"column":1}},"children":[{"type":"text","value":"一旦利润 \u003e 40% - 将止损设置为开仓价格上方 25%。","position":{"start":{"line":390,"column":1},"end":{"line":390,"column":1}},"key":"pks8ekZ8ji"}],"key":"EK5GAzruHV"}],"key":"A48xS1QUWz"},{"type":"code","lang":"python","value":"# Default imports\n\nclass AwesomeStrategy(IStrategy):\n\n    # ... populate_* methods\n\n    use_custom_stoploss = True\n\n    def custom_stoploss(self, pair: str, trade: Trade, current_time: datetime,\n                        current_rate: float, current_profit: float, after_fill: bool,\n                        **kwargs) -\u003e float | None:\n\n        # evaluate highest to lowest, so that highest possible stop is used\n        if current_profit \u003e 0.40:\n            return stoploss_from_open(0.25, current_profit, is_short=trade.is_short, leverage=trade.leverage)\n        elif current_profit \u003e 0.25:\n            return stoploss_from_open(0.15, current_profit, is_short=trade.is_short, leverage=trade.leverage)\n        elif current_profit \u003e 0.20:\n            return stoploss_from_open(0.07, current_profit, is_short=trade.is_short, leverage=trade.leverage)\n\n        # return maximum stoploss value, keeping current stoploss price unchanged\n        return None","position":{"start":{"line":392,"column":1},"end":{"line":415,"column":1}},"key":"OceG0mxkbK"},{"type":"heading","depth":5,"position":{"start":{"line":417,"column":1},"end":{"line":417,"column":1}},"children":[{"type":"text","value":"使用数据框架中的指标实现自定义止损示例","position":{"start":{"line":417,"column":1},"end":{"line":417,"column":1}},"key":"ciHJSWdOZo"}],"identifier":"id","label":"使用数据框架中的指标实现自定义止损示例","html_id":"id-11","implicit":true,"key":"yYvDcj50vN"},{"type":"paragraph","position":{"start":{"line":419,"column":1},"end":{"line":419,"column":1}},"children":[{"type":"text","value":"绝对止损值可以从存储在数据框架中的指标派生。此示例使用价格下方的抛物线 SAR 作为止损。","position":{"start":{"line":419,"column":1},"end":{"line":419,"column":1}},"key":"tjiOyrBLAk"}],"key":"B9yEreF0Qm"},{"type":"code","lang":"python","value":"# Default imports\n\nclass AwesomeStrategy(IStrategy):\n\n    def populate_indicators(self, dataframe: DataFrame, metadata: dict) -\u003e DataFrame:\n        # \u003c...\u003e\n        dataframe[\"sar\"] = ta.SAR(dataframe)\n\n    use_custom_stoploss = True\n\n    def custom_stoploss(self, pair: str, trade: Trade, current_time: datetime,\n                        current_rate: float, current_profit: float, after_fill: bool,\n                        **kwargs) -\u003e float | None:\n\n        dataframe, _ = self.dp.get_analyzed_dataframe(pair, self.timeframe)\n        last_candle = dataframe.iloc[-1].squeeze()\n\n        # Use parabolic sar as absolute stoploss price\n        stoploss_price = last_candle[\"sar\"]\n\n        # Convert absolute price to percentage relative to current_rate\n        if stoploss_price \u003c current_rate:\n            return stoploss_from_absolute(stoploss_price, current_rate, is_short=trade.is_short)\n\n        # return maximum stoploss value, keeping current stoploss price unchanged\n        return None","position":{"start":{"line":421,"column":1},"end":{"line":448,"column":1}},"key":"h2mZAHCCBC"},{"type":"paragraph","position":{"start":{"line":450,"column":1},"end":{"line":450,"column":1}},"children":[{"type":"text","value":"有关在策略回调中使用数据框架的更多信息，请参见","position":{"start":{"line":450,"column":1},"end":{"line":450,"column":1}},"key":"dZweDfazMN"},{"type":"crossReference","url":"/strategy-advanced","position":{"start":{"line":450,"column":1},"end":{"line":450,"column":1}},"children":[{"type":"text","value":"数据框架访问","position":{"start":{"line":450,"column":1},"end":{"line":450,"column":1}},"key":"mQpFg7gV5R"}],"urlSource":"strategy-advanced.md#dataframe-access","dataUrl":"/strategy-advanced.json","identifier":"dataframe-access","label":"dataframe-access","remote":true,"protocol":"file","key":"cMNq7vlJWZ"},{"type":"text","value":"。","position":{"start":{"line":450,"column":1},"end":{"line":450,"column":1}},"key":"aUiQHqtfvi"}],"key":"xBMPx3qQeH"},{"type":"heading","depth":4,"position":{"start":{"line":452,"column":1},"end":{"line":452,"column":1}},"children":[{"type":"text","value":"止损计算的常用辅助函数","position":{"start":{"line":452,"column":1},"end":{"line":452,"column":1}},"key":"kkXBlJPad6"}],"identifier":"id","label":"止损计算的常用辅助函数","html_id":"id-12","implicit":true,"key":"WU0RMHJQXZ"},{"type":"heading","depth":5,"position":{"start":{"line":454,"column":1},"end":{"line":454,"column":1}},"children":[{"type":"text","value":"相对于开仓价格的止损","position":{"start":{"line":454,"column":1},"end":{"line":454,"column":1}},"key":"GzuGrUeMIH"}],"identifier":"id","label":"相对于开仓价格的止损","html_id":"id-13","implicit":true,"key":"zOKEgdFKX6"},{"type":"paragraph","position":{"start":{"line":456,"column":1},"end":{"line":457,"column":1}},"children":[{"type":"text","value":"从 ","position":{"start":{"line":456,"column":1},"end":{"line":456,"column":1}},"key":"c0OCwtdY80"},{"type":"inlineCode","value":"custom_stoploss()","position":{"start":{"line":456,"column":1},"end":{"line":456,"column":1}},"key":"bFfPezzHmD"},{"type":"text","value":" 返回的止损值必须指定相对于 ","position":{"start":{"line":456,"column":1},"end":{"line":456,"column":1}},"key":"qGrAA06adK"},{"type":"inlineCode","value":"current_rate","position":{"start":{"line":456,"column":1},"end":{"line":456,"column":1}},"key":"tYhubXqkkV"},{"type":"text","value":" 的百分比，但有时你可能想要指定相对于_开仓_价格的止损。\n","position":{"start":{"line":456,"column":1},"end":{"line":456,"column":1}},"key":"VybdFEQtqz"},{"type":"inlineCode","value":"stoploss_from_open()","position":{"start":{"line":456,"column":1},"end":{"line":456,"column":1}},"key":"Xm4c5MnoK4"},{"type":"text","value":" 是一个辅助函数，用于计算可以从 ","position":{"start":{"line":456,"column":1},"end":{"line":456,"column":1}},"key":"peCFnadpv0"},{"type":"inlineCode","value":"custom_stoploss","position":{"start":{"line":456,"column":1},"end":{"line":456,"column":1}},"key":"BDMog5hTsG"},{"type":"text","value":" 返回的止损值，该值将等同于开仓点上方所需的交易利润。","position":{"start":{"line":456,"column":1},"end":{"line":456,"column":1}},"key":"GfFVgJzvZh"}],"key":"Rq6lKz3L5p"},{"type":"admonition","kind":"hint","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"从自定义止损函数返回相对于开仓价格的止损","position":{"start":{"line":459,"column":1},"end":{"line":459,"column":1}},"key":"FnayLXHERM"}],"key":"RZTjB3L53A"},{"type":"paragraph","position":{"start":{"line":461,"column":1},"end":{"line":461,"column":1}},"children":[{"type":"text","value":"假设开仓价格为 $100，","position":{"start":{"line":461,"column":1},"end":{"line":461,"column":1}},"key":"YBQg2sOCog"},{"type":"inlineCode","value":"current_price","position":{"start":{"line":461,"column":1},"end":{"line":461,"column":1}},"key":"zX2wCVs58G"},{"type":"text","value":" 为 $121（","position":{"start":{"line":461,"column":1},"end":{"line":461,"column":1}},"key":"WLtXNyhuFG"},{"type":"inlineCode","value":"current_profit","position":{"start":{"line":461,"column":1},"end":{"line":461,"column":1}},"key":"l3aEdq6Kx4"},{"type":"text","value":" 将为 ","position":{"start":{"line":461,"column":1},"end":{"line":461,"column":1}},"key":"qmo9trrhJZ"},{"type":"inlineCode","value":"0.21","position":{"start":{"line":461,"column":1},"end":{"line":461,"column":1}},"key":"J7iZJpgh72"},{"type":"text","value":"）。","position":{"start":{"line":461,"column":1},"end":{"line":461,"column":1}},"key":"jXxVuf9EaN"}],"key":"OZT0tYzgaI"},{"type":"paragraph","position":{"start":{"line":463,"column":1},"end":{"line":463,"column":1}},"children":[{"type":"text","value":"如果我们想要在开仓价格上方 7% 设置止损价格，我们可以调用 ","position":{"start":{"line":463,"column":1},"end":{"line":463,"column":1}},"key":"AKQh0dBdJc"},{"type":"inlineCode","value":"stoploss_from_open(0.07, current_profit, False)","position":{"start":{"line":463,"column":1},"end":{"line":463,"column":1}},"key":"o8PgxYK0A0"},{"type":"text","value":"，它将返回 ","position":{"start":{"line":463,"column":1},"end":{"line":463,"column":1}},"key":"AYZIBbZmLP"},{"type":"inlineCode","value":"0.1157024793","position":{"start":{"line":463,"column":1},"end":{"line":463,"column":1}},"key":"dGhslNGptE"},{"type":"text","value":"。$121 下方 11.57% 是 $107，这与 $100 上方 7% 相同。","position":{"start":{"line":463,"column":1},"end":{"line":463,"column":1}},"key":"REZXibRIwl"}],"key":"Npa4iQYxkP"},{"type":"paragraph","position":{"start":{"line":465,"column":1},"end":{"line":465,"column":1}},"children":[{"type":"text","value":"此函数会考虑杠杆 - 所以在 10 倍杠杆下，实际止损将是 $100 上方 0.7%（0.7% * 10x = 7%）。","position":{"start":{"line":465,"column":1},"end":{"line":465,"column":1}},"key":"YAVhIsfB3P"}],"key":"ldCUqTqbGb"},{"type":"code","lang":"python","value":"# Default imports\n\nclass AwesomeStrategy(IStrategy):\n\n    # ... populate_* methods\n\n    use_custom_stoploss = True\n\n    def custom_stoploss(self, pair: str, trade: Trade, current_time: datetime,\n                        current_rate: float, current_profit: float, after_fill: bool,\n                        **kwargs) -\u003e float | None:\n\n        # once the profit has risen above 10%, keep the stoploss at 7% above the open price\n        if current_profit \u003e 0.10:\n            return stoploss_from_open(0.07, current_profit, is_short=trade.is_short, leverage=trade.leverage)\n\n        return 1\n","position":{"start":{"line":467,"column":1},"end":{"line":486,"column":1}},"key":"JrrHp6OTkE"},{"type":"paragraph","position":{"start":{"line":488,"column":1},"end":{"line":488,"column":1}},"children":[{"type":"text","value":"完整示例可以在文档的","position":{"start":{"line":488,"column":1},"end":{"line":488,"column":1}},"key":"YVoKffWp9m"},{"type":"crossReference","url":"/strategy-callbacks","position":{"start":{"line":488,"column":1},"end":{"line":488,"column":1}},"children":[{"type":"text","value":"自定义止损","position":{"start":{"line":488,"column":1},"end":{"line":488,"column":1}},"key":"BgnqlX10ZG"}],"urlSource":"strategy-callbacks.md#custom-stoploss","dataUrl":"/strategy-callbacks.json","identifier":"custom-stoploss","label":"custom-stoploss","remote":true,"protocol":"file","kind":"heading","template":"{name}","resolved":true,"html_id":"custom-stoploss","key":"WeOz2FmTQ2"},{"type":"text","value":"部分找到。","position":{"start":{"line":488,"column":1},"end":{"line":488,"column":1}},"key":"MwX7gHOOWU"}],"key":"wQZDpPTX3a"}],"key":"VL8oKH2XBv"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"Hbj4x7znUL"}],"key":"TTHofGDbmM"},{"type":"paragraph","position":{"start":{"line":492,"column":1},"end":{"line":493,"column":1}},"children":[{"type":"text","value":"向 ","position":{"start":{"line":492,"column":1},"end":{"line":492,"column":1}},"key":"ksvJ0Bkoci"},{"type":"inlineCode","value":"stoploss_from_open()","position":{"start":{"line":492,"column":1},"end":{"line":492,"column":1}},"key":"K7tZbH2cxX"},{"type":"text","value":" 提供无效输入可能会产生\"CustomStoploss 函数未返回有效止损\"警告。\n如果 ","position":{"start":{"line":492,"column":1},"end":{"line":492,"column":1}},"key":"jm4SrOcjzi"},{"type":"inlineCode","value":"current_profit","position":{"start":{"line":492,"column":1},"end":{"line":492,"column":1}},"key":"rTWBYMRc14"},{"type":"text","value":" 参数低于指定的 ","position":{"start":{"line":492,"column":1},"end":{"line":492,"column":1}},"key":"ap79ttkpU7"},{"type":"inlineCode","value":"open_relative_stop","position":{"start":{"line":492,"column":1},"end":{"line":492,"column":1}},"key":"GPkdWwACJ2"},{"type":"text","value":"，这种情况可能会发生。当交易关闭被 ","position":{"start":{"line":492,"column":1},"end":{"line":492,"column":1}},"key":"hKiYVlHx9z"},{"type":"inlineCode","value":"confirm_trade_exit()","position":{"start":{"line":492,"column":1},"end":{"line":492,"column":1}},"key":"IwNVv43wyh"},{"type":"text","value":" 方法阻止时，可能会出现这种情况。可以通过在 ","position":{"start":{"line":492,"column":1},"end":{"line":492,"column":1}},"key":"hHoICM8PV3"},{"type":"inlineCode","value":"confirm_trade_exit()","position":{"start":{"line":492,"column":1},"end":{"line":492,"column":1}},"key":"YnkmhCd890"},{"type":"text","value":" 中检查 ","position":{"start":{"line":492,"column":1},"end":{"line":492,"column":1}},"key":"N8qClP21JB"},{"type":"inlineCode","value":"exit_reason","position":{"start":{"line":492,"column":1},"end":{"line":492,"column":1}},"key":"CV0nNaDu3D"},{"type":"text","value":" 来永不阻止止损卖出，或者使用 ","position":{"start":{"line":492,"column":1},"end":{"line":492,"column":1}},"key":"jdH0OWB6GZ"},{"type":"inlineCode","value":"return stoploss_from_open(...) or 1","position":{"start":{"line":492,"column":1},"end":{"line":492,"column":1}},"key":"TRwetK1YXO"},{"type":"text","value":" 惯用法来解决警告，这将在 ","position":{"start":{"line":492,"column":1},"end":{"line":492,"column":1}},"key":"pvuKlS6GK7"},{"type":"inlineCode","value":"current_profit \u003c open_relative_stop","position":{"start":{"line":492,"column":1},"end":{"line":492,"column":1}},"key":"QmJlACPJAA"},{"type":"text","value":" 时请求不更改止损。","position":{"start":{"line":492,"column":1},"end":{"line":492,"column":1}},"key":"PR6zgPRofE"}],"key":"ZiZRQ8m9qN"}],"key":"YhB2fG9GXO"},{"type":"heading","depth":5,"position":{"start":{"line":496,"column":1},"end":{"line":496,"column":1}},"children":[{"type":"text","value":"从绝对价格计算止损百分比","position":{"start":{"line":496,"column":1},"end":{"line":496,"column":1}},"key":"HzWg02aq4n"}],"identifier":"id","label":"从绝对价格计算止损百分比","html_id":"id-14","implicit":true,"key":"d5RfXYTCgQ"},{"type":"paragraph","position":{"start":{"line":498,"column":1},"end":{"line":498,"column":1}},"children":[{"type":"text","value":"从 ","position":{"start":{"line":498,"column":1},"end":{"line":498,"column":1}},"key":"LGcOAFhZaA"},{"type":"inlineCode","value":"custom_stoploss()","position":{"start":{"line":498,"column":1},"end":{"line":498,"column":1}},"key":"siuPO3sQRa"},{"type":"text","value":" 返回的止损值始终指定相对于 ","position":{"start":{"line":498,"column":1},"end":{"line":498,"column":1}},"key":"KUBliu9LD4"},{"type":"inlineCode","value":"current_rate","position":{"start":{"line":498,"column":1},"end":{"line":498,"column":1}},"key":"gYnEO41KmR"},{"type":"text","value":" 的百分比。为了在指定的绝对价格水平设置止损，我们需要使用 ","position":{"start":{"line":498,"column":1},"end":{"line":498,"column":1}},"key":"SVkC8qlfVj"},{"type":"inlineCode","value":"stop_rate","position":{"start":{"line":498,"column":1},"end":{"line":498,"column":1}},"key":"rjQnuuzlvF"},{"type":"text","value":" 来计算相对于 ","position":{"start":{"line":498,"column":1},"end":{"line":498,"column":1}},"key":"UyOOuZGW97"},{"type":"inlineCode","value":"current_rate","position":{"start":{"line":498,"column":1},"end":{"line":498,"column":1}},"key":"iWaR0odjpI"},{"type":"text","value":" 的百分比，这将给出与从开仓价格指定百分比相同的结果。","position":{"start":{"line":498,"column":1},"end":{"line":498,"column":1}},"key":"xmVMnJpTvv"}],"key":"oSw7kuCLL0"},{"type":"paragraph","position":{"start":{"line":500,"column":1},"end":{"line":500,"column":1}},"children":[{"type":"text","value":"辅助函数 ","position":{"start":{"line":500,"column":1},"end":{"line":500,"column":1}},"key":"fKqwLdZhYu"},{"type":"inlineCode","value":"stoploss_from_absolute()","position":{"start":{"line":500,"column":1},"end":{"line":500,"column":1}},"key":"mX2bELkbjg"},{"type":"text","value":" 可用于将绝对价格转换为可以从 ","position":{"start":{"line":500,"column":1},"end":{"line":500,"column":1}},"key":"Q5o3CRTmGA"},{"type":"inlineCode","value":"custom_stoploss()","position":{"start":{"line":500,"column":1},"end":{"line":500,"column":1}},"key":"W9PnkKFRcM"},{"type":"text","value":" 返回的当前价格相对止损。","position":{"start":{"line":500,"column":1},"end":{"line":500,"column":1}},"key":"pKa6Lsgh42"}],"key":"zvVd5D7wSj"},{"type":"admonition","kind":"hint","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"从自定义止损函数返回使用绝对价格的止损","position":{"start":{"line":502,"column":1},"end":{"line":502,"column":1}},"key":"d4s8AUlWq8"}],"key":"l1pMtH7xaZ"},{"type":"paragraph","position":{"start":{"line":504,"column":1},"end":{"line":505,"column":1}},"children":[{"type":"text","value":"如果我们想要在当前价格下方 2xATR 追踪止损价格，我们可以调用 ","position":{"start":{"line":504,"column":1},"end":{"line":504,"column":1}},"key":"x3DQxxhSVy"},{"type":"inlineCode","value":"stoploss_from_absolute(current_rate + (side * candle[\"atr\"] * 2), current_rate=current_rate, is_short=trade.is_short, leverage=trade.leverage)","position":{"start":{"line":504,"column":1},"end":{"line":504,"column":1}},"key":"bYBVm6u18B"},{"type":"text","value":"。\n对于期货，我们需要调整方向（向上或向下）以及调整杠杆，因为 ","position":{"start":{"line":504,"column":1},"end":{"line":504,"column":1}},"key":"YsMGzYgKEb"},{"type":"crossReference","url":"/strategy-callbacks","position":{"start":{"line":504,"column":1},"end":{"line":504,"column":1}},"children":[{"type":"inlineCode","value":"custom_stoploss","position":{"start":{"line":504,"column":1},"end":{"line":504,"column":1}},"key":"z7Z5kPZVSH"}],"urlSource":"strategy-callbacks.md#custom-stoploss","dataUrl":"/strategy-callbacks.json","identifier":"custom-stoploss","label":"custom-stoploss","remote":true,"protocol":"file","kind":"heading","template":"{name}","resolved":true,"html_id":"custom-stoploss","key":"ebZfFZ5o9F"},{"type":"text","value":" 回调返回的是","position":{"start":{"line":504,"column":1},"end":{"line":504,"column":1}},"key":"GnPawHmc87"},{"type":"crossReference","url":"/stoploss","position":{"start":{"line":504,"column":1},"end":{"line":504,"column":1}},"children":[{"type":"text","value":"\"此交易的风险\"","position":{"start":{"line":504,"column":1},"end":{"line":504,"column":1}},"key":"W4QILQkPQJ"}],"urlSource":"stoploss.md#stoploss-and-leverage","dataUrl":"/stoploss.json","identifier":"stoploss-and-leverage","label":"stoploss-and-leverage","remote":true,"protocol":"file","key":"mIEJo8JdHK"},{"type":"text","value":" - 而不是相对价格变动。","position":{"start":{"line":504,"column":1},"end":{"line":504,"column":1}},"key":"hhtGN3T1Pw"}],"key":"ukhAH5dBPJ"},{"type":"code","lang":"python","value":"# Default imports\n\nclass AwesomeStrategy(IStrategy):\n\n    use_custom_stoploss = True\n\n    def populate_indicators(self, dataframe: DataFrame, metadata: dict) -\u003e DataFrame:\n        dataframe[\"atr\"] = ta.ATR(dataframe, timeperiod=14)\n        return dataframe\n\n    def custom_stoploss(self, pair: str, trade: Trade, current_time: datetime,\n                        current_rate: float, current_profit: float, after_fill: bool,\n                        **kwargs) -\u003e float | None:\n        dataframe, _ = self.dp.get_analyzed_dataframe(pair, self.timeframe)\n        trade_date = timeframe_to_prev_date(self.timeframe, trade.open_date_utc)\n        candle = dataframe.iloc[-1].squeeze()\n        side = 1 if trade.is_short else -1\n        return stoploss_from_absolute(current_rate + (side * candle[\"atr\"] * 2), \n                                        current_rate=current_rate, \n                                        is_short=trade.is_short,\n                                        leverage=trade.leverage)\n","position":{"start":{"line":507,"column":1},"end":{"line":530,"column":1}},"key":"MPqm0pV4sP"}],"key":"xVR0ExdpJc"},{"type":"thematicBreak","position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"key":"jbj6LQYkzY"},{"type":"heading","depth":3,"position":{"start":{"line":536,"column":1},"end":{"line":536,"column":1}},"children":[{"type":"text","value":"自定义 ROI","position":{"start":{"line":536,"column":1},"end":{"line":536,"column":1}},"key":"xRs7EtcQXw"}],"identifier":"id-roi","label":"自定义 ROI","html_id":"id-roi","implicit":true,"key":"uLPaxK54x5"},{"type":"paragraph","position":{"start":{"line":538,"column":1},"end":{"line":538,"column":1}},"children":[{"type":"text","value":"对开放交易每次迭代（大约每 5 秒）调用，直到交易关闭。","position":{"start":{"line":538,"column":1},"end":{"line":538,"column":1}},"key":"GtmuQgZ4z9"}],"key":"FthiT2mz5K"},{"type":"paragraph","position":{"start":{"line":540,"column":1},"end":{"line":540,"column":1}},"children":[{"type":"text","value":"必须通过在策略对象上设置 ","position":{"start":{"line":540,"column":1},"end":{"line":540,"column":1}},"key":"D1IspRkdF3"},{"type":"inlineCode","value":"use_custom_roi=True","position":{"start":{"line":540,"column":1},"end":{"line":540,"column":1}},"key":"MXKYfkreIM"},{"type":"text","value":" 来启用自定义 ROI 方法的使用。","position":{"start":{"line":540,"column":1},"end":{"line":540,"column":1}},"key":"zzzBDj9ssl"}],"key":"H42oDKQNxK"},{"type":"paragraph","position":{"start":{"line":542,"column":1},"end":{"line":542,"column":1}},"children":[{"type":"text","value":"此方法允许你定义退出交易的自定义最小 ROI 阈值，以比率表示（例如，","position":{"start":{"line":542,"column":1},"end":{"line":542,"column":1}},"key":"GiD44Qh7lP"},{"type":"inlineCode","value":"0.05","position":{"start":{"line":542,"column":1},"end":{"line":542,"column":1}},"key":"Cgf82WilOo"},{"type":"text","value":" 表示 5% 利润）。如果同时定义了 ","position":{"start":{"line":542,"column":1},"end":{"line":542,"column":1}},"key":"V8RMME1UWC"},{"type":"inlineCode","value":"minimal_roi","position":{"start":{"line":542,"column":1},"end":{"line":542,"column":1}},"key":"oipuiqSBox"},{"type":"text","value":" 和 ","position":{"start":{"line":542,"column":1},"end":{"line":542,"column":1}},"key":"C2RHMtVmZk"},{"type":"inlineCode","value":"custom_roi","position":{"start":{"line":542,"column":1},"end":{"line":542,"column":1}},"key":"cYQK603Z1T"},{"type":"text","value":"，则较低的阈值将触发退出。例如，如果 ","position":{"start":{"line":542,"column":1},"end":{"line":542,"column":1}},"key":"uU1YS9FnRY"},{"type":"inlineCode","value":"minimal_roi","position":{"start":{"line":542,"column":1},"end":{"line":542,"column":1}},"key":"EWVYON5uhH"},{"type":"text","value":" 设置为 ","position":{"start":{"line":542,"column":1},"end":{"line":542,"column":1}},"key":"wR1vQmcvJe"},{"type":"inlineCode","value":"{\"0\": 0.10}","position":{"start":{"line":542,"column":1},"end":{"line":542,"column":1}},"key":"vw2ypShj76"},{"type":"text","value":"（0 分钟时为 10%）且 ","position":{"start":{"line":542,"column":1},"end":{"line":542,"column":1}},"key":"sPR1wV1NiR"},{"type":"inlineCode","value":"custom_roi","position":{"start":{"line":542,"column":1},"end":{"line":542,"column":1}},"key":"sE7iNr0WG0"},{"type":"text","value":" 返回 ","position":{"start":{"line":542,"column":1},"end":{"line":542,"column":1}},"key":"SSLdHaoSgK"},{"type":"inlineCode","value":"0.05","position":{"start":{"line":542,"column":1},"end":{"line":542,"column":1}},"key":"U64t4gz53m"},{"type":"text","value":"，则当利润达到 5% 时交易将退出。同样，如果 ","position":{"start":{"line":542,"column":1},"end":{"line":542,"column":1}},"key":"w3jscZqa7Z"},{"type":"inlineCode","value":"custom_roi","position":{"start":{"line":542,"column":1},"end":{"line":542,"column":1}},"key":"BfyduxHu43"},{"type":"text","value":" 返回 ","position":{"start":{"line":542,"column":1},"end":{"line":542,"column":1}},"key":"eYWQ3QQ1sC"},{"type":"inlineCode","value":"0.10","position":{"start":{"line":542,"column":1},"end":{"line":542,"column":1}},"key":"F4CabkOE6c"},{"type":"text","value":" 且 ","position":{"start":{"line":542,"column":1},"end":{"line":542,"column":1}},"key":"iCAWE57EA2"},{"type":"inlineCode","value":"minimal_roi","position":{"start":{"line":542,"column":1},"end":{"line":542,"column":1}},"key":"zjJUOYi6bW"},{"type":"text","value":" 设置为 ","position":{"start":{"line":542,"column":1},"end":{"line":542,"column":1}},"key":"FNYmNvd02j"},{"type":"inlineCode","value":"{\"0\": 0.05}","position":{"start":{"line":542,"column":1},"end":{"line":542,"column":1}},"key":"YCAKMYpVW8"},{"type":"text","value":"（0 分钟时为 5%），则当利润达到 5% 时交易将关闭。","position":{"start":{"line":542,"column":1},"end":{"line":542,"column":1}},"key":"RIIcvZH0jQ"}],"key":"AHWofH9EkJ"},{"type":"paragraph","position":{"start":{"line":544,"column":1},"end":{"line":544,"column":1}},"children":[{"type":"text","value":"该方法必须返回一个表示新 ROI 阈值的浮点数比率，或返回 ","position":{"start":{"line":544,"column":1},"end":{"line":544,"column":1}},"key":"u1IZb7yvaw"},{"type":"inlineCode","value":"None","position":{"start":{"line":544,"column":1},"end":{"line":544,"column":1}},"key":"A1MQaVHegs"},{"type":"text","value":" 以回退到 ","position":{"start":{"line":544,"column":1},"end":{"line":544,"column":1}},"key":"EDWBe2zzOk"},{"type":"inlineCode","value":"minimal_roi","position":{"start":{"line":544,"column":1},"end":{"line":544,"column":1}},"key":"l40EAF3YaS"},{"type":"text","value":" 逻辑。返回 ","position":{"start":{"line":544,"column":1},"end":{"line":544,"column":1}},"key":"yg8KNsuoi7"},{"type":"inlineCode","value":"NaN","position":{"start":{"line":544,"column":1},"end":{"line":544,"column":1}},"key":"vBvEMkbkfs"},{"type":"text","value":" 或 ","position":{"start":{"line":544,"column":1},"end":{"line":544,"column":1}},"key":"aUdN0EQ12b"},{"type":"inlineCode","value":"inf","position":{"start":{"line":544,"column":1},"end":{"line":544,"column":1}},"key":"aR0mgww0uJ"},{"type":"text","value":" 值被视为无效，将被视为 ","position":{"start":{"line":544,"column":1},"end":{"line":544,"column":1}},"key":"TLUmVRrYBf"},{"type":"inlineCode","value":"None","position":{"start":{"line":544,"column":1},"end":{"line":544,"column":1}},"key":"EOAHVXtyrb"},{"type":"text","value":"，导致机器人使用 ","position":{"start":{"line":544,"column":1},"end":{"line":544,"column":1}},"key":"P5imWZT1cq"},{"type":"inlineCode","value":"minimal_roi","position":{"start":{"line":544,"column":1},"end":{"line":544,"column":1}},"key":"svxhMGWFTM"},{"type":"text","value":" 配置。","position":{"start":{"line":544,"column":1},"end":{"line":544,"column":1}},"key":"orpqIx12cW"}],"key":"hiigvg9WsO"},{"type":"heading","depth":4,"position":{"start":{"line":546,"column":1},"end":{"line":546,"column":1}},"children":[{"type":"text","value":"自定义 ROI 示例","position":{"start":{"line":546,"column":1},"end":{"line":546,"column":1}},"key":"on2UgbxWV1"}],"identifier":"id-roi","label":"自定义 ROI 示例","html_id":"id-roi-1","implicit":true,"key":"RcPyxRwSMd"},{"type":"paragraph","position":{"start":{"line":548,"column":1},"end":{"line":548,"column":1}},"children":[{"type":"text","value":"以下示例说明如何使用 ","position":{"start":{"line":548,"column":1},"end":{"line":548,"column":1}},"key":"BABQ59n3OM"},{"type":"inlineCode","value":"custom_roi","position":{"start":{"line":548,"column":1},"end":{"line":548,"column":1}},"key":"sMM2Z1IwOr"},{"type":"text","value":" 函数实现不同的 ROI 逻辑。","position":{"start":{"line":548,"column":1},"end":{"line":548,"column":1}},"key":"we67GBZEDD"}],"key":"hD7iJW4v39"},{"type":"heading","depth":5,"position":{"start":{"line":550,"column":1},"end":{"line":550,"column":1}},"children":[{"type":"text","value":"按交易方向自定义 ROI","position":{"start":{"line":550,"column":1},"end":{"line":550,"column":1}},"key":"fnt3RoNi29"}],"identifier":"id-roi","label":"按交易方向自定义 ROI","html_id":"id-roi-2","implicit":true,"key":"KCseHenyN5"},{"type":"paragraph","position":{"start":{"line":552,"column":1},"end":{"line":552,"column":1}},"children":[{"type":"text","value":"根据 ","position":{"start":{"line":552,"column":1},"end":{"line":552,"column":1}},"key":"fGA0kPaUfn"},{"type":"inlineCode","value":"side","position":{"start":{"line":552,"column":1},"end":{"line":552,"column":1}},"key":"o3ER2vct3g"},{"type":"text","value":" 使用不同的 ROI 阈值。在此示例中，多头入场为 5%，空头入场为 2%。","position":{"start":{"line":552,"column":1},"end":{"line":552,"column":1}},"key":"MXSroL9yaf"}],"key":"q6AfLdSHRI"},{"type":"code","lang":"python","value":"# Default imports\n\nclass AwesomeStrategy(IStrategy):\n\n    use_custom_roi = True\n\n    # ... populate_* methods\n\n    def custom_roi(self, pair: str, trade: Trade, current_time: datetime, trade_duration: int,\n                   entry_tag: str | None, side: str, **kwargs) -\u003e float | None:\n        \"\"\"\n        自定义 ROI 逻辑，返回新的最小 ROI 阈值（以比率表示，例如 0.05 表示 +5%）。\n        仅在 use_custom_roi 设置为 True 时调用。\n\n        如果与 minimal_roi 同时使用，当达到较低的阈值时将触发退出。\n        示例：如果 minimal_roi = {\"0\": 0.01} 且 custom_roi 返回 0.05，\n        当利润达到 5% 时将触发退出。\n\n        :param pair: 当前分析的交易对。\n        :param trade: 交易对象。\n        :param current_time: datetime 对象，包含当前日期时间。\n        :param trade_duration: 当前交易持续时间（分钟）。\n        :param entry_tag: 如果买入信号提供了可选的 entry_tag（buy_tag）。\n        :param side: 'long' 或 'short' - 表示当前交易的方向。\n        :param **kwargs: 确保保留此参数，以便更新不会破坏你的策略。\n        :return float: 新的 ROI 值（比率），或 None 以回退到 minimal_roi 逻辑。\n        \"\"\"\n        return 0.05 if side == \"long\" else 0.02","position":{"start":{"line":554,"column":1},"end":{"line":583,"column":1}},"key":"CMqxKngJjL"},{"type":"heading","depth":5,"position":{"start":{"line":585,"column":1},"end":{"line":585,"column":1}},"children":[{"type":"text","value":"按交易对自定义 ROI","position":{"start":{"line":585,"column":1},"end":{"line":585,"column":1}},"key":"KykVTlfkWH"}],"identifier":"id-roi","label":"按交易对自定义 ROI","html_id":"id-roi-3","implicit":true,"key":"HzBBs99AvJ"},{"type":"paragraph","position":{"start":{"line":587,"column":1},"end":{"line":587,"column":1}},"children":[{"type":"text","value":"根据 ","position":{"start":{"line":587,"column":1},"end":{"line":587,"column":1}},"key":"uF6us3PpYG"},{"type":"inlineCode","value":"pair","position":{"start":{"line":587,"column":1},"end":{"line":587,"column":1}},"key":"y8XoIUcmXC"},{"type":"text","value":" 使用不同的 ROI 阈值。","position":{"start":{"line":587,"column":1},"end":{"line":587,"column":1}},"key":"cZfH23Qh3T"}],"key":"wShISkIVXv"},{"type":"code","lang":"python","value":"# Default imports\n\nclass AwesomeStrategy(IStrategy):\n\n    use_custom_roi = True\n\n    # ... populate_* methods\n\n    def custom_roi(self, pair: str, trade: Trade, current_time: datetime, trade_duration: int,\n                   entry_tag: str | None, side: str, **kwargs) -\u003e float | None:\n\n        stake = trade.stake_currency\n        roi_map = {\n            f\"BTC/{stake}\": 0.02, # BTC 为 2%\n            f\"ETH/{stake}\": 0.03, # ETH 为 3%\n            f\"XRP/{stake}\": 0.04, # XRP 为 4%\n        }\n\n        return roi_map.get(pair, 0.01) # 其他交易对为 1%","position":{"start":{"line":589,"column":1},"end":{"line":609,"column":1}},"key":"phhPlaIhjX"},{"type":"heading","depth":5,"position":{"start":{"line":611,"column":1},"end":{"line":611,"column":1}},"children":[{"type":"text","value":"按入场标签自定义 ROI","position":{"start":{"line":611,"column":1},"end":{"line":611,"column":1}},"key":"GXN8BmM88H"}],"identifier":"id-roi","label":"按入场标签自定义 ROI","html_id":"id-roi-4","implicit":true,"key":"iWhmC5yEqM"},{"type":"paragraph","position":{"start":{"line":613,"column":1},"end":{"line":613,"column":1}},"children":[{"type":"text","value":"根据买入信号提供的 ","position":{"start":{"line":613,"column":1},"end":{"line":613,"column":1}},"key":"APnVMK3ZM4"},{"type":"inlineCode","value":"entry_tag","position":{"start":{"line":613,"column":1},"end":{"line":613,"column":1}},"key":"SDi9TwXx26"},{"type":"text","value":" 使用不同的 ROI 阈值。","position":{"start":{"line":613,"column":1},"end":{"line":613,"column":1}},"key":"KmAm1bt1vj"}],"key":"ffzaRXRfiQ"},{"type":"code","lang":"python","value":"# Default imports\n\nclass AwesomeStrategy(IStrategy):\n\n    use_custom_roi = True\n\n    # ... populate_* methods\n\n    def custom_roi(self, pair: str, trade: Trade, current_time: datetime, trade_duration: int,\n                   entry_tag: str | None, side: str, **kwargs) -\u003e float | None:\n\n        roi_by_tag = {\n            \"breakout\": 0.08,       # 如果标签是 \"breakout\" 则为 8%\n            \"rsi_overbought\": 0.05, # 如果标签是 \"rsi_overbought\" 则为 5%\n            \"mean_reversion\": 0.03, # 如果标签是 \"mean_reversion\" 则为 3%\n        }\n\n        return roi_by_tag.get(entry_tag, 0.01)  # 如果标签未知则为 1%","position":{"start":{"line":615,"column":1},"end":{"line":634,"column":1}},"key":"FZbRWIVd5P"},{"type":"heading","depth":5,"position":{"start":{"line":636,"column":1},"end":{"line":636,"column":1}},"children":[{"type":"text","value":"基于 ATR 的自定义 ROI","position":{"start":{"line":636,"column":1},"end":{"line":636,"column":1}},"key":"nbkpvUK71w"}],"identifier":"id-atr-roi","label":"基于 ATR 的自定义 ROI","html_id":"id-atr-roi","implicit":true,"key":"WMCaiUF5Zb"},{"type":"paragraph","position":{"start":{"line":638,"column":1},"end":{"line":638,"column":1}},"children":[{"type":"text","value":"ROI 值可以从存储在数据框架中的指标派生。此示例使用 ATR 比率作为 ROI。","position":{"start":{"line":638,"column":1},"end":{"line":638,"column":1}},"key":"yeTpNK4soh"}],"key":"auvWFE0wb8"},{"type":"code","lang":"python","value":"# Default imports\n# \u003c...\u003e\nimport talib.abstract as ta\n\nclass AwesomeStrategy(IStrategy):\n\n    use_custom_roi = True\n\n    def populate_indicators(self, dataframe: DataFrame, metadata: dict) -\u003e DataFrame:\n        # \u003c...\u003e\n        dataframe[\"atr\"] = ta.ATR(dataframe, timeperiod=10)\n\n    def custom_roi(self, pair: str, trade: Trade, current_time: datetime, trade_duration: int,\n                   entry_tag: str | None, side: str, **kwargs) -\u003e float | None:\n\n        dataframe, _ = self.dp.get_analyzed_dataframe(pair, self.timeframe)\n        last_candle = dataframe.iloc[-1].squeeze()\n        atr_ratio = last_candle[\"atr\"] / last_candle[\"close\"]\n\n        return atr_ratio # 返回 ATR 值作为比率","position":{"start":{"line":640,"column":1},"end":{"line":661,"column":1}},"key":"j4QIW7LDKM"},{"type":"thematicBreak","position":{"start":{"line":663,"column":1},"end":{"line":663,"column":1}},"key":"nslHHVfBul"},{"type":"heading","depth":3,"position":{"start":{"line":665,"column":1},"end":{"line":665,"column":1}},"children":[{"type":"text","value":"自定义订单价格规则","position":{"start":{"line":665,"column":1},"end":{"line":665,"column":1}},"key":"JecpSDkfyT"}],"identifier":"id","label":"自定义订单价格规则","html_id":"id-15","implicit":true,"key":"qs7fNdfJ4D"},{"type":"paragraph","position":{"start":{"line":667,"column":1},"end":{"line":667,"column":1}},"children":[{"type":"text","value":"默认情况下，freqtrade 使用订单簿自动设置订单价格（","position":{"start":{"line":667,"column":1},"end":{"line":667,"column":1}},"key":"cT64aoLoot"},{"type":"crossReference","url":"/configuration","position":{"start":{"line":667,"column":1},"end":{"line":667,"column":1}},"children":[{"type":"text","value":"相关文档","position":{"start":{"line":667,"column":1},"end":{"line":667,"column":1}},"key":"aY5TiHnR2o"}],"urlSource":"configuration.md#prices-used-for-orders","dataUrl":"/configuration.json","identifier":"prices-used-for-orders","label":"prices-used-for-orders","remote":true,"protocol":"file","key":"At2aeSmDVJ"},{"type":"text","value":"），你也可以选择基于你的策略创建自定义订单价格。","position":{"start":{"line":667,"column":1},"end":{"line":667,"column":1}},"key":"m4xMLghsQb"}],"key":"kHmgENoELB"},{"type":"paragraph","position":{"start":{"line":669,"column":1},"end":{"line":669,"column":1}},"children":[{"type":"text","value":"你可以通过在策略文件中创建 ","position":{"start":{"line":669,"column":1},"end":{"line":669,"column":1}},"key":"pY75QSlEu2"},{"type":"inlineCode","value":"custom_entry_price()","position":{"start":{"line":669,"column":1},"end":{"line":669,"column":1}},"key":"M16pXb6bFl"},{"type":"text","value":" 函数自定义入场价格，以及 ","position":{"start":{"line":669,"column":1},"end":{"line":669,"column":1}},"key":"kyRdfKVNBV"},{"type":"inlineCode","value":"custom_exit_price()","position":{"start":{"line":669,"column":1},"end":{"line":669,"column":1}},"key":"N7j89eSLk5"},{"type":"text","value":" 函数自定义出场价格。","position":{"start":{"line":669,"column":1},"end":{"line":669,"column":1}},"key":"mf9vogPUML"}],"key":"vzQrVFt3zC"},{"type":"paragraph","position":{"start":{"line":671,"column":1},"end":{"line":671,"column":1}},"children":[{"type":"text","value":"每个方法都会在向交易所下单前被调用。","position":{"start":{"line":671,"column":1},"end":{"line":671,"column":1}},"key":"kodUh5FC9d"}],"key":"zIAX6yhmnX"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Tip","key":"Q2ZyPpT7VF"}],"key":"R58s16sYsW"},{"type":"paragraph","position":{"start":{"line":674,"column":1},"end":{"line":674,"column":1}},"children":[{"type":"text","value":"如果你的自定义定价函数返回 None 或无效值，价格将回退到 ","position":{"start":{"line":674,"column":1},"end":{"line":674,"column":1}},"key":"SiwGQEjQUH"},{"type":"inlineCode","value":"proposed_rate","position":{"start":{"line":674,"column":1},"end":{"line":674,"column":1}},"key":"a4SauDwv1E"},{"type":"text","value":"，即基于常规定价配置的价格。","position":{"start":{"line":674,"column":1},"end":{"line":674,"column":1}},"key":"RWL1JKPCX2"}],"key":"HO2RFNslcL"},{"type":"paragraph","position":{"start":{"line":676,"column":1},"end":{"line":676,"column":1}},"children":[{"type":"text","value":"使用 custom_entry_price 时，Trade 对象会在与该交易相关的第一个入场订单创建时可用，对于第一次入场，","position":{"start":{"line":676,"column":1},"end":{"line":676,"column":1}},"key":"x6FOLuCzdg"},{"type":"inlineCode","value":"trade","position":{"start":{"line":676,"column":1},"end":{"line":676,"column":1}},"key":"kMkiGeDztu"},{"type":"text","value":" 参数值为 ","position":{"start":{"line":676,"column":1},"end":{"line":676,"column":1}},"key":"KP7BEVMcDN"},{"type":"inlineCode","value":"None","position":{"start":{"line":676,"column":1},"end":{"line":676,"column":1}},"key":"jH4shjbLd0"},{"type":"text","value":"。","position":{"start":{"line":676,"column":1},"end":{"line":676,"column":1}},"key":"wA6FcGAq6H"}],"key":"FrtE2ypY0n"}],"key":"yEsBgGjzhQ"},{"type":"heading","depth":4,"position":{"start":{"line":679,"column":1},"end":{"line":679,"column":1}},"children":[{"type":"text","value":"自定义订单入场和出场价格示例","position":{"start":{"line":679,"column":1},"end":{"line":679,"column":1}},"key":"ro5NW4aRvI"}],"identifier":"id","label":"自定义订单入场和出场价格示例","html_id":"id-16","implicit":true,"key":"KNqlgkZDI8"},{"type":"code","lang":"python","value":"# Default imports\n\nclass AwesomeStrategy(IStrategy):\n\n    # ... populate_* methods\n\n    def custom_entry_price(self, pair: str, trade: Trade | None, current_time: datetime, proposed_rate: float,\n                           entry_tag: str | None, side: str, **kwargs) -\u003e float:\n\n        dataframe, last_updated = self.dp.get_analyzed_dataframe(pair=pair,\n                                                                timeframe=self.timeframe)\n        new_entryprice = dataframe[\"bollinger_10_lowerband\"].iat[-1]\n\n        return new_entryprice\n\n    def custom_exit_price(self, pair: str, trade: Trade,\n                          current_time: datetime, proposed_rate: float,\n                          current_profit: float, exit_tag: str | None, **kwargs) -\u003e float:\n\n        dataframe, last_updated = self.dp.get_analyzed_dataframe(pair=pair,\n                                                                timeframe=self.timeframe)\n        new_exitprice = dataframe[\"bollinger_10_upperband\"].iat[-1]\n\n        return new_exitprice\n","position":{"start":{"line":681,"column":1},"end":{"line":707,"column":1}},"key":"NkHcd3MO6R"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"t83dYOJbQS"}],"key":"J7gyZJtCKt"},{"type":"paragraph","position":{"start":{"line":710,"column":1},"end":{"line":710,"column":1}},"children":[{"type":"text","value":"修改入场和出场价格仅适用于限价单。根据选择的价格，这可能导致大量未成交订单。默认情况下，当前价格与自定义价格之间的最大允许距离为 2%，该值可通过配置中的 ","position":{"start":{"line":710,"column":1},"end":{"line":710,"column":1}},"key":"F9MPjDLWxH"},{"type":"inlineCode","value":"custom_price_max_distance_ratio","position":{"start":{"line":710,"column":1},"end":{"line":710,"column":1}},"key":"tZlIkG1Ge3"},{"type":"text","value":" 参数更改。","position":{"start":{"line":710,"column":1},"end":{"line":710,"column":1}},"key":"giY0W4r9rW"}],"key":"dmEDFNunBs"},{"type":"paragraph","position":{"start":{"line":712,"column":1},"end":{"line":712,"column":1}},"children":[{"type":"strong","position":{"start":{"line":712,"column":1},"end":{"line":712,"column":1}},"children":[{"type":"text","value":"示例","position":{"start":{"line":712,"column":1},"end":{"line":712,"column":1}},"key":"oZSrc5yvLY"}],"key":"sQo0wAn6uz"},{"type":"text","value":"：","position":{"start":{"line":712,"column":1},"end":{"line":712,"column":1}},"key":"o6wMQI7zwV"}],"key":"VkYUWUc8bU"},{"type":"paragraph","position":{"start":{"line":714,"column":1},"end":{"line":714,"column":1}},"children":[{"type":"text","value":"如果 new_entryprice 是 97，proposed_rate 是 100，","position":{"start":{"line":714,"column":1},"end":{"line":714,"column":1}},"key":"HoUeYYpbp9"},{"type":"inlineCode","value":"custom_price_max_distance_ratio","position":{"start":{"line":714,"column":1},"end":{"line":714,"column":1}},"key":"v9z2Xrph3q"},{"type":"text","value":" 设置为 2%，则保留的有效自定义入场价格将是 98，比当前（建议）价格低 2%。","position":{"start":{"line":714,"column":1},"end":{"line":714,"column":1}},"key":"ocpq6vDxQS"}],"key":"ZlwILhMQg3"}],"key":"HzGQIyxp1q"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"回测","position":{"start":{"line":717,"column":1},"end":{"line":717,"column":1}},"key":"EkGTtOGtd7"}],"key":"f6rfDKLL7K"},{"type":"paragraph","position":{"start":{"line":718,"column":1},"end":{"line":718,"column":1}},"children":[{"type":"text","value":"自定义价格在回测中受支持（自 2021.12 起），如果价格落在 K 线的最高/最低范围内，订单将会成交。","position":{"start":{"line":718,"column":1},"end":{"line":718,"column":1}},"key":"UlQrNmIP9h"}],"key":"ctOJTyapoe"},{"type":"paragraph","position":{"start":{"line":720,"column":1},"end":{"line":720,"column":1}},"children":[{"type":"text","value":"未能立即成交的订单将受到常规超时处理，这会在每根（详细）K 线发生一次。","position":{"start":{"line":720,"column":1},"end":{"line":720,"column":1}},"key":"N3jEfs4LLj"}],"key":"skKpsYdMmZ"},{"type":"paragraph","position":{"start":{"line":722,"column":1},"end":{"line":722,"column":1}},"children":[{"type":"inlineCode","value":"custom_exit_price()","position":{"start":{"line":722,"column":1},"end":{"line":722,"column":1}},"key":"gTjTNNEOox"},{"type":"text","value":" 仅针对类型为 exit_signal、自定义退出和部分退出的卖出调用。所有其他退出类型将使用常规回测价格。","position":{"start":{"line":722,"column":1},"end":{"line":722,"column":1}},"key":"u4dqvg4ppy"}],"key":"kzawSndn3e"}],"key":"ntj8k6qzsE"},{"type":"thematicBreak","position":{"start":{"line":726,"column":1},"end":{"line":726,"column":1}},"key":"kY7VC4ckHw"},{"type":"heading","depth":3,"position":{"start":{"line":728,"column":1},"end":{"line":728,"column":1}},"children":[{"type":"text","value":"自定义订单超时规则","position":{"start":{"line":728,"column":1},"end":{"line":728,"column":1}},"key":"Ick5Si6Hwa"}],"identifier":"id","label":"自定义订单超时规则","html_id":"id-17","implicit":true,"key":"sR94DB3ssv"},{"type":"paragraph","position":{"start":{"line":730,"column":1},"end":{"line":730,"column":1}},"children":[{"type":"text","value":"简单的、基于时间的订单超时可以通过策略或在配置的 ","position":{"start":{"line":730,"column":1},"end":{"line":730,"column":1}},"key":"lQV0hCJFfi"},{"type":"inlineCode","value":"unfilledtimeout","position":{"start":{"line":730,"column":1},"end":{"line":730,"column":1}},"key":"CDkk30fKkE"},{"type":"text","value":" 部分进行配置。","position":{"start":{"line":730,"column":1},"end":{"line":730,"column":1}},"key":"cfXLAdmD8R"}],"key":"Gdpkae5cRX"},{"type":"paragraph","position":{"start":{"line":732,"column":1},"end":{"line":732,"column":1}},"children":[{"type":"text","value":"然而，freqtrade 还为两种订单类型提供了自定义回调，允许你基于自定义标准决定订单是否超时。","position":{"start":{"line":732,"column":1},"end":{"line":732,"column":1}},"key":"XA66IhaisU"}],"key":"zPszGlEUwd"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"u5Mxr8BOnx"}],"key":"C3Eyov9Brz"},{"type":"paragraph","position":{"start":{"line":735,"column":1},"end":{"line":735,"column":1}},"children":[{"type":"text","value":"回测会在订单价格落在 K 线的最高/最低范围内时成交订单。","position":{"start":{"line":735,"column":1},"end":{"line":735,"column":1}},"key":"yJAjNfNfng"}],"key":"eKIXOEljhp"},{"type":"paragraph","position":{"start":{"line":737,"column":1},"end":{"line":737,"column":1}},"children":[{"type":"text","value":"以下回调将针对不会立即成交的订单（使用自定义定价）在每个（详细）K 线调用一次。","position":{"start":{"line":737,"column":1},"end":{"line":737,"column":1}},"key":"aM8tU8FjKG"}],"key":"MWXr2513Z3"}],"key":"h80knY767r"},{"type":"heading","depth":4,"position":{"start":{"line":740,"column":1},"end":{"line":740,"column":1}},"children":[{"type":"text","value":"自定义订单超时示例","position":{"start":{"line":740,"column":1},"end":{"line":740,"column":1}},"key":"S0MgpHFdWf"}],"identifier":"id","label":"自定义订单超时示例","html_id":"id-18","implicit":true,"key":"D2gbnSXIey"},{"type":"paragraph","position":{"start":{"line":742,"column":1},"end":{"line":742,"column":1}},"children":[{"type":"text","value":"对每个未成交订单调用，直到订单成交或取消。","position":{"start":{"line":742,"column":1},"end":{"line":742,"column":1}},"key":"G2rDHtRSUA"}],"key":"xoTQI5SYIA"},{"type":"paragraph","position":{"start":{"line":744,"column":1},"end":{"line":744,"column":1}},"children":[{"type":"inlineCode","value":"check_entry_timeout()","position":{"start":{"line":744,"column":1},"end":{"line":744,"column":1}},"key":"AVJNBoUfjL"},{"type":"text","value":" 用于交易入场，而 ","position":{"start":{"line":744,"column":1},"end":{"line":744,"column":1}},"key":"FmCwRdDFnn"},{"type":"inlineCode","value":"check_exit_timeout()","position":{"start":{"line":744,"column":1},"end":{"line":744,"column":1}},"key":"x1ONlrc2Si"},{"type":"text","value":" 用于交易出场订单。","position":{"start":{"line":744,"column":1},"end":{"line":744,"column":1}},"key":"hfMMNBnv6Q"}],"key":"qAwzPxrndU"},{"type":"paragraph","position":{"start":{"line":746,"column":1},"end":{"line":746,"column":1}},"children":[{"type":"text","value":"下面是一个简单的示例，它根据资产价格应用不同的未成交超时。","position":{"start":{"line":746,"column":1},"end":{"line":746,"column":1}},"key":"X0ojDiJDzD"}],"key":"WHo1HP6eqp"},{"type":"paragraph","position":{"start":{"line":748,"column":1},"end":{"line":748,"column":1}},"children":[{"type":"text","value":"它对高价资产应用较短的超时，而对低价币种允许更长的成交时间。","position":{"start":{"line":748,"column":1},"end":{"line":748,"column":1}},"key":"N58h0yWtop"}],"key":"nacmMRNu05"},{"type":"paragraph","position":{"start":{"line":750,"column":1},"end":{"line":750,"column":1}},"children":[{"type":"text","value":"函数必须返回 ","position":{"start":{"line":750,"column":1},"end":{"line":750,"column":1}},"key":"bHMG0bkNmc"},{"type":"inlineCode","value":"True","position":{"start":{"line":750,"column":1},"end":{"line":750,"column":1}},"key":"sfucH8qbM8"},{"type":"text","value":"（取消订单）或 ","position":{"start":{"line":750,"column":1},"end":{"line":750,"column":1}},"key":"ChKKz9mIBo"},{"type":"inlineCode","value":"False","position":{"start":{"line":750,"column":1},"end":{"line":750,"column":1}},"key":"lOQL8ePlzC"},{"type":"text","value":"（保持订单活跃）。","position":{"start":{"line":750,"column":1},"end":{"line":750,"column":1}},"key":"Ii5DNwh0Mh"}],"key":"aSijXujQ2S"},{"type":"code","lang":"python","value":"# Default imports\n\nclass AwesomeStrategy(IStrategy):\n\n    # ... populate_* methods\n\n    # 设置 unfilledtimeout 为 25 小时，因为下面的最大超时是 24 小时。\n    unfilledtimeout = {\n        \"entry\": 60 * 25,\n        \"exit\": 60 * 25\n    }\n\n    def check_entry_timeout(self, pair: str, trade: Trade, order: Order,\n                            current_time: datetime, **kwargs) -\u003e bool:\n        if trade.open_rate \u003e 100 and trade.open_date_utc \u003c current_time - timedelta(minutes=5):\n            return True\n        elif trade.open_rate \u003e 10 and trade.open_date_utc \u003c current_time - timedelta(minutes=3):\n            return True\n        elif trade.open_rate \u003c 1 and trade.open_date_utc \u003c current_time - timedelta(hours=24):\n           return True\n        return False\n\n\n    def check_exit_timeout(self, pair: str, trade: Trade, order: Order,\n                           current_time: datetime, **kwargs) -\u003e bool:\n        if trade.open_rate \u003e 100 and trade.open_date_utc \u003c current_time - timedelta(minutes=5):\n            return True\n        elif trade.open_rate \u003e 10 and trade.open_date_utc \u003c current_time - timedelta(minutes=3):\n            return True\n        elif trade.open_rate \u003c 1 and trade.open_date_utc \u003c current_time - timedelta(hours=24):\n           return True\n        return False","position":{"start":{"line":752,"column":1},"end":{"line":785,"column":1}},"key":"EWgm0R91rO"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"rTs51EPbWn"}],"key":"hkV9xxexvn"},{"type":"paragraph","position":{"start":{"line":788,"column":1},"end":{"line":788,"column":1}},"children":[{"type":"text","value":"对于上面的示例，","position":{"start":{"line":788,"column":1},"end":{"line":788,"column":1}},"key":"wpXoeUKLLH"},{"type":"inlineCode","value":"unfilledtimeout","position":{"start":{"line":788,"column":1},"end":{"line":788,"column":1}},"key":"ojzzUAh0YE"},{"type":"text","value":" 必须设置为大于 24 小时的值，否则该类型的超时将首先应用。","position":{"start":{"line":788,"column":1},"end":{"line":788,"column":1}},"key":"gc7YN36Ehq"}],"key":"XdKAcd6FFf"}],"key":"McBkIMXdhe"},{"type":"heading","depth":4,"position":{"start":{"line":791,"column":1},"end":{"line":791,"column":1}},"children":[{"type":"text","value":"自定义订单超时示例（使用额外数据）","position":{"start":{"line":791,"column":1},"end":{"line":791,"column":1}},"key":"IZYaYVmOih"}],"identifier":"id","label":"自定义订单超时示例（使用额外数据）","html_id":"id-19","implicit":true,"key":"QAxrhy4TX3"},{"type":"code","lang":"python","value":"# Default imports\n\nclass AwesomeStrategy(IStrategy):\n\n    # ... populate_* methods\n\n    # 设置 unfilledtimeout 为 25 小时，因为下面的最大超时是 24 小时。\n    unfilledtimeout = {\n        \"entry\": 60 * 25,\n        \"exit\": 60 * 25\n    }\n\n    def check_entry_timeout(self, pair: str, trade: Trade, order: Order,\n                            current_time: datetime, **kwargs) -\u003e bool:\n        ob = self.dp.orderbook(pair, 1)\n        current_price = ob[\"bids\"][0][0]\n        # 如果价格比订单价格高出 2% 以上，取消买单。\n        if current_price \u003e order.price * 1.02:\n            return True\n        return False\n\n\n    def check_exit_timeout(self, pair: str, trade: Trade, order: Order,\n                           current_time: datetime, **kwargs) -\u003e bool:\n        ob = self.dp.orderbook(pair, 1)\n        current_price = ob[\"asks\"][0][0]\n        # 如果价格比订单价格低 2% 以上，取消卖单。\n        if current_price \u003c order.price * 0.98:\n            return True\n        return False","position":{"start":{"line":793,"column":1},"end":{"line":824,"column":1}},"key":"moGuaYv6CK"},{"type":"thematicBreak","position":{"start":{"line":826,"column":1},"end":{"line":826,"column":1}},"key":"M73ujUjFbj"},{"type":"heading","depth":3,"position":{"start":{"line":828,"column":1},"end":{"line":828,"column":1}},"children":[{"type":"text","value":"机器人订单确认","position":{"start":{"line":828,"column":1},"end":{"line":828,"column":1}},"key":"BhBHKlp12A"}],"identifier":"id","label":"机器人订单确认","html_id":"id-20","implicit":true,"key":"WTDcce8ZVj"},{"type":"paragraph","position":{"start":{"line":830,"column":1},"end":{"line":831,"column":1}},"children":[{"type":"text","value":"确认交易入场/出场。\n这些是在订单下单之前最后调用的方法。","position":{"start":{"line":830,"column":1},"end":{"line":830,"column":1}},"key":"qdzQVQFCNw"}],"key":"rOewHOJaO9"},{"type":"heading","depth":4,"position":{"start":{"line":833,"column":1},"end":{"line":833,"column":1}},"children":[{"type":"text","value":"交易入场（买单）确认","position":{"start":{"line":833,"column":1},"end":{"line":833,"column":1}},"key":"g6zPC7MSKE"}],"identifier":"id","label":"交易入场（买单）确认","html_id":"id-21","implicit":true,"key":"zLeuSFkT8L"},{"type":"paragraph","position":{"start":{"line":835,"column":1},"end":{"line":835,"column":1}},"children":[{"type":"inlineCode","value":"confirm_trade_entry()","position":{"start":{"line":835,"column":1},"end":{"line":835,"column":1}},"key":"I08XUtQ78W"},{"type":"text","value":" 可用于在最后一刻中止交易入场（可能是因为价格不符合预期）。","position":{"start":{"line":835,"column":1},"end":{"line":835,"column":1}},"key":"QwDR4Acq2L"}],"key":"CR4EC3fN25"},{"type":"code","lang":"python","value":"# Default imports\n\nclass AwesomeStrategy(IStrategy):\n\n    # ... populate_* methods\n\n    def confirm_trade_entry(self, pair: str, order_type: str, amount: float, rate: float,\n                            time_in_force: str, current_time: datetime, entry_tag: str | None,\n                            side: str, **kwargs) -\u003e bool:\n        \"\"\"\n        Called right before placing a entry order.\n        Timing for this function is critical, so avoid doing heavy computations or\n        network requests in this method.\n\n        For full documentation please go to https://www.freqtrade.io/en/latest/strategy-advanced/\n\n        When not implemented by a strategy, returns True (always confirming).\n\n        :param pair: Pair that's about to be bought/shorted.\n        :param order_type: Order type (as configured in order_types). usually limit or market.\n        :param amount: Amount in target (base) currency that's going to be traded.\n        :param rate: Rate that's going to be used when using limit orders \n                     or current rate for market orders.\n        :param time_in_force: Time in force. Defaults to GTC (Good-til-cancelled).\n        :param current_time: datetime object, containing the current datetime\n        :param entry_tag: Optional entry_tag (buy_tag) if provided with the buy signal.\n        :param side: \"long\" or \"short\" - indicating the direction of the proposed trade\n        :param **kwargs: Ensure to keep this here so updates to this won't break your strategy.\n        :return bool: When True is returned, then the buy-order is placed on the exchange.\n            False aborts the process\n        \"\"\"\n        return True\n","position":{"start":{"line":837,"column":1},"end":{"line":871,"column":1}},"key":"wz8E3QqwkY"},{"type":"heading","depth":4,"position":{"start":{"line":873,"column":1},"end":{"line":873,"column":1}},"children":[{"type":"text","value":"交易出场（卖单）确认","position":{"start":{"line":873,"column":1},"end":{"line":873,"column":1}},"key":"xTCew0bc5r"}],"identifier":"id","label":"交易出场（卖单）确认","html_id":"id-22","implicit":true,"key":"iUfMLFEcr2"},{"type":"paragraph","position":{"start":{"line":875,"column":1},"end":{"line":875,"column":1}},"children":[{"type":"inlineCode","value":"confirm_trade_exit()","position":{"start":{"line":875,"column":1},"end":{"line":875,"column":1}},"key":"a0mNLDFA8V"},{"type":"text","value":" 可用于在最后一刻中止交易出场（可能是因为价格不符合预期）。","position":{"start":{"line":875,"column":1},"end":{"line":875,"column":1}},"key":"O9BSN2ldpV"}],"key":"bnqZTjj5ot"},{"type":"paragraph","position":{"start":{"line":877,"column":1},"end":{"line":878,"column":1}},"children":[{"type":"inlineCode","value":"confirm_trade_exit()","position":{"start":{"line":877,"column":1},"end":{"line":877,"column":1}},"key":"wxg0fZ7Ca9"},{"type":"text","value":" 可能会在同一迭代中多次调用同一交易，如果适用不同的退出原因。\n退出原因（如果适用）将按以下顺序排列：","position":{"start":{"line":877,"column":1},"end":{"line":877,"column":1}},"key":"yOxn8mQQyM"}],"key":"DbaT90dItP"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":880,"column":1},"end":{"line":884,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":880,"column":1},"end":{"line":880,"column":1}},"children":[{"type":"inlineCode","value":"exit_signal","position":{"start":{"line":880,"column":1},"end":{"line":880,"column":1}},"key":"NHx35KzxnS"},{"type":"text","value":" / ","position":{"start":{"line":880,"column":1},"end":{"line":880,"column":1}},"key":"C7G7zxBY1S"},{"type":"inlineCode","value":"custom_exit","position":{"start":{"line":880,"column":1},"end":{"line":880,"column":1}},"key":"wVlNSDUfQM"}],"key":"vVvTR0NpKk"},{"type":"listItem","spread":true,"position":{"start":{"line":881,"column":1},"end":{"line":881,"column":1}},"children":[{"type":"inlineCode","value":"stop_loss","position":{"start":{"line":881,"column":1},"end":{"line":881,"column":1}},"key":"fST1KNahCO"}],"key":"K8N8lYKdYI"},{"type":"listItem","spread":true,"position":{"start":{"line":882,"column":1},"end":{"line":882,"column":1}},"children":[{"type":"inlineCode","value":"roi","position":{"start":{"line":882,"column":1},"end":{"line":882,"column":1}},"key":"AgbzJ6c6uo"}],"key":"DEx7Ls2znq"},{"type":"listItem","spread":true,"position":{"start":{"line":883,"column":1},"end":{"line":884,"column":1}},"children":[{"type":"inlineCode","value":"trailing_stop_loss","position":{"start":{"line":883,"column":1},"end":{"line":883,"column":1}},"key":"YV8nT4TQF3"}],"key":"pciOmmHAL7"}],"key":"VZDiWBEe5J"},{"type":"code","lang":"python","value":"# Default imports\n\nclass AwesomeStrategy(IStrategy):\n\n    # ... populate_* methods\n\n    def confirm_trade_exit(self, pair: str, trade: Trade, order_type: str, amount: float,\n                           rate: float, time_in_force: str, exit_reason: str,\n                           current_time: datetime, **kwargs) -\u003e bool:\n        \"\"\"\n        Called right before placing a regular exit order.\n        Timing for this function is critical, so avoid doing heavy computations or\n        network requests in this method.\n\n        For full documentation please go to https://www.freqtrade.io/en/latest/strategy-advanced/\n\n        When not implemented by a strategy, returns True (always confirming).\n\n        :param pair: Pair for trade that's about to be exited.\n        :param trade: trade object.\n        :param order_type: Order type (as configured in order_types). usually limit or market.\n        :param amount: Amount in base currency.\n        :param rate: Rate that's going to be used when using limit orders\n                     or current rate for market orders.\n        :param time_in_force: Time in force. Defaults to GTC (Good-til-cancelled).\n        :param exit_reason: Exit reason.\n            Can be any of [\"roi\", \"stop_loss\", \"stoploss_on_exchange\", \"trailing_stop_loss\",\n                           \"exit_signal\", \"force_exit\", \"emergency_exit\"]\n        :param current_time: datetime object, containing the current datetime\n        :param **kwargs: Ensure to keep this here so updates to this won't break your strategy.\n        :return bool: When True, then the exit-order is placed on the exchange.\n            False aborts the process\n        \"\"\"\n        if exit_reason == \"force_exit\" and trade.calc_profit_ratio(rate) \u003c 0:\n            # Reject force-sells with negative profit\n            # This is just a sample, please adjust to your needs\n            # (this does not necessarily make sense, assuming you know when you're force-selling)\n            return False\n        return True\n","position":{"start":{"line":885,"column":1},"end":{"line":926,"column":1}},"key":"aqqnwdqTKs"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"vK4M9qKlN6"}],"key":"Llq9H86Obr"},{"type":"paragraph","position":{"start":{"line":929,"column":1},"end":{"line":929,"column":1}},"children":[{"type":"inlineCode","value":"confirm_trade_exit()","position":{"start":{"line":929,"column":1},"end":{"line":929,"column":1}},"key":"xFOwafGFXR"},{"type":"text","value":" 可以阻止止损退出，导致重大损失，因为这将忽略止损退出。","position":{"start":{"line":929,"column":1},"end":{"line":929,"column":1}},"key":"iH1h0aDLyl"}],"key":"bRYI02TXl6"},{"type":"paragraph","position":{"start":{"line":931,"column":1},"end":{"line":931,"column":1}},"children":[{"type":"inlineCode","value":"confirm_trade_exit()","position":{"start":{"line":931,"column":1},"end":{"line":931,"column":1}},"key":"tJwQ0Kt29h"},{"type":"text","value":" 不会为清算调用 - 因为清算是由交易所强制执行的，因此无法拒绝。","position":{"start":{"line":931,"column":1},"end":{"line":931,"column":1}},"key":"ZL5a02PSpL"}],"key":"IVYL6qj5hm"}],"key":"xvAUa4W8l6"},{"type":"heading","depth":3,"position":{"start":{"line":936,"column":1},"end":{"line":936,"column":1}},"children":[{"type":"text","value":"调整交易仓位","position":{"start":{"line":936,"column":1},"end":{"line":936,"column":1}},"key":"IdkdwekQ6A"}],"label":"adjust-trade-position","identifier":"adjust-trade-position","html_id":"adjust-trade-position","key":"snnHzCwHdi"},{"type":"paragraph","position":{"start":{"line":938,"column":1},"end":{"line":940,"column":1}},"children":[{"type":"inlineCode","value":"position_adjustment_enable","position":{"start":{"line":938,"column":1},"end":{"line":938,"column":1}},"key":"M0PByLn9ZE"},{"type":"text","value":" 策略属性启用了策略中 ","position":{"start":{"line":938,"column":1},"end":{"line":938,"column":1}},"key":"SbvkEb1yDh"},{"type":"inlineCode","value":"adjust_trade_position()","position":{"start":{"line":938,"column":1},"end":{"line":938,"column":1}},"key":"twEgK0VbUg"},{"type":"text","value":" 回调的使用。\n出于性能原因，默认情况下它是禁用的，如果启用，freqtrade 将在启动时显示警告消息。\n","position":{"start":{"line":938,"column":1},"end":{"line":938,"column":1}},"key":"XsjlTYPh79"},{"type":"inlineCode","value":"adjust_trade_position()","position":{"start":{"line":938,"column":1},"end":{"line":938,"column":1}},"key":"bFM0JdBDy5"},{"type":"text","value":" 可用于执行额外的订单，例如使用 DCA（美元成本平均）管理风险或增加或减少仓位。","position":{"start":{"line":938,"column":1},"end":{"line":938,"column":1}},"key":"KD4iriPdHt"}],"key":"JgXeGX3vfn"},{"type":"paragraph","position":{"start":{"line":942,"column":1},"end":{"line":942,"column":1}},"children":[{"type":"text","value":"额外订单也会导致额外费用，并且这些订单不计入 ","position":{"start":{"line":942,"column":1},"end":{"line":942,"column":1}},"key":"Q9T5LuZLEy"},{"type":"inlineCode","value":"max_open_trades","position":{"start":{"line":942,"column":1},"end":{"line":942,"column":1}},"key":"NVpFEmBGcL"},{"type":"text","value":"。","position":{"start":{"line":942,"column":1},"end":{"line":942,"column":1}},"key":"JmHPaUgsgb"}],"key":"BE7BQU6AgD"},{"type":"paragraph","position":{"start":{"line":944,"column":1},"end":{"line":944,"column":1}},"children":[{"type":"text","value":"当有未成交订单（买单或卖单）等待执行时，也会调用此回调 - 如果数量、价格或方向不同，将取消现有的未成交订单以放置新订单。部分成交的订单也将被取消，并将被回调返回的新数量替换。","position":{"start":{"line":944,"column":1},"end":{"line":944,"column":1}},"key":"VVY0sgMqbt"}],"key":"mPI4geP6ZV"},{"type":"paragraph","position":{"start":{"line":946,"column":1},"end":{"line":946,"column":1}},"children":[{"type":"inlineCode","value":"adjust_trade_position()","position":{"start":{"line":946,"column":1},"end":{"line":946,"column":1}},"key":"PAglEPMYs6"},{"type":"text","value":" 在交易期间非常频繁地被调用，因此你必须尽可能保持实现的性能。","position":{"start":{"line":946,"column":1},"end":{"line":946,"column":1}},"key":"ZRzdEoV2UH"}],"key":"eHRVsbEM44"},{"type":"paragraph","position":{"start":{"line":948,"column":1},"end":{"line":949,"column":1}},"children":[{"type":"text","value":"仓位调整将始终应用于交易的方向，因此正值将始终增加你的仓位（负值将减少你的仓位），无论它是多头还是空头交易。\n调整订单可以通过返回一个 2 元素元组来分配标签，第一个元素是调整数量，第二个元素是标签（例如 ","position":{"start":{"line":948,"column":1},"end":{"line":948,"column":1}},"key":"TVXzm9huJr"},{"type":"inlineCode","value":"return 250, \"increase_favorable_conditions\"","position":{"start":{"line":948,"column":1},"end":{"line":948,"column":1}},"key":"B8VF4sJlMR"},{"type":"text","value":"）。","position":{"start":{"line":948,"column":1},"end":{"line":948,"column":1}},"key":"Ww94DJ2cDc"}],"key":"Bh3gxghIR9"},{"type":"paragraph","position":{"start":{"line":951,"column":1},"end":{"line":951,"column":1}},"children":[{"type":"text","value":"无法修改杠杆，返回的仓位金额假定为应用杠杆之前。","position":{"start":{"line":951,"column":1},"end":{"line":951,"column":1}},"key":"muv293Z7oC"}],"key":"evl9FMn1Wx"},{"type":"paragraph","position":{"start":{"line":953,"column":1},"end":{"line":953,"column":1}},"children":[{"type":"text","value":"当前分配给仓位的组合仓位金额保存在 ","position":{"start":{"line":953,"column":1},"end":{"line":953,"column":1}},"key":"doNVIXO8fl"},{"type":"inlineCode","value":"trade.stake_amount","position":{"start":{"line":953,"column":1},"end":{"line":953,"column":1}},"key":"v06BfG3eeB"},{"type":"text","value":" 中。因此，","position":{"start":{"line":953,"column":1},"end":{"line":953,"column":1}},"key":"Os7zIqz9eC"},{"type":"inlineCode","value":"trade.stake_amount","position":{"start":{"line":953,"column":1},"end":{"line":953,"column":1}},"key":"qOsl0Sa4AZ"},{"type":"text","value":" 将在每次通过 ","position":{"start":{"line":953,"column":1},"end":{"line":953,"column":1}},"key":"XeAkVChdHz"},{"type":"inlineCode","value":"adjust_trade_position()","position":{"start":{"line":953,"column":1},"end":{"line":953,"column":1}},"key":"FsB5YuV2VK"},{"type":"text","value":" 进行额外入场和部分出场时更新。","position":{"start":{"line":953,"column":1},"end":{"line":953,"column":1}},"key":"XtwlCmQGgB"}],"key":"IFpYOTe2qy"},{"type":"admonition","kind":"danger","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"松散逻辑","position":{"start":{"line":955,"column":1},"end":{"line":955,"column":1}},"key":"Bnv1EhmLbg"}],"key":"SldAtPtnVr"},{"type":"paragraph","position":{"start":{"line":956,"column":1},"end":{"line":956,"column":1}},"children":[{"type":"text","value":"在模拟和实盘运行中，此函数将每 ","position":{"start":{"line":956,"column":1},"end":{"line":956,"column":1}},"key":"LQ3Q7ZiVPT"},{"type":"inlineCode","value":"throttle_process_secs","position":{"start":{"line":956,"column":1},"end":{"line":956,"column":1}},"key":"E1NEbiBkts"},{"type":"text","value":"（默认为 5 秒）调用一次。如果你有松散的逻辑（例如，如果最后一根 K 线的 RSI 低于 30，则增加仓位），你的机器人将每 5 秒进行一次额外重新入场，直到你用完资金，达到 ","position":{"start":{"line":956,"column":1},"end":{"line":956,"column":1}},"key":"SYacMMTSbC"},{"type":"inlineCode","value":"max_position_adjustment","position":{"start":{"line":956,"column":1},"end":{"line":956,"column":1}},"key":"Gvdv1ZShtf"},{"type":"text","value":" 限制，或者出现 RSI 大于 30 的新 K 线。","position":{"start":{"line":956,"column":1},"end":{"line":956,"column":1}},"key":"J5mB12bm5u"}],"key":"sN7gHUa3Z5"},{"type":"paragraph","position":{"start":{"line":958,"column":1},"end":{"line":958,"column":1}},"children":[{"type":"text","value":"部分出场也可能发生同样的情况。","position":{"start":{"line":958,"column":1},"end":{"line":958,"column":1}},"key":"laJnOdIOQi"}],"key":"Hl7SRk7Mt6"},{"type":"paragraph","position":{"start":{"line":960,"column":1},"end":{"line":960,"column":1}},"children":[{"type":"text","value":"因此，请确保有严格的逻辑和/或检查最后成交的订单以及是否已有未成交订单。","position":{"start":{"line":960,"column":1},"end":{"line":960,"column":1}},"key":"CjwMripgVF"}],"key":"ulxZ5VciOM"}],"key":"nNAlXjAzlS"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"多次仓位调整的性能","position":{"start":{"line":963,"column":1},"end":{"line":963,"column":1}},"key":"UiuvY87PUg"}],"key":"hG5bOr2DxF"},{"type":"paragraph","position":{"start":{"line":964,"column":1},"end":{"line":964,"column":1}},"children":[{"type":"text","value":"仓位调整可以是增加策略输出的好方法 - 但如果广泛使用此功能，也可能有缺点。","position":{"start":{"line":964,"column":1},"end":{"line":964,"column":1}},"key":"bEOg19CmYo"}],"key":"ink9bu864L"},{"type":"paragraph","position":{"start":{"line":966,"column":1},"end":{"line":966,"column":1}},"children":[{"type":"text","value":"每个订单将在交易期间附加到交易对象 - 因此增加内存使用。","position":{"start":{"line":966,"column":1},"end":{"line":966,"column":1}},"key":"RGQhq5rDz8"}],"key":"rSNt6KDMmk"},{"type":"paragraph","position":{"start":{"line":968,"column":1},"end":{"line":968,"column":1}},"children":[{"type":"text","value":"因此，不建议使用长时间持续和 10 次甚至 100 次仓位调整的交易，应该定期关闭以避免影响性能。","position":{"start":{"line":968,"column":1},"end":{"line":968,"column":1}},"key":"kIz3ny5FhA"}],"key":"rrbffucR5O"}],"key":"tOBNk4CmYb"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"回测","position":{"start":{"line":971,"column":1},"end":{"line":971,"column":1}},"key":"MVvwj4p0dR"}],"key":"gms1cR87tF"},{"type":"paragraph","position":{"start":{"line":972,"column":1},"end":{"line":972,"column":1}},"children":[{"type":"text","value":"在回测期间，此回调在 ","position":{"start":{"line":972,"column":1},"end":{"line":972,"column":1}},"key":"t4tDPSCC5p"},{"type":"inlineCode","value":"timeframe","position":{"start":{"line":972,"column":1},"end":{"line":972,"column":1}},"key":"hTZTlyz6Ua"},{"type":"text","value":" 或 ","position":{"start":{"line":972,"column":1},"end":{"line":972,"column":1}},"key":"JsQ6uAjUHD"},{"type":"inlineCode","value":"timeframe_detail","position":{"start":{"line":972,"column":1},"end":{"line":972,"column":1}},"key":"aCuOMAZUZ1"},{"type":"text","value":" 中的每根 K 线调用一次，因此运行时性能将受到影响。","position":{"start":{"line":972,"column":1},"end":{"line":972,"column":1}},"key":"Gy7PEGdKOn"}],"key":"MYVscp6nGy"},{"type":"paragraph","position":{"start":{"line":974,"column":1},"end":{"line":974,"column":1}},"children":[{"type":"text","value":"这也可能导致实盘和回测之间的结果不同，因为回测只能在每根 K 线调整一次交易，而实盘可以在每根 K 线多次调整交易。","position":{"start":{"line":974,"column":1},"end":{"line":974,"column":1}},"key":"fScnWBG56Y"}],"key":"iOgm91leNS"}],"key":"KlgfiGioQ3"},{"type":"heading","depth":4,"position":{"start":{"line":977,"column":1},"end":{"line":977,"column":1}},"children":[{"type":"text","value":"增加仓位","position":{"start":{"line":977,"column":1},"end":{"line":977,"column":1}},"key":"O9iusD5gvK"}],"identifier":"id","label":"增加仓位","html_id":"id-23","implicit":true,"key":"sGYbiFMr6G"},{"type":"paragraph","position":{"start":{"line":979,"column":1},"end":{"line":979,"column":1}},"children":[{"type":"text","value":"当需要进行额外入场订单时（即增加仓位——多头为买单，空头为卖单），策略应返回一个介于 ","position":{"start":{"line":979,"column":1},"end":{"line":979,"column":1}},"key":"liFPhEXqvQ"},{"type":"inlineCode","value":"min_stake","position":{"start":{"line":979,"column":1},"end":{"line":979,"column":1}},"key":"GMEGc6c4L2"},{"type":"text","value":" 和 ","position":{"start":{"line":979,"column":1},"end":{"line":979,"column":1}},"key":"z6BtXkgxxA"},{"type":"inlineCode","value":"max_stake","position":{"start":{"line":979,"column":1},"end":{"line":979,"column":1}},"key":"QS7wMEBxUE"},{"type":"text","value":" 之间的正数 ","position":{"start":{"line":979,"column":1},"end":{"line":979,"column":1}},"key":"bIQWOMbj60"},{"type":"strong","position":{"start":{"line":979,"column":1},"end":{"line":979,"column":1}},"children":[{"type":"text","value":"stake_amount","position":{"start":{"line":979,"column":1},"end":{"line":979,"column":1}},"key":"Fe6igvqZ7P"}],"key":"Fco08Hw0hk"},{"type":"text","value":"（以仓位货币计价）。","position":{"start":{"line":979,"column":1},"end":{"line":979,"column":1}},"key":"k1L7z3M9Kp"}],"key":"SStgvHMMvs"},{"type":"paragraph","position":{"start":{"line":981,"column":1},"end":{"line":982,"column":1}},"children":[{"type":"text","value":"如果钱包中没有足够的资金（返回值高于 ","position":{"start":{"line":981,"column":1},"end":{"line":981,"column":1}},"key":"SFoedV8O79"},{"type":"inlineCode","value":"max_stake","position":{"start":{"line":981,"column":1},"end":{"line":981,"column":1}},"key":"prXc2GRzzn"},{"type":"text","value":"），则该信号会被忽略。\n","position":{"start":{"line":981,"column":1},"end":{"line":981,"column":1}},"key":"yevcs0GymZ"},{"type":"inlineCode","value":"max_entry_position_adjustment","position":{"start":{"line":981,"column":1},"end":{"line":981,"column":1}},"key":"qMRx5xeyT5"},{"type":"text","value":" 属性用于限制机器人每笔交易（在首次入场订单之外）可执行的额外入场次数。默认值为 -1，表示机器人对调整入场次数没有限制。","position":{"start":{"line":981,"column":1},"end":{"line":981,"column":1}},"key":"aSu1YIiT2M"}],"key":"umDAT59U8Y"},{"type":"paragraph","position":{"start":{"line":984,"column":1},"end":{"line":984,"column":1}},"children":[{"type":"text","value":"一旦达到你在 ","position":{"start":{"line":984,"column":1},"end":{"line":984,"column":1}},"key":"z7UZTI3Zd9"},{"type":"inlineCode","value":"max_entry_position_adjustment","position":{"start":{"line":984,"column":1},"end":{"line":984,"column":1}},"key":"qSilv8UXfT"},{"type":"text","value":" 上设置的最大额外入场次数，额外入场将被忽略，但回调仍会被调用以寻找部分出场机会。","position":{"start":{"line":984,"column":1},"end":{"line":984,"column":1}},"key":"zp18hr5khW"}],"key":"jWi2xadvJl"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"关于仓位大小","position":{"start":{"line":986,"column":1},"end":{"line":986,"column":1}},"key":"MbCE1tU0tx"}],"key":"CxEHptUQ5l"},{"type":"paragraph","position":{"start":{"line":987,"column":1},"end":{"line":987,"column":1}},"children":[{"type":"text","value":"使用固定仓位大小意味着首次订单将使用该金额，就像没有仓位调整一样。","position":{"start":{"line":987,"column":1},"end":{"line":987,"column":1}},"key":"fG5sszWOU9"}],"key":"iAalzDWJaW"},{"type":"paragraph","position":{"start":{"line":989,"column":1},"end":{"line":989,"column":1}},"children":[{"type":"text","value":"如果你希望通过 DCA 进行额外买入，请确保钱包中留有足够的资金。","position":{"start":{"line":989,"column":1},"end":{"line":989,"column":1}},"key":"EwafySPpLs"}],"key":"pjhHX24Z78"},{"type":"paragraph","position":{"start":{"line":991,"column":1},"end":{"line":991,"column":1}},"children":[{"type":"text","value":"对 DCA 订单使用 “unlimited” 仓位金额时，需要你实现 ","position":{"start":{"line":991,"column":1},"end":{"line":991,"column":1}},"key":"fkY4OrpMTW"},{"type":"inlineCode","value":"custom_stake_amount()","position":{"start":{"line":991,"column":1},"end":{"line":991,"column":1}},"key":"PPhQoZZUrC"},{"type":"text","value":" 回调，以避免初始订单占用全部资金。","position":{"start":{"line":991,"column":1},"end":{"line":991,"column":1}},"key":"oTQPvCDDVt"}],"key":"p8IoWK88Mz"}],"key":"rwPtpYhjky"},{"type":"heading","depth":4,"position":{"start":{"line":994,"column":1},"end":{"line":994,"column":1}},"children":[{"type":"text","value":"减少仓位","position":{"start":{"line":994,"column":1},"end":{"line":994,"column":1}},"key":"sQqMxDujZY"}],"identifier":"id","label":"减少仓位","html_id":"id-24","implicit":true,"key":"oPlHa659SM"},{"type":"paragraph","position":{"start":{"line":996,"column":1},"end":{"line":996,"column":1}},"children":[{"type":"text","value":"策略应返回一个负的 stake_amount（以仓位货币计价）用于部分出场。","position":{"start":{"line":996,"column":1},"end":{"line":996,"column":1}},"key":"hyJu9xx7OK"}],"key":"w4P5WlR1X0"},{"type":"paragraph","position":{"start":{"line":998,"column":1},"end":{"line":998,"column":1}},"children":[{"type":"text","value":"返回当前持有的全部仓位（","position":{"start":{"line":998,"column":1},"end":{"line":998,"column":1}},"key":"KqgCZiO0SD"},{"type":"inlineCode","value":"-trade.stake_amount","position":{"start":{"line":998,"column":1},"end":{"line":998,"column":1}},"key":"s93ymhMmJ5"},{"type":"text","value":"）将导致完全出场。","position":{"start":{"line":998,"column":1},"end":{"line":998,"column":1}},"key":"ZC2IzyeUhX"}],"key":"w0G7ZHhBUX"},{"type":"paragraph","position":{"start":{"line":1000,"column":1},"end":{"line":1000,"column":1}},"children":[{"type":"text","value":"返回超过上述值（即剩余 stake_amount 变为负数）将导致机器人忽略该信号。","position":{"start":{"line":1000,"column":1},"end":{"line":1000,"column":1}},"key":"Bhx9dykUFR"}],"key":"UWmIgx7apr"},{"type":"paragraph","position":{"start":{"line":1002,"column":1},"end":{"line":1002,"column":1}},"children":[{"type":"text","value":"对于部分出场，重要的是要知道用于计算部分出场订单币种数量的公式是 ","position":{"start":{"line":1002,"column":1},"end":{"line":1002,"column":1}},"key":"RDVKu7YCWR"},{"type":"inlineCode","value":"部分出场数量 = negative_stake_amount * trade.amount / trade.stake_amount","position":{"start":{"line":1002,"column":1},"end":{"line":1002,"column":1}},"key":"vXHvuTSA2a"},{"type":"text","value":"，其中 ","position":{"start":{"line":1002,"column":1},"end":{"line":1002,"column":1}},"key":"DaIZXtfkSq"},{"type":"inlineCode","value":"negative_stake_amount","position":{"start":{"line":1002,"column":1},"end":{"line":1002,"column":1}},"key":"WNlXRtg2So"},{"type":"text","value":" 是 ","position":{"start":{"line":1002,"column":1},"end":{"line":1002,"column":1}},"key":"z840DKH1Z4"},{"type":"inlineCode","value":"adjust_trade_position","position":{"start":{"line":1002,"column":1},"end":{"line":1002,"column":1}},"key":"l0vNWHoneb"},{"type":"text","value":" 函数返回的值。正如公式所示，该公式与当前仓位盈亏无关，只与 ","position":{"start":{"line":1002,"column":1},"end":{"line":1002,"column":1}},"key":"Ksh5qGFmUH"},{"type":"inlineCode","value":"trade.amount","position":{"start":{"line":1002,"column":1},"end":{"line":1002,"column":1}},"key":"MFZnnEjbBi"},{"type":"text","value":" 和 ","position":{"start":{"line":1002,"column":1},"end":{"line":1002,"column":1}},"key":"G0QeXy1bcE"},{"type":"inlineCode","value":"trade.stake_amount","position":{"start":{"line":1002,"column":1},"end":{"line":1002,"column":1}},"key":"IrieiCuUWR"},{"type":"text","value":" 有关，这两个值不会受到价格波动影响。","position":{"start":{"line":1002,"column":1},"end":{"line":1002,"column":1}},"key":"jNWympfxr3"}],"key":"jtsr29i0bH"},{"type":"paragraph","position":{"start":{"line":1004,"column":1},"end":{"line":1004,"column":1}},"children":[{"type":"text","value":"例如，假设你以 50 的开盘价买入 2 个 SHITCOIN/USDT，意味着该交易的仓位金额为 100 USDT。现在价格涨到 200，你想卖出一半。这时你需要返回 ","position":{"start":{"line":1004,"column":1},"end":{"line":1004,"column":1}},"key":"osJxBgmjWC"},{"type":"inlineCode","value":"trade.stake_amount","position":{"start":{"line":1004,"column":1},"end":{"line":1004,"column":1}},"key":"QCpbOGOJrT"},{"type":"text","value":" 的 -50%（0.5 * 100 USDT），即 -50。机器人会计算需要卖出的数量，即 ","position":{"start":{"line":1004,"column":1},"end":{"line":1004,"column":1}},"key":"us1DsEXLXU"},{"type":"inlineCode","value":"50 * 2 / 100","position":{"start":{"line":1004,"column":1},"end":{"line":1004,"column":1}},"key":"XpwAHDXUa7"},{"type":"text","value":"，等于 1 个 SHITCOIN/USDT。如果你返回 -200（2 * 200 的 50%），机器人会忽略，因为 ","position":{"start":{"line":1004,"column":1},"end":{"line":1004,"column":1}},"key":"YSn357IaNO"},{"type":"inlineCode","value":"trade.stake_amount","position":{"start":{"line":1004,"column":1},"end":{"line":1004,"column":1}},"key":"Cr5S06hyr6"},{"type":"text","value":" 只有 100 USDT，而你要求卖出 200 USDT，相当于卖出 4 个 SHITCOIN/USDT。","position":{"start":{"line":1004,"column":1},"end":{"line":1004,"column":1}},"key":"DEa52tOsIx"}],"key":"ZA9GCpMRll"},{"type":"paragraph","position":{"start":{"line":1006,"column":1},"end":{"line":1006,"column":1}},"children":[{"type":"text","value":"回到上面的例子，当前价格为 200，你的交易当前 USDT 价值为 400 USDT。假设你想部分卖出 100 USDT，以取回初始投资并将利润留在交易中，希望价格继续上涨。这时你需要先计算要卖出的确切数量。由于你想按当前价格卖出价值 100 USDT 的币，部分卖出的确切数量为 ","position":{"start":{"line":1006,"column":1},"end":{"line":1006,"column":1}},"key":"NLuLaVu5hG"},{"type":"inlineCode","value":"100 * 2 / 400","position":{"start":{"line":1006,"column":1},"end":{"line":1006,"column":1}},"key":"U8OTErMDZL"},{"type":"text","value":"，等于 0.5 个 SHITCOIN/USDT。既然知道了要卖出的数量（0.5），你在 ","position":{"start":{"line":1006,"column":1},"end":{"line":1006,"column":1}},"key":"uaBPYUOFQc"},{"type":"inlineCode","value":"adjust_trade_position","position":{"start":{"line":1006,"column":1},"end":{"line":1006,"column":1}},"key":"zd4jLGsvCb"},{"type":"text","value":" 函数中需要返回的值是 ","position":{"start":{"line":1006,"column":1},"end":{"line":1006,"column":1}},"key":"uVghrKyr5E"},{"type":"inlineCode","value":"-部分出场数量 * trade.stake_amount / trade.amount","position":{"start":{"line":1006,"column":1},"end":{"line":1006,"column":1}},"key":"SsEVlivNfq"},{"type":"text","value":"，即 -25。机器人会卖出 0.5 个 SHITCOIN/USDT，交易中保留 1.5 个。你将从部分出场中获得 100 USDT。","position":{"start":{"line":1006,"column":1},"end":{"line":1006,"column":1}},"key":"UXmbxTJAyM"}],"key":"AeoMJdOleZ"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"止损计算","position":{"start":{"line":1008,"column":1},"end":{"line":1008,"column":1}},"key":"FJEyTdWfhk"}],"key":"MmG4vLr40m"},{"type":"paragraph","position":{"start":{"line":1010,"column":1},"end":{"line":1010,"column":1}},"children":[{"type":"text","value":"止损仍然以初始开仓价为基准计算，而不是均价。","position":{"start":{"line":1010,"column":1},"end":{"line":1010,"column":1}},"key":"VerDRSrMyK"}],"key":"oHaDlIXvJe"},{"type":"paragraph","position":{"start":{"line":1012,"column":1},"end":{"line":1012,"column":1}},"children":[{"type":"text","value":"常规止损规则仍然适用（不能下移止损）。","position":{"start":{"line":1012,"column":1},"end":{"line":1012,"column":1}},"key":"rrjJVpWkI6"}],"key":"OsbHVfuOnl"},{"type":"paragraph","position":{"start":{"line":1014,"column":1},"end":{"line":1014,"column":1}},"children":[{"type":"text","value":"虽然 ","position":{"start":{"line":1014,"column":1},"end":{"line":1014,"column":1}},"key":"vgP3khYt5Z"},{"type":"inlineCode","value":"/stopentry","position":{"start":{"line":1014,"column":1},"end":{"line":1014,"column":1}},"key":"cyhb4Kfcsx"},{"type":"text","value":" 命令会阻止机器人进入新交易，但仓位调整功能会继续在已有交易上买入新订单。","position":{"start":{"line":1014,"column":1},"end":{"line":1014,"column":1}},"key":"L43LVl9UEc"}],"key":"K7kcWJjjJB"}],"key":"Q1oFAg4tze"},{"type":"code","lang":"python","value":"# Default imports\n\nclass DigDeeperStrategy(IStrategy):\n\n    position_adjustment_enable = True\n\n    # Attempts to handle large drops with DCA. High stoploss is required.\n    stoploss = -0.30\n\n    # ... populate_* methods\n\n    # Example specific variables\n    max_entry_position_adjustment = 3\n    # This number is explained a bit further down\n    max_dca_multiplier = 5.5\n\n    # This is called when placing the initial order (opening trade)\n    def custom_stake_amount(self, pair: str, current_time: datetime, current_rate: float,\n                            proposed_stake: float, min_stake: float | None, max_stake: float,\n                            leverage: float, entry_tag: str | None, side: str,\n                            **kwargs) -\u003e float:\n\n        # We need to leave most of the funds for possible further DCA orders\n        # This also applies to fixed stakes\n        return proposed_stake / self.max_dca_multiplier\n\n    def adjust_trade_position(self, trade: Trade, current_time: datetime,\n                              current_rate: float, current_profit: float,\n                              min_stake: float | None, max_stake: float,\n                              current_entry_rate: float, current_exit_rate: float,\n                              current_entry_profit: float, current_exit_profit: float,\n                              **kwargs\n                              ) -\u003e float | None | tuple[float | None, str | None]:\n        \"\"\"\n        Custom trade adjustment logic, returning the stake amount that a trade should be\n        increased or decreased.\n        This means extra entry or exit orders with additional fees.\n        Only called when `position_adjustment_enable` is set to True.\n\n        For full documentation please go to https://www.freqtrade.io/en/latest/strategy-advanced/\n\n        When not implemented by a strategy, returns None\n\n        :param trade: trade object.\n        :param current_time: datetime object, containing the current datetime\n        :param current_rate: Current entry rate (same as current_entry_profit)\n        :param current_profit: Current profit (as ratio), calculated based on current_rate \n                               (same as current_entry_profit).\n        :param min_stake: Minimal stake size allowed by exchange (for both entries and exits)\n        :param max_stake: Maximum stake allowed (either through balance, or by exchange limits).\n        :param current_entry_rate: Current rate using entry pricing.\n        :param current_exit_rate: Current rate using exit pricing.\n        :param current_entry_profit: Current profit using entry pricing.\n        :param current_exit_profit: Current profit using exit pricing.\n        :param **kwargs: Ensure to keep this here so updates to this won't break your strategy.\n        :return float: Stake amount to adjust your trade,\n                       Positive values to increase position, Negative values to decrease position.\n                       Return None for no action.\n                       Optionally, return a tuple with a 2nd element with an order reason\n        \"\"\"\n        if trade.has_open_orders:\n            # Only act if no orders are open\n            return\n\n        if current_profit \u003e 0.05 and trade.nr_of_successful_exits == 0:\n            # Take half of the profit at +5%\n            return -(trade.stake_amount / 2), \"half_profit_5%\"\n\n        if current_profit \u003e -0.05:\n            return None\n\n        # Obtain pair dataframe (just to show how to access it)\n        dataframe, _ = self.dp.get_analyzed_dataframe(trade.pair, self.timeframe)\n        # Only buy when not actively falling price.\n        last_candle = dataframe.iloc[-1].squeeze()\n        previous_candle = dataframe.iloc[-2].squeeze()\n        if last_candle[\"close\"] \u003c previous_candle[\"close\"]:\n            return None\n\n        filled_entries = trade.select_filled_orders(trade.entry_side)\n        count_of_entries = trade.nr_of_successful_entries\n        # Allow up to 3 additional increasingly larger buys (4 in total)\n        # Initial buy is 1x\n        # If that falls to -5% profit, we buy 1.25x more, average profit should increase to roughly -2.2%\n        # If that falls down to -5% again, we buy 1.5x more\n        # If that falls once again down to -5%, we buy 1.75x more\n        # Total stake for this trade would be 1 + 1.25 + 1.5 + 1.75 = 5.5x of the initial allowed stake.\n        # That is why max_dca_multiplier is 5.5\n        # Hope you have a deep wallet!\n        try:\n            # This returns first order stake size\n            stake_amount = filled_entries[0].stake_amount_filled\n            # This then calculates current safety order size\n            stake_amount = stake_amount * (1 + (count_of_entries * 0.25))\n            return stake_amount, \"1/3rd_increase\"\n        except Exception as exception:\n            return None\n\n        return None\n","position":{"start":{"line":1017,"column":1},"end":{"line":1118,"column":1}},"key":"jub17HSZrJ"},{"type":"heading","depth":4,"position":{"start":{"line":1120,"column":1},"end":{"line":1120,"column":1}},"children":[{"type":"text","value":"仓位调整计算","position":{"start":{"line":1120,"column":1},"end":{"line":1120,"column":1}},"key":"TM12HrfyyQ"}],"identifier":"id","label":"仓位调整计算","html_id":"id-25","implicit":true,"key":"A2DzU9QCyh"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1122,"column":1},"end":{"line":1126,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1122,"column":1},"end":{"line":1122,"column":1}},"children":[{"type":"text","value":"入场价格使用加权平均计算。","position":{"start":{"line":1122,"column":1},"end":{"line":1122,"column":1}},"key":"fVBq7KwgL9"}],"key":"ou8MI6ngno"},{"type":"listItem","spread":true,"position":{"start":{"line":1123,"column":1},"end":{"line":1123,"column":1}},"children":[{"type":"text","value":"出场不会影响平均入场价格。","position":{"start":{"line":1123,"column":1},"end":{"line":1123,"column":1}},"key":"eWjEQGeUYG"}],"key":"yWeHJr37Th"},{"type":"listItem","spread":true,"position":{"start":{"line":1124,"column":1},"end":{"line":1124,"column":1}},"children":[{"type":"text","value":"部分出场的相对利润是相对于此时的平均入场价格。","position":{"start":{"line":1124,"column":1},"end":{"line":1124,"column":1}},"key":"eN4KaOKGzs"}],"key":"R9RHZEKySZ"},{"type":"listItem","spread":true,"position":{"start":{"line":1125,"column":1},"end":{"line":1126,"column":1}},"children":[{"type":"text","value":"最终出场的相对利润是基于总投资资本计算的。（见下面的例子）","position":{"start":{"line":1125,"column":1},"end":{"line":1125,"column":1}},"key":"PFFq4qWlsv"}],"key":"uG1XFgpWHt"}],"key":"MZZzFAL5t1"},{"type":"admonition","kind":"hint","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"计算示例","position":{"start":{"line":1127,"column":1},"end":{"line":1127,"column":1}},"key":"PuW4cDNEFM"}],"key":"pcHfldBNfK"},{"type":"paragraph","position":{"start":{"line":1128,"column":1},"end":{"line":1128,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":1128,"column":1},"end":{"line":1128,"column":1}},"children":[{"type":"text","value":"此示例假设零手续费，且为一个虚拟币的多头仓位。","position":{"start":{"line":1128,"column":1},"end":{"line":1128,"column":1}},"key":"hC6sCq3ken"}],"key":"B9kMkZAWrl"}],"key":"gniJzIGmA3"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1130,"column":1},"end":{"line":1136,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1130,"column":1},"end":{"line":1130,"column":1}},"children":[{"type":"text","value":"买入 100@8$","position":{"start":{"line":1130,"column":1},"end":{"line":1130,"column":1}},"key":"M897RPzOpk"}],"key":"ekWq9ukAwJ"},{"type":"listItem","spread":true,"position":{"start":{"line":1131,"column":1},"end":{"line":1131,"column":1}},"children":[{"type":"text","value":"买入 100@9$ -\u003e 平均价格：8.5$","position":{"start":{"line":1131,"column":1},"end":{"line":1131,"column":1}},"key":"nVdN2IDcZE"}],"key":"Y8Zumnxs6q"},{"type":"listItem","spread":true,"position":{"start":{"line":1132,"column":1},"end":{"line":1132,"column":1}},"children":[{"type":"text","value":"卖出 100@10$ -\u003e 平均价格：8.5$，已实现利润 150$，17.65%","position":{"start":{"line":1132,"column":1},"end":{"line":1132,"column":1}},"key":"Bns2ikvyEV"}],"key":"wWiK7qABIe"},{"type":"listItem","spread":true,"position":{"start":{"line":1133,"column":1},"end":{"line":1133,"column":1}},"children":[{"type":"text","value":"买入 150@11$ -\u003e 平均价格：10$，已实现利润 150$，17.65%","position":{"start":{"line":1133,"column":1},"end":{"line":1133,"column":1}},"key":"AkEvj56Mt3"}],"key":"ERXyVwSjyd"},{"type":"listItem","spread":true,"position":{"start":{"line":1134,"column":1},"end":{"line":1134,"column":1}},"children":[{"type":"text","value":"卖出 100@12$ -\u003e 平均价格：10$，总已实现利润 350$，20%","position":{"start":{"line":1134,"column":1},"end":{"line":1134,"column":1}},"key":"r4Z3UkSFfX"}],"key":"RUo0XwO1AR"},{"type":"listItem","spread":true,"position":{"start":{"line":1135,"column":1},"end":{"line":1136,"column":1}},"children":[{"type":"text","value":"卖出 150@14$ -\u003e 平均价格：10$，总已实现利润 950$，40%  \u003c- ","position":{"start":{"line":1135,"column":1},"end":{"line":1135,"column":1}},"key":"OFonfuKij1"},{"type":"emphasis","position":{"start":{"line":1135,"column":1},"end":{"line":1135,"column":1}},"children":[{"type":"text","value":"这将是最后的\"出场\"消息","position":{"start":{"line":1135,"column":1},"end":{"line":1135,"column":1}},"key":"Vj4JhtXRcR"}],"key":"HJzCBQ8MTj"}],"key":"GbKJLXpoFt"}],"key":"RMogJXZMYz"},{"type":"paragraph","position":{"start":{"line":1137,"column":1},"end":{"line":1137,"column":1}},"children":[{"type":"text","value":"这笔交易的总利润是 950$，总投资为 3350$（","position":{"start":{"line":1137,"column":1},"end":{"line":1137,"column":1}},"key":"xJw80SONdC"},{"type":"inlineCode","value":"100@8$ + 100@9$ + 150@11$","position":{"start":{"line":1137,"column":1},"end":{"line":1137,"column":1}},"key":"gfFyz1Y6QT"},{"type":"text","value":"）。因此，最终相对利润为 28.35%（","position":{"start":{"line":1137,"column":1},"end":{"line":1137,"column":1}},"key":"NjqBPBYeKR"},{"type":"inlineCode","value":"950 / 3350","position":{"start":{"line":1137,"column":1},"end":{"line":1137,"column":1}},"key":"gE25vqTkWO"},{"type":"text","value":"）。","position":{"start":{"line":1137,"column":1},"end":{"line":1137,"column":1}},"key":"NNKkzEzulz"}],"key":"IPxh2TEZBG"}],"key":"R9sMeMj5Im"},{"type":"heading","depth":3,"position":{"start":{"line":1140,"column":1},"end":{"line":1140,"column":1}},"children":[{"type":"text","value":"调整订单价格","position":{"start":{"line":1140,"column":1},"end":{"line":1140,"column":1}},"key":"NXDkFz77sa"}],"identifier":"id","label":"调整订单价格","html_id":"id-26","implicit":true,"key":"OCVOSWZ5Bq"},{"type":"paragraph","position":{"start":{"line":1142,"column":1},"end":{"line":1142,"column":1}},"children":[{"type":"text","value":"策略开发者可以使用 ","position":{"start":{"line":1142,"column":1},"end":{"line":1142,"column":1}},"key":"JJWl2LgNEs"},{"type":"inlineCode","value":"adjust_order_price()","position":{"start":{"line":1142,"column":1},"end":{"line":1142,"column":1}},"key":"bf8tlgxvpx"},{"type":"text","value":" 回调在新K线到达时刷新/替换限价订单。","position":{"start":{"line":1142,"column":1},"end":{"line":1142,"column":1}},"key":"Fh2BNtFvk0"}],"key":"ULpchcaLWB"},{"type":"paragraph","position":{"start":{"line":1144,"column":1},"end":{"line":1144,"column":1}},"children":[{"type":"text","value":"除非订单在当前K线内已被（重新）放置，否则此回调在每次迭代时都会被调用一次 - 限制每个订单的最大（重新）放置次数为每根K线一次。","position":{"start":{"line":1144,"column":1},"end":{"line":1144,"column":1}},"key":"P8VoGQsO42"}],"key":"IVKlszUUOO"},{"type":"paragraph","position":{"start":{"line":1146,"column":1},"end":{"line":1146,"column":1}},"children":[{"type":"text","value":"这也意味着第一次调用将在初始订单放置后的下一根K线开始时进行。","position":{"start":{"line":1146,"column":1},"end":{"line":1146,"column":1}},"key":"HzSMWpzhdS"}],"key":"RsYaESx7ny"},{"type":"paragraph","position":{"start":{"line":1148,"column":1},"end":{"line":1148,"column":1}},"children":[{"type":"text","value":"请注意，","position":{"start":{"line":1148,"column":1},"end":{"line":1148,"column":1}},"key":"mHVrYN9Rgm"},{"type":"inlineCode","value":"custom_entry_price()","position":{"start":{"line":1148,"column":1},"end":{"line":1148,"column":1}},"key":"MIs99uQ7NF"},{"type":"text","value":"/","position":{"start":{"line":1148,"column":1},"end":{"line":1148,"column":1}},"key":"lZT3P952ox"},{"type":"inlineCode","value":"custom_exit_price()","position":{"start":{"line":1148,"column":1},"end":{"line":1148,"column":1}},"key":"vK4GnSSrdp"},{"type":"text","value":" 仍然是在信号发出时决定初始限价订单价格目标的方法。","position":{"start":{"line":1148,"column":1},"end":{"line":1148,"column":1}},"key":"XTEPmAaSJ8"}],"key":"Z9mrzDKTu6"},{"type":"paragraph","position":{"start":{"line":1150,"column":1},"end":{"line":1150,"column":1}},"children":[{"type":"text","value":"可以通过返回 ","position":{"start":{"line":1150,"column":1},"end":{"line":1150,"column":1}},"key":"zGAhGJDJ5N"},{"type":"inlineCode","value":"None","position":{"start":{"line":1150,"column":1},"end":{"line":1150,"column":1}},"key":"tUCktGQqsQ"},{"type":"text","value":" 来取消此回调中的订单。","position":{"start":{"line":1150,"column":1},"end":{"line":1150,"column":1}},"key":"VVJ5pNpyQc"}],"key":"t8RGc0qNQy"},{"type":"paragraph","position":{"start":{"line":1152,"column":1},"end":{"line":1152,"column":1}},"children":[{"type":"text","value":"返回 ","position":{"start":{"line":1152,"column":1},"end":{"line":1152,"column":1}},"key":"Cz2FqSYke1"},{"type":"inlineCode","value":"current_order_rate","position":{"start":{"line":1152,"column":1},"end":{"line":1152,"column":1}},"key":"K0bNugA9tp"},{"type":"text","value":" 将保持订单在交易所\"原样\"。","position":{"start":{"line":1152,"column":1},"end":{"line":1152,"column":1}},"key":"WAtH3rzJ5c"}],"key":"t5fPnmwp0M"},{"type":"paragraph","position":{"start":{"line":1154,"column":1},"end":{"line":1154,"column":1}},"children":[{"type":"text","value":"返回任何其他价格将取消现有订单，并替换为新订单。","position":{"start":{"line":1154,"column":1},"end":{"line":1154,"column":1}},"key":"mGY5Zke52Y"}],"key":"MxnpmcOpoo"},{"type":"paragraph","position":{"start":{"line":1156,"column":1},"end":{"line":1157,"column":1}},"children":[{"type":"text","value":"如果原始订单的取消失败，则不会替换订单 - 尽管订单很可能已在交易所被取消。如果这种情况发生在初始入场时，将导致订单被删除，而在仓位调整订单中，将导致交易规模保持不变。","position":{"start":{"line":1156,"column":1},"end":{"line":1156,"column":1}},"key":"gOKOQ9D7HE"},{"type":"break","position":{"start":{"line":1156,"column":1},"end":{"line":1156,"column":1}},"key":"umuFPXQT97"},{"type":"text","value":"如果订单已部分成交，则不会替换订单。但是，如果需要/希望，你可以使用 ","position":{"start":{"line":1156,"column":1},"end":{"line":1156,"column":1}},"key":"z5mEVA7P0P"},{"type":"crossReference","position":{"start":{"line":1156,"column":1},"end":{"line":1156,"column":1}},"children":[{"type":"inlineCode","value":"adjust_trade_position()","position":{"start":{"line":1156,"column":1},"end":{"line":1156,"column":1}},"key":"yeWoKz6eFb"}],"identifier":"adjust-trade-position","label":"adjust-trade-position","kind":"heading","template":"{name}","resolved":true,"html_id":"adjust-trade-position","key":"m1DLYQwj3G"},{"type":"text","value":" 来调整交易规模到预期的仓位大小。","position":{"start":{"line":1156,"column":1},"end":{"line":1156,"column":1}},"key":"l6wjoAA4xk"}],"key":"TrRmdDNjo7"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"常规超时","position":{"start":{"line":1159,"column":1},"end":{"line":1159,"column":1}},"key":"VU6a4iPRdl"}],"key":"WkqnYjJ8aY"},{"type":"paragraph","position":{"start":{"line":1160,"column":1},"end":{"line":1160,"column":1}},"children":[{"type":"text","value":"入场 ","position":{"start":{"line":1160,"column":1},"end":{"line":1160,"column":1}},"key":"vmLip6UvYW"},{"type":"inlineCode","value":"unfilledtimeout","position":{"start":{"line":1160,"column":1},"end":{"line":1160,"column":1}},"key":"KuDhqVvYJW"},{"type":"text","value":" 机制（以及 ","position":{"start":{"line":1160,"column":1},"end":{"line":1160,"column":1}},"key":"FtN0ubEIvs"},{"type":"inlineCode","value":"check_entry_timeout()","position":{"start":{"line":1160,"column":1},"end":{"line":1160,"column":1}},"key":"r4IspXv11Q"},{"type":"text","value":"/","position":{"start":{"line":1160,"column":1},"end":{"line":1160,"column":1}},"key":"hh7w6EA3Zc"},{"type":"inlineCode","value":"check_exit_timeout()","position":{"start":{"line":1160,"column":1},"end":{"line":1160,"column":1}},"key":"CyaPb92ePj"},{"type":"text","value":"）优先于此回调。","position":{"start":{"line":1160,"column":1},"end":{"line":1160,"column":1}},"key":"KFJ7ygLU7X"}],"key":"u4FUvxWTXa"},{"type":"paragraph","position":{"start":{"line":1162,"column":1},"end":{"line":1162,"column":1}},"children":[{"type":"text","value":"通过上述方法取消的订单不会调用此回调。请确保更新超时值以符合你的预期。","position":{"start":{"line":1162,"column":1},"end":{"line":1162,"column":1}},"key":"mkZvifZYEk"}],"key":"cbuDnb8c3q"}],"key":"ADDfOVeIzO"},{"type":"code","lang":"python","value":"# Default imports\n\nclass AwesomeStrategy(IStrategy):\n\n    # ... populate_* methods\n\n    def adjust_order_price(\n        self,\n        trade: Trade,\n        order: Order | None,\n        pair: str,\n        current_time: datetime,\n        proposed_rate: float,\n        current_order_rate: float,\n        entry_tag: str | None,\n        side: str,\n        is_entry: bool,\n        **kwargs,\n    ) -\u003e float | None:\n        \"\"\"\n        Exit and entry order price re-adjustment logic, returning the user desired limit price.\n        This only executes when a order was already placed, still open (unfilled fully or partially)\n        and not timed out on subsequent candles after entry trigger.\n\n        For full documentation please go to https://www.freqtrade.io/en/latest/strategy-callbacks/\n\n        When not implemented by a strategy, returns current_order_rate as default.\n        If current_order_rate is returned then the existing order is maintained.\n        If None is returned then order gets canceled but not replaced by a new one.\n\n        :param pair: Pair that's currently analyzed\n        :param trade: Trade object.\n        :param order: Order object\n        :param current_time: datetime object, containing the current datetime\n        :param proposed_rate: Rate, calculated based on pricing settings in entry_pricing.\n        :param current_order_rate: Rate of the existing order in place.\n        :param entry_tag: Optional entry_tag (buy_tag) if provided with the buy signal.\n        :param side: 'long' or 'short' - indicating the direction of the proposed trade\n        :param is_entry: True if the order is an entry order, False if it's an exit order.\n        :param **kwargs: Ensure to keep this here so updates to this won't break your strategy.\n        :return float or None: New entry price value if provided\n        \"\"\"\n\n        # Limit entry orders to use and follow SMA200 as price target for the first 10 minutes since entry trigger for BTC/USDT pair.\n        if (\n            is_entry\n            and pair == \"BTC/USDT\" \n            and entry_tag == \"long_sma200\" \n            and side == \"long\" \n            and (current_time - timedelta(minutes=10)) \u003c= trade.open_date_utc\n        ):\n            # just cancel the order if it has been filled more than half of the amount\n            if order.filled \u003e order.remaining:\n                return None\n            else:\n                dataframe, _ = self.dp.get_analyzed_dataframe(pair=pair, timeframe=self.timeframe)\n                current_candle = dataframe.iloc[-1].squeeze()\n                # desired price\n                return current_candle[\"sma_200\"]\n        # default: maintain existing order\n        return current_order_rate","position":{"start":{"line":1165,"column":1},"end":{"line":1227,"column":1}},"key":"PIZmFnkLF7"},{"type":"admonition","kind":"danger","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"与 ","position":{"start":{"line":1229,"column":1},"end":{"line":1229,"column":1}},"key":"FmlwlgAgQN"},{"type":"inlineCode","value":"adjust_*_price()","position":{"start":{"line":1229,"column":1},"end":{"line":1229,"column":1}},"key":"Q0Ava4H4OT"},{"type":"text","value":" 的不兼容性","position":{"start":{"line":1229,"column":1},"end":{"line":1229,"column":1}},"key":"H1ZtZ43qeE"}],"key":"dabbSmgJrD"},{"type":"paragraph","position":{"start":{"line":1230,"column":1},"end":{"line":1230,"column":1}},"children":[{"type":"text","value":"如果你同时实现了 ","position":{"start":{"line":1230,"column":1},"end":{"line":1230,"column":1}},"key":"IiOZ1biNY9"},{"type":"inlineCode","value":"adjust_order_price()","position":{"start":{"line":1230,"column":1},"end":{"line":1230,"column":1}},"key":"zUrhJUbKMV"},{"type":"text","value":" 和 ","position":{"start":{"line":1230,"column":1},"end":{"line":1230,"column":1}},"key":"JaHUvVWnnZ"},{"type":"inlineCode","value":"adjust_entry_price()","position":{"start":{"line":1230,"column":1},"end":{"line":1230,"column":1}},"key":"rSgdYDWD7v"},{"type":"text","value":"/","position":{"start":{"line":1230,"column":1},"end":{"line":1230,"column":1}},"key":"LAx0Vvjv3x"},{"type":"inlineCode","value":"adjust_exit_price()","position":{"start":{"line":1230,"column":1},"end":{"line":1230,"column":1}},"key":"Gc6tyiDDmk"},{"type":"text","value":"，则只会使用 ","position":{"start":{"line":1230,"column":1},"end":{"line":1230,"column":1}},"key":"nUvMKnVhEY"},{"type":"inlineCode","value":"adjust_order_price()","position":{"start":{"line":1230,"column":1},"end":{"line":1230,"column":1}},"key":"kYLzMJMaA9"},{"type":"text","value":"。","position":{"start":{"line":1230,"column":1},"end":{"line":1230,"column":1}},"key":"aVU9R9H3Hp"}],"key":"egzRchTTWw"},{"type":"paragraph","position":{"start":{"line":1232,"column":1},"end":{"line":1232,"column":1}},"children":[{"type":"text","value":"如果你需要调整入场/出场价格，你可以选择在 ","position":{"start":{"line":1232,"column":1},"end":{"line":1232,"column":1}},"key":"qFHx8XcmLx"},{"type":"inlineCode","value":"adjust_order_price()","position":{"start":{"line":1232,"column":1},"end":{"line":1232,"column":1}},"key":"GYnXMGvQCG"},{"type":"text","value":" 中实现逻辑，或者使用分开的 ","position":{"start":{"line":1232,"column":1},"end":{"line":1232,"column":1}},"key":"YFRvHr99Fi"},{"type":"inlineCode","value":"adjust_entry_price()","position":{"start":{"line":1232,"column":1},"end":{"line":1232,"column":1}},"key":"YYOvJ1fubK"},{"type":"text","value":" / ","position":{"start":{"line":1232,"column":1},"end":{"line":1232,"column":1}},"key":"gKAHtEUR2Q"},{"type":"inlineCode","value":"adjust_exit_price()","position":{"start":{"line":1232,"column":1},"end":{"line":1232,"column":1}},"key":"SCs6p08Z5o"},{"type":"text","value":" 回调，但不能同时使用两者。","position":{"start":{"line":1232,"column":1},"end":{"line":1232,"column":1}},"key":"GDkjbIlNho"}],"key":"BfVjS78ppr"},{"type":"paragraph","position":{"start":{"line":1234,"column":1},"end":{"line":1234,"column":1}},"children":[{"type":"text","value":"混合使用这些功能是不支持的，会在机器人启动时引发错误。","position":{"start":{"line":1234,"column":1},"end":{"line":1234,"column":1}},"key":"U8vwdG9xD5"}],"key":"raHrF1oIIF"}],"key":"gmECuuS70q"},{"type":"heading","depth":4,"position":{"start":{"line":1237,"column":1},"end":{"line":1237,"column":1}},"children":[{"type":"text","value":"调整入场价格","position":{"start":{"line":1237,"column":1},"end":{"line":1237,"column":1}},"key":"TviQx7bwmf"}],"identifier":"id","label":"调整入场价格","html_id":"id-27","implicit":true,"key":"dPACZeEnIn"},{"type":"paragraph","position":{"start":{"line":1239,"column":1},"end":{"line":1239,"column":1}},"children":[{"type":"text","value":"策略开发者可以使用 ","position":{"start":{"line":1239,"column":1},"end":{"line":1239,"column":1}},"key":"LABAxqwlJu"},{"type":"inlineCode","value":"adjust_entry_price()","position":{"start":{"line":1239,"column":1},"end":{"line":1239,"column":1}},"key":"HMUHpNvnKL"},{"type":"text","value":" 回调在新K线到达时刷新/替换入场限价订单。","position":{"start":{"line":1239,"column":1},"end":{"line":1239,"column":1}},"key":"Nucz4L3l27"}],"key":"OvlnLLwucp"},{"type":"paragraph","position":{"start":{"line":1241,"column":1},"end":{"line":1241,"column":1}},"children":[{"type":"text","value":"这是 ","position":{"start":{"line":1241,"column":1},"end":{"line":1241,"column":1}},"key":"PIBYqf2on4"},{"type":"inlineCode","value":"adjust_order_price()","position":{"start":{"line":1241,"column":1},"end":{"line":1241,"column":1}},"key":"VVWXWtRbcq"},{"type":"text","value":" 的一个子集，仅用于入场订单。","position":{"start":{"line":1241,"column":1},"end":{"line":1241,"column":1}},"key":"E7fIxJhTXV"}],"key":"h4orVal1Ln"},{"type":"paragraph","position":{"start":{"line":1243,"column":1},"end":{"line":1243,"column":1}},"children":[{"type":"text","value":"其余所有行为与 ","position":{"start":{"line":1243,"column":1},"end":{"line":1243,"column":1}},"key":"X0osbbZDSd"},{"type":"inlineCode","value":"adjust_order_price()","position":{"start":{"line":1243,"column":1},"end":{"line":1243,"column":1}},"key":"daGvIX2YL7"},{"type":"text","value":" 相同。","position":{"start":{"line":1243,"column":1},"end":{"line":1243,"column":1}},"key":"n7tqmuwSqU"}],"key":"aTtYVtt7b1"},{"type":"paragraph","position":{"start":{"line":1245,"column":1},"end":{"line":1245,"column":1}},"children":[{"type":"text","value":"交易开始日期（","position":{"start":{"line":1245,"column":1},"end":{"line":1245,"column":1}},"key":"N7F8XsbYTi"},{"type":"inlineCode","value":"trade.open_date_utc","position":{"start":{"line":1245,"column":1},"end":{"line":1245,"column":1}},"key":"z5daHBNPy8"},{"type":"text","value":"）将保持在第一个订单放置的时间。","position":{"start":{"line":1245,"column":1},"end":{"line":1245,"column":1}},"key":"BQQUXsehfy"}],"key":"fM0CAWfBDb"},{"type":"paragraph","position":{"start":{"line":1247,"column":1},"end":{"line":1247,"column":1}},"children":[{"type":"text","value":"请确保注意这一点 - 并相应地调整其他回调中的逻辑，使用第一个成交订单的日期。","position":{"start":{"line":1247,"column":1},"end":{"line":1247,"column":1}},"key":"XVsnT1s37Z"}],"key":"XJZT0f4WOZ"},{"type":"heading","depth":4,"position":{"start":{"line":1249,"column":1},"end":{"line":1249,"column":1}},"children":[{"type":"text","value":"调整出场价格","position":{"start":{"line":1249,"column":1},"end":{"line":1249,"column":1}},"key":"htP9eBQC7j"}],"identifier":"id","label":"调整出场价格","html_id":"id-28","implicit":true,"key":"ixaEyGSEtH"},{"type":"paragraph","position":{"start":{"line":1251,"column":1},"end":{"line":1251,"column":1}},"children":[{"type":"text","value":"策略开发者可以使用 ","position":{"start":{"line":1251,"column":1},"end":{"line":1251,"column":1}},"key":"QXREhqY90m"},{"type":"inlineCode","value":"adjust_exit_price()","position":{"start":{"line":1251,"column":1},"end":{"line":1251,"column":1}},"key":"YJJAKRipU5"},{"type":"text","value":" 回调在新K线到达时刷新/替换出场限价订单。","position":{"start":{"line":1251,"column":1},"end":{"line":1251,"column":1}},"key":"fzDNooGNOJ"}],"key":"yAoAc3LApE"},{"type":"paragraph","position":{"start":{"line":1253,"column":1},"end":{"line":1253,"column":1}},"children":[{"type":"text","value":"这是 ","position":{"start":{"line":1253,"column":1},"end":{"line":1253,"column":1}},"key":"kfnjtqRVfN"},{"type":"inlineCode","value":"adjust_order_price()","position":{"start":{"line":1253,"column":1},"end":{"line":1253,"column":1}},"key":"tyvVGuduYM"},{"type":"text","value":" 的一个子集，仅用于出场订单。","position":{"start":{"line":1253,"column":1},"end":{"line":1253,"column":1}},"key":"yQj3w9Ttrd"}],"key":"crzZpJpgmH"},{"type":"paragraph","position":{"start":{"line":1255,"column":1},"end":{"line":1255,"column":1}},"children":[{"type":"text","value":"其余所有行为与 ","position":{"start":{"line":1255,"column":1},"end":{"line":1255,"column":1}},"key":"VMhdAUkMwM"},{"type":"inlineCode","value":"adjust_order_price()","position":{"start":{"line":1255,"column":1},"end":{"line":1255,"column":1}},"key":"YRLXLwq7Q7"},{"type":"text","value":" 相同。","position":{"start":{"line":1255,"column":1},"end":{"line":1255,"column":1}},"key":"uHcuj2nvkX"}],"key":"y3ygPxkSF6"},{"type":"heading","depth":3,"position":{"start":{"line":1257,"column":1},"end":{"line":1257,"column":1}},"children":[{"type":"text","value":"杠杆回调","position":{"start":{"line":1257,"column":1},"end":{"line":1257,"column":1}},"key":"nruCRPDgm9"}],"identifier":"id","label":"杠杆回调","html_id":"id-29","implicit":true,"key":"WfM3nkeNvC"},{"type":"paragraph","position":{"start":{"line":1259,"column":1},"end":{"line":1259,"column":1}},"children":[{"type":"text","value":"在允许杠杆交易的市场中，此方法必须返回所需的杠杆倍数（默认为 1 -\u003e 无杠杆）。","position":{"start":{"line":1259,"column":1},"end":{"line":1259,"column":1}},"key":"hnXbJqRb87"}],"key":"wzLi6HGIMO"},{"type":"paragraph","position":{"start":{"line":1261,"column":1},"end":{"line":1261,"column":1}},"children":[{"type":"text","value":"假设资金为 500USDT，杠杆倍数为 3 的交易将产生 500 x 3 = 1500 USDT 的仓位。","position":{"start":{"line":1261,"column":1},"end":{"line":1261,"column":1}},"key":"w9cFgPda20"}],"key":"aKklmPtqyQ"},{"type":"paragraph","position":{"start":{"line":1263,"column":1},"end":{"line":1264,"column":1}},"children":[{"type":"text","value":"超过 ","position":{"start":{"line":1263,"column":1},"end":{"line":1263,"column":1}},"key":"rJW7T7ssvE"},{"type":"inlineCode","value":"max_leverage","position":{"start":{"line":1263,"column":1},"end":{"line":1263,"column":1}},"key":"PyZlsgXKrN"},{"type":"text","value":" 的值将被调整为 ","position":{"start":{"line":1263,"column":1},"end":{"line":1263,"column":1}},"key":"ucaPaLuMXg"},{"type":"inlineCode","value":"max_leverage","position":{"start":{"line":1263,"column":1},"end":{"line":1263,"column":1}},"key":"f4HTABKJmq"},{"type":"text","value":"。\n对于不支持杠杆的市场/交易所，此方法将被忽略。","position":{"start":{"line":1263,"column":1},"end":{"line":1263,"column":1}},"key":"LdJBDqFHDK"}],"key":"djEnjAszRi"},{"type":"code","lang":"python","value":"# Default imports\n\nclass AwesomeStrategy(IStrategy):\n    def leverage(self, pair: str, current_time: datetime, current_rate: float,\n                 proposed_leverage: float, max_leverage: float, entry_tag: str | None, side: str,\n                 **kwargs) -\u003e float:\n        \"\"\"\n        Customize leverage for each new trade. This method is only called in futures mode.\n\n        :param pair: Pair that's currently analyzed\n        :param current_time: datetime object, containing the current datetime\n        :param current_rate: Rate, calculated based on pricing settings in exit_pricing.\n        :param proposed_leverage: A leverage proposed by the bot.\n        :param max_leverage: Max leverage allowed on this pair\n        :param entry_tag: Optional entry_tag (buy_tag) if provided with the buy signal.\n        :param side: \"long\" or \"short\" - indicating the direction of the proposed trade\n        :return: A leverage amount, which is between 1.0 and max_leverage.\n        \"\"\"\n        return 1.0","position":{"start":{"line":1266,"column":1},"end":{"line":1286,"column":1}},"key":"PiTKc3nqAJ"},{"type":"paragraph","position":{"start":{"line":1288,"column":1},"end":{"line":1288,"column":1}},"children":[{"type":"text","value":"所有利润计算都包含杠杆。止损和 ROI 的计算也包含杠杆。","position":{"start":{"line":1288,"column":1},"end":{"line":1288,"column":1}},"key":"NyaUzrHCoN"}],"key":"KimuLx5Qjj"},{"type":"paragraph","position":{"start":{"line":1290,"column":1},"end":{"line":1290,"column":1}},"children":[{"type":"text","value":"在 10 倍杠杆下设置 10% 的止损，将在价格下跌 1% 时触发止损。","position":{"start":{"line":1290,"column":1},"end":{"line":1290,"column":1}},"key":"P8tztTlTKC"}],"key":"V8fUFoICcM"},{"type":"heading","depth":3,"position":{"start":{"line":1292,"column":1},"end":{"line":1292,"column":1}},"children":[{"type":"text","value":"订单成交回调","position":{"start":{"line":1292,"column":1},"end":{"line":1292,"column":1}},"key":"MOglk4gb02"}],"identifier":"id","label":"订单成交回调","html_id":"id-30","implicit":true,"key":"ReOQd79kWJ"},{"type":"paragraph","position":{"start":{"line":1294,"column":1},"end":{"line":1294,"column":1}},"children":[{"type":"inlineCode","value":"order_filled()","position":{"start":{"line":1294,"column":1},"end":{"line":1294,"column":1}},"key":"HvzGKhgzym"},{"type":"text","value":" 回调可用于在订单成交后根据当前交易状态执行特定操作。","position":{"start":{"line":1294,"column":1},"end":{"line":1294,"column":1}},"key":"KN2y7a1WGP"}],"key":"a3kHKgeTlY"},{"type":"paragraph","position":{"start":{"line":1296,"column":1},"end":{"line":1296,"column":1}},"children":[{"type":"text","value":"它将独立于订单类型（入场、出场、止损或仓位调整）被调用。","position":{"start":{"line":1296,"column":1},"end":{"line":1296,"column":1}},"key":"t28yMQQ39i"}],"key":"BRb0HTTYzs"},{"type":"paragraph","position":{"start":{"line":1298,"column":1},"end":{"line":1298,"column":1}},"children":[{"type":"text","value":"假设你的策略需要在开仓时存储该 K 线的最高价，可以通过如下示例所示的回调实现这一点。","position":{"start":{"line":1298,"column":1},"end":{"line":1298,"column":1}},"key":"vtVynl1xbr"}],"key":"deyAWBqUt0"},{"type":"code","lang":"python","value":"# Default imports\n\nclass AwesomeStrategy(IStrategy):\n    def order_filled(self, pair: str, trade: Trade, order: Order, current_time: datetime, **kwargs) -\u003e None:\n        \"\"\"\n        Called right after an order fills. \n        Will be called for all order types (entry, exit, stoploss, position adjustment).\n        :param pair: Pair for trade\n        :param trade: trade object.\n        :param order: Order object.\n        :param current_time: datetime object, containing the current datetime\n        :param **kwargs: Ensure to keep this here so updates to this won't break your strategy.\n        \"\"\"\n        # Obtain pair dataframe (just to show how to access it)\n        dataframe, _ = self.dp.get_analyzed_dataframe(trade.pair, self.timeframe)\n        last_candle = dataframe.iloc[-1].squeeze()\n        \n        if (trade.nr_of_successful_entries == 1) and (order.ft_order_side == trade.entry_side):\n            trade.set_custom_data(key=\"entry_candle_high\", value=last_candle[\"high\"])\n\n        return None\n","position":{"start":{"line":1300,"column":1},"end":{"line":1323,"column":1}},"key":"jCMa4BVCDF"},{"type":"heading","depth":3,"position":{"start":{"line":1325,"column":1},"end":{"line":1325,"column":1}},"children":[{"type":"text","value":"图表注释回调","position":{"start":{"line":1325,"column":1},"end":{"line":1325,"column":1}},"key":"gHrNKVQU1M"}],"identifier":"id","label":"图表注释回调","html_id":"id-31","implicit":true,"key":"Je55sXebCn"},{"type":"paragraph","position":{"start":{"line":1327,"column":1},"end":{"line":1328,"column":1}},"children":[{"type":"text","value":"每当 freqUI 请求显示图表数据时，都会调用图表注释回调。\n此回调在交易周期中没有实际意义，仅用于图表展示。","position":{"start":{"line":1327,"column":1},"end":{"line":1327,"column":1}},"key":"V0gq9mPju7"}],"key":"zswBcwTjzM"},{"type":"paragraph","position":{"start":{"line":1330,"column":1},"end":{"line":1331,"column":1}},"children":[{"type":"text","value":"策略可以返回一个 ","position":{"start":{"line":1330,"column":1},"end":{"line":1330,"column":1}},"key":"rpLAQQrMxO"},{"type":"inlineCode","value":"AnnotationType","position":{"start":{"line":1330,"column":1},"end":{"line":1330,"column":1}},"key":"oDbx4vghd5"},{"type":"text","value":" 对象列表，这些对象会显示在图表上。\n根据返回内容，图表可以显示水平区域、垂直区域或框选区域。","position":{"start":{"line":1330,"column":1},"end":{"line":1330,"column":1}},"key":"H7WSeGkmbf"}],"key":"LXSfRgsd6p"},{"type":"paragraph","position":{"start":{"line":1333,"column":1},"end":{"line":1333,"column":1}},"children":[{"type":"text","value":"完整对象如下所示：","position":{"start":{"line":1333,"column":1},"end":{"line":1333,"column":1}},"key":"BOCW3F88S9"}],"key":"pYO1IWZLyn"},{"type":"code","lang":"json","value":"{\n    \"type\": \"area\", // Type of the annotation, currently only \"area\" is supported\n    \"start\": \"2024-01-01 15:00:00\", // Start date of the area\n    \"end\": \"2024-01-01 16:00:00\",  // End date of the area\n    \"y_start\": 94000.2,  // Price / y axis value\n    \"y_end\": 98000, // Price / y axis value\n    \"color\": \"\",\n    \"label\": \"some label\"\n}","position":{"start":{"line":1335,"column":1},"end":{"line":1345,"column":1}},"key":"Z5gRYgW3gc"},{"type":"paragraph","position":{"start":{"line":1347,"column":1},"end":{"line":1348,"column":1}},"children":[{"type":"text","value":"下面的示例将在图表上标记第 8 小时和第 15 小时的区域，使用灰色突出显示市场开盘和收盘时间。\n这显然是一个非常基础的示例。","position":{"start":{"line":1347,"column":1},"end":{"line":1347,"column":1}},"key":"wDJ0Da5v2F"}],"key":"YgsiWXEoWF"},{"type":"code","lang":"python","value":"# Default imports\n\nclass AwesomeStrategy(IStrategy):\n    def plot_annotations(\n        self, pair: str, start_date: datetime, end_date: datetime, dataframe: DataFrame, **kwargs\n    ) -\u003e list[AnnotationType]:\n        \"\"\"\n        Retrieve area annotations for a chart.\n        Must be returned as array, with type, label, color, start, end, y_start, y_end.\n        All settings except for type are optional - though it usually makes sense to include either\n        \"start and end\" or \"y_start and y_end\" for either horizontal or vertical plots\n        (or all 4 for boxes).\n        :param pair: Pair that's currently analyzed\n        :param start_date: Start date of the chart data being requested\n        :param end_date: End date of the chart data being requested\n        :param dataframe: DataFrame with the analyzed data for the chart\n        :param **kwargs: Ensure to keep this here so updates to this won't break your strategy.\n        :return: List of AnnotationType objects\n        \"\"\"\n        annotations = []\n        while start_dt \u003c end_date:\n            start_dt += timedelta(hours=1)\n            if start_dt.hour in (8, 15):\n                annotations.append(\n                    {\n                        \"type\": \"area\",\n                        \"label\": \"Trade open and close hours\",\n                        \"start\": start_dt,\n                        \"end\": start_dt + timedelta(hours=1),\n                        # Omitting y_start and y_end will result in a vertical area spanning the whole height of the main Chart\n                        \"color\": \"rgba(133, 133, 133, 0.4)\",\n                    }\n                )\n\n        return annotations\n","position":{"start":{"line":1350,"column":1},"end":{"line":1387,"column":1}},"key":"D7nuoQxjVs"},{"type":"paragraph","position":{"start":{"line":1389,"column":1},"end":{"line":1389,"column":1}},"children":[{"type":"text","value":"所有条目都将被验证，如果不符合预期的模式，将不会被传递给 UI，并且会记录错误。","position":{"start":{"line":1389,"column":1},"end":{"line":1389,"column":1}},"key":"Jrb8orzrNV"}],"key":"UvTnCQohi7"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"过多图片注释","position":{"start":{"line":1391,"column":1},"end":{"line":1391,"column":1}},"key":"D7U7Gt3sD9"}],"key":"l29cMV9Vz2"},{"type":"paragraph","position":{"start":{"line":1392,"column":1},"end":{"line":1392,"column":1}},"children":[{"type":"text","value":"使用过多注释可能导致 UI 卡顿，特别是在绘制大量历史数据时。","position":{"start":{"line":1392,"column":1},"end":{"line":1392,"column":1}},"key":"lxDiJok6nF"}],"key":"eRRAZ4YQyW"},{"type":"paragraph","position":{"start":{"line":1394,"column":1},"end":{"line":1394,"column":1}},"children":[{"type":"text","value":"请谨慎使用注释功能。","position":{"start":{"line":1394,"column":1},"end":{"line":1394,"column":1}},"key":"gmJ8ceoJAx"}],"key":"wU6zrJbahi"}],"key":"GuwaaNHE3o"},{"type":"heading","depth":4,"position":{"start":{"line":1397,"column":1},"end":{"line":1397,"column":1}},"children":[{"type":"text","value":"图表注释示例","position":{"start":{"line":1397,"column":1},"end":{"line":1397,"column":1}},"key":"HQUyoJX7ZA"}],"identifier":"id","label":"图表注释示例","html_id":"id-32","implicit":true,"key":"t93RMQFTCM"},{"type":"paragraph","position":{"start":{"line":1399,"column":1},"end":{"line":1400,"column":1}},"children":[{"type":"image","url":"/build/freqUI-chart-annotat-6ca425e986932e863842497203176546.png","alt":"FreqUI - 图表注释","position":{"start":{"line":1399,"column":1},"end":{"line":1399,"column":1}},"key":"XXnhglU0sd","urlSource":"assets/freqUI-chart-annotations-dark.png","urlOptimized":"/build/freqUI-chart-annotat-6ca425e986932e863842497203176546.webp"},{"type":"text","value":"\n","position":{"start":{"line":1399,"column":1},"end":{"line":1399,"column":1}},"key":"psMG6hUtli"},{"type":"image","url":"/build/freqUI-chart-annotat-1e4333673f820e578805f2b84b0b8eca.png","alt":"FreqUI - 图表注释","position":{"start":{"line":1399,"column":1},"end":{"line":1399,"column":1}},"key":"LWWbYJlrIS","urlSource":"assets/freqUI-chart-annotations-light.png","urlOptimized":"/build/freqUI-chart-annotat-1e4333673f820e578805f2b84b0b8eca.webp"}],"key":"kjruJBudhp"},{"type":"admonition","kind":"important","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"上图使用的代码","position":{"start":{"line":1402,"column":1},"end":{"line":1402,"column":1}},"key":"U98B4Dq5CK"}],"key":"cP0EfZb8C2"},{"type":"paragraph","position":{"start":{"line":1403,"column":1},"end":{"line":1403,"column":1}},"children":[{"type":"text","value":"这是一个示例代码，仅供参考。","position":{"start":{"line":1403,"column":1},"end":{"line":1403,"column":1}},"key":"YURGK1sUNX"}],"key":"wwYxL0FPnk"},{"type":"code","lang":"python","value":"# Default imports\n\nclass AwesomeStrategy(IStrategy):\n    def plot_annotations(\n        self, pair: str, start_date: datetime, end_date: datetime, dataframe: DataFrame, **kwargs\n    ) -\u003e list[AnnotationType]:\n        annotations = []\n        while start_dt \u003c end_date:\n            start_dt += timedelta(hours=1)\n            if (start_dt.hour % 4) == 0:\n                mark_areas.append(\n                    {\n                        \"type\": \"area\",\n                        \"label\": \"4h\",\n                        \"start\": start_dt,\n                        \"end\": start_dt + timedelta(hours=1),\n                        \"color\": \"rgba(133, 133, 133, 0.4)\",\n                    }\n                )\n            elif (start_dt.hour % 2) == 0:\n            price = dataframe.loc[dataframe[\"date\"] == start_dt, [\"close\"]].mean()\n                mark_areas.append(\n                    {\n                        \"type\": \"area\",\n                        \"label\": \"2h\",\n                        \"start\": start_dt,\n                        \"end\": start_dt + timedelta(hours=1),\n                        \"y_end\": price * 1.01,\n                        \"y_start\": price * 0.99,\n                        \"color\": \"rgba(0, 255, 0, 0.4)\",\n                    }\n                )\n\n        return annotations\n","position":{"start":{"line":1405,"column":1},"end":{"line":1441,"column":1}},"key":"Q4VO39r99a"}],"key":"cuM6SyrF9f"}],"key":"UuY9Yl1jwU"}],"key":"MvnPDkQQDp"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"策略自定义指南","short_title":"策略自定义","url":"/strategy-customization","group":"安装"},"next":{"title":"止损配置指南","short_title":"止损","url":"/stoploss","group":"安装"}}},"domain":"http://localhost:3001"},"project":{"title":"Freqtrade 中文文档","description":"Freqtrade 中文文档","authors":[{"id":"Freqtrade","name":"Freqtrade"}],"github":"https://github.com/freqtrade-cn/docs_zh-CN","keywords":["Freqtrade","中文文档","交易机器人","量化交易","加密货币","数字货币","区块链","人工智能","机器学习"],"id":"111d4f50-18b2-4ed2-9189-3954f232e613","toc":[{"file":"index.md"},{"file":"terms.md"},{"file":"docker_quickstart.md"},{"children":[{"file":"installation.md"},{"file":"windows_installation.md"}],"title":"安装"},{"file":"bot-basics.md"},{"file":"configuration.md"},{"file":"strategy-101.md"},{"file":"strategy-customization.md"},{"file":"strategy-callbacks.md"},{"file":"stoploss.md"},{"file":"plugins.md"},{"file":"bot-usage.md"},{"children":[{"file":"telegram-usage.md"},{"file":"freq-ui.md"},{"file":"rest-api.md"},{"file":"webhook-config.md"}],"title":"机器人控制和管理"},{"file":"data-download.md"},{"file":"backtesting.md"},{"file":"hyperopt.md"},{"children":[{"file":"freqai.md"},{"file":"freqai-configuration.md"},{"file":"freqai-parameter-table.md"},{"file":"freqai-feature-engineering.md"},{"file":"freqai-running.md"},{"file":"freqai-reinforcement-learning.md"},{"file":"freqai-developers.md"}],"title":"FreqAI"},{"file":"leverage.md"},{"file":"utils.md"},{"file":"plotting.md"},{"file":"exchanges.md"},{"children":[{"file":"data-analysis.md"},{"file":"strategy_analysis_example.md"},{"file":"advanced-backtesting.md"}],"title":"数据分析"},{"children":[{"file":"advanced-setup.md"},{"file":"trade-object.md"},{"file":"lookahead-analysis.md"},{"file":"recursive-analysis.md"},{"file":"strategy-advanced.md"},{"file":"advanced-hyperopt.md"},{"file":"advanced-orderflow.md"},{"file":"producer-consumer.md"},{"file":"sql_cheatsheet.md"},{"file":"edge.md"}],"title":"高级话题"},{"file":"faq.md"},{"file":"strategy_migration.md"},{"file":"updating.md"},{"file":"commands.md"},{"file":"deprecated.md"},{"file":"developer.md"},{"children":[{"file":"commands/main.md"},{"file":"commands/backtesting-analysis.md"},{"file":"commands/backtesting.md"},{"file":"commands/backtesting-show.md"},{"file":"commands/convert-data.md"},{"file":"commands/convert-db.md"},{"file":"commands/convert-trade-data.md"},{"file":"commands/create-userdir.md"},{"file":"commands/download-data.md"},{"file":"commands/edge.md"},{"file":"commands/hyperopt-list.md"},{"file":"commands/hyperopt.md"},{"file":"commands/hyperopt-show.md"},{"file":"commands/install-ui.md"},{"file":"commands/list-data.md"},{"file":"commands/list-exchanges.md"},{"file":"commands/list-freqaimodels.md"},{"file":"commands/list-hyperoptloss.md"},{"file":"commands/list-markets.md"},{"file":"commands/list-pairs.md"},{"file":"commands/list-strategies.md"},{"file":"commands/list-timeframes.md"},{"file":"commands/lookahead-analysis.md"},{"file":"commands/new-config.md"},{"file":"commands/new-strategy.md"},{"file":"commands/plot-dataframe.md"},{"file":"commands/plot-profit.md"},{"file":"commands/recursive-analysis.md"},{"file":"commands/show-config.md"},{"file":"commands/show-trades.md"},{"file":"commands/strategy-updater.md"},{"file":"commands/test-pairlist.md"},{"file":"commands/trade.md"},{"file":"commands/trades-to-ohlcv.md"},{"file":"commands/webserver.md"}],"title":"Commands"}],"thumbnail":"/build/freqtrade_poweredby-54c1a23e325977ebc310429538f96a71.svg","exports":[],"bibliography":[],"index":"index","pages":[{"slug":"terms","title":"Freqtrade 术语词典","short_title":"术语词典","description":"本文档详细解释了 Freqtrade 和量化交易中的核心术语，为用户提供全面的概念参考。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["术语","概念","词典","参考","量化交易","Freqtrade"],"level":1},{"slug":"docker-quickstart","title":"使用 Docker 运行 Freqtrade","short_title":"Docker 快速入门","description":"了解如何使用 Docker 容器运行和管理 Freqtrade 交易机器人,包括安装、配置和常见问题解决","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["Docker","容器","快速入门","部署"],"level":1},{"level":1,"title":"安装"},{"slug":"installation","title":"安装 Freqtrade","short_title":"安装","description":"了解如何安装和配置 Freqtrade 交易机器人,包括脚本安装、手动安装和 Conda 安装等多种方式","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["安装","配置","指南","入门"],"level":2},{"slug":"windows-installation","title":"Windows 安装指南","short_title":"Windows 安装","description":"本文档详细介绍了如何在 Windows 系统上安装 Freqtrade 交易机器人,包括自动安装和手动安装两种方式。","date":"","thumbnail":"/build/windows_install-36fd100b8143b6955258a9fa59765217.png","thumbnailOptimized":"/build/windows_install-36fd100b8143b6955258a9fa59765217.webp","banner":"","bannerOptimized":"","tags":["Windows","安装","配置","指南"],"level":2},{"slug":"bot-basics","title":"Freqtrade 基础","short_title":"基础指南","description":"本文档介绍了 Freqtrade 的基本术语、概念和执行逻辑,帮助你理解 Freqtrade 的工作原理。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"configuration","title":"配置 Freqtrade","short_title":"配置","description":"了解如何配置 Freqtrade 交易机器人,包括配置文件、环境变量等多种配置方式","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["配置","参数","环境变量","设置"],"level":1},{"slug":"strategy-101","title":"Freqtrade 策略开发指南","short_title":"策略开发指南","description":"本文档介绍了 Freqtrade 策略开发的基础知识,包括必备概念、策略结构以及如何开发自己的交易策略。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"strategy-customization","title":"策略自定义指南","short_title":"策略自定义","description":"本文档介绍如何在 Freqtrade 中自定义交易策略,包括添加新指标、设置交易规则等内容。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["策略开发","自定义","指标","交易规则","编程"],"level":1},{"slug":"strategy-callbacks","title":"策略回调指南","short_title":"策略回调","description":"本文档详细介绍了 Freqtrade 交易机器人中可用的各种策略回调函数,包括它们的用途、调用时机以及使用方法。","date":"","thumbnail":"/build/freqUI-chart-annotat-6ca425e986932e863842497203176546.png","thumbnailOptimized":"/build/freqUI-chart-annotat-6ca425e986932e863842497203176546.webp","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"stoploss","title":"止损配置指南","short_title":"止损","description":"详细介绍 Freqtrade 中的止损功能,包括静态止损、追踪止损等多种止损模式的配置方法。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"plugins","title":"插件体系","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"bot-usage","title":"机器人使用指南","short_title":"机器人使用","description":"本文档介绍了如何启动和运行 FreqTrade 机器人,包括命令行参数、配置文件使用等基本操作说明。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"level":1,"title":"机器人控制和管理"},{"slug":"telegram-usage","title":"Telegram 使用指南","short_title":"Telegram 指南","description":"本文档详细介绍了如何为 Freqtrade 创建和配置 Telegram 机器人，以及如何获取必要的用户 ID 和群组 ID。","date":"","thumbnail":"/build/telegram_forcebuy-73d7978f775ad92a8fe74de0313966a6.png","thumbnailOptimized":"/build/telegram_forcebuy-73d7978f775ad92a8fe74de0313966a6.webp","banner":"","bannerOptimized":"","tags":["Telegram","通知","机器人","配置","消息推送"],"level":2},{"slug":"freq-ui","title":"FreqUI 用户界面","short_title":"FreqUI","description":"FreqUI 是 Freqtrade 的内置 Web 界面,提供了一个现代化的响应式界面来监控和控制您的交易机器人。本文档介绍了如何安装、配置和使用 FreqUI。","date":"","thumbnail":"/build/frequi-login-CORS-li-92549992a8d3a76bc770a0f5b151e366.png","thumbnailOptimized":"/build/frequi-login-CORS-li-92549992a8d3a76bc770a0f5b151e366.webp","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"rest-api","title":"REST API 指南","short_title":"REST API","description":"本文档介绍了 Freqtrade 的 REST API 功能,包括如何配置 API 服务器、安全设置、身份验证以及各种 API 端点的使用方法。","date":"","thumbnail":"/build/frequi_url-75e93be0830e56c293348021fb304d08.png","thumbnailOptimized":"/build/frequi_url-75e93be0830e56c293348021fb304d08.webp","banner":"","bannerOptimized":"","tags":["REST API","接口","配置","安全","自动化"],"level":2},{"slug":"webhook-config","title":"Webhook 配置指南","short_title":"Webhook 指南","description":"Freqtrade 的 Webhook 功能允许您在交易事件发生时发送通知到外部服务。本文档详细介绍了如何配置和使用 Webhook。","date":"","thumbnail":"/build/discord_notification-0536645313306293db781a3e0e0489d8.png","thumbnailOptimized":"/build/discord_notification-0536645313306293db781a3e0e0489d8.webp","banner":"","bannerOptimized":"","tags":["Webhook","通知","外部服务","事件","配置"],"level":2},{"slug":"data-download","title":"数据下载","description":"了解如何使用 Freqtrade 下载历史交易数据，包括 K 线数据、回测数据和超参优化所需数据的下载方法和命令参数说明","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"backtesting","title":"回测","short_title":"回测","description":"了解如何使用 Freqtrade 的回测功能验证和优化你的交易策略,包括回测命令、参数配置和结果分析","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["回测","策略验证","性能分析","历史数据"],"level":1},{"slug":"hyperopt","title":"Hyperopt 超参数优化指南","short_title":"Hyperopt 指南","description":"Hyperopt 是 Freqtrade 中用于自动化策略参数优化的工具,通过搜索最佳参数组合来提升策略性能。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["超参数优化","Hyperopt","策略优化","机器学习","参数调优"],"level":1},{"level":1,"title":"FreqAI"},{"slug":"freqai","title":"Freqai","description":"","date":"","thumbnail":"/build/freqai_doc_logo-3f2859a5a8ebe9e577941dd454c6c5ee.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"freqai-configuration","title":"FreqAI 配置指南","short_title":"FreqAI 配置","description":"本文档详细介绍了如何配置 FreqAI,包括配置文件设置和策略构建。FreqAI 是 Freqtrade 的机器学习框架,可用于构建和训练预测模型。","date":"","thumbnail":"/build/freqai_pytorch-diagr-d0712f166402f727b4f65efd22bf6315.png","thumbnailOptimized":"/build/freqai_pytorch-diagr-d0712f166402f727b4f65efd22bf6315.webp","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"freqai-parameter-table","title":"FreqAI 参数表","short_title":"参数表","description":"本文档详细列出了 FreqAI 的所有配置参数,包括通用配置参数和特征参数,并对每个参数的功能、数据类型和默认值进行了说明。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"freqai-feature-engineering","title":"FreqAI 特征工程指南","short_title":"特征工程","description":"本文档详细介绍了 FreqAI 的特征工程功能,包括如何定义和扩展特征、数据处理管道、异常值检测等内容。这些功能可以帮助用户构建更强大的预测模型。","date":"","thumbnail":"/build/freqai_weight-factor-70f8aa4395fdd17979cf8f96e17171d0.jpg","thumbnailOptimized":"/build/freqai_weight-factor-70f8aa4395fdd17979cf8f96e17171d0.webp","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"freqai-running","title":"FreqAI 运行指南","short_title":"FreqAI 运行","description":"FreqAI 是一个自适应机器学习框架，本文档介绍了如何在实时和回测模式下运行 FreqAI，包括模型训练、部署和管理等内容。","date":"","thumbnail":"/build/freqai_moving-window-05da86a83d6712baee031086385a7735.jpg","thumbnailOptimized":"/build/freqai_moving-window-05da86a83d6712baee031086385a7735.webp","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"freqai-reinforcement-learning","title":"FreqAI 强化学习指南","short_title":"强化学习","description":"本文档详细介绍了 FreqAI 的强化学习功能,包括基本概念、运行方法、环境配置等内容。这些功能可以帮助用户构建和训练强化学习模型进行自动交易。","date":"","thumbnail":"/build/tensorboard-27f8850881840b007f5a56a202abb949.jpg","thumbnailOptimized":"/build/tensorboard-27f8850881840b007f5a56a202abb949.webp","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"freqai-developers","title":"FreqAI 开发者指南","short_title":"FreqAI 开发","description":"本文档详细介绍了 FreqAI 的项目架构、数据处理流程和文件结构,为开发者提供了深入了解 FreqAI 内部工作原理的指南。","date":"","thumbnail":"/build/freqai_algorithm-dia-6d1ac15cf50f9103773ecaea4b8fd261.jpg","thumbnailOptimized":"/build/freqai_algorithm-dia-6d1ac15cf50f9103773ecaea4b8fd261.webp","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"leverage","title":"使用杠杆交易","description":"了解如何在 Freqtrade 中使用杠杆交易,包括做空、保证金和期货交易等高级功能","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"utils","title":"实用工具命令指南","short_title":"实用工具指南","description":"本文档详细介绍了 Freqtrade 中的各种实用工具子命令,包括创建用户目录、配置文件、列出交易所和交易对等功能。","date":"","thumbnail":"/build/show-config-output-2a74674e687e07d8afa7ace1b96df8bb.png","thumbnailOptimized":"/build/show-config-output-2a74674e687e07d8afa7ace1b96df8bb.webp","banner":"","bannerOptimized":"","tags":["工具","命令","配置","策略","交易所"],"level":1},{"slug":"plotting","title":"绘图","short_title":"绘图","description":"了解如何使用 Freqtrade 的绘图功能可视化价格、指标和利润数据,包括安装配置、命令参数和示例","date":"","thumbnail":"/build/plot-dataframe-40c25f36af7de6fc6f078d42ae5f90f5.png","thumbnailOptimized":"/build/plot-dataframe-40c25f36af7de6fc6f078d42ae5f90f5.webp","banner":"","bannerOptimized":"","tags":["绘图","可视化","指标","回测","利润"],"level":1},{"slug":"exchanges","title":"交易所特定说明","short_title":"交易所说明","description":"了解各个交易所的特殊配置和常见问题","date":"","thumbnail":"/build/binance_futures_sett-b4a8da10c6eb01bf904d6fc3533999b6.png","thumbnailOptimized":"/build/binance_futures_sett-b4a8da10c6eb01bf904d6fc3533999b6.webp","banner":"","bannerOptimized":"","tags":["交易所","配置","API","连接","问题解决"],"level":1},{"level":1,"title":"数据分析"},{"slug":"data-analysis","title":"使用 Jupyter 笔记本分析机器人数据","description":"使用 Jupyter 笔记本分析 Freqtrade 机器人的回测结果和交易历史数据","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"strategy-analysis-example","title":"Freqtrade 策略分析示例","short_title":"策略分析示例","description":"本文档介绍如何使用 Freqtrade 提供的工具来分析和调试交易策略,包括数据可视化、回测分析等功能。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"advanced-backtesting","title":"高级回测分析","short_title":"高级回测","description":"本文档介绍了 FreqTrade 的高级回测分析功能,包括买入/卖出标签分析、信号导出等高级特性。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"高级话题"},{"slug":"advanced-setup","title":"高级安装后配置","short_title":"高级安装","description":"本文档介绍了 FreqTrade 安装后可以执行的高级任务和配置选项,包括多实例运行、日志配置等高级特性。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"trade-object","title":"交易对象文档","short_title":"交易对象指南","description":"本文档详细介绍了 Freqtrade 中的交易对象(Trade)，包括其属性、方法以及在策略中的使用方式。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"lookahead-analysis","title":"前瞻性分析指南","short_title":"前瞻性分析","description":"前瞻性分析是一个用于检测和验证交易策略中是否存在前瞻性偏差的工具。本文档详细介绍了如何使用该工具来确保策略的有效性。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"recursive-analysis","title":"递归分析指南","short_title":"递归分析","description":"递归分析是一个用于检测和验证交易策略中是否存在因递归公式导致的不准确性的工具。本文档详细介绍了如何使用该工具来确保策略的有效性。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"strategy-advanced","title":"Freqtrade 高级策略指南","short_title":"高级策略","description":"本文档详细介绍了 Freqtrade 交易机器人的高级策略开发概念,包括持久化存储、回调方法等进阶功能。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"advanced-hyperopt","title":"高级超参数优化","short_title":"高级超参数优化","description":"本文档介绍了 FreqTrade 的高级超参数优化功能,包括自定义损失函数等高级特性。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"advanced-orderflow","title":"高级委托流分析","short_title":"委托流分析","description":"本文档介绍了 FreqTrade 的委托流分析功能,包括如何配置和使用公共成交数据进行高级委托流分析。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"producer-consumer","title":"生产者/消费者模式","short_title":"生产者/消费者","description":"本文档介绍了 Freqtrade 的生产者/消费者模式,包括如何配置多个机器人实例共享计算指标和信号,以及相关的 websocket 设置。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["生产者","消费者","分布式","多实例","WebSocket"],"level":2},{"slug":"sql-cheatsheet","title":"SQL 助手","short_title":"SQL 助手","description":"本文档提供了使用 SQLite 数据库进行查询的详细指南和常用命令参考。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"edge","title":"Edge Positioning - 边缘定位","short_title":"Edge","description":"Edge Positioning 模块使用概率统计来计算交易胜率和风险回报比,从而优化策略的入场点、头寸大小和止损设置。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["Edge","概率","统计","策略优化","风险管理"],"level":2},{"slug":"faq","title":"Freqtrade 常见问题","short_title":"FAQ","description":"本文档回答了关于 Freqtrade 交易机器人的常见问题,包括支持的市场、初学者指南以及常见问题的故障排除。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"strategy-migration","title":"策略迁移指南","short_title":"策略迁移","description":"本文档详细介绍了如何将 Freqtrade V2 策略迁移到 V3，包括接口变更、方法重命名以及新增功能的完整说明。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"updating","title":"更新指南","short_title":"更新指南","description":"本文档详细介绍了如何更新 Freqtrade 的不同安装方式,包括 Docker、安装脚本和原生安装等方法。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"commands","title":"Commands","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"deprecated","title":"已弃用功能","short_title":"已弃用功能","description":"本文档介绍了 FreqTrade 中已弃用和移除的命令行参数、配置参数和机器人功能,帮助用户避免使用不再受支持的特性。","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"developer","title":"开发者指南","short_title":"开发者指南","description":"本文档面向 FreqTrade 的开发者,介绍如何为项目做出贡献、配置开发环境、编写测试以及其他开发相关的重要信息。","date":"","thumbnail":"/build/pycharm_debug-7a8a6d1f4a91d643a2d41ff932bf9a82.png","thumbnailOptimized":"/build/pycharm_debug-7a8a6d1f4a91d643a2d41ff932bf9a82.webp","banner":"","bannerOptimized":"","tags":[],"level":1},{"level":1,"title":"Commands"},{"slug":"main","title":"Main","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"backtesting-analysis","title":"Backtesting Analysis","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"backtesting-1","title":"Backtesting","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"backtesting-show","title":"Backtesting Show","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"convert-data","title":"Convert Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"convert-db","title":"Convert Db","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"convert-trade-data","title":"Convert Trade Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"create-userdir","title":"Create Userdir","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"download-data","title":"Download Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"edge-1","title":"Edge","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"hyperopt-list","title":"Hyperopt List","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"hyperopt-1","title":"Hyperopt","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"hyperopt-show","title":"Hyperopt Show","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"install-ui","title":"Install Ui","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"list-data","title":"List Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"list-exchanges","title":"List Exchanges","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"list-freqaimodels","title":"List Freqaimodels","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"list-hyperoptloss","title":"List Hyperoptloss","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"list-markets","title":"List Markets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"list-pairs","title":"List Pairs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"list-strategies","title":"List Strategies","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"list-timeframes","title":"List Timeframes","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"lookahead-analysis-1","title":"Lookahead Analysis","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"new-config","title":"New Config","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"new-strategy","title":"New Strategy","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"plot-dataframe","title":"Plot Dataframe","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"plot-profit","title":"Plot Profit","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"recursive-analysis-1","title":"Recursive Analysis","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"show-config","title":"Show Config","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"show-trades","title":"Show Trades","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"strategy-updater","title":"Strategy Updater","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"test-pairlist","title":"Test Pairlist","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"trade","title":"Trade","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"trades-to-ohlcv","title":"Trades To Ohlcv","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"webserver","title":"Webserver","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}}},"actionData":null,"errors":null},"future":{"unstable_dev":false,"unstable_postcss":false,"unstable_tailwind":false,"v2_errorBoundary":true,"v2_headers":true,"v2_meta":true,"v2_normalizeFormMethod":true,"v2_routeConvention":true}};</script><script type="module" async="">import "/build/manifest-98DF227B.js";
import * as route0 from "/build/root-PZGRQ5GW.js";
import * as route1 from "/build/routes/$-IZLSCQFJ.js";
window.__remixRouteModules = {"root":route0,"routes/$":route1};

import("/build/entry.client-UNPC4GT3.js");</script></body></html>