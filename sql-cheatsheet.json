{"version":2,"kind":"Article","sha256":"b2091d4a8cf41b13575dde7bf9334116be035978f147c1670ebbd5e744da264d","slug":"sql-cheatsheet","location":"/sql_cheatsheet.md","dependencies":[],"frontmatter":{"title":"SQL 助手","description":"本文档提供了使用 SQLite 数据库进行查询的详细指南和常用命令参考。","short_title":"SQL 助手","subtitle":"SQLite 数据库查询参考","subject":"SQL 查询指南","content_includes_title":false,"authors":[{"id":"Freqtrade","name":"Freqtrade"}],"github":"https://github.com/freqtrade-cn/docs_zh-CN","keywords":["Freqtrade","中文文档","交易机器人","量化交易","加密货币","数字货币","区块链","人工智能","机器学习"],"numbering":{"title":{"offset":1}},"edit_url":"https://github.com/freqtrade-cn/docs_zh-CN/blob/main/sql_cheatsheet.md","exports":[{"format":"md","filename":"sql_cheatsheet.md","url":"/build/sql_cheatsheet-03cb48ec619daab5b8390a9de4d7f3f9.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"本页包含一些帮助，如果你想查询你的 sqlite 数据库。","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"HMg21EkMTC"}],"key":"CSVHNBMSwj"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"其他数据库系统","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"As1NrAdtBF"}],"key":"LvU8hwHeRa"},{"type":"paragraph","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"要使用其他数据库系统，如 PostgreSQL 或 MariaDB，你可以使用相同的查询，但你需要使用相应数据库系统的客户端。","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"i0wPKoMWWo"},{"type":"crossReference","url":"/advanced-setup","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"点击这里","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"h7ACvxoiYm"}],"urlSource":"advanced-setup.md#use-a-different-database-system","dataUrl":"/advanced-setup.json","identifier":"use-a-different-database-system","label":"use-a-different-database-system","remote":true,"protocol":"file","key":"TMkVe9ajhi"},{"type":"text","value":"了解如何使用 freqtrade 设置不同的数据库系统。","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"Fav830aJbt"}],"key":"n91eTiGk6Y"}],"key":"xhSUklneni"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"yZbKProYkW"}],"key":"BoPPtKu4QV"},{"type":"paragraph","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"如果你不熟悉 SQL，在数据库上运行查询时应该非常小心。","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"X6R0Mq0d5q"}],"key":"ysDFkZzolW"},{"type":"paragraph","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"在运行任何查询之前，始终确保有数据库的备份。","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"SxQfiOT5cc"}],"key":"sT68iKLBQ8"}],"key":"I1RrCpjVoc"},{"type":"heading","depth":2,"position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"安装 sqlite3","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"Vz4ApBJMLu"}],"identifier":"id-sqlite3","label":"安装 sqlite3","html_id":"id-sqlite3","implicit":true,"key":"MJyMJmaN2F"},{"type":"paragraph","position":{"start":{"line":25,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"text","value":"Sqlite3 是一个基于终端的 sqlite 应用程序。\n如果你觉得更舒服，可以随意使用像 SqliteBrowser 这样的可视化数据库编辑器。","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"txTl8HCje4"}],"key":"XDN9UY4EBs"},{"type":"heading","depth":3,"position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"Ubuntu/Debian 安装","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"gkW1Hqnk3S"}],"identifier":"ubuntu-debian","label":"Ubuntu/Debian 安装","html_id":"ubuntu-debian","implicit":true,"key":"OOjdOrBORH"},{"type":"code","lang":"bash","value":"sudo apt-get install sqlite3","position":{"start":{"line":30,"column":1},"end":{"line":32,"column":1}},"key":"HIua2vkIT5"},{"type":"heading","depth":3,"position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"children":[{"type":"text","value":"通过 docker 使用 sqlite3","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"eK2hOYRc4z"}],"identifier":"id-docker-sqlite3","label":"通过 docker 使用 sqlite3","html_id":"id-docker-sqlite3","implicit":true,"key":"SKjRkOkwsC"},{"type":"paragraph","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"text","value":"freqtrade docker 镜像确实包含 sqlite3，所以你可以在不需要在主机系统上安装任何东西的情况下编辑数据库。","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"wzPuoZeMYz"}],"key":"drSXZ5e8rn"},{"type":"code","lang":"bash","value":"docker compose exec freqtrade /bin/bash\nsqlite3 <database-file>.sqlite","position":{"start":{"line":38,"column":1},"end":{"line":41,"column":1}},"key":"zwX2tiwLHn"},{"type":"heading","depth":2,"position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"children":[{"type":"text","value":"打开数据库","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"F1a483gAJl"}],"identifier":"id","label":"打开数据库","html_id":"id","implicit":true,"key":"DT8sA9INpb"},{"type":"code","lang":"bash","value":"sqlite3\n.open <filepath>","position":{"start":{"line":45,"column":1},"end":{"line":48,"column":1}},"key":"zZuAVETJLy"},{"type":"heading","depth":2,"position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"children":[{"type":"text","value":"表结构","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"key":"XAUDxIOtP7"}],"identifier":"id","label":"表结构","html_id":"id-1","implicit":true,"key":"ykc8Ck9l4q"},{"type":"heading","depth":3,"position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"children":[{"type":"text","value":"列出表","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"key":"BwBESdiJN0"}],"identifier":"id","label":"列出表","html_id":"id-2","implicit":true,"key":"S5eAif6vLf"},{"type":"code","lang":"bash","value":".tables","position":{"start":{"line":54,"column":1},"end":{"line":56,"column":1}},"key":"jdciZOJskM"},{"type":"heading","depth":3,"position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"children":[{"type":"text","value":"显示表结构","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"key":"oHOzc2Yd2W"}],"identifier":"id","label":"显示表结构","html_id":"id-3","implicit":true,"key":"ubPWr60ZYt"},{"type":"code","lang":"bash","value":".schema <table_name>","position":{"start":{"line":60,"column":1},"end":{"line":62,"column":1}},"key":"gQ94WAFji3"},{"type":"heading","depth":3,"position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"children":[{"type":"text","value":"获取表中的所有交易","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"key":"g39yySHvLj"}],"identifier":"id","label":"获取表中的所有交易","html_id":"id-4","implicit":true,"key":"WupDguk57a"},{"type":"code","lang":"sql","value":"SELECT * FROM trades;","position":{"start":{"line":66,"column":1},"end":{"line":68,"column":1}},"key":"idmScF4hWZ"},{"type":"heading","depth":2,"position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"children":[{"type":"text","value":"破坏性查询","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"u8okwLoxDg"}],"identifier":"id","label":"破坏性查询","html_id":"id-5","implicit":true,"key":"xymw6X5uKB"},{"type":"paragraph","position":{"start":{"line":72,"column":1},"end":{"line":73,"column":1}},"children":[{"type":"text","value":"写入数据库的查询。\n这些查询通常不应该需要，因为 freqtrade 试图自己处理所有数据库操作 - 或通过 API 或 telegram 命令暴露它们。","position":{"start":{"line":72,"column":1},"end":{"line":72,"column":1}},"key":"MQSSu5h38j"}],"key":"qMj9mX9n9D"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"CF2OKVlXFK"}],"key":"kNcId7c3Fr"},{"type":"paragraph","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"children":[{"type":"text","value":"在运行以下任何查询之前，请确保你有数据库的备份。","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"ejYZr0FDW1"}],"key":"sNRoRCDsDv"}],"key":"UvmsLS0MJf"},{"type":"admonition","kind":"danger","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Danger","key":"wOy1GbzWBl"}],"key":"oS9nGpybiF"},{"type":"paragraph","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"children":[{"type":"text","value":"当机器人连接到数据库时，你也应该","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"key":"stzWY3DPHJ"},{"type":"strong","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"children":[{"type":"text","value":"永远不要","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"key":"wAvIC0hO2a"}],"key":"l0wAV3ttoe"},{"type":"text","value":"运行任何写入查询（","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"key":"yO6qWovipw"},{"type":"inlineCode","value":"update","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"key":"wljZbhy02M"},{"type":"text","value":"、","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"key":"d3ZfGHx40g"},{"type":"inlineCode","value":"insert","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"key":"UH3Apk507u"},{"type":"text","value":"、","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"key":"F2elLzyRUi"},{"type":"inlineCode","value":"delete","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"key":"kNIYUi63WF"},{"type":"text","value":"）。","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"key":"j9j1qHQCto"}],"key":"hi6FypHide"},{"type":"paragraph","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"children":[{"type":"text","value":"这可能导致数据损坏 - 很可能无法恢复。","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"key":"aLR0cvR8oD"}],"key":"ePIwaUBH2P"}],"key":"QCGgIofEEt"},{"type":"heading","depth":3,"position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"children":[{"type":"text","value":"修复在交易所手动出场后仍然开放的交易","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"key":"awYS0yvFDn"}],"identifier":"id","label":"修复在交易所手动出场后仍然开放的交易","html_id":"id-6","implicit":true,"key":"tIFpMSUT1f"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"AZItJLODgp"}],"key":"Wfiai8g5QT"},{"type":"paragraph","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"children":[{"type":"text","value":"在交易所手动卖出交易对不会被机器人检测到，它会尝试卖出。只要可能，应该使用 /forceexit ","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"key":"E6qzaleIRH"},{"type":"text","value":" 来完成同样的事情。","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"key":"ztmZ1Pwz5x"}],"key":"NdMpdnjvI1"},{"type":"paragraph","position":{"start":{"line":90,"column":1},"end":{"line":90,"column":1}},"children":[{"type":"text","value":"强烈建议在进行任何手动更改之前备份你的数据库文件。","position":{"start":{"line":90,"column":1},"end":{"line":90,"column":1}},"key":"Vv3QQ3t8K5"}],"key":"vX8x0gJgJz"}],"key":"J8kfMdTqFy"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"ALsP5nmFXB"}],"key":"RhK0ltLO9P"},{"type":"paragraph","position":{"start":{"line":94,"column":1},"end":{"line":94,"column":1}},"children":[{"type":"text","value":"在 /forceexit 之后，这应该不是必需的，因为 force_exit 订单会在下一次迭代时被机器人自动关闭。","position":{"start":{"line":94,"column":1},"end":{"line":94,"column":1}},"key":"h621fXAORB"}],"key":"uC7rFjaNex"}],"key":"l0H56Pq9F6"},{"type":"code","lang":"sql","value":"UPDATE trades\nSET is_open=0,\n  close_date=<close_date>,\n  close_rate=<close_rate>,\n  close_profit = close_rate / open_rate - 1,\n  close_profit_abs = (amount * <close_rate> * (1 - fee_close) - (amount * (open_rate * (1 - fee_open)))),\n  exit_reason=<exit_reason>\nWHERE id=<trade_ID_to_update>;","position":{"start":{"line":97,"column":1},"end":{"line":106,"column":1}},"key":"BnHwNyi7Fb"},{"type":"heading","depth":4,"position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"children":[{"type":"text","value":"示例","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"key":"UNEqJJxiC3"}],"identifier":"id","label":"示例","html_id":"id-7","implicit":true,"key":"w7jQgVZmjy"},{"type":"code","lang":"sql","value":"UPDATE trades\nSET is_open=0,\n  close_date='2020-06-20 03:08:45.103418',\n  close_rate=0.19638016,\n  close_profit=0.0496,\n  close_profit_abs = (amount * 0.19638016 * (1 - fee_close) - (amount * (open_rate * (1 - fee_open)))),\n  exit_reason='force_exit'  \nWHERE id=31;","position":{"start":{"line":110,"column":1},"end":{"line":119,"column":1}},"key":"M0UVNbKNVI"},{"type":"heading","depth":3,"position":{"start":{"line":121,"column":1},"end":{"line":121,"column":1}},"children":[{"type":"text","value":"从数据库中删除交易","position":{"start":{"line":121,"column":1},"end":{"line":121,"column":1}},"key":"S3wvWDw6mQ"}],"identifier":"id","label":"从数据库中删除交易","html_id":"id-8","implicit":true,"key":"orEmBMw1WY"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"使用 RPC 方法删除交易","position":{"start":{"line":123,"column":1},"end":{"line":123,"column":1}},"key":"JnEz8WHFcX"}],"key":"AF0NHchjXu"},{"type":"paragraph","position":{"start":{"line":124,"column":1},"end":{"line":124,"column":1}},"children":[{"type":"text","value":"考虑通过 telegram 或 rest API 使用 ","position":{"start":{"line":124,"column":1},"end":{"line":124,"column":1}},"key":"kIEaImFBSo"},{"type":"inlineCode","value":"/delete <tradeid>","position":{"start":{"line":124,"column":1},"end":{"line":124,"column":1}},"key":"o5GoCfYORn"},{"type":"text","value":"。这是删除交易的推荐方式。","position":{"start":{"line":124,"column":1},"end":{"line":124,"column":1}},"key":"xFTyIdi7Zl"}],"key":"fCKGjLqpvf"}],"key":"FnHnGUH092"},{"type":"paragraph","position":{"start":{"line":127,"column":1},"end":{"line":127,"column":1}},"children":[{"type":"text","value":"如果你仍然想直接从数据库中删除交易，你可以使用下面的查询。","position":{"start":{"line":127,"column":1},"end":{"line":127,"column":1}},"key":"kz6rF6Juew"}],"key":"RMdfOniYjj"},{"type":"admonition","kind":"danger","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Danger","key":"YFv3scORIz"}],"key":"WrTJutm4Gu"},{"type":"paragraph","position":{"start":{"line":130,"column":1},"end":{"line":130,"column":1}},"children":[{"type":"text","value":"某些系统（Ubuntu）在其 sqlite3 包中禁用了外键。使用 sqlite 时 - 请确保通过在上面的查询之前运行 ","position":{"start":{"line":130,"column":1},"end":{"line":130,"column":1}},"key":"Oi5AjbL7tV"},{"type":"inlineCode","value":"PRAGMA foreign_keys = ON","position":{"start":{"line":130,"column":1},"end":{"line":130,"column":1}},"key":"Jdzd1GkcTw"},{"type":"text","value":" 来启用外键。","position":{"start":{"line":130,"column":1},"end":{"line":130,"column":1}},"key":"vLxhVLWLL8"}],"key":"xmZUDX3pys"}],"key":"MrNGf8AcUB"},{"type":"code","lang":"sql","value":"DELETE FROM trades WHERE id = <tradeid>;\n\nDELETE FROM trades WHERE id = 31;","position":{"start":{"line":133,"column":1},"end":{"line":137,"column":1}},"key":"A53KttsGQx"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"XlGi6g9tmg"}],"key":"dqfUPpzWry"},{"type":"paragraph","position":{"start":{"line":140,"column":1},"end":{"line":140,"column":1}},"children":[{"type":"text","value":"这将从数据库中删除此交易。请确保你获得了正确的 id，并且","position":{"start":{"line":140,"column":1},"end":{"line":140,"column":1}},"key":"DLK1oWGWko"},{"type":"strong","position":{"start":{"line":140,"column":1},"end":{"line":140,"column":1}},"children":[{"type":"text","value":"永远不要","position":{"start":{"line":140,"column":1},"end":{"line":140,"column":1}},"key":"AO1GlYWZqg"}],"key":"px6fSK9DSq"},{"type":"text","value":"在没有 ","position":{"start":{"line":140,"column":1},"end":{"line":140,"column":1}},"key":"cz0nb9MGDD"},{"type":"inlineCode","value":"where","position":{"start":{"line":140,"column":1},"end":{"line":140,"column":1}},"key":"MzscPxPT2f"},{"type":"text","value":" 子句的情况下运行此查询。","position":{"start":{"line":140,"column":1},"end":{"line":140,"column":1}},"key":"mMzwSPtzrA"}],"key":"v7dl82c2Fi"}],"key":"r05PUfufWX"}],"key":"zCfkalgseJ"}],"key":"vH1bqRN1JY"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"生产者/消费者模式","short_title":"生产者/消费者","url":"/producer-consumer","group":"高级话题"},"next":{"title":"Edge Positioning - 边缘定位","short_title":"Edge","url":"/edge","group":"高级话题"}}},"domain":"http://localhost:3002"}