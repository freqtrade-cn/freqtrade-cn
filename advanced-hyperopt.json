{"version":2,"kind":"Article","sha256":"45a50edc4c2ac8e52f5904ef3ee966d6aff822647bf135a69116b9de0f4f0901","slug":"advanced-hyperopt","location":"/advanced-hyperopt.md","dependencies":[],"frontmatter":{"title":"高级超参数优化","description":"本文档介绍了 FreqTrade 的高级超参数优化功能,包括自定义损失函数等高级特性。","short_title":"高级超参数优化","subtitle":"深入了解超参数优化功能","subject":"FreqTrade 高级超参数优化指南","authors":[{"id":"Freqtrade","name":"Freqtrade"}],"github":"https://github.com/freqtrade-cn/docs_zh-CN","keywords":["Freqtrade","中文文档","交易机器人","量化交易","加密货币","数字货币","区块链","人工智能","机器学习"],"numbering":{"title":{"offset":1}},"edit_url":"https://github.com/freqtrade-cn/docs_zh-CN/blob/main/advanced-hyperopt.md","exports":[{"format":"md","filename":"advanced-hyperopt.md","url":"/build/advanced-hyperopt-38e4886c21e6881ebd27b9adab7149b6.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"高级超参数优化（Hyperopt）","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"Gwep7fKQFy"}],"identifier":"id-hyperopt","label":"高级超参数优化（Hyperopt）","html_id":"id-hyperopt","implicit":true,"key":"sQCS5aBj6I"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"本页介绍一些高级 Hyperopt 主题，可能比创建普通超参数优化类需要更高的编码技能和 Python 知识。","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"tlwqwQBRd5"}],"key":"W93yuGdUPV"},{"type":"heading","depth":3,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"创建和使用自定义损失函数","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"tddIjoE6tR"}],"identifier":"id","label":"创建和使用自定义损失函数","html_id":"id","implicit":true,"key":"h6qJDC6LgF"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"要使用自定义损失函数类，请确保你的自定义 hyperopt 损失类中定义了 ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"xB7llkjSOB"},{"type":"inlineCode","value":"hyperopt_loss_function","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"LQ83q38jXZ"},{"type":"text","value":" 函数。\n对于下方的示例，你需要在 hyperopt 命令中添加参数 ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"oEWVzZFUaB"},{"type":"inlineCode","value":"--hyperopt-loss SuperDuperHyperOptLoss","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"YK4N41gT3r"},{"type":"text","value":"，以便使用该函数。","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"lBrhtehNgi"}],"key":"LvSNeSsSEu"},{"type":"paragraph","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"下面是一个示例，与默认 Hyperopt 损失实现完全相同。完整示例可见于 ","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"L0AcIpJapc"},{"type":"link","url":"https://github.com/freqtrade/freqtrade/blob/develop/freqtrade/templates/sample_hyperopt_loss.py","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"userdata/hyperopts","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"w1d9eAPYfe"}],"urlSource":"https://github.com/freqtrade/freqtrade/blob/develop/freqtrade/templates/sample_hyperopt_loss.py","data":{"kind":"file","org":"freqtrade","repo":"freqtrade","reference":"develop","file":"freqtrade/templates/sample_hyperopt_loss.py","raw":"https://raw.githubusercontent.com/freqtrade/freqtrade/develop/freqtrade/templates/sample_hyperopt_loss.py"},"internal":false,"protocol":"github","key":"Ug1sOZdRny"},{"type":"text","value":"。","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"WXU3V6MvCD"}],"key":"l4IBCKRzPl"},{"type":"code","lang":"python","value":"from datetime import datetime\nfrom typing import Any, Dict\n\nfrom pandas import DataFrame\n\nfrom freqtrade.constants import Config\nfrom freqtrade.optimize.hyperopt import IHyperOptLoss\n\nTARGET_TRADES = 600\nEXPECTED_MAX_PROFIT = 3.0\nMAX_ACCEPTED_TRADE_DURATION = 300\n\nclass SuperDuperHyperOptLoss(IHyperOptLoss):\n    \"\"\"\n    定义 hyperopt 的默认损失函数\n    \"\"\"\n\n    @staticmethod\n    def hyperopt_loss_function(\n        *,\n        results: DataFrame,\n        trade_count: int,\n        min_date: datetime,\n        max_date: datetime,\n        config: Config,\n        processed: dict[str, DataFrame],\n        backtest_stats: dict[str, Any],\n        starting_balance: float,\n        **kwargs,\n    ) -> float:\n        \"\"\"\n        目标函数，结果越小越好\n        这是传统算法（freqtrade 一直使用的）。权重分配如下：\n        * 0.4 给交易时长\n        * 0.25：避免交易亏损\n        * 1.0 给总利润，相对于上面定义的期望值（`EXPECTED_MAX_PROFIT`）\n        \"\"\"\n        total_profit = results['profit_ratio'].sum()\n        trade_duration = results['trade_duration'].mean()\n\n        trade_loss = 1 - 0.25 * exp(-(trade_count - TARGET_TRADES) ** 2 / 10 ** 5.8)\n        profit_loss = max(0, 1 - total_profit / EXPECTED_MAX_PROFIT)\n        duration_loss = 0.4 * min(trade_duration / MAX_ACCEPTED_TRADE_DURATION, 1)\n        result = trade_loss + profit_loss + duration_loss\n        return result","position":{"start":{"line":20,"column":1},"end":{"line":66,"column":1}},"key":"PGOpNFNeAm"},{"type":"paragraph","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"children":[{"type":"text","value":"目前，参数说明如下：","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"eH5KracQn9"}],"key":"U8otyPbT9q"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":70,"column":1},"end":{"line":80,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":70,"column":1},"end":{"line":72,"column":1}},"children":[{"type":"inlineCode","value":"results","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"GDBMRC7xtz"},{"type":"text","value":"：包含结果交易的 DataFrame。\n结果中可用的列如下（与回测时 ","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"tVZCPQ2Ay7"},{"type":"inlineCode","value":"--export trades","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"QlZSo7Hk28"},{"type":"text","value":" 输出文件一致）：","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"XncaadaVSC"},{"type":"break","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"sVoeKdWsjZ"},{"type":"inlineCode","value":"pair, profit_ratio, profit_abs, open_date, open_rate, fee_open, close_date, close_rate, fee_close, amount, trade_duration, is_open, exit_reason, stake_amount, min_rate, max_rate, stop_loss_ratio, stop_loss_abs","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"HhckL4IYqt"}],"key":"f3M1EJTo5p"},{"type":"listItem","spread":true,"position":{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},"children":[{"type":"inlineCode","value":"trade_count","position":{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},"key":"XOThE2RBWB"},{"type":"text","value":"：交易数量（等同于 ","position":{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},"key":"GP4GGaMxE7"},{"type":"inlineCode","value":"len(results)","position":{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},"key":"JXBwmj6FqP"},{"type":"text","value":"）","position":{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},"key":"nB9ZAyIjIK"}],"key":"Pd57fZjWbz"},{"type":"listItem","spread":true,"position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"children":[{"type":"inlineCode","value":"min_date","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"key":"MFADQLEvtV"},{"type":"text","value":"：使用的时间范围起始日期","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"key":"TmssN6RMmA"}],"key":"IVMPBcQ1k8"},{"type":"listItem","spread":true,"position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"children":[{"type":"inlineCode","value":"max_date","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"Jd3s5ZUdyk"},{"type":"text","value":"：使用的时间范围结束日期","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"cVebqUe47d"}],"key":"z5uPmWqem9"},{"type":"listItem","spread":true,"position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"children":[{"type":"inlineCode","value":"config","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"Z9JcruhNeC"},{"type":"text","value":"：使用的配置对象（注意：如果某些策略相关参数属于 hyperopt 空间，这里未必会更新全部参数）。","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"vkJ6nQwvB3"}],"key":"MryhLSWE9g"},{"type":"listItem","spread":true,"position":{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},"children":[{"type":"inlineCode","value":"processed","position":{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},"key":"KzeMjGw1gN"},{"type":"text","value":"：以交易对为键的 DataFrame 字典，包含回测用到的数据。","position":{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},"key":"SzrL1CyJLk"}],"key":"Na3VB7Prtq"},{"type":"listItem","spread":true,"position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"children":[{"type":"inlineCode","value":"backtest_stats","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"CQ1iKemdR5"},{"type":"text","value":"：回测统计信息，格式与回测文件“strategy”子结构一致。可用字段见 ","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"ovX3uSrjlR"},{"type":"inlineCode","value":"optimize_reports.py","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"deJcEOv1ry"},{"type":"text","value":" 中的 ","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"sNUZqBSB3p"},{"type":"inlineCode","value":"generate_strategy_stats()","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"QAwttwQOzV"},{"type":"text","value":"。","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"VH8K8vB1mg"}],"key":"h0SlmSuAhI"},{"type":"listItem","spread":true,"position":{"start":{"line":79,"column":1},"end":{"line":80,"column":1}},"children":[{"type":"inlineCode","value":"starting_balance","position":{"start":{"line":79,"column":1},"end":{"line":79,"column":1}},"key":"KiDMNX0kDB"},{"type":"text","value":"：回测使用的初始资金。","position":{"start":{"line":79,"column":1},"end":{"line":79,"column":1}},"key":"l6gtE5TueA"}],"key":"XqZuYQWh1P"}],"key":"M1TqYOkw38"},{"type":"paragraph","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"children":[{"type":"text","value":"该函数需返回一个浮点数（","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"oYw8bAQRnL"},{"type":"inlineCode","value":"float","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"Vnnu1PCUPO"},{"type":"text","value":"）。数值越小，结果越好。参数和权重分配可自行调整。","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"AD3SWgTUce"}],"key":"lcY9hAqYrY"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"KaVD2dgbww"}],"key":"YiOMu1jUlO"},{"type":"paragraph","position":{"start":{"line":84,"column":1},"end":{"line":84,"column":1}},"children":[{"type":"text","value":"该函数每个 epoch 调用一次——请尽量优化代码，避免拖慢 hyperopt。","position":{"start":{"line":84,"column":1},"end":{"line":84,"column":1}},"key":"tscEAnRKNi"}],"key":"ZIKoANHZhC"}],"key":"miNCltkbZ9"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"inlineCode","value":"*args","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"PwAYpRPg9k"},{"type":"text","value":" 和 ","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"iO84Am1nBl"},{"type":"inlineCode","value":"**kwargs","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"RTGwR7ZSzl"}],"key":"b1bihkgw1o"},{"type":"paragraph","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"children":[{"type":"text","value":"请保留接口中的 ","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"key":"vmyC88UiUw"},{"type":"inlineCode","value":"*args","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"key":"jIj0WpI7qW"},{"type":"text","value":" 和 ","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"key":"HIAsP2qq7j"},{"type":"inlineCode","value":"**kwargs","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"key":"WoihQDPZAt"},{"type":"text","value":"，以便未来扩展。","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"key":"R4Z26JuVCF"}],"key":"YzEwBT0w4s"}],"key":"DrR5TLdeS6"},{"type":"heading","depth":3,"position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"children":[{"type":"text","value":"覆盖预定义空间","position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"key":"FlYjC4lK2q"}],"label":"overriding-pre-defined-spaces","identifier":"overriding-pre-defined-spaces","html_id":"overriding-pre-defined-spaces","key":"tIZhuUb5Nw"},{"type":"paragraph","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"children":[{"type":"text","value":"要覆盖预定义空间（如 ","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"eC7kmemza2"},{"type":"inlineCode","value":"roi_space","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"DIpiB0Z12l"},{"type":"text","value":"、","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"NIiWAf6Lwx"},{"type":"inlineCode","value":"generate_roi_table","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"l849TXaIWV"},{"type":"text","value":"、","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"nkRZ4Zjyad"},{"type":"inlineCode","value":"stoploss_space","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"cR8tXz92Ak"},{"type":"text","value":"、","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"Ep1BaFVCTP"},{"type":"inlineCode","value":"trailing_space","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"KD9NSqnEUS"},{"type":"text","value":"、","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"Dvk9ZAlyDA"},{"type":"inlineCode","value":"max_open_trades_space","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"Z9YaZZupIv"},{"type":"text","value":"），请在策略中定义一个嵌套的 Hyperopt 类，并如下定义所需空间：","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"qd30RcfFH2"}],"key":"MnuJ3GnZ6j"},{"type":"code","lang":"python","value":"from freqtrade.optimize.space import Categorical, Dimension, Integer, SKDecimal\n\nclass MyAwesomeStrategy(IStrategy):\n    class HyperOpt:\n        # 自定义止损空间\n        def stoploss_space():\n            return [SKDecimal(-0.05, -0.01, decimals=3, name='stoploss')]\n\n        # 自定义 ROI 空间\n        def roi_space() -> List[Dimension]:\n            return [\n                Integer(10, 120, name='roi_t1'),\n                Integer(10, 60, name='roi_t2'),\n                Integer(10, 40, name='roi_t3'),\n                SKDecimal(0.01, 0.04, decimals=3, name='roi_p1'),\n                SKDecimal(0.01, 0.07, decimals=3, name='roi_p2'),\n                SKDecimal(0.01, 0.20, decimals=3, name='roi_p3'),\n            ]\n\n        def generate_roi_table(params: Dict) -> dict[int, float]:\n\n            roi_table = {}\n            roi_table[0] = params['roi_p1'] + params['roi_p2'] + params['roi_p3']\n            roi_table[params['roi_t3']] = params['roi_p1'] + params['roi_p2']\n            roi_table[params['roi_t3'] + params['roi_t2']] = params['roi_p1']\n            roi_table[params['roi_t3'] + params['roi_t2'] + params['roi_t1']] = 0\n\n            return roi_table\n\n        def trailing_space() -> List[Dimension]:\n            # 这里所有参数都是必需的，只能修改类型或范围。\n            return [\n                # 固定为 true，如果优化 trailing_stop，则假定始终使用追踪止损。\n                Categorical([True], name='trailing_stop'),\n\n                SKDecimal(0.01, 0.35, decimals=3, name='trailing_stop_positive'),\n                # 'trailing_stop_positive_offset' 应大于 'trailing_stop_positive'，\n                # 所以这里用中间参数表示两者的差值。'trailing_stop_positive_offset' 的值在\n                # generate_trailing_params() 方法中构造。\n                # 这类似于用于构造 ROI 表的 hyperspace 维度。\n                SKDecimal(0.001, 0.1, decimals=3, name='trailing_stop_positive_offset_p1'),\n\n                Categorical([True, False], name='trailing_only_offset_is_reached'),\n        ]\n\n        # 自定义最大持仓数空间\n        def max_open_trades_space(self) -> List[Dimension]:\n            return [\n                Integer(-1, 10, name='max_open_trades'),\n            ]","position":{"start":{"line":97,"column":1},"end":{"line":148,"column":1}},"key":"bicHFOPSby"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"VIXbFhzxlm"}],"key":"nlUaLdVNek"},{"type":"paragraph","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"children":[{"type":"text","value":"所有覆盖都是可选的，可根据需要混合使用。","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"key":"O4QA5LGwsd"}],"key":"HCEKKi4Jbh"}],"key":"eLN1TL3Ry9"},{"type":"heading","depth":4,"position":{"start":{"line":154,"column":1},"end":{"line":154,"column":1}},"children":[{"type":"text","value":"动态参数","position":{"start":{"line":154,"column":1},"end":{"line":154,"column":1}},"key":"ea0qBsovM2"}],"identifier":"id","label":"动态参数","html_id":"id-1","implicit":true,"key":"IriqqSZtDZ"},{"type":"paragraph","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"children":[{"type":"text","value":"参数也可以动态定义，但在 ","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"key":"oqCBBG9Ek2"},{"type":"crossReference","url":"/strategy-callbacks","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"children":[{"type":"inlineCode","value":"bot_start()","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"key":"fz7W6qOZkk"},{"type":"text","value":" 回调","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"key":"YAhyKrZcWF"}],"urlSource":"strategy-callbacks.md#bot-start","dataUrl":"/strategy-callbacks.json","identifier":"bot-start","label":"bot-start","remote":true,"protocol":"file","kind":"heading","template":"{name}","resolved":true,"html_id":"bot-start","key":"YN8IM04A9S"},{"type":"text","value":" 被调用后，实例必须能访问到这些参数。","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"key":"P01Hi1v43k"}],"key":"d9AV8S5MrG"},{"type":"code","lang":"python","value":"\nclass MyAwesomeStrategy(IStrategy):\n\n    def bot_start(self, **kwargs) -> None:\n        self.buy_adx = IntParameter(20, 30, default=30, optimize=True)\n\n    # ...","position":{"start":{"line":158,"column":1},"end":{"line":166,"column":1}},"key":"RuxArznLeT"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"A0jwQU88b3"}],"key":"kurcFm0M6q"},{"type":"paragraph","position":{"start":{"line":169,"column":1},"end":{"line":169,"column":1}},"children":[{"type":"text","value":"以这种方式创建的参数不会出现在 ","position":{"start":{"line":169,"column":1},"end":{"line":169,"column":1}},"key":"fUZfmo6sty"},{"type":"inlineCode","value":"list-strategies","position":{"start":{"line":169,"column":1},"end":{"line":169,"column":1}},"key":"hZQAHOyXhO"},{"type":"text","value":" 的参数计数中。","position":{"start":{"line":169,"column":1},"end":{"line":169,"column":1}},"key":"DSYtzQaFsp"}],"key":"tEeDvnYYrr"}],"key":"SLtXfn8E5R"},{"type":"heading","depth":4,"position":{"start":{"line":172,"column":1},"end":{"line":172,"column":1}},"children":[{"type":"text","value":"覆盖 Base estimator","position":{"start":{"line":172,"column":1},"end":{"line":172,"column":1}},"key":"gk6Y690MfU"}],"identifier":"id-base-estimator","label":"覆盖 Base estimator","html_id":"id-base-estimator","implicit":true,"key":"si0G9QiC16"},{"type":"paragraph","position":{"start":{"line":174,"column":1},"end":{"line":174,"column":1}},"children":[{"type":"text","value":"你可以通过在 Hyperopt 子类中实现 ","position":{"start":{"line":174,"column":1},"end":{"line":174,"column":1}},"key":"OxGtdlJv1s"},{"type":"inlineCode","value":"generate_estimator()","position":{"start":{"line":174,"column":1},"end":{"line":174,"column":1}},"key":"GkGezr9K5N"},{"type":"text","value":"，为 Hyperopt 定义自己的 optuna 采样器。","position":{"start":{"line":174,"column":1},"end":{"line":174,"column":1}},"key":"qPPzX5rdk4"}],"key":"wfZsoNfCZl"},{"type":"code","lang":"python","value":"class MyAwesomeStrategy(IStrategy):\n    class HyperOpt:\n        def generate_estimator(dimensions: List['Dimension'], **kwargs):\n            return \"NSGAIIISampler\"\n","position":{"start":{"line":176,"column":1},"end":{"line":182,"column":1}},"key":"ZdNw9IgPyk"},{"type":"paragraph","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"children":[{"type":"text","value":"可用值包括 “NSGAIISampler”、“TPESampler”、“GPSampler”、“CmaEsSampler”、“NSGAIIISampler”、“QMCSampler”（详情见 ","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"key":"DCzWXBYAEG"},{"type":"link","url":"https://optuna.readthedocs.io/en/stable/reference/samplers/index.html","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"children":[{"type":"text","value":"optuna-samplers 文档","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"key":"mhp6cpBb0m"}],"urlSource":"https://optuna.readthedocs.io/en/stable/reference/samplers/index.html","key":"BmsZRCqej5"},{"type":"text","value":"），也可以是继承自 ","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"key":"mOYOIJvydj"},{"type":"inlineCode","value":"optuna.samplers.BaseSampler","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"key":"tbuVzvvSd6"},{"type":"text","value":" 的类实例。","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"key":"EfwpbdXy8K"}],"key":"EFgiShujIq"},{"type":"paragraph","position":{"start":{"line":186,"column":1},"end":{"line":186,"column":1}},"children":[{"type":"text","value":"有时需要自行研究以发现更多采样器（如 optunahub 提供的）。","position":{"start":{"line":186,"column":1},"end":{"line":186,"column":1}},"key":"VKrtBTiwjg"}],"key":"FXo103Pdxd"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"OJCLtolA0I"}],"key":"PzOhYfRAf2"},{"type":"paragraph","position":{"start":{"line":189,"column":1},"end":{"line":190,"column":1}},"children":[{"type":"text","value":"虽然可以自定义 estimator，但需要你自己研究参数并分析/理解应使用哪些参数。\n如果不确定，建议直接使用默认值（","position":{"start":{"line":189,"column":1},"end":{"line":189,"column":1}},"key":"J3zqXdQh3E"},{"type":"inlineCode","value":"\"NSGAIIISampler\"","position":{"start":{"line":189,"column":1},"end":{"line":189,"column":1}},"key":"yMswMQHXe9"},{"type":"text","value":" 被证明最为通用）。","position":{"start":{"line":189,"column":1},"end":{"line":189,"column":1}},"key":"eJINPatJeG"}],"key":"ez5D5aLy0q"}],"key":"SLi4CuHUt0"},{"type":"admonition","kind":"hint","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"使用 Optunahub 的 ","position":{"start":{"line":193,"column":1},"end":{"line":193,"column":1}},"key":"eCYYoY3jvl"},{"type":"inlineCode","value":"AutoSampler","position":{"start":{"line":193,"column":1},"end":{"line":193,"column":1}},"key":"IlZqPUUptt"}],"key":"NRfNqXX4E7"},{"type":"paragraph","position":{"start":{"line":195,"column":1},"end":{"line":195,"column":1}},"children":[{"type":"link","url":"https://hub.optuna.org/samplers/auto_sampler/","position":{"start":{"line":195,"column":1},"end":{"line":195,"column":1}},"children":[{"type":"text","value":"AutoSampler 文档","position":{"start":{"line":195,"column":1},"end":{"line":195,"column":1}},"key":"AeLQqMdYWy"}],"urlSource":"https://hub.optuna.org/samplers/auto_sampler/","key":"J26xgpO0do"}],"key":"EPYLnpe42D"},{"type":"paragraph","position":{"start":{"line":197,"column":1},"end":{"line":197,"column":1}},"children":[{"type":"text","value":"安装必要依赖","position":{"start":{"line":197,"column":1},"end":{"line":197,"column":1}},"key":"sSajQAwNWj"}],"key":"AIraZ9zFdv"},{"type":"code","lang":"bash","value":"pip install optunahub cmaes torch scipy","position":{"start":{"line":198,"column":1},"end":{"line":200,"column":1}},"key":"DUVmuC0VTi"},{"type":"paragraph","position":{"start":{"line":201,"column":1},"end":{"line":201,"column":1}},"children":[{"type":"text","value":"在策略中实现 ","position":{"start":{"line":201,"column":1},"end":{"line":201,"column":1}},"key":"GhAQ4o7n2T"},{"type":"inlineCode","value":"generate_estimator()","position":{"start":{"line":201,"column":1},"end":{"line":201,"column":1}},"key":"HxV2SkrnEs"}],"key":"pXeEqMqefo"},{"type":"code","lang":"python","value":"# ...\nfrom freqtrade.strategy.interface import IStrategy\nfrom typing import List\nimport optunahub\n# ... \n\nclass my_strategy(IStrategy):\n    class HyperOpt:\n        def generate_estimator(dimensions: List[\"Dimension\"], **kwargs):\n            if \"random_state\" in kwargs.keys():\n                return optunahub.load_module(\"samplers/auto_sampler\").AutoSampler(seed=kwargs[\"random_state\"])\n            else:\n                return optunahub.load_module(\"samplers/auto_sampler\").AutoSampler()\n","position":{"start":{"line":203,"column":1},"end":{"line":218,"column":1}},"key":"uMivGsRCZz"},{"type":"paragraph","position":{"start":{"line":220,"column":1},"end":{"line":220,"column":1}},"children":[{"type":"text","value":"显然，optuna 支持的其他采样器也可用同样方式集成。","position":{"start":{"line":220,"column":1},"end":{"line":220,"column":1}},"key":"jC19045fMo"}],"key":"B53dfCk1Dh"}],"key":"AXY9xD4Nk5"},{"type":"heading","depth":3,"position":{"start":{"line":223,"column":1},"end":{"line":223,"column":1}},"children":[{"type":"text","value":"空间类型选项","position":{"start":{"line":223,"column":1},"end":{"line":223,"column":1}},"key":"Go9DKfBwyc"}],"identifier":"id","label":"空间类型选项","html_id":"id-2","implicit":true,"key":"tsBkhshDVX"},{"type":"paragraph","position":{"start":{"line":225,"column":1},"end":{"line":225,"column":1}},"children":[{"type":"text","value":"对于附加空间，scikit-optimize（结合 Freqtrade）提供以下空间类型：","position":{"start":{"line":225,"column":1},"end":{"line":225,"column":1}},"key":"fi983fYnnB"}],"key":"eMc7ohcbHl"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":227,"column":1},"end":{"line":231,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"children":[{"type":"inlineCode","value":"Categorical","position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"key":"qJobiobuYG"},{"type":"text","value":" - 从类别列表中选择（如 ","position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"key":"Jp2U565eFG"},{"type":"inlineCode","value":"Categorical(['a', 'b', 'c'], name=\"cat\")","position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"key":"s2wamU1R3H"},{"type":"text","value":"）","position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"key":"i5AKp1j3SU"}],"key":"KAUFCyLXiO"},{"type":"listItem","spread":true,"position":{"start":{"line":228,"column":1},"end":{"line":228,"column":1}},"children":[{"type":"inlineCode","value":"Integer","position":{"start":{"line":228,"column":1},"end":{"line":228,"column":1}},"key":"Ff38e8tZlL"},{"type":"text","value":" - 从整数范围中选择（如 ","position":{"start":{"line":228,"column":1},"end":{"line":228,"column":1}},"key":"lTtpSroJZL"},{"type":"inlineCode","value":"Integer(1, 10, name='rsi')","position":{"start":{"line":228,"column":1},"end":{"line":228,"column":1}},"key":"gqI7PDUANE"},{"type":"text","value":"）","position":{"start":{"line":228,"column":1},"end":{"line":228,"column":1}},"key":"pQW0dYrYos"}],"key":"qbv9XKb9RZ"},{"type":"listItem","spread":true,"position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"children":[{"type":"inlineCode","value":"SKDecimal","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"key":"xVqsPVI0YQ"},{"type":"text","value":" - 从有限精度的小数范围中选择（如 ","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"key":"mFmPdYToyq"},{"type":"inlineCode","value":"SKDecimal(0.1, 0.5, decimals=3, name='adx')","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"key":"slaUneZnys"},{"type":"text","value":"）。","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"key":"IaxujZ1o79"},{"type":"emphasis","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"children":[{"type":"text","value":"仅 Freqtrade 提供。","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"key":"k46NGB3dVY"}],"key":"G5mMlr93md"}],"key":"gKvX3xeN8y"},{"type":"listItem","spread":true,"position":{"start":{"line":230,"column":1},"end":{"line":231,"column":1}},"children":[{"type":"inlineCode","value":"Real","position":{"start":{"line":230,"column":1},"end":{"line":230,"column":1}},"key":"WOkgtCSkY9"},{"type":"text","value":" - 从全精度小数范围中选择（如 ","position":{"start":{"line":230,"column":1},"end":{"line":230,"column":1}},"key":"UZiB32sq2N"},{"type":"inlineCode","value":"Real(0.1, 0.5, name='adx')","position":{"start":{"line":230,"column":1},"end":{"line":230,"column":1}},"key":"CYbqxZvqM7"},{"type":"text","value":"）","position":{"start":{"line":230,"column":1},"end":{"line":230,"column":1}},"key":"hCAnSmKZm1"}],"key":"RcSdwWsIfY"}],"key":"jjihHvpduv"},{"type":"paragraph","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"children":[{"type":"text","value":"你可以从 ","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"SQadhF2djI"},{"type":"inlineCode","value":"freqtrade.optimize.space","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"hQmgKvXZW0"},{"type":"text","value":" 导入所有这些类型，尽管 ","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"IP2TD9bxv8"},{"type":"inlineCode","value":"Categorical","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"GDhHhkI8yP"},{"type":"text","value":"、","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"gn7nITNboR"},{"type":"inlineCode","value":"Integer","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"XGrIkQh1k3"},{"type":"text","value":" 和 ","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"Td760Vd4Iy"},{"type":"inlineCode","value":"Real","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"NUqF3Z3nAk"},{"type":"text","value":" 只是 scikit-optimize 空间的别名。","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"tU8fq1KSZg"},{"type":"inlineCode","value":"SKDecimal","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"DGaNnWreG6"},{"type":"text","value":" 由 freqtrade 提供，用于更快的优化。","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"R438pGYX4S"}],"key":"audPC4J9P0"},{"type":"code","lang":"python","value":"from freqtrade.optimize.space import Categorical, Dimension, Integer, SKDecimal, Real  # noqa","position":{"start":{"line":234,"column":1},"end":{"line":236,"column":1}},"key":"DoVKMQvcc2"},{"type":"admonition","kind":"hint","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"SKDecimal vs. Real","position":{"start":{"line":238,"column":1},"end":{"line":238,"column":1}},"key":"aG572NaZoe"}],"key":"giNbXjFf12"},{"type":"paragraph","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"children":[{"type":"text","value":"我们建议几乎所有场景都使用 ","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"GMtb41hgB6"},{"type":"inlineCode","value":"SKDecimal","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"ySLuKg8tok"},{"type":"text","value":"，而不是 ","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"Ma2rexXwve"},{"type":"inlineCode","value":"Real","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"Xc7152ZJSO"},{"type":"text","value":" 空间。虽然 Real 空间提供全精度（高达约 16 位小数），但这种精度很少需要，且会导致 hyperopt 时间过长。","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"iYtbcE7ZcS"}],"key":"kW3HP9oEem"},{"type":"paragraph","position":{"start":{"line":241,"column":1},"end":{"line":241,"column":1}},"children":[{"type":"text","value":"假设定义了一个较小的空间（","position":{"start":{"line":241,"column":1},"end":{"line":241,"column":1}},"key":"c2wOgsazPf"},{"type":"inlineCode","value":"SKDecimal(0.10, 0.15, decimals=2, name='xxx')","position":{"start":{"line":241,"column":1},"end":{"line":241,"column":1}},"key":"Q9OmuEFt6W"},{"type":"text","value":"）——SKDecimal 只有 5 种可能（","position":{"start":{"line":241,"column":1},"end":{"line":241,"column":1}},"key":"uX8DbYQNGM"},{"type":"inlineCode","value":"[0.10, 0.11, 0.12, 0.13, 0.14, 0.15]","position":{"start":{"line":241,"column":1},"end":{"line":241,"column":1}},"key":"C1mFARXeQB"},{"type":"text","value":"）。","position":{"start":{"line":241,"column":1},"end":{"line":241,"column":1}},"key":"VqBAlIzJ2d"}],"key":"i3FiQocPMp"},{"type":"paragraph","position":{"start":{"line":243,"column":1},"end":{"line":243,"column":1}},"children":[{"type":"text","value":"相应的 real 空间 ","position":{"start":{"line":243,"column":1},"end":{"line":243,"column":1}},"key":"bwgSPUwLOV"},{"type":"inlineCode","value":"Real(0.10, 0.15 name='xxx')","position":{"start":{"line":243,"column":1},"end":{"line":243,"column":1}},"key":"AYkVvacFZg"},{"type":"text","value":" 则有几乎无限多的可能（","position":{"start":{"line":243,"column":1},"end":{"line":243,"column":1}},"key":"rCcOijober"},{"type":"inlineCode","value":"[0.10, 0.010000000001, 0.010000000002, ... 0.014999999999, 0.01500000000]","position":{"start":{"line":243,"column":1},"end":{"line":243,"column":1}},"key":"BVj3dUwToh"},{"type":"text","value":"）。","position":{"start":{"line":243,"column":1},"end":{"line":243,"column":1}},"key":"FqPOoP5Y0F"}],"key":"HdXZIP6wBc"}],"key":"a0zHtJimjX"}],"key":"iGaYtIHGaI"}],"key":"b2wYdYYdnm"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Freqtrade 高级策略指南","short_title":"高级策略","url":"/strategy-advanced","group":"高级话题"},"next":{"title":"高级委托流分析","short_title":"委托流分析","url":"/advanced-orderflow","group":"高级话题"}}},"domain":"http://localhost:3001"}