---
title: 使用杠杆交易
description: 了解如何在 Freqtrade 中使用杠杆交易,包括做空、保证金和期货交易等高级功能
---


# 使用杠杆交易

:::{warning} 测试功能
此功能仍处于测试阶段。如果您发现任何问题，请通过 Discord 或 Github Issue 告知我们。
:::

:::{warning} 一个账户上的多个机器人
您不能在同一个账户上运行两个使用杠杆的机器人。对于杠杆/保证金交易，freqtrade 假设它是账户的唯一用户，所有清算水平都是基于此假设计算的。
:::

:::{danger} 使用杠杆交易非常危险
不要使用杠杆 > 1 的策略进行交易，除非该策略在现货市场上已经显示出积极的结果。检查您的策略的止损。杠杆为 2 时，止损为 0.5（50%）太低，这些交易将在达到止损之前被清算。
我们不承担因使用此软件或此模式而导致的任何损失的责任。

请仅在您了解 freqtrade（和您的策略）如何工作时使用高级交易模式。
此外，永远不要冒险超过您能承受的损失。
:::

如果您已经有现有的策略，请阅读 [策略迁移指南](strategy_migration.md#strategy-migration-between-v2-and-v3) 以将您的策略从 freqtrade v2 策略迁移到可以做空和交易期货的版本 3 策略。

## 做空

当 [`trading_mode`](#leverage-trading-modes) 设置为 `spot` 时，无法进行做空交易。要进行做空交易，`trading_mode` 必须设置为 `margin`（目前不可用）或 [`futures`](#futures)，并且 [`margin_mode`](#margin-mode) 必须设置为 `cross`（目前不可用）或 [`isolated`](#isolated-margin-mode)。

对于做空策略，策略类必须设置类变量 `can_short = True`。

请阅读 [策略自定义](strategy-customization.md#entry-signal-rules) 以获取有关如何设置信号以进入和退出做空交易的说明。

## 理解 `trading_mode`

可能的值是：`spot`（默认）、`margin`（目前不可用）或 `futures`。

### 现货 Spot

常规交易模式（低风险）

- 仅做多交易（无做空交易）。
- 无杠杆。
- 无清算。
- 获得的/损失的利润等于资产价值的变化（减去交易费用）。

### 杠杆交易模式 Leverage

使用杠杆时，交易者从交易所借入资金。资金必须全额偿还给交易所（可能带有利息），交易者保留使用借入资金进行的任何交易的利润，或支付任何损失。

由于资金必须始终偿还，交易所将在杠杆账户中资产的总价值下降到某个点（损失的总价值小于交易者在杠杆账户中实际拥有的抵押品价值）时**清算**（强制出售交易者的资产），以确保交易者有足够的资金将借入的资产偿还给交易所。交易所还将收取**清算费用**，增加交易者的损失。

因此，**如果您不完全了解自己在做什么，请不要使用杠杆交易。杠杆交易风险很高，可能导致您的资产价值迅速降至 0，没有机会再次增值。**

#### 保证金 Margin（目前不可用）

交易发生在现货市场，但交易所以等于所选杠杆的金额向您借出货币。您将借给您的金额连同利息偿还给交易所，您的利润/损失乘以指定的杠杆。

#### 期货 Futures

永续合约（也称为永续期货）是以与基础资产紧密相关的价格交易的合约。您不是在交易实际资产，而是在交易衍生合约。永续合约可以无限期持续，与期货或期权合约不同。

除了期货合约价格变化带来的收益/损失外，交易者还交换_资金费用_，这些费用是根据期货合约与基础资产之间的价格差异得出的。期货合约与基础资产之间的价格差异因交易所而异。

要在期货市场上交易，您必须将 `trading_mode` 设置为"futures"。
您还必须选择"保证金模式"（如下所述）- freqtrade 目前仅支持隔离保证金。

```json
"trading_mode": "futures",
"margin_mode": "isolated"
```

##### 对命名

Freqtrade 遵循 [ccxt 期货命名约定](https://docs.ccxt.com/#/README?id=perpetual-swap-perpetual-future)。
因此，期货对的命名将为 `base/quote:settle`（例如 `ETH/USDT:USDT`）。

### 保证金模式

除了 `trading_mode` 之外，您还必须配置 `margin_mode`。
虽然 freqtrade 目前仅支持一种保证金模式，但这将改变，通过现在配置它，您已为未来的更新做好准备。

可能的值是：`isolated` 或 `cross`（目前不可用）。

#### 隔离保证金模式

每个市场（交易对）在单独的账户中保留抵押品

```json
"margin_mode": "isolated"
```

#### 交叉保证金模式

一个账户用于在市场（交易对）之间共享抵押品。保证金从总账户余额中提取，以避免在需要时被清算。

```json
"margin_mode": "cross"
```

请阅读 [交易所特定说明](exchanges.md) 以了解支持此模式的交易所及其差异。

## 设置使用的杠杆

不同的策略和风险状况将需要不同水平的杠杆。
虽然您可以配置一个静态杠杆值，但 freqtrade 提供了通过 [策略杠杆回调](strategy-callbacks.md#leverage-callback) 调整此值的灵活性 - 允许您按对使用不同的杠杆，或基于其他因素使您的策略结果受益。

如果未实现，杠杆默认为 1x（无杠杆）。

:::{warning} 
更高的杠杆也等于更高的风险 - 请确保您完全理解使用杠杆的影响！
:::

## 理解 `liquidation_buffer`

*默认为 `0.05`*

一个比率，指定在清算价格和止损之间放置多大的安全网，以防止头寸达到清算价格。
这个人工清算价格计算为：

`freqtrade_liquidation_price = liquidation_price ± (abs(open_rate - liquidation_price) * liquidation_buffer)`

- `±` = `+` 用于做多交易
- `±` = `-` 用于做空交易

可能的值是 0.0 到 0.99 之间的任何浮点数

**例如：** 如果交易以 10 coin/USDT 的价格进入，并且该交易的清算价格为 8 coin/USDT，则 `liquidation_buffer` 设置为 `0.05` 时，该交易的最小止损将为 $8 + ((10 - 8) * 0.05) = 8 + 0.1 = 8.1$

:::{danger} `liquidation_buffer` 为 0.0 或低 `liquidation_buffer` 可能导致清算和清算费用
目前 Freqtrade 能够计算清算价格，但不计算清算费用。将 `liquidation_buffer` 设置为 0.0 或使用低 `liquidation_buffer` 可能导致您的头寸被清算。Freqtrade 不跟踪清算费用，因此清算将导致您的机器人的利润/损失结果不准确。如果您使用低 `liquidation_buffer`，建议在您的交易所支持的情况下使用 `stoploss_on_exchange`。
:::

(unavailable-funding-rates)=

## 不可用的资金费率

对于期货数据，交易所通常提供期货蜡烛、标记和资金费率。然而，通常蜡烛和标记可能可用，但资金费率不可用。这可能会影响回测时间范围，即您可能只能测试最近的时间范围，而不能测试较早的时间范围，遇到 `No data found. Terminating.` 错误。要解决此问题，请添加 [configuration.md](configuration.md) 中列出的 `futures_funding_rate` 配置选项，建议将其设置为 `0`，除非您知道特定对、交易所和时间范围的特定资金费率。将其设置为除 `0` 以外的任何值可能会对策略中的利润计算产生重大影响，例如在 `custom_exit`、`custom_stoploss` 等函数中。

:::{warning} 这将意味着您的回测不准确。
这不会覆盖交易所提供的资金费率，但请记住，设置错误的资金费率将意味着在资金费率不可用的历史时间范围内，回测结果将不准确。
:::

### 开发者

#### 保证金模式

对于做空，支付 `borrowed` 货币利息的货币在平仓交易的同时购买（这意味着做空平仓交易中购买的金额大于做空开仓交易中出售的金额）。

对于做多，支付 `borrowed` 利息的货币已经由用户拥有，无需购买。利息从交易的 `close_value` 中减去。

所有费用都包含在交易期间的 `current_profit` 计算中。

#### 期货模式

资金费用要么添加到交易的总金额中，要么从中减去。
