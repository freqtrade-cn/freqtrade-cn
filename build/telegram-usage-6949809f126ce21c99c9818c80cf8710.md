---
title: Telegram 使用指南
subject: Freqtrade Telegram 配置指南
subtitle: 如何设置和使用 Telegram 机器人
short_title: Telegram 指南
description: 本文档详细介绍了如何为 Freqtrade 创建和配置 Telegram 机器人，以及如何获取必要的用户 ID 和群组 ID。
tags: [Telegram, 通知, 机器人, 配置, 消息推送]
categories: [通知与监控]
prerequisites: [Freqtrade已安装, 配置文件]
difficulty: beginner
estimated_time: 20分钟
last_updated: 2024-01-15
version: 1.0
nav_order: 12
toc: true
---

# Telegram 使用指南

## 设置您的 Telegram 机器人

下面我们将解释如何创建您的 Telegram 机器人，以及如何获取您的 Telegram 用户 ID。

### 1. 创建您的 Telegram 机器人

与 [Telegram BotFather](https://telegram.me/BotFather) 开始对话

发送消息 `/newbot`。

*BotFather 回复：*

> 好的，一个新机器人。我们该如何称呼它？请为您的机器人选择一个名称。

选择您机器人的公开名称（例如 `Freqtrade bot`）

*BotFather 回复：*

> 很好。现在让我们为您的机器人选择一个用户名。它必须以 `bot` 结尾。例如：TetrisBot 或 tetris_bot。

选择您机器人的名称 ID 并发送给 BotFather（例如 "`My_own_freqtrade_bot`"）

*BotFather 回复：*

> 完成！恭喜您的新机器人。您可以在 `t.me/yourbots_name_bot` 找到它。您现在可以为您的机器人添加描述、关于部分和个人资料图片，请参阅 /help 获取命令列表。顺便说一下，当您完成创建您的酷炫机器人后，如果您想要一个更好的用户名，请联系我们的机器人支持。只需确保机器人在执行此操作之前完全可操作。
> 使用此令牌访问 HTTP API：`22222222:APITOKEN`
> 有关 Bot API 的描述，请参阅此页面：https://core.telegram.org/bots/api Father bot 将返回给您令牌（API 密钥）

复制 API 令牌（上例中的 `22222222:APITOKEN`）并将其用于配置参数 `token`。

别忘了通过点击 `/START` 按钮开始与您的机器人对话

### 2. Telegram 用户 ID

#### 获取您的用户 ID

与 [userinfobot](https://telegram.me/userinfobot) 对话

获取您的 "Id"，您将使用它作为配置参数 `chat_id`。

#### 使用群组 ID

要获取群组 ID，您可以将机器人添加到群组中，启动 freqtrade，并发出 `/tg_info` 命令。
这将返回群组 ID，无需使用其他随机机器人。
虽然仍然需要 "chat_id"，但此命令不需要将其设置为特定的群组 ID。

响应还将包含 "topic_id"（如果需要）- 两者都采用可以直接复制/粘贴到配置中的格式。

```json
 {
    "enabled": true,
    "token": "********",
    "chat_id": "-1001332619709",
    "topic_id": "122"
}
```

对于 Freqtrade 配置，您可以使用完整值（包括 `-`）作为字符串：

```json
   "chat_id": "-1001332619709"
```

:::{warning} 使用 telegram 群组
    使用 telegram 群组时，您正在给予 telegram 群组的每个成员访问您的 freqtrade 机器人和通过 telegram 可能的所有命令的权限。请确保您可以信任 telegram 群组中的每个人，以避免不愉快的意外。

##### 群组话题 ID

要在群组中使用特定话题，您可以在配置中使用 `topic_id` 参数。这将允许您在群组的特定话题中使用机器人。  
如果没有这个，如果为群组聊天启用了话题，机器人将始终响应群组中的一般频道。

```json
   "chat_id": "-1001332619709",
   "topic_id": "3"
```

与群组 ID 类似 - 您可以从话题/线程中使用 `/tg_info` 获取正确的话题 ID。

#### 授权用户

对于群组，限制谁可以向机器人发送命令可能很有用。

如果 `"authorized_users": []` 存在且为空，则不允许任何用户控制机器人。
在下面的示例中，只有 ID 为 "1234567" 的用户被允许控制机器人 - 所有其他用户只能接收消息。

```json
   "chat_id": "-1001332619709",
   "topic_id": "3",
   "authorized_users": ["1234567"]
```

## 控制 telegram 通知

Freqtrade 提供了控制 telegram 机器人详细程度的方法。
每个设置都有以下可能的值：

* `on` - 将发送消息，并通知用户。
* `silent` - 将发送消息，通知将没有声音/振动。
* `off` - 完全跳过发送消息类型。

显示不同设置的示例配置：

```json
"telegram": {
    "enabled": true,
    "token": "your_telegram_token",
    "chat_id": "your_telegram_chat_id",
    "allow_custom_messages": true,
    "notification_settings": {
        "status": "silent",
        "warning": "on",
        "startup": "off",
        "entry": "silent",
        "entry_fill": "on",
        "entry_cancel": "silent",
        "exit": {
            "roi": "silent",
            "emergency_exit": "on",
            "force_exit": "on",
            "exit_signal": "silent",
            "trailing_stop_loss": "on",
            "stop_loss": "on",
            "stoploss_on_exchange": "on",
            "custom_exit": "silent",  // 未指定退出原因的自定义退出
            "partial_exit": "on",
            // "custom_exit_message": "silent",  // 禁用单个自定义退出原因
            "*": "off"  // 禁用所有其他退出原因
        },
        // "exit": "off",  // 禁用所有退出消息的简单配置
        "exit_cancel": "on",
        "exit_fill": "off",
        "protection_trigger": "off",
        "protection_trigger_global": "on",
        "strategy_msg": "off",
        "show_candle": "off"
    },
    "reload": true,
    "balance_dust_level": 0.01
},
```

* `entry` 通知在订单下单时发送，而 `entry_fill` 通知在订单在交易所成交时发送。  
* `exit` 通知在订单下单时发送，而 `exit_fill` 通知在订单在交易所成交时发送。  
    退出消息（`exit` 和 `exit_fill`）可以在各个退出原因级别进一步控制，使用特定的退出原因作为键。所有退出原因的默认值为 `on` - 但可以通过特殊的 `*` 键进行配置 - 这将作为所有未明确定义的退出原因的通配符。
* `*_fill` 通知默认关闭，必须明确启用。  
* `protection_trigger` 通知在保护触发时发送，`protection_trigger_global` 通知在全局保护触发时发送。  
* `strategy_msg` - 接收来自策略的通知，通过策略中的 `self.dp.send_msg()` 发送[更多详情](strategy-customization.md#send-notification)。  
* `show_candle` - 在入场/退出消息中显示蜡烛图值。唯一可能的值是 `"ohlc"` 或 `"off"`。  
* `balance_dust_level` 将定义 `/balance` 命令将什么视为"灰尘" - 将显示余额低于此值的货币。  
* `allow_custom_messages` 完全禁用策略消息。  
* `reload` 允许您在选定的消息上禁用重新加载按钮。  

## 创建自定义键盘（命令快捷按钮）

Telegram 允许我们创建一个带有命令按钮的自定义键盘。
默认的自定义键盘如下所示。

```python
[
    ["/daily", "/profit", "/balance"], # 第 1 行，3 个命令
    ["/status", "/status table", "/performance"], # 第 2 行，3 个命令
    ["/count", "/start", "/stop", "/help"] # 第 3 行，4 个命令
]
```

### 使用方法

您可以在 `config.json` 中创建自己的键盘：

```json
"telegram": {
      "enabled": true,
      "token": "your_telegram_token",
      "chat_id": "your_telegram_chat_id",
      "keyboard": [
          ["/daily", "/stats", "/balance", "/profit"],
          ["/status table", "/performance"],
          ["/reload_config", "/count", "/logs"]
      ]
   },
```

:::{note} 支持的命令
只允许以下命令。不支持命令参数！

`/start`, `/pause`, `/stop`, `/status`, `/status table`, `/trades`, `/profit`, `/performance`, `/daily`, `/stats`, `/count`, `/locks`, `/balance`, `/stopentry`, `/reload_config`, `/show_config`, `/logs`, `/whitelist`, `/blacklist`, `/edge`, `/help`, `/version`, `/marketdir`
:::

## Telegram 命令

默认情况下，Telegram 机器人显示预定义的命令。某些命令只能通过向机器人发送来使用。下表列出了官方命令。您可以随时使用 `/help` 请求帮助。

|  命令 | 描述 |
|----------|-------------|
| **系统命令** | |
| `/start` | 启动交易机器人 |
| `/pause | /stopentry | /stopbuy` | 暂停交易机器人。根据其规则优雅地处理开放交易。不进入新仓位。 |
| `/stop` | 停止交易机器人 |
| `/reload_config` | 重新加载配置文件 |
| `/show_config` | 显示当前配置的相关操作设置部分 |
| `/logs [limit]` | 显示最后的日志消息。 |
| `/help` | 显示帮助消息 |
| `/version` | 显示版本 |
| **状态** | |
| `/status` | 列出所有开放交易 |
| `/status <trade_id>` | 列出一个或多个特定交易。用空格分隔多个 <trade_id>。 |
| `/status table` | 以表格格式列出所有开放交易。待处理的买单用星号 (*) 标记，待处理的卖单用双星号 (**) 标记 |
| `/order <trade_id>` | 列出一个或多个特定交易的订单。用空格分隔多个 <trade_id>。 |
| `/trades [limit]` | 以表格格式列出所有最近关闭的交易。 |
| `/count` | 显示已使用和可用的交易数量 |
| `/locks` | 显示当前锁定的交易对。 |
| `/unlock <pair or lock_id>` | 移除此交易对的锁定（或此锁定 ID）。 |
| `/marketdir [long | short | even | none]` | 更新表示当前市场方向的用户管理变量。如果未提供方向，将显示当前设置的方向。 |
| `/list_custom_data <trade_id> [key]` | 列出交易 ID 和键组合的自定义数据。如果未提供键，将列出为该交易 ID 找到的所有键值对。 |
| **修改交易状态** | |
| `/forceexit <trade_id> | /fx <tradeid>` | 立即退出给定交易（忽略 `minimum_roi`）。 |
| `/forceexit all | /fx all` | 立即退出所有开放交易（忽略 `minimum_roi`）。 |
| `/fx` | `/forceexit` 的别名 |
| `/forcelong <pair> [rate]` | 立即买入给定交易对。rate 是可选的，仅适用于限价单。（必须将 `force_entry_enable` 设置为 True） |
| `/forceshort <pair> [rate]` | 立即做空给定交易对。rate 是可选的，仅适用于限价单。这只在非现货市场有效。（必须将 `force_entry_enable` 设置为 True） |
| `/delete <trade_id>` | 从数据库中删除特定交易。尝试关闭开放订单。需要在交易所手动处理此交易。 |
| `/reload_trade <trade_id>` | 从交易所重新加载交易。仅在实盘有效，可能有助于恢复在交易所手动卖出的交易。 |
| `/cancel_open_order <trade_id> | /coo <trade_id>` | 取消交易的开放订单。 |
| **指标** | |
| `/profit [<n>]` | 显示最近 n 天（默认所有交易）的已关闭交易的盈亏摘要和您的表现统计 |
| `/profit_[long\|short] [<n>]` | 显示您在一个方向上已平仓交易的盈亏摘要以及一些关于您表现的统计数据，涵盖过去n天（默认为所有交易）|
| `/performance` | 按交易对显示每个已完成交易的表现 |
| `/balance` | 显示每个货币的机器人管理余额 |
| `/balance full` | 显示每个货币的账户余额 |
| `/daily <n>` | 显示最近 n 天（n 默认为 7）的每日盈亏 |
| `/weekly <n>` | 显示最近 n 周（n 默认为 8）的每周盈亏 |
| `/monthly <n>` | 显示最近 n 个月（n 默认为 6）的每月盈亏 |
| `/stats` | 显示按退出原因统计的胜/负以及买入和卖出的平均持有时间 |
| `/exits` | 显示按退出原因统计的胜/负以及买入和卖出的平均持有时间 |
| `/entries` | 显示按退出原因统计的胜/负以及买入和卖出的平均持有时间 |
| `/whitelist [sorted] [baseonly]` | 显示当前白名单。可选择按字母顺序显示和/或仅显示每个交易对的基础货币。 |
| `/blacklist [pair]` | 显示当前黑名单，或将交易对添加到黑名单。 |
| `/edge` | 如果启用，显示 Edge 验证的交易对。 |

## Telegram 命令示例

下面，您将收到每个命令的 Telegram 消息示例。

### /start

> **状态：** `running`

### /pause | /stopentry | /stopbuy

> **状态：** `paused, no more entries will occur from now. Run /start to enable entries.`

通过将状态更改为 `paused` 来防止机器人开仓新交易。
开放交易将继续按照其常规规则（ROI/退出信号、止损等）进行管理。
请注意，仓位调整仍然活跃，但仅在退出方面 - 这意味着当机器人处于 `paused` 状态时，它只能减少开放交易的仓位大小。

之后，给机器人时间关闭开放交易（可以通过 `/status table` 检查）。
一旦所有仓位都关闭，运行 `/stop` 完全停止机器人。

使用 `/start` 将机器人恢复到 `running` 状态，允许它开仓新仓位。

:::{warning}
暂停/停止入场信号仅在机器人运行时有效，并且不会持久化，因此重启机器人将导致此重置。
:::

### /stop

> `Stopping trader ...`
> **状态：** `stopped`

### /status

对于每个开放交易，机器人将向您发送以下消息。
入场标签可通过策略配置。

> **交易 ID：** `123` `(1 天前)`  
> **当前交易对：** CVC/BTC  
> **方向：** 做多  
> **杠杆：** 1.0  
> **数量：** `26.64180098`  
> **入场标签：** Awesome Long Signal  
> **入场价格：** `0.00007489`  
> **当前价格：** `0.00007489`  
> **未实现盈亏：** `12.95%`  
> **止损：** `0.00007389 (-0.02%)`  

### /status table

以表格格式返回所有开放交易的状态。

```text
ID L/S    交易对    时间    盈亏
----    --------  -------  --------
  67 L   SC/BTC    1 d      13.33%
 123 S   CVC/BTC   1 h      12.95%
```

### /count

返回已使用和可用的交易数量。

```text
当前    最大
---------  -----
     2     10
```

### /profit

也可以使用 `/profit_long` 和 `/profit_short` 来仅显示多头或空头交易的利润。

返回您的盈亏和表现摘要。

> **ROI：** 已关闭交易  
>   ∙ `0.00485701 BTC (2.2%) (15.2 Σ%)`  
>   ∙ `62.968 USD`  
> **ROI：** 所有交易  
>   ∙ `0.00255280 BTC (1.5%) (6.43 Σ%)`  
>   ∙ `33.095 EUR`  
>
> **总交易次数：** `138`  
> **机器人启动：** `2022-07-11 18:40:44`  
> **第一笔交易：** `3 天前`  
> **最新交易：** `2 分钟前`  
> **平均持续时间：** `2:33:45`  
> **最佳表现：** `PAY/BTC: 50.23%`  
> **交易量：** `0.5 BTC`  
> **盈亏比：** `1.04`  
> **胜/负：** `102 / 36`  
> **胜率：** `73.91%`  
> **期望值（比率）：** `4.87 (1.66)`  
> **最大回撤：** `9.23% (0.01255 BTC)`  

相对盈亏 `1.2%` 是每笔交易的平均盈亏。  
相对盈亏 `15.2 Σ%` 是基于起始资金计算的 - 所以在这种情况下，起始资金是 `0.00485701 * 1.152 = 0.00738 BTC`。  
**起始资金(**) 要么取自 `available_capital` 设置，要么通过使用当前钱包大小 - 利润计算。  
**盈亏比** 计算为总利润/总亏损 - 应作为策略的整体指标。  
**期望值** 对应于每单位风险货币的平均回报，即胜率和风险回报比（获胜交易的平均收益与亏损交易的平均损失相比）。  
**期望值比率** 是基于所有过去交易的表现对后续交易的预期盈亏。  
**最大回撤** 对应于回测指标 `Absolute Drawdown (Account)` - 计算为 `(Absolute Drawdown) / (DrawdownHigh + startingBalance)`。  
**机器人启动日期** 将指机器人首次启动的日期。对于较旧的机器人，这将默认为第一笔交易的开放日期。  

### /forceexit <trade_id>

> **BINANCE：** 以限价 `0.01650000` 退出 BTC/LTC（盈亏：~-4.07%，-0.00008168）

:::{tip}
您可以通过不带参数调用 `/forceexit` 获取所有开放交易的列表，这将显示按钮以简单退出交易。

此命令在 `/fx` 中有别名 - 具有相同的功能，但在"紧急"情况下输入更快。
:::

### /forcelong <pair> [rate] | /forceshort <pair> [rate]

`/forcebuy <pair> [rate]` 也支持做多，但应被视为已弃用。

> **BINANCE：** 以限价 `0.03400000` 做多 ETH/BTC（`1.000000 ETH`，`225.290 USD`）

省略交易对将打开一个查询，询问要交易的交易对（基于当前白名单）。
通过 `/forcelong` 创建的交易将具有 `force_entry` 的买入标签。

![Telegram 强制买入截图](assets/telegram_forcebuy.png)

请注意，要使此功能工作，需要将 `force_entry_enable` 设置为 true。

[更多详情](configuration.md#understand-force_entry_enable)

### /performance

返回机器人已卖出的每种加密货币的表现。
> 表现：  
> 1. `RCN/BTC 0.003 BTC (57.77%) (1)`  
> 2. `PAY/BTC 0.0012 BTC (56.91%) (1)`  
> 3. `VIB/BTC 0.0011 BTC (47.07%) (1)`  
> 4. `SALT/BTC 0.0010 BTC (30.24%) (1)`  
> 5. `STORJ/BTC 0.0009 BTC (27.24%) (1)`  
> ...  

相对表现是针对该货币的总投资计算的，汇总该货币的所有已成交入场。

### /balance

返回您在交易所拥有的所有加密货币的余额。

> **货币：** BTC  
> **可用：** 3.05890234  
> **余额：** 3.05890234  
> **待处理：** 0.0  
>
> **货币：** CVC  
> **可用：** 86.64180098  
> **余额：** 86.64180098  
> **待处理：** 0.0  

### /daily <n>

默认情况下 `/daily` 将返回最近 7 天。下面的示例是 `/daily 3`：

> **最近 3 天的每日盈亏：**

```text
日期（次数）     USDT          USD         盈亏 %
--------------  ------------  ----------  ----------
2022-06-11 (1)  -0.746 USDT   -0.75 USD   -0.08%
2022-06-10 (0)  0 USDT        0.00 USD    0.00%
2022-06-09 (5)  20 USDT       20.10 USD   5.00%
```

### /weekly <n>

默认情况下 `/weekly` 将返回最近 8 周，包括当前周。每周从周一开始。
下面的示例是 `/weekly 3`：

> **最近 3 周的每周盈亏（从周一开始）：**

```text
周一（次数）  盈亏 BTC      盈亏 USD     盈亏 %
-------------  --------------  ------------    ----------
2018-01-03 (5)  0.00224175 BTC  29,142 USD   4.98%
2017-12-27 (1)  0.00033131 BTC   4,307 USD   0.00%
2017-12-20 (4)  0.00269130 BTC  34.986 USD   5.12%
```

### /monthly <n>

默认情况下 `/monthly` 将返回最近 6 个月，包括当前月。下面的示例是 `/monthly 3`：

> **最近 3 个月的每月盈亏：**

```text
月份（次数）  盈亏 BTC      盈亏 USD     盈亏 %
-------------  --------------  ------------    ----------
2018-01 (20)    0.00224175 BTC  29,142 USD  4.98%
2017-12 (5)    0.00033131 BTC   4,307 USD   0.00%
2017-11 (10)    0.00269130 BTC  34.986 USD  5.10%
```

### /whitelist

显示当前白名单

> 使用包含 22 个交易对的 `StaticPairList` 白名单  
> `IOTA/BTC, NEO/BTC, TRX/BTC, VET/BTC, ADA/BTC, ETC/BTC, NCASH/BTC, DASH/BTC, XRP/BTC, XVG/BTC, EOS/BTC, LTC/BTC, OMG/BTC, BTG/BTC, LSK/BTC, ZEC/BTC, HOT/BTC, IOTX/BTC, XMR/BTC, AST/BTC, XLM/BTC, NANO/BTC`

### /blacklist [pair]

显示当前黑名单。
如果设置了交易对，则此交易对将被添加到交易对列表中。
也支持多个交易对，用空格分隔。  
使用 `/reload_config` 重置黑名单。

> 使用包含 2 个交易对的 `StaticPairList` 黑名单  
>`DODGE/BTC`, `HOT/BTC`。  

### /edge

显示 Edge 验证的交易对及其相应的胜率、期望值和止损值。

> **Edge 仅验证以下交易对：**

```text
交易对      胜率    期望值    止损
--------  ---------  ------------  ----------
DOCK/ETH   0.522727      0.881821       -0.03
PHX/ETH    0.677419      0.560488       -0.03
HOT/ETH    0.733333      0.490492       -0.03
HC/ETH     0.588235      0.280988       -0.02
ARDR/ETH   0.366667      0.143059       -0.01
```

### /version

> **版本：** `0.14.3`

### /marketdir

如果提供了市场方向，该命令将更新表示当前市场方向的用户管理变量。
此变量在机器人启动时不会设置为任何有效的市场方向，必须由用户设置。下面的示例是 `/marketdir long`：

```text
成功将市场方向从 none 更新为 long。
```

如果未提供市场方向，该命令将输出当前设置的市场方向。下面的示例是 `/marketdir`：

```text
当前设置的市场方向：even
```

您可以通过 `self.market_direction` 在策略中使用市场方向。

:::{warning} 机器人重启
请注意，市场方向不会持久化，将在机器人重启/重新加载后重置。
:::

:::{danger} 回测
由于此值/变量旨在在模拟/实盘交易中手动更改。

使用 `market_direction` 的策略可能不会产生可靠、可重现的结果（对此变量的更改不会反映在回测中）。使用风险自负。
:::
