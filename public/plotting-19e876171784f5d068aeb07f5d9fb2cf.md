---
title: 绘图
description: 了解如何使用 Freqtrade 的绘图功能可视化价格、指标和利润数据,包括安装配置、命令参数和示例
subject: Freqtrade 绘图功能指南
subtitle: 可视化价格、指标和回测结果
short_title: 绘图
tags: [绘图, 可视化, 指标, 回测, 利润]
categories: [工具与命令]
prerequisites: [回测数据, 策略开发]
difficulty: beginner
estimated_time: 15分钟
last_updated: 2024-01-15
version: 1.0
nav_order: 16
toc: true
---

# 绘图

本页解释了如何绘制价格、指标和利润。

:::{warning} 已弃用
本页中描述的命令（`plot-dataframe`、`plot-profit`）应被视为已弃用，并且处于维护模式。
这主要是由于即使是中等大小的图表也可能导致的性能问题，而且从用户界面的角度来看，"存储文件并在浏览器中打开"并不是很直观。

虽然目前没有立即计划移除它们，但它们并未积极维护，如果需要进行重大更改以保持其工作，可能会在短期内被移除。

请使用 [FreqUI](freq-ui.md) 进行绘图需求，它不会遇到相同的性能问题。
:::

## 安装 / 设置

绘图模块使用 Plotly 库。您可以通过运行以下命令来安装 / 升级：

```bash
pip install -U -r requirements-plot.txt
```

## 绘制价格和指标

`freqtrade plot-dataframe` 子命令显示一个交互式图表，包含三个子图：

* 主图，带有蜡烛图和跟随价格的指标（sma/ema）
* 成交量柱状图
* 由 `--indicators2` 指定的其他指标

![plot-dataframe](assets/plot-dataframe.png)

可能的参数：

```{include} commands/plot-dataframe.md
```

示例：

```bash
freqtrade plot-dataframe -p BTC/ETH --strategy AwesomeStrategy
```

`-p/--pairs` 参数可用于指定您想要绘制的交易对。

:::{caution}
`freqtrade plot-dataframe` 子命令为每个交易对生成一个绘图文件。
:::

指定自定义指标。

使用 `--indicators1` 用于主图，`--indicators2` 用于下方的子图（如果值在不同于价格的范围）。

```bash
freqtrade plot-dataframe --strategy AwesomeStrategy -p BTC/ETH --indicators1 sma ema --indicators2 macd
```

### 进一步的使用示例

要绘制多个交易对，请用空格分隔它们：

```bash
freqtrade plot-dataframe --strategy AwesomeStrategy -p BTC/ETH XRP/ETH
```

要绘制时间范围（以放大）

```bash
freqtrade plot-dataframe --strategy AwesomeStrategy -p BTC/ETH --timerange=20180801-20180805
```

要绘制存储在数据库中的交易，请使用 `--db-url` 结合 `--trade-source DB`：

```bash
freqtrade plot-dataframe --strategy AwesomeStrategy --db-url sqlite:///tradesv3.dry_run.sqlite -p BTC/ETH --trade-source DB
```

要绘制回测结果中的交易，请使用 `--export-filename <filename>`

```bash
freqtrade plot-dataframe --strategy AwesomeStrategy --export-filename user_data/backtest_results/backtest-result.json -p BTC/ETH
```

### 绘图数据框基础

![plot-dataframe2](assets/plot-dataframe2.png)

`plot-dataframe` 子命令需要回测数据、策略和回测结果文件或数据库，其中包含与策略相对应的交易。

生成的图表将包含以下元素：

* 绿色三角形：来自策略的买入信号。（注意：并非每个买入信号都会生成交易，请与青色圆圈进行比较。）
* 红色三角形：来自策略的卖出信号。（同样，并非每个卖出信号都会终止交易，请与红色和绿色方块进行比较。）
* 青色圆圈：交易入场点。
* 红色方块：亏损或 0% 利润的交易出场点。
* 绿色方块：盈利交易的出场点。
* 与蜡烛图比例相对应的指标（例如 SMA/EMA），由 `--indicators1` 指定。
* 成交量（主图底部的柱状图）。
* 不同比例的指标（例如 MACD、RSI）在成交量柱状图下方，由 `--indicators2` 指定。

:::{warning} 布林带
如果存在 `bb_lowerband` 和 `bb_upperband` 列，布林带会自动添加到图表中，并绘制为从下带到上带的浅蓝色区域。
:::

#### 高级绘图配置

可以在策略中的 `plot_config` 参数中指定高级绘图配置。

使用 `plot_config` 时的其他功能包括：

* 为每个指标指定颜色
* 指定其他子图
* 指定指标对以填充之间的区域

下面的示例绘图配置为指标指定了固定颜色。否则，连续的图表可能会每次产生不同的颜色方案，使得比较变得困难。
它还允许多个子图同时显示 MACD 和 RSI。

可以使用 `type` 键配置绘图类型。可能的类型有：

* `scatter` 对应于 `plotly.graph_objects.Scatter` 类（默认）。
* `bar` 对应于 `plotly.graph_objects.Bar` 类。

可以在 `plotly` 字典中指定 `plotly.graph_objects.*` 构造函数的额外参数。

带有内联注释的示例配置，解释过程：

```python
@property
def plot_config(self):
    """
        构建返回字典的方法有很多。
        唯一重要的是返回值。
        示例：
            plot_config = {'main_plot': {}, 'subplots': {}}

    """
    plot_config = {}
    plot_config['main_plot'] = {
        # 主图指标的配置。
        # 假设指定了 2 个参数，emashort 和 emalong。
        f'ema_{self.emashort.value}': {'color': 'red'},
        f'ema_{self.emalong.value}': {'color': '#CCCCCC'},
        # 省略颜色时，将随机选择颜色。
        'sar': {},
        # 填充 senkou_a 和 senkou_b 之间的区域
        'senkou_a': {
            'color': 'green', #可选
            'fill_to': 'senkou_b',
            'fill_label': 'Ichimoku Cloud', #可选
            'fill_color': 'rgba(255,76,46,0.2)', #可选
        },
        # 也绘制 senkou_b，而不仅仅是到它的区域。
        'senkou_b': {}
    }
    plot_config['subplots'] = {
         # 创建 MACD 子图
        "MACD": {
            'macd': {'color': 'blue', 'fill_to': 'macdhist'},
            'macdsignal': {'color': 'orange'},
            'macdhist': {'type': 'bar', 'plotly': {'opacity': 0.9}}
        },
        # 额外的 RSI 子图
        "RSI": {
            'rsi': {'color': 'red'}
        }
    }

    return plot_config
```

:::{caution} 作为属性（以前的方法）
也可以将 plot_config 作为属性分配（这曾经是默认方式）。
这有一个缺点，即策略参数不可用，导致某些配置无法工作。

```python
    plot_config = {
        'main_plot': {
            # 主图指标的配置。
            # 指定 `ema10` 为红色，`ema50` 为灰色。
            'ema10': {'color': 'red'},
            'ema50': {'color': '#CCCCCC'},
            # 省略颜色时，将随机选择颜色。
            'sar': {},
        # 填充 senkou_a 和 senkou_b 之间的区域
        'senkou_a': {
            'color': 'green', #可选
            'fill_to': 'senkou_b',
            'fill_label': 'Ichimoku Cloud', #可选
            'fill_color': 'rgba(255,76,46,0.2)', #可选
        },
        # 也绘制 senkou_b，而不仅仅是到它的区域。
        'senkou_b': {}
        },
        'subplots': {
            # 创建 MACD 子图
            "MACD": {
                'macd': {'color': 'blue', 'fill_to': 'macdhist'},
                'macdsignal': {'color': 'orange'},
                'macdhist': {'type': 'bar', 'plotly': {'opacity': 0.9}}
            },
            # 额外的 RSI 子图
            "RSI": {
                'rsi': {'color': 'red'}
            }
        }
    }

```

:::

:::{caution}
上述配置假设 `ema10`、`ema50`、`senkou_a`、`senkou_b`、`macd`、`macdsignal`、`macdhist` 和 `rsi` 是策略创建的 DataFrame 中的列。
:::

:::{warning}
`plotly` 参数仅在使用 plotly 库时支持，并且不会与 freq-ui 一起工作。
:::

:::{warning} 交易位置调整
如果使用 `position_adjustment_enable` / `adjust_trade_position()`，交易初始买入价格将在多个订单上平均，交易开始价格很可能会出现在蜡烛范围之外。
:::

## 绘制利润

![plot-profit](assets/plot-profit.png)

`plot-profit` 子命令显示一个交互式图表，包含三个图表：

* 所有交易对的平均收盘价。
* 回测产生的总利润。
请注意，这不是实际利润，而是一个估计。
* 每个交易对的利润。
* 交易的并行性。
* 水下（回撤期间）。

第一个图表有助于了解整体市场的进展。

第二个图表将显示您的算法是否有效。

也许您希望一个算法能够稳定地产生小额利润，或者一个算法行动较少，但会产生大的波动。
此图表还将突出显示最大回撤期间的开始（和结束）。

第三个图表可以帮助发现异常值，导致利润峰值的事件。

第四个图表可以帮助您分析交易并行性，显示 max_open_trades 被最大化的频率。

`freqtrade plot-profit` 子命令的可能选项：

```{include} commands/plot-profit.md
```

`-p/--pairs` 参数可用于限制此计算中考虑的交易对。

示例：

使用自定义回测导出文件

```bash
freqtrade plot-profit  -p LTC/BTC --export-filename user_data/backtest_results/backtest-result.json
```

使用自定义数据库

```bash
freqtrade plot-profit  -p LTC/BTC --db-url sqlite:///tradesv3.sqlite --trade-source DB
```

```bash
freqtrade --datadir user_data/data/binance_save/ plot-profit -p LTC/BTC
```
