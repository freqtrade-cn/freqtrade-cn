{"version":2,"kind":"Article","sha256":"e92e2991f15bebc7659c093b20696ed23c7f327efb252c908cd92b851b7c6138","slug":"strategy-customization","location":"/strategy-customization.md","dependencies":[],"frontmatter":{"title":"策略自定义指南","description":"本文档介绍如何在 Freqtrade 中自定义交易策略,包括添加新指标、设置交易规则等内容。","short_title":"策略自定义","subtitle":"如何开发自己的交易策略","tags":["策略开发","自定义","指标","交易规则","编程"],"subject":"Freqtrade 策略开发","authors":[{"id":"Freqtrade","name":"Freqtrade"}],"github":"https://github.com/freqtrade-cn/docs_zh-CN","keywords":["Freqtrade","中文文档","交易机器人","量化交易","加密货币","数字货币","区块链","人工智能","机器学习"],"edit_url":"https://github.com/freqtrade-cn/docs_zh-CN/blob/main/strategy-customization.md","exports":[{"format":"md","filename":"strategy-customization.md","url":"/strategy-customizati-2f2ab3a165753cdf5bc0cb6654dd7378.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"策略自定义","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"Fg23z2kkhx"}],"identifier":"id","label":"策略自定义","html_id":"id","implicit":true,"key":"P0cDpIRPvo"},{"type":"paragraph","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"本页将介绍如何自定义你的策略、添加新指标以及设置交易规则。","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"sx85xeaMsQ"}],"key":"H0yDbn9c7w"},{"type":"paragraph","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"如果你还没有了解过，建议先阅读：","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"YYEXPYmU8T"}],"key":"PnZ0WkhfMm"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":24,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"link","url":"/strategy-101","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"Freqtrade 策略 101","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"OF6SowGza4"}],"urlSource":"strategy-101.md","dataUrl":"/strategy-101.json","internal":true,"protocol":"file","key":"HVtfeEvnWg"},{"type":"text","value":"，快速入门策略开发","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"CHCC2uWMEM"}],"key":"EA7JjWP1wp"},{"type":"listItem","spread":true,"position":{"start":{"line":25,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"link","url":"/bot-basics","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"Freqtrade 机器人基础","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"hG9hD5JNAe"}],"urlSource":"bot-basics.md","dataUrl":"/bot-basics.json","internal":true,"protocol":"file","key":"hNtQI4BcvD"},{"type":"text","value":"，了解机器人整体运行机制","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"WKiEz8sddN"}],"key":"p0CfgBB0AJ"}],"key":"GYPvPVgLZZ"},{"type":"heading","depth":3,"position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"开发你自己的策略","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"NWDEZUmGsQ"}],"identifier":"id","label":"开发你自己的策略","html_id":"id-1","implicit":true,"key":"pYj2UGxkqF"},{"type":"paragraph","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"text","value":"机器人自带了一个默认策略文件。","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"yJNkJ50loD"}],"key":"mwjf36sN6H"},{"type":"paragraph","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"text","value":"此外，","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"MzueWZACl3"},{"type":"link","url":"https://github.com/freqtrade/freqtrade-strategies","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"text","value":"策略仓库","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"tuOH5lowIi"}],"urlSource":"https://github.com/freqtrade/freqtrade-strategies","error":true,"key":"L7vpfhCVqH"},{"type":"text","value":"中还提供了其他策略。","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"XJ7sglNEot"}],"key":"bTwQogIp4j"},{"type":"paragraph","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"text","value":"不过你很可能有自己的策略想法。","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"zoUxySzBKA"}],"key":"rkYbWwwxCy"},{"type":"paragraph","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"text","value":"本文档旨在帮助你将想法转化为可运行的策略。","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"qog91Rnr2C"}],"key":"oKa23JmYOl"},{"type":"heading","depth":4,"position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"text","value":"生成策略模板","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"qCHABdbHYy"}],"identifier":"id","label":"生成策略模板","html_id":"id-2","implicit":true,"key":"uLDtgiYHWr"},{"type":"paragraph","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"text","value":"你可以通过以下命令快速开始：","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"d1aznHq742"}],"key":"MBVVmB6Y0e"},{"type":"code","lang":"bash","value":"freqtrade new-strategy --strategy AwesomeStrategy","position":{"start":{"line":41,"column":1},"end":{"line":43,"column":1}},"key":"QJnxnKEkri"},{"type":"paragraph","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"children":[{"type":"text","value":"这会基于模板创建一个名为 ","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"key":"YXhAj2dff9"},{"type":"inlineCode","value":"AwesomeStrategy","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"key":"ZlNtr3Cf97"},{"type":"text","value":" 的新策略，文件路径为 ","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"key":"JvcvSFQpmU"},{"type":"inlineCode","value":"user_data/strategies/AwesomeStrategy.py","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"key":"TP4BYobAmE"},{"type":"text","value":"。","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"key":"HXPXsGqtdL"}],"key":"UWIpAsmTjt"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"fKdOZw48kn"}],"key":"SKziC9IeOi"},{"type":"paragraph","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"children":[{"type":"text","value":"策略的","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"hwA7okHhF2"},{"type":"emphasis","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"children":[{"type":"text","value":"名称","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"a4FltdQAxg"}],"key":"ohwCr9Q9CG"},{"type":"text","value":"和文件名是有区别的。大多数命令中，Freqtrade 使用的是","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"HMi7Dw7muV"},{"type":"emphasis","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"children":[{"type":"text","value":"策略类名","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"JwFtsfEvRx"}],"key":"F7a2qlG2tA"},{"type":"text","value":"，而不是文件名。","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"nQekAZ4dTj"}],"key":"kQjTWQSPy0"},{"type":"paragraph","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"children":[{"type":"inlineCode","value":"new-strategy","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"key":"KvaxujJsQh"},{"type":"text","value":" 命令生成的示例策略并不会直接盈利。","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"key":"bln2UjcnG0"}],"key":"iVNxSuOV0F"}],"key":"DQv7f6Soy8"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"不同模板级别","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"CnWnE8hCHh"}],"key":"jaSU0pFz1n"},{"type":"paragraph","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"children":[{"type":"inlineCode","value":"freqtrade new-strategy","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"GmKN54XlZI"},{"type":"text","value":" 有一个额外参数 ","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"j5x4GIzf25"},{"type":"inlineCode","value":"--template","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"p3go6EW5ri"},{"type":"text","value":"，可控制生成策略的复杂程度。用 ","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"oDqWQIfYV8"},{"type":"inlineCode","value":"--template minimal","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"GJ17v9vNm0"},{"type":"text","value":" 可获得一个空白策略，无任何指标示例；用 ","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"JwcrNwd8C3"},{"type":"inlineCode","value":"--template advanced","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"MSwgPVZR7i"},{"type":"text","value":" 可获得包含更多复杂特性的模板。","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"E1xoXvErDS"}],"key":"RX3Gyqz9yR"}],"key":"CZB18Z4ogY"},{"type":"heading","depth":4,"position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"children":[{"type":"text","value":"策略结构剖析","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"VPrb6GWYWm"}],"identifier":"id","label":"策略结构剖析","html_id":"id-3","implicit":true,"key":"MZKNpQF7XK"},{"type":"paragraph","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"children":[{"type":"text","value":"一个策略文件包含构建策略逻辑所需的全部信息：","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"key":"EYN9Yl9aVt"}],"key":"s5xGoFHvSX"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":61,"column":1},"end":{"line":75,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"children":[{"type":"text","value":"K线数据（OHLCV 格式）","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"RtFoP4traG"}],"key":"okD0cR5iMV"},{"type":"listItem","spread":true,"position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"children":[{"type":"text","value":"各类指标","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"SLxkAWFh8f"}],"key":"CDb5q3omI7"},{"type":"listItem","spread":true,"position":{"start":{"line":63,"column":1},"end":{"line":64,"column":1}},"children":[{"type":"text","value":"入场逻辑","position":{"start":{"line":63,"column":1},"end":{"line":63,"column":1}},"key":"xYmGo6CaSt"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"children":[{"type":"text","value":"信号","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"key":"LexPKNSx3B"}],"key":"pJCJChNezG"}],"key":"JnAJ0lWRbN"}],"key":"ifeeALOUZL"},{"type":"listItem","spread":true,"position":{"start":{"line":65,"column":1},"end":{"line":68,"column":1}},"children":[{"type":"text","value":"出场逻辑","position":{"start":{"line":65,"column":1},"end":{"line":65,"column":1}},"key":"CziMF9gHPr"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":66,"column":1},"end":{"line":68,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"children":[{"type":"text","value":"信号","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"key":"DbbC4iEnTk"}],"key":"zXc3OtbjqQ"},{"type":"listItem","spread":true,"position":{"start":{"line":67,"column":1},"end":{"line":67,"column":1}},"children":[{"type":"text","value":"最小收益率（ROI）","position":{"start":{"line":67,"column":1},"end":{"line":67,"column":1}},"key":"UnKOhNlgWx"}],"key":"dOu6DWdRIY"},{"type":"listItem","spread":true,"position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"children":[{"type":"text","value":"回调函数（自定义函数）","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"pCFS3v073O"}],"key":"fgF1lja0rZ"}],"key":"WtYvLKKZJC"}],"key":"T9Tpr1txju"},{"type":"listItem","spread":true,"position":{"start":{"line":69,"column":1},"end":{"line":72,"column":1}},"children":[{"type":"text","value":"止损","position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"key":"b1lJTMza6T"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":70,"column":1},"end":{"line":72,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"children":[{"type":"text","value":"固定/绝对止损","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"KyPEd35bNV"}],"key":"Wm3h3b6DAs"},{"type":"listItem","spread":true,"position":{"start":{"line":71,"column":1},"end":{"line":71,"column":1}},"children":[{"type":"text","value":"跟踪止损","position":{"start":{"line":71,"column":1},"end":{"line":71,"column":1}},"key":"xt5GSUlZbk"}],"key":"TLp9R5ZqD8"},{"type":"listItem","spread":true,"position":{"start":{"line":72,"column":1},"end":{"line":72,"column":1}},"children":[{"type":"text","value":"回调函数（自定义函数）","position":{"start":{"line":72,"column":1},"end":{"line":72,"column":1}},"key":"mE7qsZTiud"}],"key":"SouexGWkHu"}],"key":"uSD9pWZnNz"}],"key":"jtOGC0rkjM"},{"type":"listItem","spread":true,"position":{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},"children":[{"type":"text","value":"定价（可选）","position":{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},"key":"maHYIifhF7"}],"key":"dC5YVv6XnS"},{"type":"listItem","spread":true,"position":{"start":{"line":74,"column":1},"end":{"line":75,"column":1}},"children":[{"type":"text","value":"持仓调整（可选）","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"key":"jRd39Zj1pj"}],"key":"lUVzVUpPzo"}],"key":"FdRuVCYZJy"},{"type":"paragraph","position":{"start":{"line":76,"column":1},"end":{"line":77,"column":1}},"children":[{"type":"text","value":"机器人自带一个名为 ","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"gvW5n8BMyn"},{"type":"inlineCode","value":"SampleStrategy","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"YdknS0uLRo"},{"type":"text","value":" 的示例策略，可作为参考：","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"FNvrrMecMh"},{"type":"inlineCode","value":"user_data/strategies/sample_strategy.py","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"kUw5QN0wDK"},{"type":"text","value":"。\n你可以用参数 ","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"RzqJT4WdOK"},{"type":"inlineCode","value":"--strategy SampleStrategy","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"QjA6A9FgQk"},{"type":"text","value":" 进行测试。注意这里用的是策略类名，而不是文件名。","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"Q0CLGxy1XL"}],"key":"bzmIOnF4Rk"},{"type":"paragraph","position":{"start":{"line":79,"column":1},"end":{"line":79,"column":1}},"children":[{"type":"text","value":"此外，还有一个名为 ","position":{"start":{"line":79,"column":1},"end":{"line":79,"column":1}},"key":"zvzNrjOdyL"},{"type":"inlineCode","value":"INTERFACE_VERSION","position":{"start":{"line":79,"column":1},"end":{"line":79,"column":1}},"key":"b83Ducs6cg"},{"type":"text","value":" 的属性，用于定义策略接口的版本。当前版本为 3，如果未在策略中显式设置，则默认为 3。","position":{"start":{"line":79,"column":1},"end":{"line":79,"column":1}},"key":"ga1RaAxBh4"}],"key":"QMi1qTnIAB"},{"type":"paragraph","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"children":[{"type":"text","value":"你可能会看到旧策略设置为接口版本 2，未来版本会要求升级到 v3。","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"u19r6Sfbod"}],"key":"vgeQ4TCV0R"},{"type":"paragraph","position":{"start":{"line":83,"column":1},"end":{"line":83,"column":1}},"children":[{"type":"text","value":"用 ","position":{"start":{"line":83,"column":1},"end":{"line":83,"column":1}},"key":"orZdUxUVo2"},{"type":"inlineCode","value":"trade","position":{"start":{"line":83,"column":1},"end":{"line":83,"column":1}},"key":"KFgACqBfXj"},{"type":"text","value":" 命令即可启动机器人进入 dry 或 live 模式：","position":{"start":{"line":83,"column":1},"end":{"line":83,"column":1}},"key":"O4pakNCAHe"}],"key":"V0VLHlwvYE"},{"type":"code","lang":"bash","value":"freqtrade trade --strategy AwesomeStrategy","position":{"start":{"line":85,"column":1},"end":{"line":87,"column":1}},"key":"leaeKDaSAh"},{"type":"heading","depth":4,"position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"children":[{"type":"text","value":"机器人运行模式","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"key":"scC6rUNE7L"}],"identifier":"id","label":"机器人运行模式","html_id":"id-4","implicit":true,"key":"bJ4Cs2ffKr"},{"type":"paragraph","position":{"start":{"line":91,"column":1},"end":{"line":91,"column":1}},"children":[{"type":"text","value":"Freqtrade 策略可在 5 种主要模式下被机器人处理：","position":{"start":{"line":91,"column":1},"end":{"line":91,"column":1}},"key":"ljX6cD61A7"}],"key":"gyFx03BUdr"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":93,"column":1},"end":{"line":98,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"children":[{"type":"text","value":"回测（backtesting）","position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"key":"uodcvTew4N"}],"key":"dPRyrtfr3k"},{"type":"listItem","spread":true,"position":{"start":{"line":94,"column":1},"end":{"line":94,"column":1}},"children":[{"type":"text","value":"超参优化（hyperopting）","position":{"start":{"line":94,"column":1},"end":{"line":94,"column":1}},"key":"PVOwsCqsck"}],"key":"eIDggkDaOc"},{"type":"listItem","spread":true,"position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"children":[{"type":"text","value":"模拟盘（dry/forward testing）","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"NfHhl9HWyf"}],"key":"cfs3ctY61q"},{"type":"listItem","spread":true,"position":{"start":{"line":96,"column":1},"end":{"line":96,"column":1}},"children":[{"type":"text","value":"实盘（live）","position":{"start":{"line":96,"column":1},"end":{"line":96,"column":1}},"key":"VAq4BDH2jR"}],"key":"KlRwO8FR2G"},{"type":"listItem","spread":true,"position":{"start":{"line":97,"column":1},"end":{"line":98,"column":1}},"children":[{"type":"text","value":"FreqAI（本页不涉及）","position":{"start":{"line":97,"column":1},"end":{"line":97,"column":1}},"key":"ryYdzaeEdN"}],"key":"Ss1BDPgyxi"}],"key":"UvWkC1ERTS"},{"type":"paragraph","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"children":[{"type":"text","value":"关于如何设置 dry 或 live 模式，请查阅","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"JjbJALuCqz"},{"type":"link","url":"/configuration","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"children":[{"type":"text","value":"配置文档","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"wW881HnMsh"}],"urlSource":"configuration.md","dataUrl":"/configuration.json","internal":true,"protocol":"file","key":"DBpIWaCpBI"},{"type":"text","value":"。","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"UKtxWu1yn6"}],"key":"r6iQLujLPQ"},{"type":"paragraph","position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"children":[{"type":"strong","position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"children":[{"type":"text","value":"测试时请始终使用 dry 模式，这样可以在不冒资金风险的情况下了解策略实际表现。","position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"key":"gdwiCM5aiI"}],"key":"gMgMAqmVlV"}],"key":"i1L7sLW0mw"},{"type":"heading","depth":3,"position":{"start":{"line":103,"column":1},"end":{"line":103,"column":1}},"children":[{"type":"text","value":"深入剖析","position":{"start":{"line":103,"column":1},"end":{"line":103,"column":1}},"key":"c9V4TmPKCK"}],"identifier":"id","label":"深入剖析","html_id":"id-5","implicit":true,"key":"RLLjD9dsfE"},{"type":"paragraph","position":{"start":{"line":105,"column":1},"end":{"line":105,"column":1}},"children":[{"type":"strong","position":{"start":{"line":105,"column":1},"end":{"line":105,"column":1}},"children":[{"type":"text","value":"以下内容将以 ","position":{"start":{"line":105,"column":1},"end":{"line":105,"column":1}},"key":"ZgxoiXAXA2"},{"type":"link","url":"https://github.com/freqtrade/freqtrade/blob/develop/freqtrade/templates/sample_strategy.py","position":{"start":{"line":105,"column":1},"end":{"line":105,"column":1}},"children":[{"type":"text","value":"user​_data​/strategies​/sample​_strategy​.py","position":{"start":{"line":105,"column":1},"end":{"line":105,"column":1}},"key":"RxPAJaW1hq"}],"urlSource":"https://github.com/freqtrade/freqtrade/blob/develop/freqtrade/templates/sample_strategy.py","data":{"kind":"file","org":"freqtrade","repo":"freqtrade","reference":"develop","file":"freqtrade/templates/sample_strategy.py","raw":"https://raw.githubusercontent.com/freqtrade/freqtrade/develop/freqtrade/templates/sample_strategy.py"},"internal":false,"protocol":"github","key":"okZddcMS3y"},{"type":"text","value":" 为参考。","position":{"start":{"line":105,"column":1},"end":{"line":105,"column":1}},"key":"VIfLjeaKag"}],"key":"Tsne4uJbzH"}],"key":"SadfDNOKfI"},{"type":"admonition","kind":"caution","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"策略与回测","position":{"start":{"line":107,"column":1},"end":{"line":107,"column":1}},"key":"lPaT6hPiok"}],"key":"t1Uf5n3Cho"},{"type":"paragraph","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"children":[{"type":"text","value":"为避免回测与 dry/live 模式下出现问题和意外差异，请注意回测时 ","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"key":"usSJrdNjvu"},{"type":"inlineCode","value":"populate_*()","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"key":"zV2LrjQHVQ"},{"type":"text","value":" 方法会一次性传入完整时间区间。","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"key":"fDntKe6dSA"}],"key":"L3LbVqUjQx"},{"type":"paragraph","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"children":[{"type":"text","value":"因此建议使用向量化操作（针对整个 dataframe，而非循环），避免用 ","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"tvwz8E2c3S"},{"type":"inlineCode","value":"df.iloc[-1]","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"jcCffACUyF"},{"type":"text","value":"，而应用 ","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"tEner0ZJLD"},{"type":"inlineCode","value":"df.shift()","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"iApr9xUd9D"},{"type":"text","value":" 获取前一根K线。","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"uXztWexe0b"}],"key":"oU1RkWVA1c"}],"key":"q9EcCtPqrZ"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"警惕未来数据","position":{"start":{"line":113,"column":1},"end":{"line":113,"column":1}},"key":"UX2gWBbW1r"}],"key":"ZqG3Watv4q"},{"type":"paragraph","position":{"start":{"line":114,"column":1},"end":{"line":114,"column":1}},"children":[{"type":"text","value":"回测时 ","position":{"start":{"line":114,"column":1},"end":{"line":114,"column":1}},"key":"NkTcFvEolN"},{"type":"inlineCode","value":"populate_*()","position":{"start":{"line":114,"column":1},"end":{"line":114,"column":1}},"key":"McX0NUwDsT"},{"type":"text","value":" 方法会传入完整时间区间，策略作者需确保不使用未来数据。","position":{"start":{"line":114,"column":1},"end":{"line":114,"column":1}},"key":"pKNQsouXep"}],"key":"pFV6ZD8kTW"},{"type":"paragraph","position":{"start":{"line":116,"column":1},"end":{"line":116,"column":1}},"children":[{"type":"text","value":"常见错误模式见文档后面的","position":{"start":{"line":116,"column":1},"end":{"line":116,"column":1}},"key":"fI6vvNkEdX"},{"type":"link","url":"#%E5%BC%80%E5%8F%91%E7%AD%96%E7%95%A5%E6%97%B6%E7%9A%84%E5%B8%B8%E8%A7%81%E9%94%99%E8%AF%AF","position":{"start":{"line":116,"column":1},"end":{"line":116,"column":1}},"children":[{"type":"text","value":"常见错误","position":{"start":{"line":116,"column":1},"end":{"line":116,"column":1}},"key":"FD4phTI0wy"}],"urlSource":"#%E5%BC%80%E5%8F%91%E7%AD%96%E7%95%A5%E6%97%B6%E7%9A%84%E5%B8%B8%E8%A7%81%E9%94%99%E8%AF%AF","key":"H0AGif6r0G"},{"type":"text","value":"章节。","position":{"start":{"line":116,"column":1},"end":{"line":116,"column":1}},"key":"mZcBNtUx0X"}],"key":"TGYOMxuM95"}],"key":"m4nXiBiYzK"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"前视与递归分析","position":{"start":{"line":119,"column":1},"end":{"line":119,"column":1}},"key":"IRvY4NNo0w"}],"key":"Y45onBA8tf"},{"type":"paragraph","position":{"start":{"line":120,"column":1},"end":{"line":120,"column":1}},"children":[{"type":"text","value":"Freqtrade 提供了两条命令帮助检测常见的前视（未来数据）和递归偏差（指标值方差）问题。在 dry/live 前，建议先用 ","position":{"start":{"line":120,"column":1},"end":{"line":120,"column":1}},"key":"gaMH9EaunB"},{"type":"link","url":"/lookahead-analysis","position":{"start":{"line":120,"column":1},"end":{"line":120,"column":1}},"children":[{"type":"text","value":"lookahead","position":{"start":{"line":120,"column":1},"end":{"line":120,"column":1}},"key":"IHc8gl93vP"}],"urlSource":"lookahead-analysis.md","dataUrl":"/lookahead-analysis.json","internal":true,"protocol":"file","key":"pZ6N6oCAG8"},{"type":"text","value":" 和 ","position":{"start":{"line":120,"column":1},"end":{"line":120,"column":1}},"key":"IsBsqUDLEW"},{"type":"link","url":"/recursive-analysis","position":{"start":{"line":120,"column":1},"end":{"line":120,"column":1}},"children":[{"type":"text","value":"recursive","position":{"start":{"line":120,"column":1},"end":{"line":120,"column":1}},"key":"NBpQfa3o2E"}],"urlSource":"recursive-analysis.md","dataUrl":"/recursive-analysis.json","internal":true,"protocol":"file","key":"C66ILMQfi2"},{"type":"text","value":" 工具分析。","position":{"start":{"line":120,"column":1},"end":{"line":120,"column":1}},"key":"JnYuLE9AHu"}],"key":"uSXFuMlr2p"}],"key":"tlov50CGWw"},{"type":"heading","depth":4,"position":{"start":{"line":123,"column":1},"end":{"line":123,"column":1}},"children":[{"type":"text","value":"DataFrame","position":{"start":{"line":123,"column":1},"end":{"line":123,"column":1}},"key":"N8nh7nPpSs"}],"identifier":"dataframe","label":"DataFrame","html_id":"dataframe","implicit":true,"key":"SEQjb0RbNU"},{"type":"paragraph","position":{"start":{"line":125,"column":1},"end":{"line":126,"column":1}},"children":[{"type":"text","value":"Freqtrade 使用 ","position":{"start":{"line":125,"column":1},"end":{"line":125,"column":1}},"key":"Rs7cOp37Fl"},{"type":"link","url":"https://pandas.pydata.org/","position":{"start":{"line":125,"column":1},"end":{"line":125,"column":1}},"children":[{"type":"text","value":"pandas","position":{"start":{"line":125,"column":1},"end":{"line":125,"column":1}},"key":"yD0J30kQ8j"}],"urlSource":"https://pandas.pydata.org/","key":"ggmuezcabg"},{"type":"text","value":" 存储/提供 K 线（OHLCV）数据。\nPandas 是处理表格数据的强大库。","position":{"start":{"line":125,"column":1},"end":{"line":125,"column":1}},"key":"EiW23SV6pQ"}],"key":"zSr1wrRNpi"},{"type":"paragraph","position":{"start":{"line":128,"column":1},"end":{"line":128,"column":1}},"children":[{"type":"text","value":"DataFrame 的每一行对应一根K线，最新的完整K线总是排在最后（按日期排序）。","position":{"start":{"line":128,"column":1},"end":{"line":128,"column":1}},"key":"sDNTZxnRKj"}],"key":"J29yQr2IwG"},{"type":"paragraph","position":{"start":{"line":130,"column":1},"end":{"line":130,"column":1}},"children":[{"type":"text","value":"用 pandas 的 ","position":{"start":{"line":130,"column":1},"end":{"line":130,"column":1}},"key":"NztSOKGD0B"},{"type":"inlineCode","value":"head()","position":{"start":{"line":130,"column":1},"end":{"line":130,"column":1}},"key":"o7poF66zC8"},{"type":"text","value":" 查看前几行：","position":{"start":{"line":130,"column":1},"end":{"line":130,"column":1}},"key":"ewNyxWtggh"}],"key":"qne9e3tSgJ"},{"type":"code","lang":"output","value":"> dataframe.head()\n                       date      open      high       low     close     volume\n0 2021-11-09 23:25:00+00:00  67279.67  67321.84  67255.01  67300.97   44.62253\n1 2021-11-09 23:30:00+00:00  67300.97  67301.34  67183.03  67187.01   61.38076\n2 2021-11-09 23:35:00+00:00  67187.02  67187.02  67031.93  67123.81  113.42728\n3 2021-11-09 23:40:00+00:00  67123.80  67222.40  67080.33  67160.48   78.96008\n4 2021-11-09 23:45:00+00:00  67160.48  67160.48  66901.26  66943.37  111.39292","position":{"start":{"line":132,"column":1},"end":{"line":140,"column":1}},"key":"CA3PkuOOW1"},{"type":"paragraph","position":{"start":{"line":142,"column":1},"end":{"line":142,"column":1}},"children":[{"type":"text","value":"DataFrame 是一个表格，列不是单一值，而是一组数据。因此，像下面这样直接用 Python 比较会报错：","position":{"start":{"line":142,"column":1},"end":{"line":142,"column":1}},"key":"Orfk9ZNhkS"}],"key":"BEAigXzLkj"},{"type":"code","lang":"python","value":"    if dataframe['rsi'] > 30:\n        dataframe['enter_long'] = 1","position":{"start":{"line":144,"column":1},"end":{"line":147,"column":1}},"key":"zjzgR2S0Uc"},{"type":"paragraph","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"children":[{"type":"text","value":"上述写法会报错：","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"key":"LLgxEDjbUh"},{"type":"inlineCode","value":"The truth value of a Series is ambiguous [...]","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"key":"FiIdbexXPd"},{"type":"text","value":"。","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"key":"ZEqFNmJDaX"}],"key":"wqvMuKszO6"},{"type":"paragraph","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"children":[{"type":"text","value":"应改为 pandas 向量化写法，对整个 dataframe 执行操作：","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"key":"A92GsBwghm"}],"key":"UQdvYKvhMY"},{"type":"code","lang":"python","value":"    dataframe.loc[\n        (dataframe['rsi'] > 30)\n    , 'enter_long'] = 1","position":{"start":{"line":153,"column":1},"end":{"line":157,"column":1}},"key":"ZSxZVHkLaR"},{"type":"paragraph","position":{"start":{"line":159,"column":1},"end":{"line":159,"column":1}},"children":[{"type":"text","value":"这样会在 RSI 大于 30 时，为新列 ","position":{"start":{"line":159,"column":1},"end":{"line":159,"column":1}},"key":"Z5uVXwtxx4"},{"type":"inlineCode","value":"enter_long","position":{"start":{"line":159,"column":1},"end":{"line":159,"column":1}},"key":"mKHvNH1JFg"},{"type":"text","value":" 赋值 1。","position":{"start":{"line":159,"column":1},"end":{"line":159,"column":1}},"key":"zjAF6hf1Wc"}],"key":"win3PonqPd"},{"type":"paragraph","position":{"start":{"line":161,"column":1},"end":{"line":161,"column":1}},"children":[{"type":"text","value":"Freqtrade 会用这个新列作为入场信号，假定下一根K线开盘时开仓。","position":{"start":{"line":161,"column":1},"end":{"line":161,"column":1}},"key":"OQ2RiC8b3S"}],"key":"rXcP7Ex1W3"},{"type":"paragraph","position":{"start":{"line":163,"column":1},"end":{"line":163,"column":1}},"children":[{"type":"text","value":"Pandas 支持高效的向量化计算，建议尽量避免循环，直接用向量化方法。","position":{"start":{"line":163,"column":1},"end":{"line":163,"column":1}},"key":"S2ZYjnccVN"}],"key":"NMSpVcJEMP"},{"type":"paragraph","position":{"start":{"line":165,"column":1},"end":{"line":165,"column":1}},"children":[{"type":"text","value":"向量化操作会对整列数据进行计算，比逐行循环快得多。","position":{"start":{"line":165,"column":1},"end":{"line":165,"column":1}},"key":"fYudcpsDQg"}],"key":"jF9Y6GGowv"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"信号 vs 交易","position":{"start":{"line":167,"column":1},"end":{"line":167,"column":1}},"key":"hnpFWR0mxv"}],"key":"LVzZyFv7ps"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":169,"column":1},"end":{"line":170,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":169,"column":1},"end":{"line":169,"column":1}},"children":[{"type":"text","value":"信号由指标在K线收盘时生成，表示有意愿开仓。","position":{"start":{"line":169,"column":1},"end":{"line":169,"column":1}},"key":"NeE6KigTxB"}],"key":"hJXM3ffErh"},{"type":"listItem","spread":true,"position":{"start":{"line":170,"column":1},"end":{"line":170,"column":1}},"children":[{"type":"text","value":"交易是在实际下单（实盘时在交易所），会尽量在下一根K线开盘时成交。","position":{"start":{"line":170,"column":1},"end":{"line":170,"column":1}},"key":"mddv0irs1U"}],"key":"OO9eUhSg4s"}],"key":"dNKzZ9lrsP"}],"key":"ubLKcQ2ZeN"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"交易下单假设","position":{"start":{"line":174,"column":1},"end":{"line":174,"column":1}},"key":"iaNW0wk1oG"}],"key":"YZplIw1W9K"},{"type":"paragraph","position":{"start":{"line":176,"column":1},"end":{"line":176,"column":1}},"children":[{"type":"text","value":"回测时，信号在K线收盘时生成，交易在下一根K线开盘时执行。","position":{"start":{"line":176,"column":1},"end":{"line":176,"column":1}},"key":"Nsk2bu9Rzp"}],"key":"uc4gTX0sry"},{"type":"paragraph","position":{"start":{"line":178,"column":1},"end":{"line":178,"column":1}},"children":[{"type":"text","value":"dry/live 模式下，因需先分析所有交易对 dataframe，再处理下单，可能有延迟。建议减少交易对数量，并用高主频 CPU。","position":{"start":{"line":178,"column":1},"end":{"line":178,"column":1}},"key":"PV55u9AUIo"}],"key":"D6TwF5wxZw"}],"key":"zQKW4GiY8K"},{"type":"heading","depth":5,"position":{"start":{"line":182,"column":1},"end":{"line":182,"column":1}},"children":[{"type":"text","value":"为什么看不到\"实时\"K线数据？","position":{"start":{"line":182,"column":1},"end":{"line":182,"column":1}},"key":"FUFgQGqcjU"}],"identifier":"id-k","label":"为什么看不到\"实时\"K线数据？","html_id":"id-k","implicit":true,"key":"taUYlSmPwd"},{"type":"paragraph","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"children":[{"type":"text","value":"Freqtrade 不会在 dataframe 中存储未完成/未收盘的K线。","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"key":"c5IQcEpPZP"}],"key":"EsMsHcGnXi"},{"type":"paragraph","position":{"start":{"line":186,"column":1},"end":{"line":186,"column":1}},"children":[{"type":"text","value":"用未完成数据做决策叫\"重绘\"，有些平台允许，但 Freqtrade 不支持。只有完整K线数据可用。","position":{"start":{"line":186,"column":1},"end":{"line":186,"column":1}},"key":"WRB4T7U0GY"}],"key":"tTA7BYhTnP"},{"type":"heading","depth":4,"position":{"start":{"line":188,"column":1},"end":{"line":188,"column":1}},"children":[{"type":"text","value":"自定义指标","position":{"start":{"line":188,"column":1},"end":{"line":188,"column":1}},"key":"MkPNl5oM5h"}],"identifier":"id","label":"自定义指标","html_id":"id-6","implicit":true,"key":"ermfoE8xPX"},{"type":"paragraph","position":{"start":{"line":190,"column":1},"end":{"line":190,"column":1}},"children":[{"type":"text","value":"入场和出场信号需要用到指标。你可以在策略文件的 ","position":{"start":{"line":190,"column":1},"end":{"line":190,"column":1}},"key":"AFdFBWRPTE"},{"type":"inlineCode","value":"populate_indicators()","position":{"start":{"line":190,"column":1},"end":{"line":190,"column":1}},"key":"JGX55j6a7c"},{"type":"text","value":" 方法中添加更多指标。","position":{"start":{"line":190,"column":1},"end":{"line":190,"column":1}},"key":"wLh3CusO9C"}],"key":"BebwwQGULY"},{"type":"paragraph","position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"children":[{"type":"text","value":"只应添加在 ","position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"key":"lA7hHgXEy0"},{"type":"inlineCode","value":"populate_entry_trend()","position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"key":"Afu7R75jNK"},{"type":"text","value":"、","position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"key":"tc6ZoPGgDP"},{"type":"inlineCode","value":"populate_exit_trend()","position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"key":"JSFJ8bPzxb"},{"type":"text","value":" 或用于生成其他指标的指标，否则会影响性能。","position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"key":"yGrTYt1kP0"}],"key":"Wu1VuZcLKH"},{"type":"paragraph","position":{"start":{"line":194,"column":1},"end":{"line":194,"column":1}},"children":[{"type":"text","value":"务必返回 dataframe，且不要删除/修改 “open”, “high”, “low”, “close”, “volume” 这几列，否则会导致异常。","position":{"start":{"line":194,"column":1},"end":{"line":194,"column":1}},"key":"KCYh55vsmq"}],"key":"QIvMlkWrBU"},{"type":"paragraph","position":{"start":{"line":196,"column":1},"end":{"line":196,"column":1}},"children":[{"type":"text","value":"示例：","position":{"start":{"line":196,"column":1},"end":{"line":196,"column":1}},"key":"nh2DsqOLyG"}],"key":"r1YzsJmgi3"},{"type":"code","lang":"python","value":"def populate_indicators(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n    \"\"\"\n    为给定 DataFrame 添加多种技术指标\n\n    性能提示：为获得最佳性能，请只用你策略或超参优化用到的指标，否则会浪费内存和 CPU。\n    :param dataframe: 交易所数据 DataFrame\n    :param metadata: 额外信息，如当前交易对\n    :return: 包含所有策略所需指标的 DataFrame\n    \"\"\"\n    dataframe['sar'] = ta.SAR(dataframe)\n    dataframe['adx'] = ta.ADX(dataframe)\n    stoch = ta.STOCHF(dataframe)\n    dataframe['fastd'] = stoch['fastd']\n    dataframe['fastk'] = stoch['fastk']\n    dataframe['bb_lower'] = ta.BBANDS(dataframe, nbdevup=2, nbdevdn=2)['lowerband']\n    dataframe['sma'] = ta.SMA(dataframe, timeperiod=40)\n    dataframe['tema'] = ta.TEMA(dataframe, timeperiod=9)\n    dataframe['mfi'] = ta.MFI(dataframe)\n    dataframe['rsi'] = ta.RSI(dataframe)\n    dataframe['ema5'] = ta.EMA(dataframe, timeperiod=5)\n    dataframe['ema10'] = ta.EMA(dataframe, timeperiod=10)\n    dataframe['ema50'] = ta.EMA(dataframe, timeperiod=50)\n    dataframe['ema100'] = ta.EMA(dataframe, timeperiod=100)\n    dataframe['ao'] = awesome_oscillator(dataframe)\n    macd = ta.MACD(dataframe)\n    dataframe['macd'] = macd['macd']\n    dataframe['macdsignal'] = macd['macdsignal']\n    dataframe['macdhist'] = macd['macdhist']\n    hilbert = ta.HT_SINE(dataframe)\n    dataframe['htsine'] = hilbert['sine']\n    dataframe['htleadsine'] = hilbert['leadsine']\n    dataframe['plus_dm'] = ta.PLUS_DM(dataframe)\n    dataframe['plus_di'] = ta.PLUS_DI(dataframe)\n    dataframe['minus_dm'] = ta.MINUS_DM(dataframe)\n    dataframe['minus_di'] = ta.MINUS_DI(dataframe)\n\n    # 记得始终返回 dataframe\n    return dataframe","position":{"start":{"line":198,"column":1},"end":{"line":237,"column":1}},"key":"vAeyqoPYgN"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"想要更多指标示例？","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"ga7BnUJ63H"}],"key":"Gml7xOzkdI"},{"type":"paragraph","position":{"start":{"line":240,"column":1},"end":{"line":240,"column":1}},"children":[{"type":"text","value":"请参考 ","position":{"start":{"line":240,"column":1},"end":{"line":240,"column":1}},"key":"DgX5tPk2bD"},{"type":"link","url":"https://github.com/freqtrade/freqtrade/blob/develop/freqtrade/templates/sample_strategy.py","position":{"start":{"line":240,"column":1},"end":{"line":240,"column":1}},"children":[{"type":"text","value":"user​_data​/strategies​/sample​_strategy​.py","position":{"start":{"line":240,"column":1},"end":{"line":240,"column":1}},"key":"U7syVxPJTh"}],"urlSource":"https://github.com/freqtrade/freqtrade/blob/develop/freqtrade/templates/sample_strategy.py","data":{"kind":"file","org":"freqtrade","repo":"freqtrade","reference":"develop","file":"freqtrade/templates/sample_strategy.py","raw":"https://raw.githubusercontent.com/freqtrade/freqtrade/develop/freqtrade/templates/sample_strategy.py"},"internal":false,"protocol":"github","key":"h44VI8XHJv"},{"type":"text","value":"，取消注释你需要的指标。","position":{"start":{"line":240,"column":1},"end":{"line":240,"column":1}},"key":"IGOJzPdJCt"}],"key":"SO9LJjkdKX"}],"key":"OSHZnkmiQi"},{"type":"heading","depth":5,"position":{"start":{"line":243,"column":1},"end":{"line":243,"column":1}},"children":[{"type":"text","value":"指标库","position":{"start":{"line":243,"column":1},"end":{"line":243,"column":1}},"key":"mLc2PQYy9F"}],"identifier":"id","label":"指标库","html_id":"id-7","implicit":true,"key":"XVkXsOFPvz"},{"type":"paragraph","position":{"start":{"line":245,"column":1},"end":{"line":245,"column":1}},"children":[{"type":"text","value":"Freqtrade 默认安装了以下技术指标库：","position":{"start":{"line":245,"column":1},"end":{"line":245,"column":1}},"key":"QsF9RB8fZO"}],"key":"JoA9LImlo1"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":247,"column":1},"end":{"line":250,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":247,"column":1},"end":{"line":247,"column":1}},"children":[{"type":"link","url":"https://ta-lib.github.io/ta-lib-python/","position":{"start":{"line":247,"column":1},"end":{"line":247,"column":1}},"children":[{"type":"text","value":"ta-lib","position":{"start":{"line":247,"column":1},"end":{"line":247,"column":1}},"key":"CefRNMyE8t"}],"urlSource":"https://ta-lib.github.io/ta-lib-python/","key":"gYi9llHKyb"}],"key":"oClGkhBomV"},{"type":"listItem","spread":true,"position":{"start":{"line":248,"column":1},"end":{"line":248,"column":1}},"children":[{"type":"link","url":"https://twopirllc.github.io/pandas-ta/","position":{"start":{"line":248,"column":1},"end":{"line":248,"column":1}},"children":[{"type":"text","value":"pandas-ta","position":{"start":{"line":248,"column":1},"end":{"line":248,"column":1}},"key":"mW04R8eKDD"}],"urlSource":"https://twopirllc.github.io/pandas-ta/","key":"bHcr3MTo41"}],"key":"m5QgrOmKVC"},{"type":"listItem","spread":true,"position":{"start":{"line":249,"column":1},"end":{"line":250,"column":1}},"children":[{"type":"link","url":"https://technical.freqtrade.io","position":{"start":{"line":249,"column":1},"end":{"line":249,"column":1}},"children":[{"type":"text","value":"technical","position":{"start":{"line":249,"column":1},"end":{"line":249,"column":1}},"key":"gKZpnRz3or"}],"urlSource":"https://technical.freqtrade.io","key":"tHyatngTVm"}],"key":"zUJBMzPEr9"}],"key":"xebyaVF8pW"},{"type":"paragraph","position":{"start":{"line":251,"column":1},"end":{"line":251,"column":1}},"children":[{"type":"text","value":"如有需要可安装其他技术指标库，或自行编写自定义指标。","position":{"start":{"line":251,"column":1},"end":{"line":251,"column":1}},"key":"LJNFGDeM2K"}],"key":"ddq5KuJaCp"},{"type":"heading","depth":4,"position":{"start":{"line":253,"column":1},"end":{"line":253,"column":1}},"children":[{"type":"text","value":"策略启动期","position":{"start":{"line":253,"column":1},"end":{"line":253,"column":1}},"key":"AmHZkzg3B8"}],"identifier":"id","label":"策略启动期","html_id":"id-8","implicit":true,"key":"VdQaEE6p8n"},{"type":"paragraph","position":{"start":{"line":255,"column":1},"end":{"line":255,"column":1}},"children":[{"type":"text","value":"部分指标在启动初期因数据不足会出现 NaN 或计算不准确。Freqtrade 无法自动判断不稳定期长度，会直接用 dataframe 中的指标值。","position":{"start":{"line":255,"column":1},"end":{"line":255,"column":1}},"key":"BKWowIlFHa"}],"key":"skaKErT7Qq"},{"type":"paragraph","position":{"start":{"line":257,"column":1},"end":{"line":257,"column":1}},"children":[{"type":"text","value":"为此，策略可设置 ","position":{"start":{"line":257,"column":1},"end":{"line":257,"column":1}},"key":"KoW4Tej5lr"},{"type":"inlineCode","value":"startup_candle_count","position":{"start":{"line":257,"column":1},"end":{"line":257,"column":1}},"key":"Te10Fc72PB"},{"type":"text","value":" 属性。","position":{"start":{"line":257,"column":1},"end":{"line":257,"column":1}},"key":"QVYiTxuPGa"}],"key":"jb93jM7wkQ"},{"type":"paragraph","position":{"start":{"line":259,"column":1},"end":{"line":259,"column":1}},"children":[{"type":"text","value":"该值应设为策略中所有指标所需的最大历史K线数。若用到高阶时间周期 informative pair，","position":{"start":{"line":259,"column":1},"end":{"line":259,"column":1}},"key":"fQVOmCJTcb"},{"type":"inlineCode","value":"startup_candle_count","position":{"start":{"line":259,"column":1},"end":{"line":259,"column":1}},"key":"SmCI3Tlj6P"},{"type":"text","value":" 也无需改变，只需用最大周期。","position":{"start":{"line":259,"column":1},"end":{"line":259,"column":1}},"key":"xDx4XE3rIZ"}],"key":"xsEd9bfj45"},{"type":"paragraph","position":{"start":{"line":261,"column":1},"end":{"line":261,"column":1}},"children":[{"type":"text","value":"可用 ","position":{"start":{"line":261,"column":1},"end":{"line":261,"column":1}},"key":"tTAb5GkGED"},{"type":"link","url":"/recursive-analysis","position":{"start":{"line":261,"column":1},"end":{"line":261,"column":1}},"children":[{"type":"text","value":"recursive-analysis","position":{"start":{"line":261,"column":1},"end":{"line":261,"column":1}},"key":"BeSKLlomYL"}],"urlSource":"recursive-analysis.md","dataUrl":"/recursive-analysis.json","internal":true,"protocol":"file","key":"xTCqPxUgR4"},{"type":"text","value":" 检查合适的 ","position":{"start":{"line":261,"column":1},"end":{"line":261,"column":1}},"key":"cG5ltHu1cw"},{"type":"inlineCode","value":"startup_candle_count","position":{"start":{"line":261,"column":1},"end":{"line":261,"column":1}},"key":"x3WhLl827Y"},{"type":"text","value":"。当递归分析显示方差为 0% 时，说明历史数据已足够。","position":{"start":{"line":261,"column":1},"end":{"line":261,"column":1}},"key":"ig9ZB1ILVd"}],"key":"ocz7Ydut05"},{"type":"paragraph","position":{"start":{"line":263,"column":1},"end":{"line":263,"column":1}},"children":[{"type":"text","value":"如本例策略用到 ema100，则应设为 400（","position":{"start":{"line":263,"column":1},"end":{"line":263,"column":1}},"key":"CucorJ5uuY"},{"type":"inlineCode","value":"startup_candle_count = 400","position":{"start":{"line":263,"column":1},"end":{"line":263,"column":1}},"key":"SZTRNBRWbH"},{"type":"text","value":"），以保证 ema100 计算准确。","position":{"start":{"line":263,"column":1},"end":{"line":263,"column":1}},"key":"lok42IRuFJ"}],"key":"LEbO8fARGp"},{"type":"code","lang":"python","value":"    dataframe['ema100'] = ta.EMA(dataframe, timeperiod=100)","position":{"start":{"line":265,"column":1},"end":{"line":267,"column":1}},"key":"BTIUln5PiS"},{"type":"paragraph","position":{"start":{"line":269,"column":1},"end":{"line":269,"column":1}},"children":[{"type":"text","value":"告知机器人所需历史长度后，回测和超参优化可从指定时间点开始。","position":{"start":{"line":269,"column":1},"end":{"line":269,"column":1}},"key":"OZO6VmDqwF"}],"key":"A3v6OKUmcS"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"多次获取 OHLCV 的警告","position":{"start":{"line":271,"column":1},"end":{"line":271,"column":1}},"key":"kOZdaneAs2"}],"key":"JPXbptFCHv"},{"type":"paragraph","position":{"start":{"line":272,"column":1},"end":{"line":272,"column":1}},"children":[{"type":"text","value":"若收到 ","position":{"start":{"line":272,"column":1},"end":{"line":272,"column":1}},"key":"NZbSUZ57TV"},{"type":"inlineCode","value":"WARNING - Using 3 calls to get OHLCV...","position":{"start":{"line":272,"column":1},"end":{"line":272,"column":1}},"key":"e6uD8ETPWL"},{"type":"text","value":"，请考虑是否真的需要这么多历史数据。过多会导致多次网络请求，拖慢机器人刷新速度。","position":{"start":{"line":272,"column":1},"end":{"line":272,"column":1}},"key":"FUaPwO87Ol"}],"key":"elwINaUR2c"},{"type":"paragraph","position":{"start":{"line":274,"column":1},"end":{"line":274,"column":1}},"children":[{"type":"text","value":"最多允许 5 次请求，避免过载。","position":{"start":{"line":274,"column":1},"end":{"line":274,"column":1}},"key":"h7CY7LRUCq"}],"key":"AmuHKKT4fR"}],"key":"wwD9SUxSde"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"Ih8OSJsQoZ"}],"key":"opVzwTxp4q"},{"type":"paragraph","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"children":[{"type":"inlineCode","value":"startup_candle_count","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"key":"Z4hB5GA545"},{"type":"text","value":" 应小于 ","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"key":"uKUJBFlZX4"},{"type":"inlineCode","value":"ohlcv_candle_limit * 5","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"key":"CJD0GUozoI"},{"type":"text","value":"（大多数交易所为 500 * 5），Dry-Run/Live 模式下只会有这么多K线。","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"key":"tJj5ydvt2p"}],"key":"c9IFEhbGFd"}],"key":"KQdeMbpLcd"},{"type":"heading","depth":5,"position":{"start":{"line":281,"column":1},"end":{"line":281,"column":1}},"children":[{"type":"text","value":"示例","position":{"start":{"line":281,"column":1},"end":{"line":281,"column":1}},"key":"FIs6Vz3pme"}],"identifier":"id","label":"示例","html_id":"id-9","implicit":true,"key":"eXgClw7aHj"},{"type":"paragraph","position":{"start":{"line":283,"column":1},"end":{"line":283,"column":1}},"children":[{"type":"text","value":"假设用 EMA100 策略回测 2019 年 1 月的 5m K 线：","position":{"start":{"line":283,"column":1},"end":{"line":283,"column":1}},"key":"bTAVnipkci"}],"key":"bnk8KvfOkh"},{"type":"code","lang":"bash","value":"freqtrade backtesting --timerange 20190101-20190201 --timeframe 5m","position":{"start":{"line":285,"column":1},"end":{"line":287,"column":1}},"key":"lnpuGKBF5z"},{"type":"paragraph","position":{"start":{"line":289,"column":1},"end":{"line":289,"column":1}},"children":[{"type":"text","value":"若 ","position":{"start":{"line":289,"column":1},"end":{"line":289,"column":1}},"key":"JuLSn65iYY"},{"type":"inlineCode","value":"startup_candle_count","position":{"start":{"line":289,"column":1},"end":{"line":289,"column":1}},"key":"n4GOPbUwBD"},{"type":"text","value":" 设为 400，回测会自动加载 400 根K线的历史数据，即从 ","position":{"start":{"line":289,"column":1},"end":{"line":289,"column":1}},"key":"uusvdhvvI3"},{"type":"inlineCode","value":"20190101 - (400 * 5m)","position":{"start":{"line":289,"column":1},"end":{"line":289,"column":1}},"key":"r2c4MxKQrD"},{"type":"text","value":"，约等于 2018-12-30 11:40:00。","position":{"start":{"line":289,"column":1},"end":{"line":289,"column":1}},"key":"XuWV6UQIxl"}],"key":"BdBkgzk9Sr"},{"type":"paragraph","position":{"start":{"line":291,"column":1},"end":{"line":291,"column":1}},"children":[{"type":"text","value":"若有该数据，指标会用扩展时间段计算，启动期（到 2019-01-01 00:00:00）会被剔除。","position":{"start":{"line":291,"column":1},"end":{"line":291,"column":1}},"key":"mnsQV5qawG"}],"key":"lJZCAeWvNv"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"启动期数据不可用","position":{"start":{"line":293,"column":1},"end":{"line":293,"column":1}},"key":"E1dQEa8zoD"}],"key":"OZNV8XOmvU"},{"type":"paragraph","position":{"start":{"line":294,"column":1},"end":{"line":294,"column":1}},"children":[{"type":"text","value":"若历史数据不足，回测会自动调整起始时间。例如本例会从 2019-01-02 09:20:00 开始。","position":{"start":{"line":294,"column":1},"end":{"line":294,"column":1}},"key":"zYrrJLEdQ6"}],"key":"CBrFaWcOuT"}],"key":"QTCeL1QrzP"},{"type":"heading","depth":4,"position":{"start":{"line":297,"column":1},"end":{"line":297,"column":1}},"children":[{"type":"text","value":"入场信号规则","position":{"start":{"line":297,"column":1},"end":{"line":297,"column":1}},"key":"XUKUAcuAYF"}],"identifier":"id","label":"入场信号规则","html_id":"id-10","implicit":true,"key":"Vvgw72MvxM"},{"type":"paragraph","position":{"start":{"line":299,"column":1},"end":{"line":299,"column":1}},"children":[{"type":"text","value":"编辑策略文件中的 ","position":{"start":{"line":299,"column":1},"end":{"line":299,"column":1}},"key":"ISV47OWssU"},{"type":"inlineCode","value":"populate_entry_trend()","position":{"start":{"line":299,"column":1},"end":{"line":299,"column":1}},"key":"qQv5wS3jMV"},{"type":"text","value":" 方法，更新入场逻辑。","position":{"start":{"line":299,"column":1},"end":{"line":299,"column":1}},"key":"jrrNOJhlsy"}],"key":"Ih4RCXsYBL"},{"type":"paragraph","position":{"start":{"line":301,"column":1},"end":{"line":301,"column":1}},"children":[{"type":"text","value":"务必返回 dataframe，且不要删除/修改 “open”, “high”, “low”, “close”, “volume” 这几列，否则会导致异常。","position":{"start":{"line":301,"column":1},"end":{"line":301,"column":1}},"key":"nvUf6Dp7Vg"}],"key":"TpdpGeUTUw"},{"type":"paragraph","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"children":[{"type":"text","value":"该方法还需定义新列 ","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"key":"WQMdcZrDvL"},{"type":"inlineCode","value":"enter_long","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"key":"qAbmGidfiH"},{"type":"text","value":"（做空为 ","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"key":"K1OjaQLDXj"},{"type":"inlineCode","value":"enter_short","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"key":"UkGQtUYfw1"},{"type":"text","value":"），入场时为 1，无操作为 0。即使只做空也必须设置 ","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"key":"rAYuBiO7UR"},{"type":"inlineCode","value":"enter_long","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"key":"C7YdJoBcWY"},{"type":"text","value":"。","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"key":"SQsmrTmKqR"}],"key":"i9wpsYCT75"},{"type":"paragraph","position":{"start":{"line":305,"column":1},"end":{"line":305,"column":1}},"children":[{"type":"text","value":"可用 ","position":{"start":{"line":305,"column":1},"end":{"line":305,"column":1}},"key":"e7YsS9kHLH"},{"type":"inlineCode","value":"enter_tag","position":{"start":{"line":305,"column":1},"end":{"line":305,"column":1}},"key":"vB3SgVp7tD"},{"type":"text","value":" 列为信号命名，便于后续调试和分析。","position":{"start":{"line":305,"column":1},"end":{"line":305,"column":1}},"key":"MkYgh5WPVF"}],"key":"XCfazu2ONe"},{"type":"paragraph","position":{"start":{"line":307,"column":1},"end":{"line":307,"column":1}},"children":[{"type":"text","value":"示例（来自 sample_strategy.py）：","position":{"start":{"line":307,"column":1},"end":{"line":307,"column":1}},"key":"ztD5y0t4Ek"}],"key":"qhWjljozvv"},{"type":"code","lang":"python","value":"def populate_entry_trend(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n    \"\"\"\n    基于技术指标，为给定 dataframe 生成买入信号\n    :param dataframe: 已填充指标的 DataFrame\n    :param metadata: 额外信息，如当前交易对\n    :return: 包含买入信号的 DataFrame\n    \"\"\"\n    dataframe.loc[\n        (\n            (qtpylib.crossed_above(dataframe['rsi'], 30)) &  # RSI 上穿 30\n            (dataframe['tema'] <= dataframe['bb_middleband']) &  # 条件\n            (dataframe['tema'] > dataframe['tema'].shift(1)) &  # 条件\n            (dataframe['volume'] > 0)  # 确保有成交量\n        ),\n        ['enter_long', 'enter_tag']] = (1, 'rsi_cross')\n\n    return dataframe","position":{"start":{"line":309,"column":1},"end":{"line":327,"column":1}},"key":"X5CUiezTeo"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"做空信号","position":{"start":{"line":329,"column":1},"end":{"line":329,"column":1}},"key":"mOORG98W2h"}],"key":"Ue8LYPqw3r"},{"type":"paragraph","position":{"start":{"line":330,"column":1},"end":{"line":332,"column":1}},"children":[{"type":"text","value":"做空可通过设置 ","position":{"start":{"line":330,"column":1},"end":{"line":330,"column":1}},"key":"FJLR4CLLkU"},{"type":"inlineCode","value":"enter_short","position":{"start":{"line":330,"column":1},"end":{"line":330,"column":1}},"key":"zEe4IsKtsX"},{"type":"text","value":"（对应多头的 ","position":{"start":{"line":330,"column":1},"end":{"line":330,"column":1}},"key":"evDnQ6go54"},{"type":"inlineCode","value":"enter_long","position":{"start":{"line":330,"column":1},"end":{"line":330,"column":1}},"key":"lEjAqOh9Ib"},{"type":"text","value":"）实现。\n","position":{"start":{"line":330,"column":1},"end":{"line":330,"column":1}},"key":"KHP9cuYz8N"},{"type":"inlineCode","value":"enter_tag","position":{"start":{"line":330,"column":1},"end":{"line":330,"column":1}},"key":"LI0hOwFB9i"},{"type":"text","value":" 列用法相同。\n做空需交易所和市场支持！如需做空，务必设置 ","position":{"start":{"line":330,"column":1},"end":{"line":330,"column":1}},"key":"xonbwNDaTw"},{"type":"link","url":"#can-short","position":{"start":{"line":330,"column":1},"end":{"line":330,"column":1}},"children":[{"type":"inlineCode","value":"can_short","position":{"start":{"line":330,"column":1},"end":{"line":330,"column":1}},"key":"pAJabrlgKv"}],"urlSource":"#can-short","key":"o4ZQog8kYb"},{"type":"text","value":" 为 True。","position":{"start":{"line":330,"column":1},"end":{"line":330,"column":1}},"key":"ki7znpvjwR"}],"key":"wUevEzx7in"},{"type":"code","lang":"python","value":"# 支持多空\ncan_short = True\n\ndef populate_entry_trend(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n    dataframe.loc[\n        (\n            (qtpylib.crossed_above(dataframe['rsi'], 30)) &\n            (dataframe['tema'] <= dataframe['bb_middleband']) &\n            (dataframe['tema'] > dataframe['tema'].shift(1)) &\n            (dataframe['volume'] > 0)\n        ),\n        ['enter_long', 'enter_tag']] = (1, 'rsi_cross')\n\n    dataframe.loc[\n        (\n            (qtpylib.crossed_below(dataframe['rsi'], 70)) &\n            (dataframe['tema'] > dataframe['bb_middleband']) &\n            (dataframe['tema'] < dataframe['tema'].shift(1)) &\n            (dataframe['volume'] > 0)\n        ),\n        ['enter_short', 'enter_tag']] = (1, 'rsi_cross')\n\n    return dataframe","position":{"start":{"line":334,"column":1},"end":{"line":358,"column":1}},"key":"VHBaqfxo6R"}],"key":"M48XBRtPuV"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Tip","key":"nO61Pt9NwR"}],"key":"kx73EanTew"},{"type":"paragraph","position":{"start":{"line":363,"column":1},"end":{"line":363,"column":1}},"children":[{"type":"text","value":"买入需要有卖方，因此需 ","position":{"start":{"line":363,"column":1},"end":{"line":363,"column":1}},"key":"cn6wouTVpS"},{"type":"inlineCode","value":"dataframe['volume'] > 0","position":{"start":{"line":363,"column":1},"end":{"line":363,"column":1}},"key":"OgDbFQ1xZR"},{"type":"text","value":"，避免在无成交量时买入/卖出。","position":{"start":{"line":363,"column":1},"end":{"line":363,"column":1}},"key":"vQgMxJkaKY"}],"key":"BSUfL68DSt"}],"key":"Tzrh7P2C62"},{"type":"heading","depth":4,"position":{"start":{"line":366,"column":1},"end":{"line":366,"column":1}},"children":[{"type":"text","value":"出场信号规则","position":{"start":{"line":366,"column":1},"end":{"line":366,"column":1}},"key":"TJdEeUF6so"}],"identifier":"id","label":"出场信号规则","html_id":"id-11","implicit":true,"key":"S4lgwvUXHt"},{"type":"paragraph","position":{"start":{"line":368,"column":1},"end":{"line":368,"column":1}},"children":[{"type":"text","value":"编辑策略文件中的 ","position":{"start":{"line":368,"column":1},"end":{"line":368,"column":1}},"key":"CoWhPlH1RB"},{"type":"inlineCode","value":"populate_exit_trend()","position":{"start":{"line":368,"column":1},"end":{"line":368,"column":1}},"key":"MITr7XtIdl"},{"type":"text","value":" 方法，更新出场逻辑。","position":{"start":{"line":368,"column":1},"end":{"line":368,"column":1}},"key":"tJIozl4M2Q"}],"key":"R5Guo6ov3G"},{"type":"paragraph","position":{"start":{"line":370,"column":1},"end":{"line":370,"column":1}},"children":[{"type":"text","value":"可通过在配置或策略中设置 ","position":{"start":{"line":370,"column":1},"end":{"line":370,"column":1}},"key":"miYnRTHAbp"},{"type":"inlineCode","value":"use_exit_signal","position":{"start":{"line":370,"column":1},"end":{"line":370,"column":1}},"key":"n8jz3rx3Km"},{"type":"text","value":" 为 false 禁用出场信号。","position":{"start":{"line":370,"column":1},"end":{"line":370,"column":1}},"key":"IAfAEVYOFn"}],"key":"p823QaXLHo"},{"type":"paragraph","position":{"start":{"line":372,"column":1},"end":{"line":372,"column":1}},"children":[{"type":"inlineCode","value":"use_exit_signal","position":{"start":{"line":372,"column":1},"end":{"line":372,"column":1}},"key":"ITEbEpdoe7"},{"type":"text","value":" 不影响","position":{"start":{"line":372,"column":1},"end":{"line":372,"column":1}},"key":"cxKCLeoZgV"},{"type":"link","url":"#%E4%BF%A1%E5%8F%B7%E5%86%B2%E7%AA%81","position":{"start":{"line":372,"column":1},"end":{"line":372,"column":1}},"children":[{"type":"text","value":"信号冲突规则","position":{"start":{"line":372,"column":1},"end":{"line":372,"column":1}},"key":"eA9rs0KwwR"}],"urlSource":"#%E4%BF%A1%E5%8F%B7%E5%86%B2%E7%AA%81","key":"keqVelni0a"},{"type":"text","value":"，后者仍然生效，可能阻止入场。","position":{"start":{"line":372,"column":1},"end":{"line":372,"column":1}},"key":"bhOSjnP5ra"}],"key":"QeexhlMSKx"},{"type":"paragraph","position":{"start":{"line":374,"column":1},"end":{"line":374,"column":1}},"children":[{"type":"text","value":"务必返回 dataframe，且不要删除/修改 “open”, “high”, “low”, “close”, “volume” 这几列，否则会导致异常。","position":{"start":{"line":374,"column":1},"end":{"line":374,"column":1}},"key":"p8i556AYSB"}],"key":"USNnIj3vol"},{"type":"paragraph","position":{"start":{"line":376,"column":1},"end":{"line":376,"column":1}},"children":[{"type":"text","value":"该方法还需定义新列 ","position":{"start":{"line":376,"column":1},"end":{"line":376,"column":1}},"key":"TcZqAgp0WB"},{"type":"inlineCode","value":"exit_long","position":{"start":{"line":376,"column":1},"end":{"line":376,"column":1}},"key":"oE3QeyNy4M"},{"type":"text","value":"（做空为 ","position":{"start":{"line":376,"column":1},"end":{"line":376,"column":1}},"key":"Locp2NcqWv"},{"type":"inlineCode","value":"exit_short","position":{"start":{"line":376,"column":1},"end":{"line":376,"column":1}},"key":"az5MXd8BGW"},{"type":"text","value":"），出场时为 1，无操作为 0。","position":{"start":{"line":376,"column":1},"end":{"line":376,"column":1}},"key":"XTjRLbFUj5"}],"key":"WJbwKaH4cP"},{"type":"paragraph","position":{"start":{"line":378,"column":1},"end":{"line":378,"column":1}},"children":[{"type":"text","value":"可用 ","position":{"start":{"line":378,"column":1},"end":{"line":378,"column":1}},"key":"s8bsfgo17S"},{"type":"inlineCode","value":"exit_tag","position":{"start":{"line":378,"column":1},"end":{"line":378,"column":1}},"key":"hG0Uru06k4"},{"type":"text","value":" 列为信号命名，便于后续调试和分析。","position":{"start":{"line":378,"column":1},"end":{"line":378,"column":1}},"key":"ct5LGZYkh3"}],"key":"iNUm3hLItW"},{"type":"paragraph","position":{"start":{"line":380,"column":1},"end":{"line":380,"column":1}},"children":[{"type":"text","value":"示例（来自 sample_strategy.py）：","position":{"start":{"line":380,"column":1},"end":{"line":380,"column":1}},"key":"slvd7Rhxsm"}],"key":"PpMRDfhZUi"},{"type":"code","lang":"python","value":"def populate_exit_trend(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n    \"\"\"\n    基于技术指标，为给定 dataframe 生成卖出信号\n    :param dataframe: 已填充指标的 DataFrame\n    :param metadata: 额外信息，如当前交易对\n    :return: 包含卖出信号的 DataFrame\n    \"\"\"\n    dataframe.loc[\n        (\n            (qtpylib.crossed_above(dataframe['rsi'], 70)) &  # RSI 上穿 70\n            (dataframe['tema'] > dataframe['bb_middleband']) &  # 条件\n            (dataframe['tema'] < dataframe['tema'].shift(1)) &  # 条件\n            (dataframe['volume'] > 0)  # 确保有成交量\n        ),\n        ['exit_long', 'exit_tag']] = (1, 'rsi_too_high')\n    return dataframe","position":{"start":{"line":382,"column":1},"end":{"line":399,"column":1}},"key":"Q3F07iRj2N"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"做空平仓","position":{"start":{"line":401,"column":1},"end":{"line":401,"column":1}},"key":"Fw97Ss9jLd"}],"key":"cqI01PO3ib"},{"type":"paragraph","position":{"start":{"line":402,"column":1},"end":{"line":402,"column":1}},"children":[{"type":"text","value":"做空平仓可通过设置 ","position":{"start":{"line":402,"column":1},"end":{"line":402,"column":1}},"key":"j3DK9BFzht"},{"type":"inlineCode","value":"exit_short","position":{"start":{"line":402,"column":1},"end":{"line":402,"column":1}},"key":"lJ4G2USji1"},{"type":"text","value":"（对应多头的 ","position":{"start":{"line":402,"column":1},"end":{"line":402,"column":1}},"key":"Ew7msAoPu3"},{"type":"inlineCode","value":"exit_long","position":{"start":{"line":402,"column":1},"end":{"line":402,"column":1}},"key":"VmMeMgDB4f"},{"type":"text","value":"）实现。","position":{"start":{"line":402,"column":1},"end":{"line":402,"column":1}},"key":"EwLCGKVWEQ"}],"key":"Y6TQsnwIuq"},{"type":"paragraph","position":{"start":{"line":404,"column":1},"end":{"line":404,"column":1}},"children":[{"type":"inlineCode","value":"exit_tag","position":{"start":{"line":404,"column":1},"end":{"line":404,"column":1}},"key":"jnLXCoBSkC"},{"type":"text","value":" 列用法相同。","position":{"start":{"line":404,"column":1},"end":{"line":404,"column":1}},"key":"mbMl7nb9lb"}],"key":"yIN3EbDQOn"},{"type":"paragraph","position":{"start":{"line":406,"column":1},"end":{"line":406,"column":1}},"children":[{"type":"text","value":"做空需交易所和市场支持！如需做空，务必设置 ","position":{"start":{"line":406,"column":1},"end":{"line":406,"column":1}},"key":"Z7jTaEk7Eh"},{"type":"link","url":"#can-short","position":{"start":{"line":406,"column":1},"end":{"line":406,"column":1}},"children":[{"type":"inlineCode","value":"can_short","position":{"start":{"line":406,"column":1},"end":{"line":406,"column":1}},"key":"vqaHVTTHrK"}],"urlSource":"#can-short","key":"y0rzgzzts5"},{"type":"text","value":" 为 True。","position":{"start":{"line":406,"column":1},"end":{"line":406,"column":1}},"key":"T4xZ8EzNYt"}],"key":"U7syFgklqe"},{"type":"code","lang":"python","value":"    # 支持多空\n    can_short = True\n\n    def populate_exit_trend(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n        dataframe.loc[\n            (\n                (qtpylib.crossed_above(dataframe['rsi'], 70)) &\n                (dataframe['tema'] > dataframe['bb_middleband']) &\n                (dataframe['tema'] < dataframe['tema'].shift(1)) &\n                (dataframe['volume'] > 0)\n            ),\n            ['exit_long', 'exit_tag']] = (1, 'rsi_too_high')\n        dataframe.loc[\n            (\n                (qtpylib.crossed_below(dataframe['rsi'], 30)) &\n                (dataframe['tema'] < dataframe['bb_middleband']) &\n                (dataframe['tema'] > dataframe['tema'].shift(1)) &\n                (dataframe['volume'] > 0)\n            ),\n            ['exit_short', 'exit_tag']] = (1, 'rsi_too_low')\n        return dataframe","position":{"start":{"line":408,"column":1},"end":{"line":430,"column":1}},"key":"D8StUBBIat"}],"key":"kTDxLZyrTN"},{"type":"heading","depth":4,"position":{"start":{"line":434,"column":1},"end":{"line":434,"column":1}},"children":[{"type":"text","value":"最小收益率（ROI）","position":{"start":{"line":434,"column":1},"end":{"line":434,"column":1}},"key":"synG2Ozti6"}],"identifier":"id-roi","label":"最小收益率（ROI）","html_id":"id-roi","implicit":true,"key":"snOcgubmph"},{"type":"paragraph","position":{"start":{"line":436,"column":1},"end":{"line":436,"column":1}},"children":[{"type":"inlineCode","value":"minimal_roi","position":{"start":{"line":436,"column":1},"end":{"line":436,"column":1}},"key":"BOWPLo4eR8"},{"type":"text","value":" 策略变量定义了交易在退出前应达到的最小收益率，与出场信号无关。","position":{"start":{"line":436,"column":1},"end":{"line":436,"column":1}},"key":"DE38rssEgT"}],"key":"YubKGLOfZ4"},{"type":"paragraph","position":{"start":{"line":438,"column":1},"end":{"line":438,"column":1}},"children":[{"type":"text","value":"格式如下，是一个 python 字典，键为开仓后经过的分钟数，值为百分比：","position":{"start":{"line":438,"column":1},"end":{"line":438,"column":1}},"key":"G9RlR6SehL"}],"key":"Ec29AdSZJc"},{"type":"code","lang":"python","value":"minimal_roi = {\n    \"40\": 0.0,\n    \"30\": 0.01,\n    \"20\": 0.02,\n    \"0\": 0.04\n}","position":{"start":{"line":440,"column":1},"end":{"line":447,"column":1}},"key":"iFz8uRh4xy"},{"type":"paragraph","position":{"start":{"line":449,"column":1},"end":{"line":449,"column":1}},"children":[{"type":"text","value":"上述配置含义：","position":{"start":{"line":449,"column":1},"end":{"line":449,"column":1}},"key":"DK5TOeqjBn"}],"key":"WhotnIXFxk"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":451,"column":1},"end":{"line":455,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":451,"column":1},"end":{"line":451,"column":1}},"children":[{"type":"text","value":"达到 4% 盈利时退出","position":{"start":{"line":451,"column":1},"end":{"line":451,"column":1}},"key":"hEJH3vdiXd"}],"key":"w2bvGAZwl0"},{"type":"listItem","spread":true,"position":{"start":{"line":452,"column":1},"end":{"line":452,"column":1}},"children":[{"type":"text","value":"20 分钟后达到 2% 盈利时退出","position":{"start":{"line":452,"column":1},"end":{"line":452,"column":1}},"key":"ZBBR14L4nA"}],"key":"XPPmaofRA1"},{"type":"listItem","spread":true,"position":{"start":{"line":453,"column":1},"end":{"line":453,"column":1}},"children":[{"type":"text","value":"30 分钟后达到 1% 盈利时退出","position":{"start":{"line":453,"column":1},"end":{"line":453,"column":1}},"key":"w8YCzmDJgQ"}],"key":"oFQLixO3yh"},{"type":"listItem","spread":true,"position":{"start":{"line":454,"column":1},"end":{"line":455,"column":1}},"children":[{"type":"text","value":"40 分钟后只要不亏损就退出","position":{"start":{"line":454,"column":1},"end":{"line":454,"column":1}},"key":"uC3Sf90muj"}],"key":"HOz7kid2xz"}],"key":"k1GxfwuVLa"},{"type":"paragraph","position":{"start":{"line":456,"column":1},"end":{"line":456,"column":1}},"children":[{"type":"text","value":"计算时包含手续费。","position":{"start":{"line":456,"column":1},"end":{"line":456,"column":1}},"key":"jboYZ66KT0"}],"key":"lYwihwQLC9"},{"type":"heading","depth":5,"position":{"start":{"line":458,"column":1},"end":{"line":458,"column":1}},"children":[{"type":"text","value":"禁用最小 ROI","position":{"start":{"line":458,"column":1},"end":{"line":458,"column":1}},"key":"rtpmOCLFIE"}],"identifier":"id-roi","label":"禁用最小 ROI","html_id":"id-roi-1","implicit":true,"key":"hQziIKbpQ7"},{"type":"paragraph","position":{"start":{"line":460,"column":1},"end":{"line":460,"column":1}},"children":[{"type":"text","value":"如需完全禁用 ROI，将其设为空字典：","position":{"start":{"line":460,"column":1},"end":{"line":460,"column":1}},"key":"cHHfu1NkNs"}],"key":"S5w6Uh94lX"},{"type":"code","lang":"python","value":"minimal_roi = {}","position":{"start":{"line":462,"column":1},"end":{"line":464,"column":1}},"key":"QgIQ8P4dy3"},{"type":"heading","depth":5,"position":{"start":{"line":466,"column":1},"end":{"line":466,"column":1}},"children":[{"type":"text","value":"ROI 中用计算表达式","position":{"start":{"line":466,"column":1},"end":{"line":466,"column":1}},"key":"EvOEGLtmna"}],"identifier":"roi","label":"ROI 中用计算表达式","html_id":"roi","implicit":true,"key":"KVrauUHRWh"},{"type":"paragraph","position":{"start":{"line":468,"column":1},"end":{"line":468,"column":1}},"children":[{"type":"text","value":"如需按K线周期（timeframe）设置时间，可用如下写法：","position":{"start":{"line":468,"column":1},"end":{"line":468,"column":1}},"key":"RK8Qrd31K4"}],"key":"NwHdKRuksN"},{"type":"code","lang":"python","value":"from freqtrade.exchange import timeframe_to_minutes\n\nclass AwesomeStrategy(IStrategy):\n\n    timeframe = \"1d\"\n    timeframe_mins = timeframe_to_minutes(timeframe)\n    minimal_roi = {\n        \"0\": 0.05,                      # 前 3 根 K 线 5%\n        str(timeframe_mins * 3): 0.02,  # 3 根 K 线后 2%\n        str(timeframe_mins * 6): 0.01,  # 6 根 K 线后 1%\n    }","position":{"start":{"line":470,"column":1},"end":{"line":482,"column":1}},"key":"hkOgHXXVIx"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"未立即成交的订单","position":{"start":{"line":484,"column":1},"end":{"line":484,"column":1}},"key":"P8Y279qPz7"}],"key":"uzm1aieYLe"},{"type":"paragraph","position":{"start":{"line":485,"column":1},"end":{"line":485,"column":1}},"children":[{"type":"inlineCode","value":"minimal_roi","position":{"start":{"line":485,"column":1},"end":{"line":485,"column":1}},"key":"c4KCDfLKDj"},{"type":"text","value":" 以 ","position":{"start":{"line":485,"column":1},"end":{"line":485,"column":1}},"key":"IQfEP1D8ek"},{"type":"inlineCode","value":"trade.open_date","position":{"start":{"line":485,"column":1},"end":{"line":485,"column":1}},"key":"R6XUKrhSqK"},{"type":"text","value":" 为基准，即首次下单时间。","position":{"start":{"line":485,"column":1},"end":{"line":485,"column":1}},"key":"gWcfaJ1Xgk"}],"key":"repyasi9mx"},{"type":"paragraph","position":{"start":{"line":487,"column":1},"end":{"line":487,"column":1}},"children":[{"type":"text","value":"对于未立即成交的限价单（如用 ","position":{"start":{"line":487,"column":1},"end":{"line":487,"column":1}},"key":"aIgLEzesM9"},{"type":"inlineCode","value":"custom_entry_price()","position":{"start":{"line":487,"column":1},"end":{"line":487,"column":1}},"key":"bTrTjYeTKu"},{"type":"text","value":"），或用 ","position":{"start":{"line":487,"column":1},"end":{"line":487,"column":1}},"key":"x9vUHqsjMD"},{"type":"inlineCode","value":"adjust_entry_price()","position":{"start":{"line":487,"column":1},"end":{"line":487,"column":1}},"key":"iC60Hg1s80"},{"type":"text","value":" 调整价格的情况，时间仍以首次下单为准。","position":{"start":{"line":487,"column":1},"end":{"line":487,"column":1}},"key":"d6LsIGvJgL"}],"key":"fti9crYqEx"}],"key":"mCqxrtpnXS"},{"type":"heading","depth":4,"position":{"start":{"line":490,"column":1},"end":{"line":490,"column":1}},"children":[{"type":"text","value":"止损","position":{"start":{"line":490,"column":1},"end":{"line":490,"column":1}},"key":"wbrPNcNNin"}],"identifier":"id","label":"止损","html_id":"id-12","implicit":true,"key":"q8E1vjYfze"},{"type":"paragraph","position":{"start":{"line":492,"column":1},"end":{"line":492,"column":1}},"children":[{"type":"text","value":"强烈建议设置止损，以保护资金免受极端行情影响。","position":{"start":{"line":492,"column":1},"end":{"line":492,"column":1}},"key":"HK3Cno3eTt"}],"key":"co6rZYLXbb"},{"type":"paragraph","position":{"start":{"line":494,"column":1},"end":{"line":494,"column":1}},"children":[{"type":"text","value":"如设置 10% 止损：","position":{"start":{"line":494,"column":1},"end":{"line":494,"column":1}},"key":"VjWtkBkJyz"}],"key":"vuf1DCZUq5"},{"type":"code","lang":"python","value":"stoploss = -0.10","position":{"start":{"line":496,"column":1},"end":{"line":498,"column":1}},"key":"S7eYFlDswf"},{"type":"paragraph","position":{"start":{"line":500,"column":1},"end":{"line":500,"column":1}},"children":[{"type":"text","value":"更多止损功能详见","position":{"start":{"line":500,"column":1},"end":{"line":500,"column":1}},"key":"eRXqvX2spx"},{"type":"link","url":"/stoploss","position":{"start":{"line":500,"column":1},"end":{"line":500,"column":1}},"children":[{"type":"text","value":"止损专页","position":{"start":{"line":500,"column":1},"end":{"line":500,"column":1}},"key":"FB3Z1lLwss"}],"urlSource":"stoploss.md","dataUrl":"/stoploss.json","internal":true,"protocol":"file","key":"cNfzWlXQRW"},{"type":"text","value":"。","position":{"start":{"line":500,"column":1},"end":{"line":500,"column":1}},"key":"QN766sdef7"}],"key":"kjiHevB0H9"},{"type":"heading","depth":4,"position":{"start":{"line":502,"column":1},"end":{"line":502,"column":1}},"children":[{"type":"text","value":"时间周期（Timeframe）","position":{"start":{"line":502,"column":1},"end":{"line":502,"column":1}},"key":"YmIHF0HJ8l"}],"identifier":"id-timeframe","label":"时间周期（Timeframe）","html_id":"id-timeframe","implicit":true,"key":"lLX8VMT47O"},{"type":"paragraph","position":{"start":{"line":504,"column":1},"end":{"line":504,"column":1}},"children":[{"type":"text","value":"即策略用的K线周期。","position":{"start":{"line":504,"column":1},"end":{"line":504,"column":1}},"key":"Yu6SwqaPHz"}],"key":"BgiIps1s7X"},{"type":"paragraph","position":{"start":{"line":506,"column":1},"end":{"line":506,"column":1}},"children":[{"type":"text","value":"常见值有 “1m”、“5m”、“15m”、“1h”，也可用交易所支持的其他周期。","position":{"start":{"line":506,"column":1},"end":{"line":506,"column":1}},"key":"TOeSQi73ab"}],"key":"S0U7AicWt5"},{"type":"paragraph","position":{"start":{"line":508,"column":1},"end":{"line":508,"column":1}},"children":[{"type":"text","value":"同一入场/出场信号在不同周期下效果可能完全不同。","position":{"start":{"line":508,"column":1},"end":{"line":508,"column":1}},"key":"DQEzktkrwu"}],"key":"b0FMlLVXOI"},{"type":"paragraph","position":{"start":{"line":510,"column":1},"end":{"line":510,"column":1}},"children":[{"type":"text","value":"在策略方法中可通过 ","position":{"start":{"line":510,"column":1},"end":{"line":510,"column":1}},"key":"JHydy926z2"},{"type":"inlineCode","value":"self.timeframe","position":{"start":{"line":510,"column":1},"end":{"line":510,"column":1}},"key":"EXq39VGMzq"},{"type":"text","value":" 访问。","position":{"start":{"line":510,"column":1},"end":{"line":510,"column":1}},"key":"SsMKyVYiZP"}],"key":"BzxrMwITCP"},{"type":"heading","depth":4,"position":{"start":{"line":512,"column":1},"end":{"line":512,"column":1}},"children":[{"type":"text","value":"是否支持做空","position":{"start":{"line":512,"column":1},"end":{"line":512,"column":1}},"key":"iy8QIvMa5q"}],"identifier":"id","label":"是否支持做空","html_id":"id-13","implicit":true,"key":"HY7SVWEyyd"},{"type":"paragraph","position":{"start":{"line":514,"column":1},"end":{"line":514,"column":1}},"children":[{"type":"text","value":"如需在合约市场做空，需设置 ","position":{"start":{"line":514,"column":1},"end":{"line":514,"column":1}},"key":"lmT481jHRH"},{"type":"inlineCode","value":"can_short = True","position":{"start":{"line":514,"column":1},"end":{"line":514,"column":1}},"key":"uudhPIP0CP"},{"type":"text","value":"。","position":{"start":{"line":514,"column":1},"end":{"line":514,"column":1}},"key":"mCVkNTznDU"}],"key":"RzF9MRrnDu"},{"type":"paragraph","position":{"start":{"line":516,"column":1},"end":{"line":516,"column":1}},"children":[{"type":"text","value":"启用后，策略在现货市场会加载失败。","position":{"start":{"line":516,"column":1},"end":{"line":516,"column":1}},"key":"HC63LutiuD"}],"key":"hDobLUhxkf"},{"type":"paragraph","position":{"start":{"line":518,"column":1},"end":{"line":518,"column":1}},"children":[{"type":"text","value":"如 ","position":{"start":{"line":518,"column":1},"end":{"line":518,"column":1}},"key":"i7MZIAfAq8"},{"type":"inlineCode","value":"enter_short","position":{"start":{"line":518,"column":1},"end":{"line":518,"column":1}},"key":"lteHnjmZJ4"},{"type":"text","value":" 列有 1，但 ","position":{"start":{"line":518,"column":1},"end":{"line":518,"column":1}},"key":"tU9sLxr7Wk"},{"type":"inlineCode","value":"can_short = False","position":{"start":{"line":518,"column":1},"end":{"line":518,"column":1}},"key":"wBOcbbCR9f"},{"type":"text","value":"（默认），则即使配置了合约市场也不会做空。","position":{"start":{"line":518,"column":1},"end":{"line":518,"column":1}},"key":"LxZX85kIfr"}],"key":"QjpVpnhKYv"},{"type":"heading","depth":4,"position":{"start":{"line":520,"column":1},"end":{"line":520,"column":1}},"children":[{"type":"text","value":"Metadata 字典","position":{"start":{"line":520,"column":1},"end":{"line":520,"column":1}},"key":"ey4n1Y2U2K"}],"identifier":"metadata","label":"Metadata 字典","html_id":"metadata","implicit":true,"key":"mfkDHytd1R"},{"type":"paragraph","position":{"start":{"line":522,"column":1},"end":{"line":523,"column":1}},"children":[{"type":"inlineCode","value":"metadata","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"AAsbM8uRSj"},{"type":"text","value":" 字典（","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"BA7Koej18S"},{"type":"inlineCode","value":"populate_entry_trend","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"mbD20S28v1"},{"type":"text","value":"、","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"M18KCl7Daz"},{"type":"inlineCode","value":"populate_exit_trend","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"BdHThzxjhf"},{"type":"text","value":"、","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"jXMBKItbgH"},{"type":"inlineCode","value":"populate_indicators","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"Zs2iiTxKBE"},{"type":"text","value":" 可用）包含额外信息。\n目前有 ","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"ZMx3foQd8o"},{"type":"inlineCode","value":"pair","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"jwYHx9oUQH"},{"type":"text","value":"，可通过 ","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"NUV2oAHYHU"},{"type":"inlineCode","value":"metadata['pair']","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"M4tceatG8w"},{"type":"text","value":" 获取，如 ","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"Hgq8GLxBqZ"},{"type":"inlineCode","value":"XRP/BTC","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"pCcQ6oPrcT"},{"type":"text","value":"（合约市场为 ","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"HOuWos5FZP"},{"type":"inlineCode","value":"XRP/BTC:BTC","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"aQET2iVIsW"},{"type":"text","value":"）。","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"dDa6cHcbt5"}],"key":"OwQblh3b4E"},{"type":"paragraph","position":{"start":{"line":525,"column":1},"end":{"line":525,"column":1}},"children":[{"type":"text","value":"metadata 不应被修改，也不会在策略函数间持久化。","position":{"start":{"line":525,"column":1},"end":{"line":525,"column":1}},"key":"MQ8IuqGzAP"}],"key":"HKyQeSVbmp"},{"type":"paragraph","position":{"start":{"line":527,"column":1},"end":{"line":527,"column":1}},"children":[{"type":"text","value":"如需持久化信息，请查阅","position":{"start":{"line":527,"column":1},"end":{"line":527,"column":1}},"key":"i417thKz2r"},{"type":"crossReference","url":"/strategy-advanced","position":{"start":{"line":527,"column":1},"end":{"line":527,"column":1}},"children":[{"type":"text","value":"信息存储","position":{"start":{"line":527,"column":1},"end":{"line":527,"column":1}},"key":"f0bQhNShuO"}],"urlSource":"strategy-advanced.md#storing-information-persistent","dataUrl":"/strategy-advanced.json","identifier":"storing-information-persistent","label":"storing-information-persistent","remote":true,"protocol":"file","key":"byrmN0zGUJ"},{"type":"text","value":"。","position":{"start":{"line":527,"column":1},"end":{"line":527,"column":1}},"key":"Gu8ToQelyw"}],"key":"MPNm4oXKb6"},{"type":"include","file":"includes/strategy-imports.md","literal":false,"lang":"markdown","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"策略所需的导入","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uNKk4yarSP"}],"identifier":"id","label":"策略所需的导入","html_id":"id-14","implicit":true,"key":"iOndIXISVB"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"在创建策略时，你需要导入必要的模块和类。以下是一个策略所需的导入：","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"aVoHUvbHsx"}],"key":"foPssa1zMF"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"默认情况下，我们建议使用以下导入作为策略的基础：\n这将涵盖 freqtrade 功能所需的所有导入。\n当然，你可以根据需要添加更多导入。","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"n0q1944Tn2"}],"key":"dl84PKJU5E"},{"type":"code","lang":"python","value":"# flake8: noqa: F401\n# isort: skip_file\n# --- Do not remove these imports ---\nimport numpy as np\nimport pandas as pd\nfrom datetime import datetime, timedelta, timezone\nfrom pandas import DataFrame\nfrom typing import Dict, Optional, Union, Tuple\n\nfrom freqtrade.strategy import (\n    IStrategy,\n    Trade, \n    Order,\n    PairLocks,\n    informative,  # @informative decorator\n    # Hyperopt Parameters\n    BooleanParameter,\n    CategoricalParameter,\n    DecimalParameter,\n    IntParameter,\n    RealParameter,\n    # timeframe helpers\n    timeframe_to_minutes,\n    timeframe_to_next_date,\n    timeframe_to_prev_date,\n    # Strategy helper functions\n    merge_informative_pair,\n    stoploss_from_absolute,\n    stoploss_from_open,\n)\n\n# --------------------------------\n# Add your lib to import here\nimport talib.abstract as ta\nfrom technical import qtpylib","position":{"start":{"line":9,"column":1},"end":{"line":45,"column":1}},"key":"a21d5wqei2"}],"key":"Up4xcETbO4"},{"type":"heading","depth":3,"position":{"start":{"line":532,"column":1},"end":{"line":532,"column":1}},"children":[{"type":"text","value":"策略文件加载","position":{"start":{"line":532,"column":1},"end":{"line":532,"column":1}},"key":"PeaUCBcQHl"}],"identifier":"id","label":"策略文件加载","html_id":"id-15","implicit":true,"key":"KRJT006vcZ"},{"type":"paragraph","position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"children":[{"type":"text","value":"默认情况下，freqtrade 会尝试从 ","position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"key":"iDAkjEPlA6"},{"type":"inlineCode","value":"userdir","position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"key":"PbF8iNljcd"},{"type":"text","value":"（默认 ","position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"key":"GI9YOoJ4Ge"},{"type":"inlineCode","value":"user_data/strategies","position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"key":"E4X45sdiLu"},{"type":"text","value":"）下所有 ","position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"key":"LMAbVNDZfg"},{"type":"inlineCode","value":".py","position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"key":"lfQg1prjc2"},{"type":"text","value":" 文件加载策略。","position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"key":"d3z1aOmuNK"}],"key":"VK6HvATpCj"},{"type":"paragraph","position":{"start":{"line":536,"column":1},"end":{"line":536,"column":1}},"children":[{"type":"text","value":"假设你的策略叫 ","position":{"start":{"line":536,"column":1},"end":{"line":536,"column":1}},"key":"tgDdW5wlzk"},{"type":"inlineCode","value":"AwesomeStrategy","position":{"start":{"line":536,"column":1},"end":{"line":536,"column":1}},"key":"tZFFIbH3WD"},{"type":"text","value":"，文件为 ","position":{"start":{"line":536,"column":1},"end":{"line":536,"column":1}},"key":"nOOMwnvWIe"},{"type":"inlineCode","value":"user_data/strategies/AwesomeStrategy.py","position":{"start":{"line":536,"column":1},"end":{"line":536,"column":1}},"key":"DG3Ei6WIAV"},{"type":"text","value":"，可用如下命令 dry（或 live，视配置而定）运行：","position":{"start":{"line":536,"column":1},"end":{"line":536,"column":1}},"key":"rD7Ge5bZyV"}],"key":"iI8aa6s6r4"},{"type":"code","lang":"bash","value":"freqtrade trade --strategy AwesomeStrategy","position":{"start":{"line":538,"column":1},"end":{"line":540,"column":1}},"key":"Grcy8SxKSf"},{"type":"paragraph","position":{"start":{"line":542,"column":1},"end":{"line":542,"column":1}},"children":[{"type":"text","value":"注意这里用的是类名，不是文件名。","position":{"start":{"line":542,"column":1},"end":{"line":542,"column":1}},"key":"cEH2ns0Eqk"}],"key":"sSXdgodGPw"},{"type":"paragraph","position":{"start":{"line":544,"column":1},"end":{"line":544,"column":1}},"children":[{"type":"text","value":"用 ","position":{"start":{"line":544,"column":1},"end":{"line":544,"column":1}},"key":"Q2VhQwZSIO"},{"type":"inlineCode","value":"freqtrade list-strategies","position":{"start":{"line":544,"column":1},"end":{"line":544,"column":1}},"key":"psmhjYgyUC"},{"type":"text","value":" 可查看所有可加载的策略（正确目录下的所有策略）。会有\"状态\"字段，提示潜在问题。","position":{"start":{"line":544,"column":1},"end":{"line":544,"column":1}},"key":"Dgq7LB9fOu"}],"key":"BhrK9mngku"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"自定义策略目录","position":{"start":{"line":546,"column":1},"end":{"line":546,"column":1}},"key":"P7XgOshSAh"}],"key":"K59ItYJ3c9"},{"type":"paragraph","position":{"start":{"line":547,"column":1},"end":{"line":547,"column":1}},"children":[{"type":"text","value":"可用 ","position":{"start":{"line":547,"column":1},"end":{"line":547,"column":1}},"key":"nGt1OAPwOu"},{"type":"inlineCode","value":"--strategy-path user_data/otherPath","position":{"start":{"line":547,"column":1},"end":{"line":547,"column":1}},"key":"vpV7aDe6U3"},{"type":"text","value":" 指定其他目录。所有需用策略的命令均支持此参数。","position":{"start":{"line":547,"column":1},"end":{"line":547,"column":1}},"key":"lg1c8xl443"}],"key":"Yh2W2bDjmi"}],"key":"ZfpBdYLvH7"},{"type":"heading","depth":3,"position":{"start":{"line":550,"column":1},"end":{"line":550,"column":1}},"children":[{"type":"text","value":"辅助交易对（Informative Pairs）","position":{"start":{"line":550,"column":1},"end":{"line":550,"column":1}},"key":"JIRyF9wQGW"}],"identifier":"id-informative-pairs","label":"辅助交易对（Informative Pairs）","html_id":"id-informative-pairs","implicit":true,"key":"eicpbDA9hP"},{"type":"heading","depth":4,"position":{"start":{"line":554,"column":1},"end":{"line":554,"column":1}},"children":[{"type":"text","value":"获取非交易对的数据","position":{"start":{"line":554,"column":1},"end":{"line":554,"column":1}},"key":"jkjCRajxXl"}],"label":"get-data-for-non-tradeable-pairs","identifier":"get-data-for-non-tradeable-pairs","html_id":"get-data-for-non-tradeable-pairs","key":"pRaBuecbc6"},{"type":"paragraph","position":{"start":{"line":556,"column":1},"end":{"line":556,"column":1}},"children":[{"type":"text","value":"有些策略需要参考更大周期的其他交易对数据。","position":{"start":{"line":556,"column":1},"end":{"line":556,"column":1}},"key":"cbeJkB81E9"}],"key":"sj5xpg2Hkn"},{"type":"paragraph","position":{"start":{"line":558,"column":1},"end":{"line":558,"column":1}},"children":[{"type":"text","value":"这些辅助对的 OHLCV 数据会在常规白名单刷新时一并下载，可通过 ","position":{"start":{"line":558,"column":1},"end":{"line":558,"column":1}},"key":"eLUjgIPRRX"},{"type":"inlineCode","value":"DataProvider","position":{"start":{"line":558,"column":1},"end":{"line":558,"column":1}},"key":"ugCjdlVYvP"},{"type":"text","value":" 获取。","position":{"start":{"line":558,"column":1},"end":{"line":558,"column":1}},"key":"FILuZfcjEX"}],"key":"b1yQlD7AXu"},{"type":"paragraph","position":{"start":{"line":560,"column":1},"end":{"line":560,"column":1}},"children":[{"type":"text","value":"这些对","position":{"start":{"line":560,"column":1},"end":{"line":560,"column":1}},"key":"WuePQKu9eC"},{"type":"strong","position":{"start":{"line":560,"column":1},"end":{"line":560,"column":1}},"children":[{"type":"text","value":"不会","position":{"start":{"line":560,"column":1},"end":{"line":560,"column":1}},"key":"ZtjDFJXutV"}],"key":"hBsQ65wAkz"},{"type":"text","value":"被交易，除非也在白名单或被动态白名单（如 ","position":{"start":{"line":560,"column":1},"end":{"line":560,"column":1}},"key":"eQFhC0FIXT"},{"type":"inlineCode","value":"VolumePairlist","position":{"start":{"line":560,"column":1},"end":{"line":560,"column":1}},"key":"mNdt3f1kCs"},{"type":"text","value":"）选中。","position":{"start":{"line":560,"column":1},"end":{"line":560,"column":1}},"key":"SR745rsmhm"}],"key":"XuFvvnsFWM"},{"type":"paragraph","position":{"start":{"line":562,"column":1},"end":{"line":562,"column":1}},"children":[{"type":"text","value":"需用元组指定，格式为 ","position":{"start":{"line":562,"column":1},"end":{"line":562,"column":1}},"key":"ZuGmEa2Mdy"},{"type":"inlineCode","value":"(\"pair\", \"timeframe\")","position":{"start":{"line":562,"column":1},"end":{"line":562,"column":1}},"key":"ujRUuUXcMA"},{"type":"text","value":"，第一个为交易对，第二个为周期。","position":{"start":{"line":562,"column":1},"end":{"line":562,"column":1}},"key":"TTwesaoYn3"}],"key":"noOCX90mJk"},{"type":"paragraph","position":{"start":{"line":564,"column":1},"end":{"line":564,"column":1}},"children":[{"type":"text","value":"示例：","position":{"start":{"line":564,"column":1},"end":{"line":564,"column":1}},"key":"Uzc8YVl0ef"}],"key":"gApQDeFxBr"},{"type":"code","lang":"python","value":"def informative_pairs(self):\n    return [(\"ETH/USDT\", \"5m\"),\n            (\"BTC/TUSD\", \"15m\"),\n            ]","position":{"start":{"line":566,"column":1},"end":{"line":571,"column":1}},"key":"bGAzeaf3u2"},{"type":"paragraph","position":{"start":{"line":573,"column":1},"end":{"line":573,"column":1}},"children":[{"type":"text","value":"完整示例见","position":{"start":{"line":573,"column":1},"end":{"line":573,"column":1}},"key":"Lo2f6xQDWm"},{"type":"link","url":"#%E5%AE%8C%E6%95%B4%E6%95%B0%E6%8D%AE%E6%8F%90%E4%BE%9B%E8%80%85%E7%A4%BA%E4%BE%8B","position":{"start":{"line":573,"column":1},"end":{"line":573,"column":1}},"children":[{"type":"text","value":"DataProvider 部分","position":{"start":{"line":573,"column":1},"end":{"line":573,"column":1}},"key":"JpNtHzjo67"}],"urlSource":"#%E5%AE%8C%E6%95%B4%E6%95%B0%E6%8D%AE%E6%8F%90%E4%BE%9B%E8%80%85%E7%A4%BA%E4%BE%8B","key":"kh0ide1e08"},{"type":"text","value":"。","position":{"start":{"line":573,"column":1},"end":{"line":573,"column":1}},"key":"eZOa43AANW"}],"key":"TGQLyfbFDG"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"kZIq73Kg29"}],"key":"ZTtEdUrBrr"},{"type":"paragraph","position":{"start":{"line":576,"column":1},"end":{"line":576,"column":1}},"children":[{"type":"text","value":"这些对会随白名单刷新，建议列表不要太长。","position":{"start":{"line":576,"column":1},"end":{"line":576,"column":1}},"key":"cgyz5zhaxt"}],"key":"IdrlQIdsqI"},{"type":"paragraph","position":{"start":{"line":578,"column":1},"end":{"line":578,"column":1}},"children":[{"type":"text","value":"只要交易所支持，所有周期和对都可用。","position":{"start":{"line":578,"column":1},"end":{"line":578,"column":1}},"key":"uMjpFGzpeD"}],"key":"xOvpPEKwKM"},{"type":"paragraph","position":{"start":{"line":580,"column":1},"end":{"line":580,"column":1}},"children":[{"type":"text","value":"但建议尽量用重采样方式获取大周期，避免请求过多被封。","position":{"start":{"line":580,"column":1},"end":{"line":580,"column":1}},"key":"zHHskyOyL6"}],"key":"G2xdEthBOS"}],"key":"D3K3Pa9MNx"},{"type":"admonition","kind":"attention","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"其他K线类型","position":{"start":{"line":583,"column":1},"end":{"line":583,"column":1}},"key":"nt9yrwF5kf"}],"key":"wst7xytV6V"},{"type":"paragraph","position":{"start":{"line":584,"column":1},"end":{"line":584,"column":1}},"children":[{"type":"text","value":"informative_pairs 还可加第三个元素，显式指定K线类型。","position":{"start":{"line":584,"column":1},"end":{"line":584,"column":1}},"key":"cgfP8ORHDh"}],"key":"D0ivif8VdW"},{"type":"paragraph","position":{"start":{"line":586,"column":1},"end":{"line":586,"column":1}},"children":[{"type":"text","value":"可用性取决于交易模式和交易所。一般现货对不能用于合约市场，反之亦然。","position":{"start":{"line":586,"column":1},"end":{"line":586,"column":1}},"key":"XFSZsJCtBT"}],"key":"bgQvbJ5OKp"},{"type":"paragraph","position":{"start":{"line":588,"column":1},"end":{"line":588,"column":1}},"children":[{"type":"text","value":"详情见交易所文档。","position":{"start":{"line":588,"column":1},"end":{"line":588,"column":1}},"key":"Co8jin6doK"}],"key":"rpYzHX9osC"}],"key":"HdIxogDFl3"},{"type":"code","lang":"python","value":"    def informative_pairs(self):\n        return [\n            (\"ETH/USDT\", \"5m\", \"\"),   # 默认 K 线类型，随 trading_mode 变化（推荐）\n            (\"ETH/USDT\", \"5m\", \"spot\"),   # 强制用现货 K 线（仅现货机器人）\n            (\"BTC/TUSD\", \"15m\", \"futures\"),  # 用合约 K 线（仅合约机器人）\n            (\"BTC/TUSD\", \"15m\", \"mark\"),  # 用标记 K 线（仅合约机器人）\n        ]","position":{"start":{"line":591,"column":1},"end":{"line":599,"column":1}},"key":"ZUlyOiIhUY"},{"type":"heading","depth":4,"position":{"start":{"line":601,"column":1},"end":{"line":601,"column":1}},"children":[{"type":"text","value":"Informative pairs 装饰器（","position":{"start":{"line":601,"column":1},"end":{"line":601,"column":1}},"key":"PPWKqjgQPH"},{"type":"inlineCode","value":"@informative()","position":{"start":{"line":601,"column":1},"end":{"line":601,"column":1}},"key":"O8YL5GtARC"},{"type":"text","value":"）","position":{"start":{"line":601,"column":1},"end":{"line":601,"column":1}},"key":"Ra5UOGASLr"}],"identifier":"informative-pairs-informative","label":"Informative pairs 装饰器（@informative()）","html_id":"informative-pairs-informative","implicit":true,"key":"BlXWInjd0W"},{"type":"paragraph","position":{"start":{"line":603,"column":1},"end":{"line":603,"column":1}},"children":[{"type":"text","value":"可用 ","position":{"start":{"line":603,"column":1},"end":{"line":603,"column":1}},"key":"Bo2tUA3zih"},{"type":"inlineCode","value":"@informative","position":{"start":{"line":603,"column":1},"end":{"line":603,"column":1}},"key":"p1t1O7TVDg"},{"type":"text","value":" 装饰器快速定义 informative pair。所有被装饰的 ","position":{"start":{"line":603,"column":1},"end":{"line":603,"column":1}},"key":"S0Km2O9iC8"},{"type":"inlineCode","value":"populate_indicators_*","position":{"start":{"line":603,"column":1},"end":{"line":603,"column":1}},"key":"wMtvcDOSDz"},{"type":"text","value":" 方法独立运行，不能访问其他 informative pair 的数据。但所有 informative dataframe 会合并传递给主 ","position":{"start":{"line":603,"column":1},"end":{"line":603,"column":1}},"key":"Ie6UIWp88O"},{"type":"inlineCode","value":"populate_indicators()","position":{"start":{"line":603,"column":1},"end":{"line":603,"column":1}},"key":"mQHMMMeJHT"},{"type":"text","value":"。","position":{"start":{"line":603,"column":1},"end":{"line":603,"column":1}},"key":"BAAYOejfiZ"}],"key":"JglP2TghaB"},{"type":"admonition","kind":"caution","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Caution","key":"TDuST4Zv5u"}],"key":"WqYu8fDDbs"},{"type":"paragraph","position":{"start":{"line":606,"column":1},"end":{"line":606,"column":1}},"children":[{"type":"text","value":"若需用一个 informative pair 的数据生成另一个 informative pair，请勿用 ","position":{"start":{"line":606,"column":1},"end":{"line":606,"column":1}},"key":"bKfmKjjFIt"},{"type":"inlineCode","value":"@informative","position":{"start":{"line":606,"column":1},"end":{"line":606,"column":1}},"key":"uoXC0yAPw2"},{"type":"text","value":" 装饰器，而应手动定义 informative pair，见","position":{"start":{"line":606,"column":1},"end":{"line":606,"column":1}},"key":"r7NBpKZD2X"},{"type":"link","url":"#%E5%AE%8C%E6%95%B4%E6%95%B0%E6%8D%AE%E6%8F%90%E4%BE%9B%E8%80%85%E7%A4%BA%E4%BE%8B","position":{"start":{"line":606,"column":1},"end":{"line":606,"column":1}},"children":[{"type":"text","value":"DataProvider 部分","position":{"start":{"line":606,"column":1},"end":{"line":606,"column":1}},"key":"GDqGonzogg"}],"urlSource":"#%E5%AE%8C%E6%95%B4%E6%95%B0%E6%8D%AE%E6%8F%90%E4%BE%9B%E8%80%85%E7%A4%BA%E4%BE%8B","key":"FHs6JipD48"},{"type":"text","value":"。","position":{"start":{"line":606,"column":1},"end":{"line":606,"column":1}},"key":"sTxAOd72Fy"}],"key":"FPywcITh4M"}],"key":"S8GM6DuWYu"},{"type":"paragraph","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"children":[{"type":"text","value":"超参优化时，hyperoptable 参数不支持 ","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"key":"sY8gjthA9a"},{"type":"inlineCode","value":".value","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"key":"WLqAuTtqGp"},{"type":"text","value":"，请用 ","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"key":"xLBIDGaseo"},{"type":"inlineCode","value":".range","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"key":"H1hpAAaHpL"},{"type":"text","value":"。见","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"key":"H6h6MDWDMf"},{"type":"crossReference","url":"/hyperopt","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"children":[{"type":"text","value":"优化指标参数","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"key":"ennmUgJBH8"}],"urlSource":"hyperopt.md#optimizing-an-indicator-parameter","dataUrl":"/hyperopt.json","identifier":"optimizing-an-indicator-parameter","label":"optimizing-an-indicator-parameter","remote":true,"protocol":"file","key":"WRfnmmVniq"},{"type":"text","value":"。","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"key":"qZAYCw7AHg"}],"key":"AE1CLIqVph"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"完整文档","position":{"start":{"line":611,"column":1},"end":{"line":611,"column":1}},"key":"XoI97eOnBa"}],"key":"wB8Znney2I"},{"type":"code","lang":"python","value":"    def informative(\n        timeframe: str,\n        asset: str = \"\",\n        fmt: str | Callable[[Any], str] | None = None,\n        *,\n        candle_type: CandleType | str | None = None,\n        ffill: bool = True,\n    ) -> Callable[[PopulateIndicators], PopulateIndicators]:\n        \"\"\"\n        用于 populate_indicators_Nn(self, dataframe, metadata) 的装饰器，定义 informative 指标。\n        \n        用法示例：\n\n            @informative('1h')\n            def populate_indicators_1h(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n                dataframe['rsi'] = ta.RSI(dataframe, timeperiod=14)\n                return dataframe\n\n        :param timeframe: 辅助K线周期，必须大于等于主策略周期。\n        :param asset: 辅助资产，如 BTC、BTC/USDT、ETH/BTC。不指定则用当前对。支持格式化字符串。\n        :param fmt: 列名格式（str）或格式化函数。默认：\n        * {base}_{quote}_{column}_{timeframe}（指定 asset 时）\n        * {column}_{timeframe}（未指定 asset 时）\n        支持变量：{base}、{BASE}、{quote}、{QUOTE}、{asset}、{column}、{timeframe}\n        :param ffill: informative pair 合并后是否前向填充。\n        :param candle_type: '', mark, index, premiumIndex, funding_rate\n        \"\"\"","position":{"start":{"line":613,"column":1},"end":{"line":641,"column":1}},"key":"lQuinox8T1"}],"key":"PvHASwjGF3"},{"type":"admonition","kind":"hint","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"快速定义 informative pair","position":{"start":{"line":645,"column":1},"end":{"line":645,"column":1}},"key":"hO5N5V3ZKc"}],"key":"U2vJcRP0Uc"},{"type":"paragraph","position":{"start":{"line":647,"column":1},"end":{"line":647,"column":1}},"children":[{"type":"text","value":"大多数情况下无需用 ","position":{"start":{"line":647,"column":1},"end":{"line":647,"column":1}},"key":"CsxwrhtUMv"},{"type":"inlineCode","value":"merge_informative_pair()","position":{"start":{"line":647,"column":1},"end":{"line":647,"column":1}},"key":"sWXL2g0bXN"},{"type":"text","value":"，可直接用装饰器：","position":{"start":{"line":647,"column":1},"end":{"line":647,"column":1}},"key":"VRMgjDaPpZ"}],"key":"olS8mv2mjC"},{"type":"code","lang":"python","value":"\n    from datetime import datetime\n    from freqtrade.persistence import Trade\n    from freqtrade.strategy import IStrategy, informative\n\n    class AwesomeStrategy(IStrategy):\n        \n        # 可省略 informative_pairs 方法\n\n        # 为每个对定义高阶周期 informative pair。可叠加装饰器。\n        @informative('30m')\n        @informative('1h')\n        def populate_indicators_1h(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n            dataframe['rsi'] = ta.RSI(dataframe, timeperiod=14)\n            return dataframe\n\n        # 定义 BTC/STAKE informative pair。可用 {stake} 占位符。最终列名如 'btc_usdt_rsi_1h'。\n        @informative('1h', 'BTC/{stake}')\n        def populate_indicators_btc_1h(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n            dataframe['rsi'] = ta.RSI(dataframe, timeperiod=14)\n            return dataframe\n\n        # 定义 BTC/ETH informative pair。需指定 quote。最终列名如 'eth_btc_rsi_1h'。\n        @informative('1h', 'ETH/BTC')\n        def populate_indicators_eth_btc_1h(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n            dataframe['rsi'] = ta.RSI(dataframe, timeperiod=14)\n            return dataframe\n    \n        # 可自定义列名格式\n        @informative('1h', 'BTC/{stake}', '{column}_{timeframe}')\n        def populate_indicators_btc_1h_2(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n            dataframe['rsi_upper'] = ta.RSI(dataframe, timeperiod=14)\n            return dataframe\n    \n        def populate_indicators(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n            dataframe['rsi'] = ta.RSI(dataframe, timeperiod=14)\n            dataframe['rsi_less'] = dataframe['rsi'] < dataframe['rsi_1h']\n            return dataframe","position":{"start":{"line":649,"column":1},"end":{"line":688,"column":1}},"key":"al2rH7uA3i"}],"key":"XOyTxL09Il"},{"type":"admonition","kind":"attention","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Attention","key":"U0ue004UKG"}],"key":"lX9r0ZnYhM"},{"type":"paragraph","position":{"start":{"line":693,"column":1},"end":{"line":693,"column":1}},"children":[{"type":"text","value":"访问其他对的 informative dataframe 时建议用字符串格式化，便于后续更换 stake 货币。","position":{"start":{"line":693,"column":1},"end":{"line":693,"column":1}},"key":"uZnxlGF4ol"}],"key":"x3liU7JjCv"},{"type":"code","lang":"python","value":"    def populate_entry_trend(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n        stake = self.config['stake_currency']\n        dataframe.loc[\n            (\n                (dataframe[f'btc_{stake}_rsi_1h'] < 35)\n                &\n                (dataframe['volume'] > 0)\n            ),\n            ['enter_long', 'enter_tag']] = (1, 'buy_signal_rsi')\n    \n        return dataframe","position":{"start":{"line":695,"column":1},"end":{"line":707,"column":1}},"key":"NEtQwZ7Heu"},{"type":"paragraph","position":{"start":{"line":709,"column":1},"end":{"line":709,"column":1}},"children":[{"type":"text","value":"或用列重命名去除 stake 货币：","position":{"start":{"line":709,"column":1},"end":{"line":709,"column":1}},"key":"uUqJG07UdT"},{"type":"inlineCode","value":"@informative('1h', 'BTC/{stake}', fmt='{base}_{column}_{timeframe}')","position":{"start":{"line":709,"column":1},"end":{"line":709,"column":1}},"key":"BibIUehFaG"},{"type":"text","value":"。","position":{"start":{"line":709,"column":1},"end":{"line":709,"column":1}},"key":"mHRk2fxbbN"}],"key":"UAwZ3vHXkz"}],"key":"nxlZANae8d"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"方法名重复","position":{"start":{"line":712,"column":1},"end":{"line":712,"column":1}},"key":"BFd2h3mgwD"}],"key":"V9nuNvBdt5"},{"type":"paragraph","position":{"start":{"line":714,"column":1},"end":{"line":714,"column":1}},"children":[{"type":"text","value":"被 ","position":{"start":{"line":714,"column":1},"end":{"line":714,"column":1}},"key":"A6eNH5jqqI"},{"type":"inlineCode","value":"@informative()","position":{"start":{"line":714,"column":1},"end":{"line":714,"column":1}},"key":"AG2fpjIiuX"},{"type":"text","value":" 装饰的方法名必须唯一！重复会覆盖前面的定义且无报错，导致部分指标不可用。请仔细检查方法名。","position":{"start":{"line":714,"column":1},"end":{"line":714,"column":1}},"key":"SDzxghkqAB"}],"key":"YI4sRNtZRo"}],"key":"MMzFUnDHD6"},{"type":"heading","depth":4,"position":{"start":{"line":717,"column":1},"end":{"line":717,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":717,"column":1},"end":{"line":717,"column":1}},"children":[{"type":"text","value":"merge_informative_pair()","position":{"start":{"line":717,"column":1},"end":{"line":717,"column":1}},"key":"sN93eDheyp"}],"key":"jrbETFxo0b"}],"identifier":"merge-informative-pair","label":"merge_informative_pair()","html_id":"merge-informative-pair","implicit":true,"key":"ib0o6l80z2"},{"type":"paragraph","position":{"start":{"line":719,"column":1},"end":{"line":719,"column":1}},"children":[{"type":"text","value":"该方法可安全、无前视偏差地将 informative pair 合并到主 dataframe。","position":{"start":{"line":719,"column":1},"end":{"line":719,"column":1}},"key":"lLdGLPAKhJ"}],"key":"OQ0PsvNw5Z"},{"type":"paragraph","position":{"start":{"line":721,"column":1},"end":{"line":721,"column":1}},"children":[{"type":"text","value":"功能：","position":{"start":{"line":721,"column":1},"end":{"line":721,"column":1}},"key":"SrrqouPgVB"}],"key":"gltvNDUQh0"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":723,"column":1},"end":{"line":726,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":723,"column":1},"end":{"line":723,"column":1}},"children":[{"type":"text","value":"列重命名，避免冲突","position":{"start":{"line":723,"column":1},"end":{"line":723,"column":1}},"key":"H2GtH0O58r"}],"key":"iL6RYl9mcB"},{"type":"listItem","spread":true,"position":{"start":{"line":724,"column":1},"end":{"line":724,"column":1}},"children":[{"type":"text","value":"无前视偏差合并","position":{"start":{"line":724,"column":1},"end":{"line":724,"column":1}},"key":"RTKCRkDel4"}],"key":"DhlMQwbxA2"},{"type":"listItem","spread":true,"position":{"start":{"line":725,"column":1},"end":{"line":726,"column":1}},"children":[{"type":"text","value":"可选前向填充","position":{"start":{"line":725,"column":1},"end":{"line":725,"column":1}},"key":"bJVS9KKzJJ"}],"key":"OCAfhebJ4g"}],"key":"Q4uYce0MkH"},{"type":"paragraph","position":{"start":{"line":727,"column":1},"end":{"line":727,"column":1}},"children":[{"type":"text","value":"完整示例见","position":{"start":{"line":727,"column":1},"end":{"line":727,"column":1}},"key":"Hq1dhtIwpU"},{"type":"link","url":"#%E5%AE%8C%E6%95%B4%E6%95%B0%E6%8D%AE%E6%8F%90%E4%BE%9B%E8%80%85%E7%A4%BA%E4%BE%8B","position":{"start":{"line":727,"column":1},"end":{"line":727,"column":1}},"children":[{"type":"text","value":"完整数据提供者示例","position":{"start":{"line":727,"column":1},"end":{"line":727,"column":1}},"key":"i9aQeFzfEc"}],"urlSource":"#%E5%AE%8C%E6%95%B4%E6%95%B0%E6%8D%AE%E6%8F%90%E4%BE%9B%E8%80%85%E7%A4%BA%E4%BE%8B","key":"CW83Td56Mx"},{"type":"text","value":"。","position":{"start":{"line":727,"column":1},"end":{"line":727,"column":1}},"key":"sGmskWObx1"}],"key":"eIxrlaiNiB"},{"type":"paragraph","position":{"start":{"line":729,"column":1},"end":{"line":729,"column":1}},"children":[{"type":"text","value":"所有 informative dataframe 列会以新名字出现在主 dataframe：","position":{"start":{"line":729,"column":1},"end":{"line":729,"column":1}},"key":"HgR3DzFj7E"}],"key":"E0Eg0oLq1h"},{"type":"admonition","kind":"important","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"列重命名","position":{"start":{"line":731,"column":1},"end":{"line":731,"column":1}},"key":"Pgqgo5805G"}],"key":"TR9hDHJ77F"},{"type":"paragraph","position":{"start":{"line":733,"column":1},"end":{"line":733,"column":1}},"children":[{"type":"text","value":"假设 ","position":{"start":{"line":733,"column":1},"end":{"line":733,"column":1}},"key":"GHCxPW6V4k"},{"type":"inlineCode","value":"inf_tf = '1d'","position":{"start":{"line":733,"column":1},"end":{"line":733,"column":1}},"key":"mRTpAduKQb"},{"type":"text","value":"，合并后列名如下：","position":{"start":{"line":733,"column":1},"end":{"line":733,"column":1}},"key":"USZbEtzLzD"}],"key":"dez74iERDd"},{"type":"code","lang":"python","value":"    'date', 'open', 'high', 'low', 'close', 'rsi'                     # 原 dataframe\n    'date_1d', 'open_1d', 'high_1d', 'low_1d', 'close_1d', 'rsi_1d'   # informative dataframe","position":{"start":{"line":735,"column":1},"end":{"line":738,"column":1}},"key":"RzsR4yiFNO"}],"key":"deQivzXSSq"},{"type":"admonition","kind":"important","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"1h 列重命名","position":{"start":{"line":742,"column":1},"end":{"line":742,"column":1}},"key":"g6f9Zkpibd"}],"key":"VZAzA5qq8h"},{"type":"paragraph","position":{"start":{"line":744,"column":1},"end":{"line":744,"column":1}},"children":[{"type":"text","value":"假设 ","position":{"start":{"line":744,"column":1},"end":{"line":744,"column":1}},"key":"G8P9IBlagA"},{"type":"inlineCode","value":"inf_tf = '1h'","position":{"start":{"line":744,"column":1},"end":{"line":744,"column":1}},"key":"lNPfkTN0he"},{"type":"text","value":"，合并后列名如下：","position":{"start":{"line":744,"column":1},"end":{"line":744,"column":1}},"key":"kh7O6jWszf"}],"key":"cx5AuTT9ry"},{"type":"code","lang":"python","value":"    'date', 'open', 'high', 'low', 'close', 'rsi'                     # 原 dataframe\n    'date_1h', 'open_1h', 'high_1h', 'low_1h', 'close_1h', 'rsi_1h'   # informative dataframe","position":{"start":{"line":746,"column":1},"end":{"line":749,"column":1}},"key":"YYpFjWTnzr"}],"key":"SxlpbsDLZ6"},{"type":"admonition","kind":"important","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"自定义实现","position":{"start":{"line":753,"column":1},"end":{"line":753,"column":1}},"key":"Ulyz6ZYNOy"}],"key":"KQzNTcoMAE"},{"type":"paragraph","position":{"start":{"line":754,"column":1},"end":{"line":754,"column":1}},"children":[{"type":"text","value":"可自定义实现如下：","position":{"start":{"line":754,"column":1},"end":{"line":754,"column":1}},"key":"JzReZ3uw9C"}],"key":"x7B3J1OVJb"},{"type":"code","lang":"python","value":"    # 日期右移 1 根K线\n    # This is necessary since the data is always the \"open date\"\n    # and a 15m candle starting at 12:15 should not know the close of the 1h candle from 12:00 to 13:00\n    minutes = timeframe_to_minutes(inf_tf)\n    # Only do this if the timeframes are different:\n    informative['date_merge'] = informative[\"date\"] + pd.to_timedelta(minutes, 'm')\n\n    # Rename columns to be unique\n    informative.columns = [f\"{col}_{inf_tf}\" for col in informative.columns]\n    # Assuming inf_tf = '1d' - then the columns will now be:\n    # date_1d, open_1d, high_1d, low_1d, close_1d, rsi_1d\n\n    # Combine the 2 dataframes\n    # all indicators on the informative sample MUST be calculated before this point\n    dataframe = pd.merge(dataframe, informative, left_on='date', right_on=f'date_merge_{inf_tf}', how='left')\n    # FFill to have the 1d value available in every row throughout the day.\n    # Without this, comparisons would only work once per day.\n    dataframe = dataframe.ffill()","position":{"start":{"line":756,"column":1},"end":{"line":775,"column":1}},"key":"dHLyqDf8jQ"}],"key":"UutAVxbdV7"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"informative 周期 < 主周期","position":{"start":{"line":778,"column":1},"end":{"line":778,"column":1}},"key":"ygRhzPhsXK"}],"key":"JnhpEGGETV"},{"type":"paragraph","position":{"start":{"line":779,"column":1},"end":{"line":779,"column":1}},"children":[{"type":"text","value":"用本方法时，不建议 informative 周期小于主 dataframe 周期，否则无法利用更多细节。若需用更细粒度信息，需用更高级方法（超出本文档范围）。","position":{"start":{"line":779,"column":1},"end":{"line":779,"column":1}},"key":"bcGhRqjw56"}],"key":"x8MjVgFnDF"}],"key":"SK8cOfRdwF"},{"type":"heading","depth":3,"position":{"start":{"line":782,"column":1},"end":{"line":782,"column":1}},"children":[{"type":"text","value":"额外数据（DataProvider）","position":{"start":{"line":782,"column":1},"end":{"line":782,"column":1}},"key":"QBEUn5KiZc"}],"identifier":"id-dataprovider","label":"额外数据（DataProvider）","html_id":"id-dataprovider","implicit":true,"key":"QYslAyz9xe"},{"type":"paragraph","position":{"start":{"line":784,"column":1},"end":{"line":784,"column":1}},"children":[{"type":"text","value":"策略可通过 ","position":{"start":{"line":784,"column":1},"end":{"line":784,"column":1}},"key":"Lw7i636ZNQ"},{"type":"inlineCode","value":"DataProvider","position":{"start":{"line":784,"column":1},"end":{"line":784,"column":1}},"key":"yRWqg4GEhX"},{"type":"text","value":" 获取更多数据。","position":{"start":{"line":784,"column":1},"end":{"line":784,"column":1}},"key":"TK9KgJF5Ip"}],"key":"pxcKgsYWax"},{"type":"paragraph","position":{"start":{"line":786,"column":1},"end":{"line":786,"column":1}},"children":[{"type":"text","value":"所有方法失败时返回 None，不抛异常。","position":{"start":{"line":786,"column":1},"end":{"line":786,"column":1}},"key":"Y91UmyCz4e"}],"key":"IB2ue8fuN2"},{"type":"paragraph","position":{"start":{"line":788,"column":1},"end":{"line":788,"column":1}},"children":[{"type":"text","value":"请根据运行模式选择合适方法（见下文示例）。","position":{"start":{"line":788,"column":1},"end":{"line":788,"column":1}},"key":"OU8mTbspWI"}],"key":"dGtTYhTl8p"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"超参优化限制","position":{"start":{"line":790,"column":1},"end":{"line":790,"column":1}},"key":"kHFmGjLyH1"}],"key":"wY6Si55Mmf"},{"type":"paragraph","position":{"start":{"line":791,"column":1},"end":{"line":791,"column":1}},"children":[{"type":"text","value":"DataProvider 在超参优化时可用，但仅限于策略内的 ","position":{"start":{"line":791,"column":1},"end":{"line":791,"column":1}},"key":"Ewcsbd53Is"},{"type":"inlineCode","value":"populate_indicators()","position":{"start":{"line":791,"column":1},"end":{"line":791,"column":1}},"key":"KVPOL65Gp9"},{"type":"text","value":"，不可用于超参优化类文件。","position":{"start":{"line":791,"column":1},"end":{"line":791,"column":1}},"key":"BQ6bRgsp1K"}],"key":"yPW6ZKBXKm"},{"type":"paragraph","position":{"start":{"line":793,"column":1},"end":{"line":793,"column":1}},"children":[{"type":"text","value":"也不可用于 ","position":{"start":{"line":793,"column":1},"end":{"line":793,"column":1}},"key":"QmQhMrERpT"},{"type":"inlineCode","value":"populate_entry_trend()","position":{"start":{"line":793,"column":1},"end":{"line":793,"column":1}},"key":"SGYWzwKlnO"},{"type":"text","value":" 和 ","position":{"start":{"line":793,"column":1},"end":{"line":793,"column":1}},"key":"UfIOeJ1Q11"},{"type":"inlineCode","value":"populate_exit_trend()","position":{"start":{"line":793,"column":1},"end":{"line":793,"column":1}},"key":"ffYGb6mOcc"},{"type":"text","value":"。","position":{"start":{"line":793,"column":1},"end":{"line":793,"column":1}},"key":"zzht29GTnA"}],"key":"Z2DWhVyQlJ"}],"key":"Og29Tsyc5N"},{"type":"heading","depth":4,"position":{"start":{"line":796,"column":1},"end":{"line":796,"column":1}},"children":[{"type":"text","value":"DataProvider 可用方法","position":{"start":{"line":796,"column":1},"end":{"line":796,"column":1}},"key":"N2kvN9N0jz"}],"identifier":"dataprovider","label":"DataProvider 可用方法","html_id":"dataprovider","implicit":true,"key":"uELKq6Sgeg"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":798,"column":1},"end":{"line":808,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":798,"column":1},"end":{"line":798,"column":1}},"children":[{"type":"link","url":"#available_pairs","position":{"start":{"line":798,"column":1},"end":{"line":798,"column":1}},"children":[{"type":"inlineCode","value":"available_pairs","position":{"start":{"line":798,"column":1},"end":{"line":798,"column":1}},"key":"KHMy6ZbODL"}],"urlSource":"#available_pairs","key":"R1ZzJotySW"},{"type":"text","value":" - 返回缓存的所有对及其周期（pair, timeframe）元组","position":{"start":{"line":798,"column":1},"end":{"line":798,"column":1}},"key":"xrS8b0sDEm"}],"key":"d70XLJN39Y"},{"type":"listItem","spread":true,"position":{"start":{"line":799,"column":1},"end":{"line":799,"column":1}},"children":[{"type":"link","url":"#current_whitelist","position":{"start":{"line":799,"column":1},"end":{"line":799,"column":1}},"children":[{"type":"inlineCode","value":"current_whitelist()","position":{"start":{"line":799,"column":1},"end":{"line":799,"column":1}},"key":"o25325F0SF"}],"urlSource":"#current_whitelist","key":"k8S2HoGPXZ"},{"type":"text","value":" - 返回当前白名单对列表，适合动态白名单（如 VolumePairlist）","position":{"start":{"line":799,"column":1},"end":{"line":799,"column":1}},"key":"nAGZ3K8Vhe"}],"key":"cwCVS5TzGs"},{"type":"listItem","spread":true,"position":{"start":{"line":800,"column":1},"end":{"line":800,"column":1}},"children":[{"type":"link","url":"#get_pair_dataframepair-timeframe","position":{"start":{"line":800,"column":1},"end":{"line":800,"column":1}},"children":[{"type":"inlineCode","value":"get_pair_dataframe(pair, timeframe)","position":{"start":{"line":800,"column":1},"end":{"line":800,"column":1}},"key":"DYuRRPk18k"}],"urlSource":"#get_pair_dataframepair-timeframe","key":"jyWHpXOyaU"},{"type":"text","value":" - 通用方法，回测时返回历史数据，dry/live 时返回缓存数据","position":{"start":{"line":800,"column":1},"end":{"line":800,"column":1}},"key":"imFmQ29MyW"}],"key":"WDlasMPEX3"},{"type":"listItem","spread":true,"position":{"start":{"line":801,"column":1},"end":{"line":801,"column":1}},"children":[{"type":"link","url":"#get_analyzed_dataframepair-timeframe","position":{"start":{"line":801,"column":1},"end":{"line":801,"column":1}},"children":[{"type":"inlineCode","value":"get_analyzed_dataframe(pair, timeframe)","position":{"start":{"line":801,"column":1},"end":{"line":801,"column":1}},"key":"W1F0eyYX2U"}],"urlSource":"#get_analyzed_dataframepair-timeframe","key":"tDOzzk1d80"},{"type":"text","value":" - 返回分析后的 dataframe 及最新分析时间","position":{"start":{"line":801,"column":1},"end":{"line":801,"column":1}},"key":"G69ucRK1P1"}],"key":"QmBaAiiXNF"},{"type":"listItem","spread":true,"position":{"start":{"line":802,"column":1},"end":{"line":802,"column":1}},"children":[{"type":"inlineCode","value":"historic_ohlcv(pair, timeframe)","position":{"start":{"line":802,"column":1},"end":{"line":802,"column":1}},"key":"QCnX01fpev"},{"type":"text","value":" - 返回磁盘上的历史数据","position":{"start":{"line":802,"column":1},"end":{"line":802,"column":1}},"key":"tM0P5GCSVC"}],"key":"xMTJJXHICt"},{"type":"listItem","spread":true,"position":{"start":{"line":803,"column":1},"end":{"line":803,"column":1}},"children":[{"type":"inlineCode","value":"market(pair)","position":{"start":{"line":803,"column":1},"end":{"line":803,"column":1}},"key":"m6PeNTcsPG"},{"type":"text","value":" - 返回交易对市场数据（手续费、限额、精度、活跃标志等）","position":{"start":{"line":803,"column":1},"end":{"line":803,"column":1}},"key":"Y4MzDgMvNH"}],"key":"hPxy5GuXkR"},{"type":"listItem","spread":true,"position":{"start":{"line":804,"column":1},"end":{"line":804,"column":1}},"children":[{"type":"inlineCode","value":"ohlcv(pair, timeframe)","position":{"start":{"line":804,"column":1},"end":{"line":804,"column":1}},"key":"zST9yGowfq"},{"type":"text","value":" - 返回当前缓存的K线数据","position":{"start":{"line":804,"column":1},"end":{"line":804,"column":1}},"key":"aTaDlJOkuH"}],"key":"PktK2XrWME"},{"type":"listItem","spread":true,"position":{"start":{"line":805,"column":1},"end":{"line":805,"column":1}},"children":[{"type":"link","url":"#orderbookpair-maximum","position":{"start":{"line":805,"column":1},"end":{"line":805,"column":1}},"children":[{"type":"inlineCode","value":"orderbook(pair, maximum)","position":{"start":{"line":805,"column":1},"end":{"line":805,"column":1}},"key":"XCdQMfnmZF"}],"urlSource":"#orderbookpair-maximum","key":"gzMdoWsPVh"},{"type":"text","value":" - 返回最新 orderbook 数据（bids/asks）","position":{"start":{"line":805,"column":1},"end":{"line":805,"column":1}},"key":"T6JYJmzHVS"}],"key":"zMEv8RYHFL"},{"type":"listItem","spread":true,"position":{"start":{"line":806,"column":1},"end":{"line":806,"column":1}},"children":[{"type":"link","url":"#tickerpair","position":{"start":{"line":806,"column":1},"end":{"line":806,"column":1}},"children":[{"type":"inlineCode","value":"ticker(pair)","position":{"start":{"line":806,"column":1},"end":{"line":806,"column":1}},"key":"iGym2pD76V"}],"urlSource":"#tickerpair","key":"afjF7Fk7UK"},{"type":"text","value":" - 返回当前 ticker 数据","position":{"start":{"line":806,"column":1},"end":{"line":806,"column":1}},"key":"vGDOCtfTSK"}],"key":"qbxa96HVY3"},{"type":"listItem","spread":true,"position":{"start":{"line":807,"column":1},"end":{"line":808,"column":1}},"children":[{"type":"inlineCode","value":"runmode","position":{"start":{"line":807,"column":1},"end":{"line":807,"column":1}},"key":"gcIotPBb3x"},{"type":"text","value":" - 当前运行模式","position":{"start":{"line":807,"column":1},"end":{"line":807,"column":1}},"key":"jEs4f1sOdc"}],"key":"FuKZbGmZTA"}],"key":"IotgIfXeyK"},{"type":"heading","depth":4,"position":{"start":{"line":809,"column":1},"end":{"line":809,"column":1}},"children":[{"type":"text","value":"示例用法","position":{"start":{"line":809,"column":1},"end":{"line":809,"column":1}},"key":"sdCGPTec55"}],"identifier":"id","label":"示例用法","html_id":"id-16","implicit":true,"key":"OhMq246nqh"},{"type":"heading","depth":4,"position":{"start":{"line":811,"column":1},"end":{"line":811,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":811,"column":1},"end":{"line":811,"column":1}},"children":[{"type":"text","value":"available_pairs","position":{"start":{"line":811,"column":1},"end":{"line":811,"column":1}},"key":"FNYfvKIzuZ"}],"key":"WsqwZIHswS"}],"identifier":"available-pairs","label":"available_pairs","html_id":"available-pairs","implicit":true,"key":"QBdVkilxG3"},{"type":"code","lang":"python","value":"for pair, timeframe in self.dp.available_pairs:\n    print(f\"available {pair}, {timeframe}\")","position":{"start":{"line":813,"column":1},"end":{"line":816,"column":1}},"key":"Uqb5I7SRj2"},{"type":"heading","depth":4,"position":{"start":{"line":818,"column":1},"end":{"line":818,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":818,"column":1},"end":{"line":818,"column":1}},"children":[{"type":"text","value":"current_whitelist()","position":{"start":{"line":818,"column":1},"end":{"line":818,"column":1}},"key":"VeBmxIDJeO"}],"key":"QrTxYDjW5W"}],"identifier":"current-whitelist","label":"current_whitelist()","html_id":"current-whitelist","implicit":true,"key":"FcViiDkk2e"},{"type":"paragraph","position":{"start":{"line":820,"column":1},"end":{"line":820,"column":1}},"children":[{"type":"text","value":"假设你开发了一个用 ","position":{"start":{"line":820,"column":1},"end":{"line":820,"column":1}},"key":"SvXRhZBNJm"},{"type":"inlineCode","value":"5m","position":{"start":{"line":820,"column":1},"end":{"line":820,"column":1}},"key":"FYMmDYBGno"},{"type":"text","value":" 周期、用 ","position":{"start":{"line":820,"column":1},"end":{"line":820,"column":1}},"key":"eQ1wyrZauc"},{"type":"inlineCode","value":"1d","position":{"start":{"line":820,"column":1},"end":{"line":820,"column":1}},"key":"dOGaiQ8u7B"},{"type":"text","value":" 周期信号的策略，且用 VolumePairList 动态选前 10 个交易对。","position":{"start":{"line":820,"column":1},"end":{"line":820,"column":1}},"key":"u3aKBlNG1e"}],"key":"PrW0tk9v61"},{"type":"paragraph","position":{"start":{"line":822,"column":1},"end":{"line":822,"column":1}},"children":[{"type":"text","value":"策略逻辑如下：","position":{"start":{"line":822,"column":1},"end":{"line":822,"column":1}},"key":"SjAs4kNFrm"}],"key":"aaSLIBOnUg"},{"type":"paragraph","position":{"start":{"line":824,"column":1},"end":{"line":824,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":824,"column":1},"end":{"line":824,"column":1}},"children":[{"type":"text","value":"每 5 分钟扫描前 10 个交易对，用 14 日 RSI 生成信号。","position":{"start":{"line":824,"column":1},"end":{"line":824,"column":1}},"key":"rSZLsmkltd"}],"key":"gzhXqzwoqP"}],"key":"nyl77PnF6q"},{"type":"paragraph","position":{"start":{"line":826,"column":1},"end":{"line":826,"column":1}},"children":[{"type":"text","value":"因数据有限，无法用 5m K 线重采样成日线。大多数交易所只给 500-1000 根K线，约等于 1.74 天。我们需要至少 14 天！","position":{"start":{"line":826,"column":1},"end":{"line":826,"column":1}},"key":"y7ytoTj0UN"}],"key":"cNd577Las2"},{"type":"paragraph","position":{"start":{"line":828,"column":1},"end":{"line":828,"column":1}},"children":[{"type":"text","value":"因此需用 informative pair，且因白名单动态变化，不知用哪些对！","position":{"start":{"line":828,"column":1},"end":{"line":828,"column":1}},"key":"Ot0yGKKX0L"}],"key":"jNTiMBO3Gv"},{"type":"paragraph","position":{"start":{"line":830,"column":1},"end":{"line":830,"column":1}},"children":[{"type":"text","value":"此时可用 ","position":{"start":{"line":830,"column":1},"end":{"line":830,"column":1}},"key":"OeIsdXwK0h"},{"type":"inlineCode","value":"self.dp.current_whitelist()","position":{"start":{"line":830,"column":1},"end":{"line":830,"column":1}},"key":"HyogxV8Lea"},{"type":"text","value":" 获取当前白名单对。","position":{"start":{"line":830,"column":1},"end":{"line":830,"column":1}},"key":"kBuZjLyqU4"}],"key":"hFQSnhbpbX"},{"type":"code","lang":"python","value":"    def informative_pairs(self):\n\n        # 获取白名单所有对\n        pairs = self.dp.current_whitelist()\n        # 为每个对分配周期\n        informative_pairs = [(pair, '1d') for pair in pairs]\n        return informative_pairs","position":{"start":{"line":832,"column":1},"end":{"line":840,"column":1}},"key":"RAJoLVvl8j"},{"type":"admonition","kind":"caution","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"current_whitelist 用于绘图","position":{"start":{"line":842,"column":1},"end":{"line":842,"column":1}},"key":"zzG3QFUJB2"}],"key":"XBsu1EcO8o"},{"type":"paragraph","position":{"start":{"line":843,"column":1},"end":{"line":843,"column":1}},"children":[{"type":"text","value":"current_whitelist 不支持 ","position":{"start":{"line":843,"column":1},"end":{"line":843,"column":1}},"key":"j4E2zXzvYX"},{"type":"inlineCode","value":"plot-dataframe","position":{"start":{"line":843,"column":1},"end":{"line":843,"column":1}},"key":"XHG2J51Ywe"},{"type":"text","value":"，也不支持 FreqUI 可视化（webserver 模式），因 webserver 配置无需白名单。","position":{"start":{"line":843,"column":1},"end":{"line":843,"column":1}},"key":"gPMMDKbygC"}],"key":"iCxoQUTrc8"}],"key":"oW8cyAWb1w"},{"type":"heading","depth":4,"position":{"start":{"line":846,"column":1},"end":{"line":846,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":846,"column":1},"end":{"line":846,"column":1}},"children":[{"type":"text","value":"get_pair_dataframe(pair, timeframe)","position":{"start":{"line":846,"column":1},"end":{"line":846,"column":1}},"key":"jYbfiCAI4H"}],"key":"i1NkAdyV1N"}],"identifier":"get-pair-dataframe-pair-timeframe","label":"get_pair_dataframe(pair, timeframe)","html_id":"get-pair-dataframe-pair-timeframe","implicit":true,"key":"AGSAuC7KeM"},{"type":"code","lang":"python","value":"# 获取第一个 informative pair 的K线数据\ninf_pair, inf_timeframe = self.informative_pairs()[0]\ninformative = self.dp.get_pair_dataframe(pair=inf_pair,\n                                         timeframe=inf_timeframe)","position":{"start":{"line":848,"column":1},"end":{"line":853,"column":1}},"key":"V5mPaGcMLW"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"回测注意","position":{"start":{"line":855,"column":1},"end":{"line":855,"column":1}},"key":"xDkU9iwDGX"}],"key":"qU8iUYqQ2X"},{"type":"paragraph","position":{"start":{"line":856,"column":1},"end":{"line":856,"column":1}},"children":[{"type":"text","value":"回测时，","position":{"start":{"line":856,"column":1},"end":{"line":856,"column":1}},"key":"iH6plHn2wU"},{"type":"inlineCode","value":"dp.get_pair_dataframe()","position":{"start":{"line":856,"column":1},"end":{"line":856,"column":1}},"key":"pGhhslrqR4"},{"type":"text","value":" 在 ","position":{"start":{"line":856,"column":1},"end":{"line":856,"column":1}},"key":"aYO9PbzXZZ"},{"type":"inlineCode","value":"populate_*()","position":{"start":{"line":856,"column":1},"end":{"line":856,"column":1}},"key":"imacy7mowe"},{"type":"text","value":" 方法中返回完整时间区间。请勿\"看未来\"，否则 dry/live 时会有意外。","position":{"start":{"line":856,"column":1},"end":{"line":856,"column":1}},"key":"zRAffgZ10r"}],"key":"xifnMzJemK"},{"type":"paragraph","position":{"start":{"line":858,"column":1},"end":{"line":858,"column":1}},"children":[{"type":"text","value":"在 ","position":{"start":{"line":858,"column":1},"end":{"line":858,"column":1}},"key":"QbCgja1o1z"},{"type":"link","url":"/strategy-callbacks","position":{"start":{"line":858,"column":1},"end":{"line":858,"column":1}},"children":[{"type":"text","value":"回调函数","position":{"start":{"line":858,"column":1},"end":{"line":858,"column":1}},"key":"Lgn7zPanyg"}],"urlSource":"strategy-callbacks.md","dataUrl":"/strategy-callbacks.json","internal":true,"protocol":"file","key":"Xp8fBeFxpE"},{"type":"text","value":" 中，则只返回当前（模拟）K线前的数据。","position":{"start":{"line":858,"column":1},"end":{"line":858,"column":1}},"key":"M2G1X0hTKu"}],"key":"BdoVOt8G2V"}],"key":"EbzfT1c5la"},{"type":"heading","depth":4,"position":{"start":{"line":861,"column":1},"end":{"line":861,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":861,"column":1},"end":{"line":861,"column":1}},"children":[{"type":"text","value":"get_analyzed_dataframe(pair, timeframe)","position":{"start":{"line":861,"column":1},"end":{"line":861,"column":1}},"key":"gGiAI1aA1I"}],"key":"pNhy1d9iql"}],"identifier":"get-analyzed-dataframe-pair-timeframe","label":"get_analyzed_dataframe(pair, timeframe)","html_id":"get-analyzed-dataframe-pair-timeframe","implicit":true,"key":"znoDriEtXH"},{"type":"paragraph","position":{"start":{"line":863,"column":1},"end":{"line":863,"column":1}},"children":[{"type":"text","value":"该方法供 freqtrade 内部用来判断最后信号，也可在特定回调中用来获取触发操作的信号（见","position":{"start":{"line":863,"column":1},"end":{"line":863,"column":1}},"key":"fKJOSUJdX1"},{"type":"link","url":"/strategy-advanced","position":{"start":{"line":863,"column":1},"end":{"line":863,"column":1}},"children":[{"type":"text","value":"高级策略文档","position":{"start":{"line":863,"column":1},"end":{"line":863,"column":1}},"key":"oTTcA1iL6H"}],"urlSource":"strategy-advanced.md","dataUrl":"/strategy-advanced.json","internal":true,"protocol":"file","key":"H0gx2T246K"},{"type":"text","value":"）。","position":{"start":{"line":863,"column":1},"end":{"line":863,"column":1}},"key":"LLaVxMBRsF"}],"key":"yVW8nilXUk"},{"type":"code","lang":"python","value":"# 获取当前 dataframe\ndataframe, last_updated = self.dp.get_analyzed_dataframe(pair=metadata['pair'],\n                                                         timeframe=self.timeframe)","position":{"start":{"line":865,"column":1},"end":{"line":869,"column":1}},"key":"AuyouSChUk"},{"type":"admonition","kind":"caution","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"无数据","position":{"start":{"line":871,"column":1},"end":{"line":871,"column":1}},"key":"DEx0R4gdeK"}],"key":"hGBWDHePQ5"},{"type":"paragraph","position":{"start":{"line":872,"column":1},"end":{"line":872,"column":1}},"children":[{"type":"text","value":"若请求的对未缓存，返回空 dataframe。可用 ","position":{"start":{"line":872,"column":1},"end":{"line":872,"column":1}},"key":"dyPRDzxPpT"},{"type":"inlineCode","value":"if dataframe.empty:","position":{"start":{"line":872,"column":1},"end":{"line":872,"column":1}},"key":"rZQcHbG7YV"},{"type":"text","value":" 检查。","position":{"start":{"line":872,"column":1},"end":{"line":872,"column":1}},"key":"dpWJKHlnBT"}],"key":"xomAktrA4R"}],"key":"gcQRotFVex"},{"type":"heading","depth":4,"position":{"start":{"line":875,"column":1},"end":{"line":875,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":875,"column":1},"end":{"line":875,"column":1}},"children":[{"type":"text","value":"orderbook(pair, maximum)","position":{"start":{"line":875,"column":1},"end":{"line":875,"column":1}},"key":"M6aj776yyM"}],"key":"KIZpUs9vPO"}],"identifier":"orderbook-pair-maximum","label":"orderbook(pair, maximum)","html_id":"orderbook-pair-maximum","implicit":true,"key":"lkt7I2Nptd"},{"type":"code","lang":"python","value":"if self.dp.runmode.value in ('live', 'dry_run'):\n    ob = self.dp.orderbook(metadata['pair'], 1)\n    dataframe['best_bid'] = ob['bids'][0][0]\n    dataframe['best_ask'] = ob['asks'][0][0]","position":{"start":{"line":877,"column":1},"end":{"line":882,"column":1}},"key":"k2C17KAlip"},{"type":"paragraph","position":{"start":{"line":884,"column":1},"end":{"line":884,"column":1}},"children":[{"type":"text","value":"orderbook 结构与 ","position":{"start":{"line":884,"column":1},"end":{"line":884,"column":1}},"key":"dCOXQMe0vU"},{"type":"link","url":"https://github.com/ccxt/ccxt/wiki/Manual#order-book-structure","position":{"start":{"line":884,"column":1},"end":{"line":884,"column":1}},"children":[{"type":"text","value":"ccxt","position":{"start":{"line":884,"column":1},"end":{"line":884,"column":1}},"key":"tQChBtVBgI"}],"urlSource":"https://github.com/ccxt/ccxt/wiki/Manual#order-book-structure","error":true,"key":"qanBoCv6cu"},{"type":"text","value":" 一致：","position":{"start":{"line":884,"column":1},"end":{"line":884,"column":1}},"key":"YPn0O7Ss4d"}],"key":"XMiEQAJYBO"},{"type":"code","lang":"js","value":"{\n    'bids': [\n        [ price, amount ],\n        ...\n    ],\n    'asks': [\n        [ price, amount ],\n        ...\n    ],\n}","position":{"start":{"line":886,"column":1},"end":{"line":897,"column":1}},"key":"TdYAMiUxqf"},{"type":"paragraph","position":{"start":{"line":899,"column":1},"end":{"line":899,"column":1}},"children":[{"type":"text","value":"用 ","position":{"start":{"line":899,"column":1},"end":{"line":899,"column":1}},"key":"PWNpT8AzbL"},{"type":"inlineCode","value":"ob['bids'][0][0]","position":{"start":{"line":899,"column":1},"end":{"line":899,"column":1}},"key":"XvHTGBUwEb"},{"type":"text","value":" 可取最优买价，","position":{"start":{"line":899,"column":1},"end":{"line":899,"column":1}},"key":"V1FGWWZS74"},{"type":"inlineCode","value":"ob['bids'][0][1]","position":{"start":{"line":899,"column":1},"end":{"line":899,"column":1}},"key":"HA2jjMQWJr"},{"type":"text","value":" 为该价位数量。","position":{"start":{"line":899,"column":1},"end":{"line":899,"column":1}},"key":"lH2j8hZbUy"}],"key":"saif3tNs1s"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"回测注意","position":{"start":{"line":901,"column":1},"end":{"line":901,"column":1}},"key":"TVP4oonUfa"}],"key":"hgGsnbDLVN"},{"type":"paragraph","position":{"start":{"line":902,"column":1},"end":{"line":902,"column":1}},"children":[{"type":"text","value":"订单簿不是历史数据的一部分，这意味着如果使用此方法，回测和超参数优化将无法正常工作，因为该方法将返回最新值。","position":{"start":{"line":902,"column":1},"end":{"line":902,"column":1}},"key":"LesPWy64eh"}],"key":"UUEq3boH5f"}],"key":"KMJ07nbyjV"},{"type":"heading","depth":4,"position":{"start":{"line":905,"column":1},"end":{"line":905,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":905,"column":1},"end":{"line":905,"column":1}},"children":[{"type":"text","value":"ticker(pair)","position":{"start":{"line":905,"column":1},"end":{"line":905,"column":1}},"key":"aXZYdwofYA"}],"key":"coUwhzbcL7"}],"identifier":"ticker-pair","label":"ticker(pair)","html_id":"ticker-pair","implicit":true,"key":"kqf4NzNVLx"},{"type":"code","lang":"python","value":"if self.dp.runmode.value in ('live', 'dry_run'):\n    ticker = self.dp.ticker(metadata['pair'])\n    dataframe['last_price'] = ticker['last']\n    dataframe['volume24h'] = ticker['quoteVolume']\n    dataframe['vwap'] = ticker['vwap']","position":{"start":{"line":907,"column":1},"end":{"line":913,"column":1}},"key":"CJL0jPeFUG"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"p1YiYkm8qk"}],"key":"dv3DRotUOx"},{"type":"paragraph","position":{"start":{"line":916,"column":1},"end":{"line":916,"column":1}},"children":[{"type":"text","value":"虽然 ticker 数据结构是 ccxt 统一接口的一部分，但不同交易所返回的值可能会有所不同。例如，许多交易所不返回 ","position":{"start":{"line":916,"column":1},"end":{"line":916,"column":1}},"key":"lVrg9oZI4a"},{"type":"inlineCode","value":"vwap","position":{"start":{"line":916,"column":1},"end":{"line":916,"column":1}},"key":"TdnA5OH2F3"},{"type":"text","value":" 值，一些交易所并不总是填充 ","position":{"start":{"line":916,"column":1},"end":{"line":916,"column":1}},"key":"THW1eQmrH1"},{"type":"inlineCode","value":"last","position":{"start":{"line":916,"column":1},"end":{"line":916,"column":1}},"key":"QvGmTbxiXy"},{"type":"text","value":" 字段（所以它可能为 None）等。因此，您需要仔细验证从交易所返回的 ticker 数据，并添加适当的错误处理/默认值。","position":{"start":{"line":916,"column":1},"end":{"line":916,"column":1}},"key":"YbMPvd1LoC"}],"key":"V9Rga5cG67"}],"key":"hxMMsHXV0a"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"回测警告","position":{"start":{"line":919,"column":1},"end":{"line":919,"column":1}},"key":"I4M37TAtBL"}],"key":"tRkB3Ek5pY"},{"type":"paragraph","position":{"start":{"line":920,"column":1},"end":{"line":920,"column":1}},"children":[{"type":"text","value":"此方法将始终返回最新/实时值。因此，在回测/超参数优化期间使用而不检查运行模式将导致错误的结果，例如，您的整个 dataframe 将在所有行中包含相同的单个值。","position":{"start":{"line":920,"column":1},"end":{"line":920,"column":1}},"key":"RTEqaeKJHY"}],"key":"RAQazeLTnx"}],"key":"VT4urDC7r0"},{"type":"heading","depth":4,"position":{"start":{"line":923,"column":1},"end":{"line":923,"column":1}},"children":[{"type":"text","value":"发送通知","position":{"start":{"line":923,"column":1},"end":{"line":923,"column":1}},"key":"JDgHhUZSD3"}],"identifier":"id","label":"发送通知","html_id":"id-17","implicit":true,"key":"HOEvULMN4I"},{"type":"paragraph","position":{"start":{"line":925,"column":1},"end":{"line":926,"column":1}},"children":[{"type":"text","value":"dataprovider 的 ","position":{"start":{"line":925,"column":1},"end":{"line":925,"column":1}},"key":"Cyj6O2Mtsu"},{"type":"inlineCode","value":".send_msg()","position":{"start":{"line":925,"column":1},"end":{"line":925,"column":1}},"key":"y6e9gWDBRB"},{"type":"text","value":" 可在策略中发送自定义通知。\n相同的通知在每个蜡烛图期间只会发送一次，除非第二个参数（","position":{"start":{"line":925,"column":1},"end":{"line":925,"column":1}},"key":"xxA4o0iXev"},{"type":"inlineCode","value":"always_send","position":{"start":{"line":925,"column":1},"end":{"line":925,"column":1}},"key":"kjucdZx3IJ"},{"type":"text","value":"）设置为 True。","position":{"start":{"line":925,"column":1},"end":{"line":925,"column":1}},"key":"HszlYlW8br"}],"key":"uF6KRTMYbt"},{"type":"code","lang":"python","value":"    self.dp.send_msg(f\"{metadata['pair']} just got hot!\")\n\n    # 强制发送此通知，避免缓存（请阅读下面的警告！）\n    self.dp.send_msg(f\"{metadata['pair']} just got hot!\", always_send=True)","position":{"start":{"line":928,"column":1},"end":{"line":933,"column":1}},"key":"cBz4GUCcj3"},{"type":"paragraph","position":{"start":{"line":935,"column":1},"end":{"line":935,"column":1}},"children":[{"type":"text","value":"通知只会在交易模式（实盘/模拟盘）中发送 - 因此可以在回测中无条件调用此方法。","position":{"start":{"line":935,"column":1},"end":{"line":935,"column":1}},"key":"hFkzQpY7K7"}],"key":"TpiDUbneaw"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"消息轰炸","position":{"start":{"line":937,"column":1},"end":{"line":937,"column":1}},"key":"UfPtVpGUlE"}],"key":"LMjKjG5NSn"},{"type":"paragraph","position":{"start":{"line":938,"column":1},"end":{"line":938,"column":1}},"children":[{"type":"text","value":"通过在此方法中设置 ","position":{"start":{"line":938,"column":1},"end":{"line":938,"column":1}},"key":"gChZpSTP02"},{"type":"inlineCode","value":"always_send=True","position":{"start":{"line":938,"column":1},"end":{"line":938,"column":1}},"key":"dxJB23FsQq"},{"type":"text","value":"，您可能会给自己发送大量消息。请谨慎使用此功能，并且只在您知道不会在整个蜡烛图期间频繁触发的情况下使用，以避免每5秒就收到一条消息。","position":{"start":{"line":938,"column":1},"end":{"line":938,"column":1}},"key":"VR3Mla4L4N"}],"key":"x5F8tIIcTR"}],"key":"zc9682iHwk"},{"type":"heading","depth":4,"position":{"start":{"line":941,"column":1},"end":{"line":941,"column":1}},"children":[{"type":"text","value":"完整 DataProvider 示例","position":{"start":{"line":941,"column":1},"end":{"line":941,"column":1}},"key":"glc4STdQTL"}],"identifier":"id-dataprovider","label":"完整 DataProvider 示例","html_id":"id-dataprovider-1","implicit":true,"key":"BjDLw4jLay"},{"type":"code","lang":"python","value":"from freqtrade.strategy import IStrategy, merge_informative_pair\nfrom pandas import DataFrame\n\nclass SampleStrategy(IStrategy):\n    # 策略初始化...\n\n    timeframe = '5m'\n\n    # ...\n\n    def informative_pairs(self):\n\n        # 获取白名单所有对\n        pairs = self.dp.current_whitelist()\n        # 为每个对分配周期\n        informative_pairs = [(pair, '1d') for pair in pairs]\n        # 可选：添加静态对\n        informative_pairs += [(\"ETH/USDT\", \"5m\"),\n                              (\"BTC/TUSD\", \"15m\"),\n                            ]\n        return informative_pairs\n\n    def populate_indicators(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n        if not self.dp:\n            # DataProvider 不可用时不做任何操作\n            return dataframe\n\n        inf_tf = '1d'\n        # 获取信息对\n        informative = self.dp.get_pair_dataframe(pair=metadata['pair'], timeframe=inf_tf)\n        # 获取14天RSI\n        informative['rsi'] = ta.RSI(informative, timeperiod=14)\n\n        # 使用辅助函数 merge_informative_pair 安全地合并交易对\n        # 自动重命名列并合并较短时间周期的 dataframe 和较长时间周期的信息对\n        # 使用 ffill 使1天的值在一天中的每一行都可用\n        # 如果没有这个，原始数据框和信息对的列之间的比较每天只能进行一次\n        # 此方法的完整文档，见下文\n        dataframe = merge_informative_pair(dataframe, informative, self.timeframe, inf_tf, ffill=True)\n\n        # 计算原始数据框的RSI（5分钟时间周期）\n        dataframe['rsi'] = ta.RSI(dataframe, timeperiod=14)\n\n        # 其他操作\n        # ...\n\n        return dataframe\n\n    def populate_entry_trend(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n\n        dataframe.loc[\n            (\n                (qtpylib.crossed_above(dataframe['rsi'], 30)) &  # RSI 上穿 30\n                (dataframe['rsi_1d'] < 30) &                     # 日线 RSI < 30\n                (dataframe['volume'] > 0)                        # 有成交量\n            ),\n            ['enter_long', 'enter_tag']] = (1, 'rsi_cross')\n","position":{"start":{"line":943,"column":1},"end":{"line":1002,"column":1}},"key":"QGxMs2MXiD"},{"type":"thematicBreak","position":{"start":{"line":1004,"column":1},"end":{"line":1004,"column":1}},"key":"UHmiEMJyex"},{"type":"heading","depth":3,"position":{"start":{"line":1006,"column":1},"end":{"line":1006,"column":1}},"children":[{"type":"text","value":"额外数据（钱包 Wallets）","position":{"start":{"line":1006,"column":1},"end":{"line":1006,"column":1}},"key":"oc1yOJR9yP"}],"identifier":"id-wallets","label":"额外数据（钱包 Wallets）","html_id":"id-wallets","implicit":true,"key":"ESvNQlWOjz"},{"type":"paragraph","position":{"start":{"line":1008,"column":1},"end":{"line":1008,"column":1}},"children":[{"type":"text","value":"策略可通过 ","position":{"start":{"line":1008,"column":1},"end":{"line":1008,"column":1}},"key":"KVRksyuO9U"},{"type":"inlineCode","value":"wallets","position":{"start":{"line":1008,"column":1},"end":{"line":1008,"column":1}},"key":"qFF8TxHlq6"},{"type":"text","value":" 对象获取当前钱包/账户余额。","position":{"start":{"line":1008,"column":1},"end":{"line":1008,"column":1}},"key":"wGncqp9Fdd"}],"key":"lND8HOk0En"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"回测/超参优化","position":{"start":{"line":1010,"column":1},"end":{"line":1010,"column":1}},"key":"dcZLJxEEya"}],"key":"phpeubAAyW"},{"type":"paragraph","position":{"start":{"line":1011,"column":1},"end":{"line":1011,"column":1}},"children":[{"type":"text","value":"Wallets 在不同函数中表现不同。","position":{"start":{"line":1011,"column":1},"end":{"line":1011,"column":1}},"key":"oDDc7kjB5A"}],"key":"ekpXQZC04Z"},{"type":"paragraph","position":{"start":{"line":1013,"column":1},"end":{"line":1013,"column":1}},"children":[{"type":"text","value":"在 ","position":{"start":{"line":1013,"column":1},"end":{"line":1013,"column":1}},"key":"RudnMB3Xgu"},{"type":"inlineCode","value":"populate_*()","position":{"start":{"line":1013,"column":1},"end":{"line":1013,"column":1}},"key":"dWSZY3blKc"},{"type":"text","value":" 方法中，返回完整钱包。","position":{"start":{"line":1013,"column":1},"end":{"line":1013,"column":1}},"key":"LbdtrgeYvi"}],"key":"ms6tUG94qZ"},{"type":"paragraph","position":{"start":{"line":1015,"column":1},"end":{"line":1015,"column":1}},"children":[{"type":"text","value":"在 ","position":{"start":{"line":1015,"column":1},"end":{"line":1015,"column":1}},"key":"O3irZ4FRJ1"},{"type":"link","url":"/strategy-callbacks","position":{"start":{"line":1015,"column":1},"end":{"line":1015,"column":1}},"children":[{"type":"text","value":"回调函数","position":{"start":{"line":1015,"column":1},"end":{"line":1015,"column":1}},"key":"VEvC9C709U"}],"urlSource":"strategy-callbacks.md","dataUrl":"/strategy-callbacks.json","internal":true,"protocol":"file","key":"wL3hoJN8d0"},{"type":"text","value":" 中，返回当前模拟钱包状态。","position":{"start":{"line":1015,"column":1},"end":{"line":1015,"column":1}},"key":"KzXff9EPfW"}],"key":"XYGYKtHaKN"}],"key":"DyyOicwFud"},{"type":"paragraph","position":{"start":{"line":1018,"column":1},"end":{"line":1018,"column":1}},"children":[{"type":"text","value":"调用前请检查 ","position":{"start":{"line":1018,"column":1},"end":{"line":1018,"column":1}},"key":"z4xb97s33Z"},{"type":"inlineCode","value":"wallets","position":{"start":{"line":1018,"column":1},"end":{"line":1018,"column":1}},"key":"pRcdT3Gcat"},{"type":"text","value":" 是否可用，避免回测时报错。","position":{"start":{"line":1018,"column":1},"end":{"line":1018,"column":1}},"key":"ifb6TS9SU4"}],"key":"rjc1YYKmTr"},{"type":"code","lang":"python","value":"if self.wallets:\n    free_eth = self.wallets.get_free('ETH')\n    used_eth = self.wallets.get_used('ETH')\n    total_eth = self.wallets.get_total('ETH')","position":{"start":{"line":1020,"column":1},"end":{"line":1025,"column":1}},"key":"Rk92Jvjs6g"},{"type":"heading","depth":4,"position":{"start":{"line":1027,"column":1},"end":{"line":1027,"column":1}},"children":[{"type":"text","value":"Wallets 可用方法","position":{"start":{"line":1027,"column":1},"end":{"line":1027,"column":1}},"key":"llxE39FpBl"}],"identifier":"wallets","label":"Wallets 可用方法","html_id":"wallets","implicit":true,"key":"bO1Aa8FjpV"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1029,"column":1},"end":{"line":1032,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1029,"column":1},"end":{"line":1029,"column":1}},"children":[{"type":"inlineCode","value":"get_free(asset)","position":{"start":{"line":1029,"column":1},"end":{"line":1029,"column":1}},"key":"ywgoG2GovE"},{"type":"text","value":" - 当前可用余额","position":{"start":{"line":1029,"column":1},"end":{"line":1029,"column":1}},"key":"ElD0hntN4h"}],"key":"n2VT263AwV"},{"type":"listItem","spread":true,"position":{"start":{"line":1030,"column":1},"end":{"line":1030,"column":1}},"children":[{"type":"inlineCode","value":"get_used(asset)","position":{"start":{"line":1030,"column":1},"end":{"line":1030,"column":1}},"key":"kt1xBw1Pw3"},{"type":"text","value":" - 当前被占用余额（挂单）","position":{"start":{"line":1030,"column":1},"end":{"line":1030,"column":1}},"key":"Y7WVkeEEWS"}],"key":"akynQBVVzC"},{"type":"listItem","spread":true,"position":{"start":{"line":1031,"column":1},"end":{"line":1032,"column":1}},"children":[{"type":"inlineCode","value":"get_total(asset)","position":{"start":{"line":1031,"column":1},"end":{"line":1031,"column":1}},"key":"kLPlkcbhPj"},{"type":"text","value":" - 总余额（前两者之和）","position":{"start":{"line":1031,"column":1},"end":{"line":1031,"column":1}},"key":"YMGBxHJcaL"}],"key":"xxy8jJ1Ej0"}],"key":"hfrZr0tYrJ"},{"type":"thematicBreak","position":{"start":{"line":1033,"column":1},"end":{"line":1033,"column":1}},"key":"pyzuRbIrBm"},{"type":"heading","depth":3,"position":{"start":{"line":1035,"column":1},"end":{"line":1035,"column":1}},"children":[{"type":"text","value":"额外数据（交易记录 Trades）","position":{"start":{"line":1035,"column":1},"end":{"line":1035,"column":1}},"key":"AqeVg6LmqC"}],"identifier":"id-trades","label":"额外数据（交易记录 Trades）","html_id":"id-trades","implicit":true,"key":"tLsMLt8XyQ"},{"type":"paragraph","position":{"start":{"line":1037,"column":1},"end":{"line":1037,"column":1}},"children":[{"type":"text","value":"可在策略中通过数据库查询历史交易。","position":{"start":{"line":1037,"column":1},"end":{"line":1037,"column":1}},"key":"KIzM7w9uX5"}],"key":"oOmj7KeVYo"},{"type":"paragraph","position":{"start":{"line":1039,"column":1},"end":{"line":1039,"column":1}},"children":[{"type":"text","value":"在文件顶部，导入所需对象：","position":{"start":{"line":1039,"column":1},"end":{"line":1039,"column":1}},"key":"TLstaSn3b1"}],"key":"cDY45KAna5"},{"type":"code","lang":"python","value":"from freqtrade.persistence import Trade","position":{"start":{"line":1041,"column":1},"end":{"line":1043,"column":1}},"key":"EDfCwYgCW3"},{"type":"paragraph","position":{"start":{"line":1045,"column":1},"end":{"line":1045,"column":1}},"children":[{"type":"text","value":"以下示例查询当天当前对的已平仓交易（可加其他过滤条件）：","position":{"start":{"line":1045,"column":1},"end":{"line":1045,"column":1}},"key":"YIyPBJb4xY"}],"key":"KaY41hBGms"},{"type":"code","lang":"python","value":"trades = Trade.get_trades_proxy(pair=metadata['pair'],\n                                open_date=datetime.now(timezone.utc) - timedelta(days=1),\n                                is_open=False,\n            ]).order_by(Trade.close_date).all()\n# 汇总该交易对的利润\ncurdayprofit = sum(trade.close_profit for trade in trades)","position":{"start":{"line":1047,"column":1},"end":{"line":1054,"column":1}},"key":"quRw2NFyMa"},{"type":"paragraph","position":{"start":{"line":1056,"column":1},"end":{"line":1056,"column":1}},"children":[{"type":"text","value":"更多方法请查阅 ","position":{"start":{"line":1056,"column":1},"end":{"line":1056,"column":1}},"key":"YMPzyRXGP4"},{"type":"link","url":"/trade-object","position":{"start":{"line":1056,"column":1},"end":{"line":1056,"column":1}},"children":[{"type":"text","value":"Trade 对象","position":{"start":{"line":1056,"column":1},"end":{"line":1056,"column":1}},"key":"Wy1WWnAHVm"}],"urlSource":"trade-object.md","dataUrl":"/trade-object.json","internal":true,"protocol":"file","key":"kAcxCiV2PM"},{"type":"text","value":" 文档。","position":{"start":{"line":1056,"column":1},"end":{"line":1056,"column":1}},"key":"ojpmysJmWq"}],"key":"qMadBs3MaQ"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"uOrFMeJOCN"}],"key":"jbIHZitGXM"},{"type":"paragraph","position":{"start":{"line":1059,"column":1},"end":{"line":1059,"column":1}},"children":[{"type":"text","value":"回测/超参优化时，","position":{"start":{"line":1059,"column":1},"end":{"line":1059,"column":1}},"key":"ZlAfIuEJbO"},{"type":"inlineCode","value":"populate_*","position":{"start":{"line":1059,"column":1},"end":{"line":1059,"column":1}},"key":"PRQ1uHJJAA"},{"type":"text","value":" 方法中无法获取交易历史，结果为空。","position":{"start":{"line":1059,"column":1},"end":{"line":1059,"column":1}},"key":"UqIcvaJ5Di"}],"key":"TqhbVazppJ"}],"key":"OTDYSLk5ld"},{"type":"heading","depth":3,"position":{"start":{"line":1062,"column":1},"end":{"line":1062,"column":1}},"children":[{"type":"text","value":"阻止特定对交易","position":{"start":{"line":1062,"column":1},"end":{"line":1062,"column":1}},"key":"vYDllhCg7N"}],"identifier":"id","label":"阻止特定对交易","html_id":"id-18","implicit":true,"key":"OnSf7sunaC"},{"type":"paragraph","position":{"start":{"line":1064,"column":1},"end":{"line":1064,"column":1}},"children":[{"type":"text","value":"Freqtrade 会在某对平仓后自动锁定该对至当前K线结束，防止同一K线内频繁交易。","position":{"start":{"line":1064,"column":1},"end":{"line":1064,"column":1}},"key":"UYKokM26Ls"}],"key":"QM9mvlNirp"},{"type":"paragraph","position":{"start":{"line":1066,"column":1},"end":{"line":1066,"column":1}},"children":[{"type":"text","value":"锁定对时会提示 ","position":{"start":{"line":1066,"column":1},"end":{"line":1066,"column":1}},"key":"iaoO5lH3f2"},{"type":"inlineCode","value":"Pair <pair> is currently locked.","position":{"start":{"line":1066,"column":1},"end":{"line":1066,"column":1}},"key":"mZOG2plzwL"},{"type":"text","value":"。","position":{"start":{"line":1066,"column":1},"end":{"line":1066,"column":1}},"key":"lzDM8KlIIY"}],"key":"QIYVa7SvHU"},{"type":"heading","depth":4,"position":{"start":{"line":1068,"column":1},"end":{"line":1068,"column":1}},"children":[{"type":"text","value":"在策略中锁定对","position":{"start":{"line":1068,"column":1},"end":{"line":1068,"column":1}},"key":"la29Dy1I9D"}],"identifier":"id","label":"在策略中锁定对","html_id":"id-19","implicit":true,"key":"CGjOkAcrrv"},{"type":"paragraph","position":{"start":{"line":1070,"column":1},"end":{"line":1070,"column":1}},"children":[{"type":"text","value":"有时希望在特定事件后锁定某对（如连续亏损）。","position":{"start":{"line":1070,"column":1},"end":{"line":1070,"column":1}},"key":"gay1HJS3Fs"}],"key":"xwMCHbK5y8"},{"type":"paragraph","position":{"start":{"line":1072,"column":1},"end":{"line":1072,"column":1}},"children":[{"type":"text","value":"可用 ","position":{"start":{"line":1072,"column":1},"end":{"line":1072,"column":1}},"key":"LrxTvrKCh2"},{"type":"inlineCode","value":"self.lock_pair(pair, until, [reason])","position":{"start":{"line":1072,"column":1},"end":{"line":1072,"column":1}},"key":"YE6hL0BUe2"},{"type":"text","value":" 实现，","position":{"start":{"line":1072,"column":1},"end":{"line":1072,"column":1}},"key":"CkWbNdATqj"},{"type":"inlineCode","value":"until","position":{"start":{"line":1072,"column":1},"end":{"line":1072,"column":1}},"key":"t7Pig8vR9f"},{"type":"text","value":" 为未来时间点，","position":{"start":{"line":1072,"column":1},"end":{"line":1072,"column":1}},"key":"I3SNY71SNs"},{"type":"inlineCode","value":"reason","position":{"start":{"line":1072,"column":1},"end":{"line":1072,"column":1}},"key":"YUS8d9kKFc"},{"type":"text","value":" 为可选说明。","position":{"start":{"line":1072,"column":1},"end":{"line":1072,"column":1}},"key":"CcdNJqTO8X"}],"key":"ljsditeLhA"},{"type":"paragraph","position":{"start":{"line":1074,"column":1},"end":{"line":1074,"column":1}},"children":[{"type":"text","value":"可用 ","position":{"start":{"line":1074,"column":1},"end":{"line":1074,"column":1}},"key":"NmUWoqy2k9"},{"type":"inlineCode","value":"self.unlock_pair(pair)","position":{"start":{"line":1074,"column":1},"end":{"line":1074,"column":1}},"key":"U33ZVSA34x"},{"type":"text","value":" 或 ","position":{"start":{"line":1074,"column":1},"end":{"line":1074,"column":1}},"key":"i8XdomwUg1"},{"type":"inlineCode","value":"self.unlock_reason(<reason>)","position":{"start":{"line":1074,"column":1},"end":{"line":1074,"column":1}},"key":"xEjB35u8xY"},{"type":"text","value":" 手动解锁，后者会解锁所有因该原因锁定的对。","position":{"start":{"line":1074,"column":1},"end":{"line":1074,"column":1}},"key":"KDnZf2vVYl"}],"key":"g6lHhoelAr"},{"type":"paragraph","position":{"start":{"line":1076,"column":1},"end":{"line":1076,"column":1}},"children":[{"type":"text","value":"用 ","position":{"start":{"line":1076,"column":1},"end":{"line":1076,"column":1}},"key":"lXaTaZ7uHv"},{"type":"inlineCode","value":"self.is_pair_locked(pair)","position":{"start":{"line":1076,"column":1},"end":{"line":1076,"column":1}},"key":"hRqmXhKzRL"},{"type":"text","value":" 检查对是否被锁定。","position":{"start":{"line":1076,"column":1},"end":{"line":1076,"column":1}},"key":"IiwGzhmRLo"}],"key":"gQOyrCI4Tr"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"RlMqhp6bU9"}],"key":"r06Caf5MpY"},{"type":"paragraph","position":{"start":{"line":1079,"column":1},"end":{"line":1079,"column":1}},"children":[{"type":"text","value":"锁定会自动延长到下一个K线结束。如 5m 周期，锁到 10:18 会延长到 10:20。","position":{"start":{"line":1079,"column":1},"end":{"line":1079,"column":1}},"key":"LNZefJmQAR"}],"key":"FXhSQgNxyT"}],"key":"wTz3Bn2lsA"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"WJ07hBTDZK"}],"key":"rIXJz4TlSJ"},{"type":"paragraph","position":{"start":{"line":1083,"column":1},"end":{"line":1083,"column":1}},"children":[{"type":"text","value":"手动锁定仅在实盘/模拟盘可用，回测时仅保护机制可锁定。","position":{"start":{"line":1083,"column":1},"end":{"line":1083,"column":1}},"key":"YqqjbZfjvV"}],"key":"pvBoslQBQo"}],"key":"ei8b0cMz6p"},{"type":"heading","depth":5,"position":{"start":{"line":1086,"column":1},"end":{"line":1086,"column":1}},"children":[{"type":"text","value":"锁定对示例","position":{"start":{"line":1086,"column":1},"end":{"line":1086,"column":1}},"key":"XYvn0XN79I"}],"identifier":"id","label":"锁定对示例","html_id":"id-20","implicit":true,"key":"qI1pkVnAUG"},{"type":"code","lang":"python","value":"from freqtrade.persistence import Trade\nfrom datetime import timedelta, datetime, timezone\n# 放在策略文件顶部\n# --------\n\n# 在 populate_indicators 或 populate_entry_trend 中：\nif self.config['runmode'].value in ('live', 'dry_run'):\n    # 查询近两天已平仓交易\n    trades = Trade.get_trades_proxy(\n        pair=metadata['pair'], is_open=False, \n        open_date=datetime.now(timezone.utc) - timedelta(days=2))\n    # 分析是否需要锁定\n    sumprofit = sum(trade.close_profit for trade in trades)\n    if sumprofit < 0:\n        # 锁定 12 小时\n        self.lock_pair(metadata['pair'], until=datetime.now(timezone.utc) + timedelta(hours=12))","position":{"start":{"line":1088,"column":1},"end":{"line":1105,"column":1}},"key":"LOvyI7YZaI"},{"type":"heading","depth":3,"position":{"start":{"line":1107,"column":1},"end":{"line":1107,"column":1}},"children":[{"type":"text","value":"打印主 dataframe","position":{"start":{"line":1107,"column":1},"end":{"line":1107,"column":1}},"key":"t1k7qfHTX6"}],"identifier":"id-dataframe","label":"打印主 dataframe","html_id":"id-dataframe","implicit":true,"key":"Me8AQWNTS0"},{"type":"paragraph","position":{"start":{"line":1109,"column":1},"end":{"line":1109,"column":1}},"children":[{"type":"text","value":"可在 ","position":{"start":{"line":1109,"column":1},"end":{"line":1109,"column":1}},"key":"XFPZRZJd5r"},{"type":"inlineCode","value":"populate_entry_trend()","position":{"start":{"line":1109,"column":1},"end":{"line":1109,"column":1}},"key":"GMpOiXD9Y2"},{"type":"text","value":" 或 ","position":{"start":{"line":1109,"column":1},"end":{"line":1109,"column":1}},"key":"TOQHMg7a3Z"},{"type":"inlineCode","value":"populate_exit_trend()","position":{"start":{"line":1109,"column":1},"end":{"line":1109,"column":1}},"key":"v3vqi4pTXf"},{"type":"text","value":" 中打印当前主 dataframe，便于调试。","position":{"start":{"line":1109,"column":1},"end":{"line":1109,"column":1}},"key":"kEGLrmwDmG"}],"key":"Ip2NMJ0Nu0"},{"type":"code","lang":"python","value":"def populate_entry_trend(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n    dataframe.loc[\n        (\n            #>> 你的条件 <<<\n        ),\n        ['enter_long', 'enter_tag']] = (1, 'somestring')\n\n    # 打印分析的对\n    print(f\"result for {metadata['pair']}\")\n\n    # 打印最后 5 行\n    print(dataframe.tail())\n\n    return dataframe","position":{"start":{"line":1111,"column":1},"end":{"line":1126,"column":1}},"key":"gdQMm2yuBz"},{"type":"paragraph","position":{"start":{"line":1128,"column":1},"end":{"line":1128,"column":1}},"children":[{"type":"text","value":"如需打印更多行可用 ","position":{"start":{"line":1128,"column":1},"end":{"line":1128,"column":1}},"key":"xvmhigkR9p"},{"type":"inlineCode","value":"print(dataframe)","position":{"start":{"line":1128,"column":1},"end":{"line":1128,"column":1}},"key":"WzHRTciSaI"},{"type":"text","value":"，但不建议，否则每对每 5 秒会输出约 500 行。","position":{"start":{"line":1128,"column":1},"end":{"line":1128,"column":1}},"key":"XkkA0XPU0m"}],"key":"X29tvEigIX"},{"type":"heading","depth":3,"position":{"start":{"line":1130,"column":1},"end":{"line":1130,"column":1}},"children":[{"type":"text","value":"开发策略时的常见错误","position":{"start":{"line":1130,"column":1},"end":{"line":1130,"column":1}},"key":"fX4rfCGeqG"}],"identifier":"id","label":"开发策略时的常见错误","html_id":"id-21","implicit":true,"key":"d7SIAB3Suj"},{"type":"heading","depth":4,"position":{"start":{"line":1132,"column":1},"end":{"line":1132,"column":1}},"children":[{"type":"text","value":"回测时\"看未来\"","position":{"start":{"line":1132,"column":1},"end":{"line":1132,"column":1}},"key":"leZ216u9Sx"}],"identifier":"id","label":"回测时\"看未来\"","html_id":"id-22","implicit":true,"key":"pNoK3wVvXJ"},{"type":"paragraph","position":{"start":{"line":1134,"column":1},"end":{"line":1134,"column":1}},"children":[{"type":"text","value":"回测为提升性能会一次性分析整个 dataframe。策略作者需确保不\"看未来\"，即不使用 dry/live 时不可用的数据。","position":{"start":{"line":1134,"column":1},"end":{"line":1134,"column":1}},"key":"ZbosLQaWLg"}],"key":"ho0XNqFC2f"},{"type":"paragraph","position":{"start":{"line":1136,"column":1},"end":{"line":1136,"column":1}},"children":[{"type":"text","value":"这是常见痛点，易导致回测与 dry/live 巨大差异。看未来的策略回测时表现极佳，实盘却很差。","position":{"start":{"line":1136,"column":1},"end":{"line":1136,"column":1}},"key":"eEM1qwSX6a"}],"key":"vCzCVLxF5M"},{"type":"paragraph","position":{"start":{"line":1138,"column":1},"end":{"line":1138,"column":1}},"children":[{"type":"text","value":"常见错误包括：","position":{"start":{"line":1138,"column":1},"end":{"line":1138,"column":1}},"key":"vbWmGn3o2w"}],"key":"JOHFVTndPJ"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1140,"column":1},"end":{"line":1145,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1140,"column":1},"end":{"line":1140,"column":1}},"children":[{"type":"text","value":"不要用 ","position":{"start":{"line":1140,"column":1},"end":{"line":1140,"column":1}},"key":"axojkDk0x1"},{"type":"inlineCode","value":"shift(-1)","position":{"start":{"line":1140,"column":1},"end":{"line":1140,"column":1}},"key":"bvVuC1lDA7"},{"type":"text","value":" 或负数，这会用到未来数据","position":{"start":{"line":1140,"column":1},"end":{"line":1140,"column":1}},"key":"V68T8pwdXe"}],"key":"kenXClGssR"},{"type":"listItem","spread":true,"position":{"start":{"line":1141,"column":1},"end":{"line":1141,"column":1}},"children":[{"type":"text","value":"不要在 ","position":{"start":{"line":1141,"column":1},"end":{"line":1141,"column":1}},"key":"HsUnDfly42"},{"type":"inlineCode","value":"populate_","position":{"start":{"line":1141,"column":1},"end":{"line":1141,"column":1}},"key":"FeqHRM7b5n"},{"type":"text","value":" 函数中用 ","position":{"start":{"line":1141,"column":1},"end":{"line":1141,"column":1}},"key":"gZQzUSFUZS"},{"type":"inlineCode","value":".iloc[-1]","position":{"start":{"line":1141,"column":1},"end":{"line":1141,"column":1}},"key":"Xkadzl0Vks"},{"type":"text","value":" 或其他绝对位置，dry-run 和回测时表现不同。回调函数中可安全用 iloc","position":{"start":{"line":1141,"column":1},"end":{"line":1141,"column":1}},"key":"gh3NKv9xX4"}],"key":"ZKaZhJUsxW"},{"type":"listItem","spread":true,"position":{"start":{"line":1142,"column":1},"end":{"line":1142,"column":1}},"children":[{"type":"text","value":"不要用 ","position":{"start":{"line":1142,"column":1},"end":{"line":1142,"column":1}},"key":"q65tGx8m9F"},{"type":"inlineCode","value":"dataframe['mean_volume'] = dataframe['volume'].mean()","position":{"start":{"line":1142,"column":1},"end":{"line":1142,"column":1}},"key":"K5GAUZ0QOl"},{"type":"text","value":" 这类全列函数，回测时会用到未来数据。应用 rolling() 计算，如 ","position":{"start":{"line":1142,"column":1},"end":{"line":1142,"column":1}},"key":"tcZ8nexBTR"},{"type":"inlineCode","value":"dataframe['volume'].rolling(<window>).mean()","position":{"start":{"line":1142,"column":1},"end":{"line":1142,"column":1}},"key":"ZJ8MyKFXBo"}],"key":"ZLbSyiGaN7"},{"type":"listItem","spread":true,"position":{"start":{"line":1143,"column":1},"end":{"line":1143,"column":1}},"children":[{"type":"text","value":"不要用 ","position":{"start":{"line":1143,"column":1},"end":{"line":1143,"column":1}},"key":"JqeQfhZXnN"},{"type":"inlineCode","value":".resample('1h')","position":{"start":{"line":1143,"column":1},"end":{"line":1143,"column":1}},"key":"r0x0y9LSIr"},{"type":"text","value":"，这会用左边界，应用 ","position":{"start":{"line":1143,"column":1},"end":{"line":1143,"column":1}},"key":"YuGNnKbW5P"},{"type":"inlineCode","value":".resample('1h', label='right')","position":{"start":{"line":1143,"column":1},"end":{"line":1143,"column":1}},"key":"VbSbBmQKpQ"}],"key":"ptKgYdAWz8"},{"type":"listItem","spread":true,"position":{"start":{"line":1144,"column":1},"end":{"line":1145,"column":1}},"children":[{"type":"text","value":"不要用 ","position":{"start":{"line":1144,"column":1},"end":{"line":1144,"column":1}},"key":"nOGHSSW7aE"},{"type":"inlineCode","value":".merge()","position":{"start":{"line":1144,"column":1},"end":{"line":1144,"column":1}},"key":"Qy7nLL0Hge"},{"type":"text","value":" 合并大周期到小周期，应用 ","position":{"start":{"line":1144,"column":1},"end":{"line":1144,"column":1}},"key":"xtV01jBBcr"},{"type":"link","url":"#%E8%BE%85%E5%8A%A9%E4%BA%A4%E6%98%93%E5%AF%B9","position":{"start":{"line":1144,"column":1},"end":{"line":1144,"column":1}},"children":[{"type":"text","value":"informative pair","position":{"start":{"line":1144,"column":1},"end":{"line":1144,"column":1}},"key":"SvNT35DdSp"}],"urlSource":"#%E8%BE%85%E5%8A%A9%E4%BA%A4%E6%98%93%E5%AF%B9","key":"iQ40B7U9rJ"},{"type":"text","value":" 工具。普通 merge 会有前视偏差","position":{"start":{"line":1144,"column":1},"end":{"line":1144,"column":1}},"key":"T5k1sGXOX3"}],"key":"kTXjNYYtTw"}],"key":"c4ke5To8n9"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"如何发现问题","position":{"start":{"line":1146,"column":1},"end":{"line":1146,"column":1}},"key":"i4u7BggOVS"}],"key":"q3UZuV6U5R"},{"type":"paragraph","position":{"start":{"line":1147,"column":1},"end":{"line":1147,"column":1}},"children":[{"type":"text","value":"建议用 ","position":{"start":{"line":1147,"column":1},"end":{"line":1147,"column":1}},"key":"wlTRdaniEs"},{"type":"link","url":"/lookahead-analysis","position":{"start":{"line":1147,"column":1},"end":{"line":1147,"column":1}},"children":[{"type":"text","value":"lookahead-analysis","position":{"start":{"line":1147,"column":1},"end":{"line":1147,"column":1}},"key":"m8hR8zE1m5"}],"urlSource":"lookahead-analysis.md","dataUrl":"/lookahead-analysis.json","internal":true,"protocol":"file","key":"BIEuTCZlKX"},{"type":"text","value":" 和 ","position":{"start":{"line":1147,"column":1},"end":{"line":1147,"column":1}},"key":"VU4BjCkizj"},{"type":"link","url":"/recursive-analysis","position":{"start":{"line":1147,"column":1},"end":{"line":1147,"column":1}},"children":[{"type":"text","value":"recursive-analysis","position":{"start":{"line":1147,"column":1},"end":{"line":1147,"column":1}},"key":"Yez6Zl6DQi"}],"urlSource":"recursive-analysis.md","dataUrl":"/recursive-analysis.json","internal":true,"protocol":"file","key":"wUx9oCQfXv"},{"type":"text","value":" 两个工具辅助排查。","position":{"start":{"line":1147,"column":1},"end":{"line":1147,"column":1}},"key":"NBkzwvitEC"}],"key":"wUJ30ILaRT"},{"type":"paragraph","position":{"start":{"line":1149,"column":1},"end":{"line":1149,"column":1}},"children":[{"type":"text","value":"但两者都不能保证完全无误。","position":{"start":{"line":1149,"column":1},"end":{"line":1149,"column":1}},"key":"IRmJfVqev2"}],"key":"khX89eU9l4"}],"key":"PD7nPc4KTe"},{"type":"heading","depth":4,"position":{"start":{"line":1152,"column":1},"end":{"line":1152,"column":1}},"children":[{"type":"text","value":"信号冲突","position":{"start":{"line":1152,"column":1},"end":{"line":1152,"column":1}},"key":"CDaUdmv4Ii"}],"identifier":"id","label":"信号冲突","html_id":"id-23","implicit":true,"key":"iNo5nqZGW5"},{"type":"paragraph","position":{"start":{"line":1154,"column":1},"end":{"line":1154,"column":1}},"children":[{"type":"text","value":"当信号冲突（如 ","position":{"start":{"line":1154,"column":1},"end":{"line":1154,"column":1}},"key":"G9NITkYjcl"},{"type":"inlineCode","value":"enter_long","position":{"start":{"line":1154,"column":1},"end":{"line":1154,"column":1}},"key":"LU9i8PqclN"},{"type":"text","value":" 和 ","position":{"start":{"line":1154,"column":1},"end":{"line":1154,"column":1}},"key":"q7b2uJq5oD"},{"type":"inlineCode","value":"exit_long","position":{"start":{"line":1154,"column":1},"end":{"line":1154,"column":1}},"key":"x1Bc4VWzjx"},{"type":"text","value":" 同时为 1）时，freqtrade 会忽略入场信号，避免刚进场就立刻出场。","position":{"start":{"line":1154,"column":1},"end":{"line":1154,"column":1}},"key":"iWwheBGNvN"}],"key":"E6aJ3szUYJ"},{"type":"paragraph","position":{"start":{"line":1156,"column":1},"end":{"line":1156,"column":1}},"children":[{"type":"text","value":"规则如下，若 3 个信号中有多个为 1，则忽略入场：","position":{"start":{"line":1156,"column":1},"end":{"line":1156,"column":1}},"key":"fxl4t0evT3"}],"key":"Ff8e7b03Kr"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1158,"column":1},"end":{"line":1160,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1158,"column":1},"end":{"line":1158,"column":1}},"children":[{"type":"inlineCode","value":"enter_long","position":{"start":{"line":1158,"column":1},"end":{"line":1158,"column":1}},"key":"Cn6qarhcSN"},{"type":"text","value":" -> ","position":{"start":{"line":1158,"column":1},"end":{"line":1158,"column":1}},"key":"IFOOOxKcRT"},{"type":"inlineCode","value":"exit_long","position":{"start":{"line":1158,"column":1},"end":{"line":1158,"column":1}},"key":"AadmogLcvR"},{"type":"text","value":", ","position":{"start":{"line":1158,"column":1},"end":{"line":1158,"column":1}},"key":"ppIVHcb2zE"},{"type":"inlineCode","value":"enter_short","position":{"start":{"line":1158,"column":1},"end":{"line":1158,"column":1}},"key":"plZuYBBO8J"}],"key":"vRLEXV2RbT"},{"type":"listItem","spread":true,"position":{"start":{"line":1159,"column":1},"end":{"line":1160,"column":1}},"children":[{"type":"inlineCode","value":"enter_short","position":{"start":{"line":1159,"column":1},"end":{"line":1159,"column":1}},"key":"E088rJt0A4"},{"type":"text","value":" -> ","position":{"start":{"line":1159,"column":1},"end":{"line":1159,"column":1}},"key":"SVZvWpAQPG"},{"type":"inlineCode","value":"exit_short","position":{"start":{"line":1159,"column":1},"end":{"line":1159,"column":1}},"key":"ksxQAIskXI"},{"type":"text","value":", ","position":{"start":{"line":1159,"column":1},"end":{"line":1159,"column":1}},"key":"W27RONEewX"},{"type":"inlineCode","value":"enter_long","position":{"start":{"line":1159,"column":1},"end":{"line":1159,"column":1}},"key":"NHqv3djWYW"}],"key":"CQvfntyrKk"}],"key":"ANJuwVXUNY"},{"type":"heading","depth":3,"position":{"start":{"line":1161,"column":1},"end":{"line":1161,"column":1}},"children":[{"type":"text","value":"更多策略思路","position":{"start":{"line":1161,"column":1},"end":{"line":1161,"column":1}},"key":"Ei0hhRmcmQ"}],"identifier":"id","label":"更多策略思路","html_id":"id-24","implicit":true,"key":"rZZn5M9rzJ"},{"type":"paragraph","position":{"start":{"line":1163,"column":1},"end":{"line":1163,"column":1}},"children":[{"type":"text","value":"如需更多策略思路，请访问 ","position":{"start":{"line":1163,"column":1},"end":{"line":1163,"column":1}},"key":"l8i9RJr90M"},{"type":"link","url":"https://github.com/freqtrade/freqtrade-strategies","position":{"start":{"line":1163,"column":1},"end":{"line":1163,"column":1}},"children":[{"type":"text","value":"策略仓库","position":{"start":{"line":1163,"column":1},"end":{"line":1163,"column":1}},"key":"GlIacAOz5X"}],"urlSource":"https://github.com/freqtrade/freqtrade-strategies","error":true,"key":"CxQCC13khP"},{"type":"text","value":"。可作为学习参考，实际效果取决于市场、交易对等。请务必先回测，再 dry-run，谨慎实盘。","position":{"start":{"line":1163,"column":1},"end":{"line":1163,"column":1}},"key":"b5am9O7sKD"}],"key":"CloPB3Fgsf"},{"type":"paragraph","position":{"start":{"line":1165,"column":1},"end":{"line":1165,"column":1}},"children":[{"type":"text","value":"欢迎参考、改编，也欢迎向仓库提交新策略 PR。","position":{"start":{"line":1165,"column":1},"end":{"line":1165,"column":1}},"key":"Su8g3nUJ9P"}],"key":"R5gW8nQHpG"},{"type":"heading","depth":3,"position":{"start":{"line":1167,"column":1},"end":{"line":1167,"column":1}},"children":[{"type":"text","value":"下一步","position":{"start":{"line":1167,"column":1},"end":{"line":1167,"column":1}},"key":"J75cuwuEj4"}],"identifier":"id","label":"下一步","html_id":"id-25","implicit":true,"key":"VAGz0fI3yt"},{"type":"paragraph","position":{"start":{"line":1169,"column":1},"end":{"line":1169,"column":1}},"children":[{"type":"text","value":"现在你已经有了完美的策略，下一步请学习","position":{"start":{"line":1169,"column":1},"end":{"line":1169,"column":1}},"key":"J1XMceKBxo"},{"type":"link","url":"/backtesting","position":{"start":{"line":1169,"column":1},"end":{"line":1169,"column":1}},"children":[{"type":"text","value":"如何回测","position":{"start":{"line":1169,"column":1},"end":{"line":1169,"column":1}},"key":"CbUnVBwcZX"}],"urlSource":"backtesting.md","dataUrl":"/backtesting.json","internal":true,"protocol":"file","key":"rq4xXHz0cH"},{"type":"text","value":"。","position":{"start":{"line":1169,"column":1},"end":{"line":1169,"column":1}},"key":"SoHSagPFqo"}],"key":"J82JSFzKVD"}],"key":"y9dQAvEvpe"}],"key":"LPlS7LZQeo"},"references":{"cite":{"order":[],"data":{}}}}