{"version":2,"kind":"Article","sha256":"e92e2991f15bebc7659c093b20696ed23c7f327efb252c908cd92b851b7c6138","slug":"strategy-customization","location":"/strategy-customization.md","dependencies":[],"frontmatter":{"title":"策略自定义指南","description":"本文档介绍如何在 Freqtrade 中自定义交易策略,包括添加新指标、设置交易规则等内容。","short_title":"策略自定义","subtitle":"如何开发自己的交易策略","tags":["策略开发","自定义","指标","交易规则","编程"],"subject":"Freqtrade 策略开发","authors":[{"id":"Freqtrade","name":"Freqtrade"}],"github":"https://github.com/freqtrade-cn/docs_zh-CN","keywords":["Freqtrade","中文文档","交易机器人","量化交易","加密货币","数字货币","区块链","人工智能","机器学习"],"edit_url":"https://github.com/freqtrade-cn/docs_zh-CN/blob/main/strategy-customization.md","exports":[{"format":"md","filename":"strategy-customization.md","url":"/strategy-customizati-2f2ab3a165753cdf5bc0cb6654dd7378.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"策略自定义","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"ehjFZdrHbK"}],"identifier":"id","label":"策略自定义","html_id":"id","implicit":true,"key":"uDAafCMQOi"},{"type":"paragraph","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"本页将介绍如何自定义你的策略、添加新指标以及设置交易规则。","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"uOFo2CqpPv"}],"key":"omITAeTurI"},{"type":"paragraph","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"如果你还没有了解过，建议先阅读：","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"lD4NP7spFx"}],"key":"b2H7je6LWi"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":24,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"link","url":"/strategy-101","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"Freqtrade 策略 101","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"JLElR4AjYS"}],"urlSource":"strategy-101.md","dataUrl":"/strategy-101.json","internal":true,"protocol":"file","key":"SU1v3FaIUP"},{"type":"text","value":"，快速入门策略开发","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"vN564IU48T"}],"key":"VSdkXkoehj"},{"type":"listItem","spread":true,"position":{"start":{"line":25,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"link","url":"/bot-basics","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"Freqtrade 机器人基础","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"f2y4u7v6SN"}],"urlSource":"bot-basics.md","dataUrl":"/bot-basics.json","internal":true,"protocol":"file","key":"md56zHVYom"},{"type":"text","value":"，了解机器人整体运行机制","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"UcN5pLTQJK"}],"key":"qp7Ps2BPzc"}],"key":"vPtR6AChhQ"},{"type":"heading","depth":3,"position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"开发你自己的策略","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"gBDYC9WsDo"}],"identifier":"id","label":"开发你自己的策略","html_id":"id-1","implicit":true,"key":"yAUKJgu6bh"},{"type":"paragraph","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"text","value":"机器人自带了一个默认策略文件。","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"VmRbaA7UyR"}],"key":"ZB9fz67q8b"},{"type":"paragraph","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"text","value":"此外，","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"dB4ich5dpv"},{"type":"link","url":"https://github.com/freqtrade/freqtrade-strategies","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"text","value":"策略仓库","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"pbzWCZivVI"}],"urlSource":"https://github.com/freqtrade/freqtrade-strategies","error":true,"key":"BSv2wZCHSB"},{"type":"text","value":"中还提供了其他策略。","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"g3bwqzscJF"}],"key":"N7k5aEMerU"},{"type":"paragraph","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"text","value":"不过你很可能有自己的策略想法。","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"re9k3Wldkl"}],"key":"Rd6kNRSdUR"},{"type":"paragraph","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"text","value":"本文档旨在帮助你将想法转化为可运行的策略。","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"BsMastO7lq"}],"key":"Obw2rMpKHE"},{"type":"heading","depth":4,"position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"text","value":"生成策略模板","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"wNvLVRrk73"}],"identifier":"id","label":"生成策略模板","html_id":"id-2","implicit":true,"key":"aftBMrmePk"},{"type":"paragraph","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"text","value":"你可以通过以下命令快速开始：","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"DMsVei0c1F"}],"key":"U7BSKokQOx"},{"type":"code","lang":"bash","value":"freqtrade new-strategy --strategy AwesomeStrategy","position":{"start":{"line":41,"column":1},"end":{"line":43,"column":1}},"key":"S1Q9ZV955Y"},{"type":"paragraph","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"children":[{"type":"text","value":"这会基于模板创建一个名为 ","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"key":"oafEwnW9WP"},{"type":"inlineCode","value":"AwesomeStrategy","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"key":"sg42brJ27C"},{"type":"text","value":" 的新策略，文件路径为 ","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"key":"XptzgGZGKY"},{"type":"inlineCode","value":"user_data/strategies/AwesomeStrategy.py","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"key":"AV7Z40u3P2"},{"type":"text","value":"。","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"key":"hT4L5XYaLp"}],"key":"YWiCBucN9J"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"ZJGKHxpRpv"}],"key":"oejuLWF5jO"},{"type":"paragraph","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"children":[{"type":"text","value":"策略的","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"ezv5BLYATl"},{"type":"emphasis","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"children":[{"type":"text","value":"名称","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"UdxY9GIIdj"}],"key":"hUTzOn3ABB"},{"type":"text","value":"和文件名是有区别的。大多数命令中，Freqtrade 使用的是","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"JVYmSh8u3X"},{"type":"emphasis","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"children":[{"type":"text","value":"策略类名","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"JBUl9S0xWw"}],"key":"MYPSQm2y1g"},{"type":"text","value":"，而不是文件名。","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"KW04OTiivu"}],"key":"Fhl8eXjX8n"},{"type":"paragraph","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"children":[{"type":"inlineCode","value":"new-strategy","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"key":"C3YT4ejyah"},{"type":"text","value":" 命令生成的示例策略并不会直接盈利。","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"key":"GsxUgnRDC8"}],"key":"WeorRFIItM"}],"key":"JBhLGPFNDs"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"不同模板级别","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"g1wFFxtrNO"}],"key":"x9F1ZE1bHi"},{"type":"paragraph","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"children":[{"type":"inlineCode","value":"freqtrade new-strategy","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"ye2Ca1wqqi"},{"type":"text","value":" 有一个额外参数 ","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"JSNuM9srDz"},{"type":"inlineCode","value":"--template","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"EDDw51QuUb"},{"type":"text","value":"，可控制生成策略的复杂程度。用 ","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"DmuIz4gM9l"},{"type":"inlineCode","value":"--template minimal","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"H2PK4zpDlE"},{"type":"text","value":" 可获得一个空白策略，无任何指标示例；用 ","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"FwAiQIDCru"},{"type":"inlineCode","value":"--template advanced","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"aTGtY4fVyx"},{"type":"text","value":" 可获得包含更多复杂特性的模板。","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"dzn2yMuuEZ"}],"key":"Bi5F46u3Gz"}],"key":"iASoAbC0fB"},{"type":"heading","depth":4,"position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"children":[{"type":"text","value":"策略结构剖析","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"ku6d9LNbTj"}],"identifier":"id","label":"策略结构剖析","html_id":"id-3","implicit":true,"key":"S7mACeQ6gx"},{"type":"paragraph","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"children":[{"type":"text","value":"一个策略文件包含构建策略逻辑所需的全部信息：","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"key":"FxMAnunVW1"}],"key":"UqMgRN8mal"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":61,"column":1},"end":{"line":75,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"children":[{"type":"text","value":"K线数据（OHLCV 格式）","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"LNXGSHgR0M"}],"key":"m7FI2IYm0c"},{"type":"listItem","spread":true,"position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"children":[{"type":"text","value":"各类指标","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"SJWzoFS39r"}],"key":"NTeHZXalIA"},{"type":"listItem","spread":true,"position":{"start":{"line":63,"column":1},"end":{"line":64,"column":1}},"children":[{"type":"text","value":"入场逻辑","position":{"start":{"line":63,"column":1},"end":{"line":63,"column":1}},"key":"XBTOBByUx5"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"children":[{"type":"text","value":"信号","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"key":"jMBxtBWSgU"}],"key":"vHwf4X32yI"}],"key":"yHGsaoJj8c"}],"key":"FRodaGTykz"},{"type":"listItem","spread":true,"position":{"start":{"line":65,"column":1},"end":{"line":68,"column":1}},"children":[{"type":"text","value":"出场逻辑","position":{"start":{"line":65,"column":1},"end":{"line":65,"column":1}},"key":"LJkxk6TAch"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":66,"column":1},"end":{"line":68,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"children":[{"type":"text","value":"信号","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"key":"s8AfBUe99S"}],"key":"M8H27Scolb"},{"type":"listItem","spread":true,"position":{"start":{"line":67,"column":1},"end":{"line":67,"column":1}},"children":[{"type":"text","value":"最小收益率（ROI）","position":{"start":{"line":67,"column":1},"end":{"line":67,"column":1}},"key":"kH5Uj32ZSb"}],"key":"A4hg3YG2p3"},{"type":"listItem","spread":true,"position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"children":[{"type":"text","value":"回调函数（自定义函数）","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"PB7XZmZZDO"}],"key":"bhAZ94Y2a9"}],"key":"szM45Zlscy"}],"key":"PEnlBfQPuu"},{"type":"listItem","spread":true,"position":{"start":{"line":69,"column":1},"end":{"line":72,"column":1}},"children":[{"type":"text","value":"止损","position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"key":"qCj51xtKrA"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":70,"column":1},"end":{"line":72,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"children":[{"type":"text","value":"固定/绝对止损","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"B4DK1OpxnN"}],"key":"z4LAhi3Grm"},{"type":"listItem","spread":true,"position":{"start":{"line":71,"column":1},"end":{"line":71,"column":1}},"children":[{"type":"text","value":"跟踪止损","position":{"start":{"line":71,"column":1},"end":{"line":71,"column":1}},"key":"y4Z8ksNhBw"}],"key":"eLZRyA1Ehr"},{"type":"listItem","spread":true,"position":{"start":{"line":72,"column":1},"end":{"line":72,"column":1}},"children":[{"type":"text","value":"回调函数（自定义函数）","position":{"start":{"line":72,"column":1},"end":{"line":72,"column":1}},"key":"jqyyKFwDuL"}],"key":"I555azMjpv"}],"key":"vw8M5fB2fz"}],"key":"mN2Cq9oJWo"},{"type":"listItem","spread":true,"position":{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},"children":[{"type":"text","value":"定价（可选）","position":{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},"key":"xNiEmUpynO"}],"key":"VQrC7RLEdu"},{"type":"listItem","spread":true,"position":{"start":{"line":74,"column":1},"end":{"line":75,"column":1}},"children":[{"type":"text","value":"持仓调整（可选）","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"key":"nCAoQV4sVG"}],"key":"TnPW4z8Dzl"}],"key":"btFjhKaBkA"},{"type":"paragraph","position":{"start":{"line":76,"column":1},"end":{"line":77,"column":1}},"children":[{"type":"text","value":"机器人自带一个名为 ","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"UYJgVB0d1k"},{"type":"inlineCode","value":"SampleStrategy","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"eP9hkPjb6p"},{"type":"text","value":" 的示例策略，可作为参考：","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"FlaKQ61Pwn"},{"type":"inlineCode","value":"user_data/strategies/sample_strategy.py","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"qjnxhpRet3"},{"type":"text","value":"。\n你可以用参数 ","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"zzKUv4NsdI"},{"type":"inlineCode","value":"--strategy SampleStrategy","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"z5llh7ZIKa"},{"type":"text","value":" 进行测试。注意这里用的是策略类名，而不是文件名。","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"kaTF6dCCix"}],"key":"Jir6ZgkIwK"},{"type":"paragraph","position":{"start":{"line":79,"column":1},"end":{"line":79,"column":1}},"children":[{"type":"text","value":"此外，还有一个名为 ","position":{"start":{"line":79,"column":1},"end":{"line":79,"column":1}},"key":"ylGUAAgFuZ"},{"type":"inlineCode","value":"INTERFACE_VERSION","position":{"start":{"line":79,"column":1},"end":{"line":79,"column":1}},"key":"nR1Ah3cUhX"},{"type":"text","value":" 的属性，用于定义策略接口的版本。当前版本为 3，如果未在策略中显式设置，则默认为 3。","position":{"start":{"line":79,"column":1},"end":{"line":79,"column":1}},"key":"zwL8vicbTf"}],"key":"XKDEs76qDK"},{"type":"paragraph","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"children":[{"type":"text","value":"你可能会看到旧策略设置为接口版本 2，未来版本会要求升级到 v3。","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"ozeVTojQD2"}],"key":"HG1xLCqrmf"},{"type":"paragraph","position":{"start":{"line":83,"column":1},"end":{"line":83,"column":1}},"children":[{"type":"text","value":"用 ","position":{"start":{"line":83,"column":1},"end":{"line":83,"column":1}},"key":"A7QMsRC4j4"},{"type":"inlineCode","value":"trade","position":{"start":{"line":83,"column":1},"end":{"line":83,"column":1}},"key":"FSnEl356f2"},{"type":"text","value":" 命令即可启动机器人进入 dry 或 live 模式：","position":{"start":{"line":83,"column":1},"end":{"line":83,"column":1}},"key":"zF0kJRoCew"}],"key":"AKtjdSnOUs"},{"type":"code","lang":"bash","value":"freqtrade trade --strategy AwesomeStrategy","position":{"start":{"line":85,"column":1},"end":{"line":87,"column":1}},"key":"m7plr8W6kq"},{"type":"heading","depth":4,"position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"children":[{"type":"text","value":"机器人运行模式","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"key":"ry9U61LuxY"}],"identifier":"id","label":"机器人运行模式","html_id":"id-4","implicit":true,"key":"xx1Ia7WnLk"},{"type":"paragraph","position":{"start":{"line":91,"column":1},"end":{"line":91,"column":1}},"children":[{"type":"text","value":"Freqtrade 策略可在 5 种主要模式下被机器人处理：","position":{"start":{"line":91,"column":1},"end":{"line":91,"column":1}},"key":"eacYC5Mlui"}],"key":"YNliVQniSQ"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":93,"column":1},"end":{"line":98,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"children":[{"type":"text","value":"回测（backtesting）","position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"key":"BFasSuIHTu"}],"key":"obekBP760o"},{"type":"listItem","spread":true,"position":{"start":{"line":94,"column":1},"end":{"line":94,"column":1}},"children":[{"type":"text","value":"超参优化（hyperopting）","position":{"start":{"line":94,"column":1},"end":{"line":94,"column":1}},"key":"RNgktlAn5n"}],"key":"qgCAzUpBei"},{"type":"listItem","spread":true,"position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"children":[{"type":"text","value":"模拟盘（dry/forward testing）","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"dROE8vZRhD"}],"key":"vdjKfrTVHg"},{"type":"listItem","spread":true,"position":{"start":{"line":96,"column":1},"end":{"line":96,"column":1}},"children":[{"type":"text","value":"实盘（live）","position":{"start":{"line":96,"column":1},"end":{"line":96,"column":1}},"key":"GNiYYTo5Bj"}],"key":"rGmoDwjQNL"},{"type":"listItem","spread":true,"position":{"start":{"line":97,"column":1},"end":{"line":98,"column":1}},"children":[{"type":"text","value":"FreqAI（本页不涉及）","position":{"start":{"line":97,"column":1},"end":{"line":97,"column":1}},"key":"gzAgkOFNqX"}],"key":"xdnonQRZu9"}],"key":"Pc5PBi4C6Q"},{"type":"paragraph","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"children":[{"type":"text","value":"关于如何设置 dry 或 live 模式，请查阅","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"LHAkgNnp6I"},{"type":"link","url":"/configuration","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"children":[{"type":"text","value":"配置文档","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"VI2EB0AwXL"}],"urlSource":"configuration.md","dataUrl":"/configuration.json","internal":true,"protocol":"file","key":"n0VbKQeWGH"},{"type":"text","value":"。","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"Yoi2s5yA7n"}],"key":"YVrGYZW2BT"},{"type":"paragraph","position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"children":[{"type":"strong","position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"children":[{"type":"text","value":"测试时请始终使用 dry 模式，这样可以在不冒资金风险的情况下了解策略实际表现。","position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"key":"YM5V9CTYi2"}],"key":"zQcGi4Z8xJ"}],"key":"mVhM2juC9s"},{"type":"heading","depth":3,"position":{"start":{"line":103,"column":1},"end":{"line":103,"column":1}},"children":[{"type":"text","value":"深入剖析","position":{"start":{"line":103,"column":1},"end":{"line":103,"column":1}},"key":"c0Y3SOPhmz"}],"identifier":"id","label":"深入剖析","html_id":"id-5","implicit":true,"key":"jG3dSeHLLF"},{"type":"paragraph","position":{"start":{"line":105,"column":1},"end":{"line":105,"column":1}},"children":[{"type":"strong","position":{"start":{"line":105,"column":1},"end":{"line":105,"column":1}},"children":[{"type":"text","value":"以下内容将以 ","position":{"start":{"line":105,"column":1},"end":{"line":105,"column":1}},"key":"LM76JsEp4r"},{"type":"link","url":"https://github.com/freqtrade/freqtrade/blob/develop/freqtrade/templates/sample_strategy.py","position":{"start":{"line":105,"column":1},"end":{"line":105,"column":1}},"children":[{"type":"text","value":"user​_data​/strategies​/sample​_strategy​.py","position":{"start":{"line":105,"column":1},"end":{"line":105,"column":1}},"key":"r6PdzXyQXI"}],"urlSource":"https://github.com/freqtrade/freqtrade/blob/develop/freqtrade/templates/sample_strategy.py","data":{"kind":"file","org":"freqtrade","repo":"freqtrade","reference":"develop","file":"freqtrade/templates/sample_strategy.py","raw":"https://raw.githubusercontent.com/freqtrade/freqtrade/develop/freqtrade/templates/sample_strategy.py"},"internal":false,"protocol":"github","key":"TqVBG1Sohy"},{"type":"text","value":" 为参考。","position":{"start":{"line":105,"column":1},"end":{"line":105,"column":1}},"key":"NMSMtXH3Ts"}],"key":"HU0fzACMVA"}],"key":"d9Fm047UwA"},{"type":"admonition","kind":"caution","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"策略与回测","position":{"start":{"line":107,"column":1},"end":{"line":107,"column":1}},"key":"cBVloywMkH"}],"key":"jH5X7nf8uD"},{"type":"paragraph","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"children":[{"type":"text","value":"为避免回测与 dry/live 模式下出现问题和意外差异，请注意回测时 ","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"key":"XYDSl6bPfa"},{"type":"inlineCode","value":"populate_*()","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"key":"jYZScBy0Dr"},{"type":"text","value":" 方法会一次性传入完整时间区间。","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"key":"GqO1vqwjj0"}],"key":"sLWDBrKtyY"},{"type":"paragraph","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"children":[{"type":"text","value":"因此建议使用向量化操作（针对整个 dataframe，而非循环），避免用 ","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"bSA4ZF0vmm"},{"type":"inlineCode","value":"df.iloc[-1]","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"fgtL8tmxqn"},{"type":"text","value":"，而应用 ","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"qsALg7FkBw"},{"type":"inlineCode","value":"df.shift()","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"g5Gf6JNPx8"},{"type":"text","value":" 获取前一根K线。","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"mBri85AKOg"}],"key":"jyKXpzJG4F"}],"key":"c7m2jcArnv"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"警惕未来数据","position":{"start":{"line":113,"column":1},"end":{"line":113,"column":1}},"key":"OqeLB6l98T"}],"key":"Selqa3uVox"},{"type":"paragraph","position":{"start":{"line":114,"column":1},"end":{"line":114,"column":1}},"children":[{"type":"text","value":"回测时 ","position":{"start":{"line":114,"column":1},"end":{"line":114,"column":1}},"key":"jjza7e67ps"},{"type":"inlineCode","value":"populate_*()","position":{"start":{"line":114,"column":1},"end":{"line":114,"column":1}},"key":"CVYSe9WlPH"},{"type":"text","value":" 方法会传入完整时间区间，策略作者需确保不使用未来数据。","position":{"start":{"line":114,"column":1},"end":{"line":114,"column":1}},"key":"DJqezECbRX"}],"key":"t3fqkVshbg"},{"type":"paragraph","position":{"start":{"line":116,"column":1},"end":{"line":116,"column":1}},"children":[{"type":"text","value":"常见错误模式见文档后面的","position":{"start":{"line":116,"column":1},"end":{"line":116,"column":1}},"key":"ZCEZ8myWWR"},{"type":"link","url":"#%E5%BC%80%E5%8F%91%E7%AD%96%E7%95%A5%E6%97%B6%E7%9A%84%E5%B8%B8%E8%A7%81%E9%94%99%E8%AF%AF","position":{"start":{"line":116,"column":1},"end":{"line":116,"column":1}},"children":[{"type":"text","value":"常见错误","position":{"start":{"line":116,"column":1},"end":{"line":116,"column":1}},"key":"XnQZF5eKcn"}],"urlSource":"#%E5%BC%80%E5%8F%91%E7%AD%96%E7%95%A5%E6%97%B6%E7%9A%84%E5%B8%B8%E8%A7%81%E9%94%99%E8%AF%AF","key":"WVIGiDZnxG"},{"type":"text","value":"章节。","position":{"start":{"line":116,"column":1},"end":{"line":116,"column":1}},"key":"KoRByzRlV1"}],"key":"bA0gw7lx7Y"}],"key":"brGTV8bxRx"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"前视与递归分析","position":{"start":{"line":119,"column":1},"end":{"line":119,"column":1}},"key":"YqdmNGXxJU"}],"key":"R0cIy4SPmu"},{"type":"paragraph","position":{"start":{"line":120,"column":1},"end":{"line":120,"column":1}},"children":[{"type":"text","value":"Freqtrade 提供了两条命令帮助检测常见的前视（未来数据）和递归偏差（指标值方差）问题。在 dry/live 前，建议先用 ","position":{"start":{"line":120,"column":1},"end":{"line":120,"column":1}},"key":"kzfURVWlhz"},{"type":"link","url":"/lookahead-analysis","position":{"start":{"line":120,"column":1},"end":{"line":120,"column":1}},"children":[{"type":"text","value":"lookahead","position":{"start":{"line":120,"column":1},"end":{"line":120,"column":1}},"key":"mS8FyUXlGC"}],"urlSource":"lookahead-analysis.md","dataUrl":"/lookahead-analysis.json","internal":true,"protocol":"file","key":"iBlDEoDnul"},{"type":"text","value":" 和 ","position":{"start":{"line":120,"column":1},"end":{"line":120,"column":1}},"key":"Yp1du5hQxd"},{"type":"link","url":"/recursive-analysis","position":{"start":{"line":120,"column":1},"end":{"line":120,"column":1}},"children":[{"type":"text","value":"recursive","position":{"start":{"line":120,"column":1},"end":{"line":120,"column":1}},"key":"EDHzm9K2K4"}],"urlSource":"recursive-analysis.md","dataUrl":"/recursive-analysis.json","internal":true,"protocol":"file","key":"syLr9cjQyb"},{"type":"text","value":" 工具分析。","position":{"start":{"line":120,"column":1},"end":{"line":120,"column":1}},"key":"tSsiBsXpas"}],"key":"haTLC2n5Tt"}],"key":"XdeFtNiIJA"},{"type":"heading","depth":4,"position":{"start":{"line":123,"column":1},"end":{"line":123,"column":1}},"children":[{"type":"text","value":"DataFrame","position":{"start":{"line":123,"column":1},"end":{"line":123,"column":1}},"key":"JfMxQwSzmW"}],"identifier":"dataframe","label":"DataFrame","html_id":"dataframe","implicit":true,"key":"hs9Rs0kPMe"},{"type":"paragraph","position":{"start":{"line":125,"column":1},"end":{"line":126,"column":1}},"children":[{"type":"text","value":"Freqtrade 使用 ","position":{"start":{"line":125,"column":1},"end":{"line":125,"column":1}},"key":"Wa7zTZLf6W"},{"type":"link","url":"https://pandas.pydata.org/","position":{"start":{"line":125,"column":1},"end":{"line":125,"column":1}},"children":[{"type":"text","value":"pandas","position":{"start":{"line":125,"column":1},"end":{"line":125,"column":1}},"key":"sgwPJEPxxz"}],"urlSource":"https://pandas.pydata.org/","key":"Q4qKoR1XLY"},{"type":"text","value":" 存储/提供 K 线（OHLCV）数据。\nPandas 是处理表格数据的强大库。","position":{"start":{"line":125,"column":1},"end":{"line":125,"column":1}},"key":"MKLunSwep7"}],"key":"awOABNTBDk"},{"type":"paragraph","position":{"start":{"line":128,"column":1},"end":{"line":128,"column":1}},"children":[{"type":"text","value":"DataFrame 的每一行对应一根K线，最新的完整K线总是排在最后（按日期排序）。","position":{"start":{"line":128,"column":1},"end":{"line":128,"column":1}},"key":"q1OPmTv1iO"}],"key":"HJFaX4faak"},{"type":"paragraph","position":{"start":{"line":130,"column":1},"end":{"line":130,"column":1}},"children":[{"type":"text","value":"用 pandas 的 ","position":{"start":{"line":130,"column":1},"end":{"line":130,"column":1}},"key":"UGFwOC9XAM"},{"type":"inlineCode","value":"head()","position":{"start":{"line":130,"column":1},"end":{"line":130,"column":1}},"key":"oNMsmKed2S"},{"type":"text","value":" 查看前几行：","position":{"start":{"line":130,"column":1},"end":{"line":130,"column":1}},"key":"WEf9uHRRC8"}],"key":"DWv27cGYoo"},{"type":"code","lang":"output","value":"> dataframe.head()\n                       date      open      high       low     close     volume\n0 2021-11-09 23:25:00+00:00  67279.67  67321.84  67255.01  67300.97   44.62253\n1 2021-11-09 23:30:00+00:00  67300.97  67301.34  67183.03  67187.01   61.38076\n2 2021-11-09 23:35:00+00:00  67187.02  67187.02  67031.93  67123.81  113.42728\n3 2021-11-09 23:40:00+00:00  67123.80  67222.40  67080.33  67160.48   78.96008\n4 2021-11-09 23:45:00+00:00  67160.48  67160.48  66901.26  66943.37  111.39292","position":{"start":{"line":132,"column":1},"end":{"line":140,"column":1}},"key":"EnGrNoj6Qq"},{"type":"paragraph","position":{"start":{"line":142,"column":1},"end":{"line":142,"column":1}},"children":[{"type":"text","value":"DataFrame 是一个表格，列不是单一值，而是一组数据。因此，像下面这样直接用 Python 比较会报错：","position":{"start":{"line":142,"column":1},"end":{"line":142,"column":1}},"key":"rOmPeuuoYE"}],"key":"DTDqK0gCxK"},{"type":"code","lang":"python","value":"    if dataframe['rsi'] > 30:\n        dataframe['enter_long'] = 1","position":{"start":{"line":144,"column":1},"end":{"line":147,"column":1}},"key":"h5c33SGro9"},{"type":"paragraph","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"children":[{"type":"text","value":"上述写法会报错：","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"key":"MTanmSIxc3"},{"type":"inlineCode","value":"The truth value of a Series is ambiguous [...]","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"key":"jvItHvwg6h"},{"type":"text","value":"。","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"key":"LLkBdLmE7X"}],"key":"goxGsTwOtU"},{"type":"paragraph","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"children":[{"type":"text","value":"应改为 pandas 向量化写法，对整个 dataframe 执行操作：","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"key":"HwyaQCvWC8"}],"key":"ah8MYpn9eK"},{"type":"code","lang":"python","value":"    dataframe.loc[\n        (dataframe['rsi'] > 30)\n    , 'enter_long'] = 1","position":{"start":{"line":153,"column":1},"end":{"line":157,"column":1}},"key":"sNL40v9Mh6"},{"type":"paragraph","position":{"start":{"line":159,"column":1},"end":{"line":159,"column":1}},"children":[{"type":"text","value":"这样会在 RSI 大于 30 时，为新列 ","position":{"start":{"line":159,"column":1},"end":{"line":159,"column":1}},"key":"fU1R6utjDt"},{"type":"inlineCode","value":"enter_long","position":{"start":{"line":159,"column":1},"end":{"line":159,"column":1}},"key":"mRlRFxb1F7"},{"type":"text","value":" 赋值 1。","position":{"start":{"line":159,"column":1},"end":{"line":159,"column":1}},"key":"ahIhlwIp26"}],"key":"ankk61sIeh"},{"type":"paragraph","position":{"start":{"line":161,"column":1},"end":{"line":161,"column":1}},"children":[{"type":"text","value":"Freqtrade 会用这个新列作为入场信号，假定下一根K线开盘时开仓。","position":{"start":{"line":161,"column":1},"end":{"line":161,"column":1}},"key":"VftpWfnqxm"}],"key":"nOAU9qZUu7"},{"type":"paragraph","position":{"start":{"line":163,"column":1},"end":{"line":163,"column":1}},"children":[{"type":"text","value":"Pandas 支持高效的向量化计算，建议尽量避免循环，直接用向量化方法。","position":{"start":{"line":163,"column":1},"end":{"line":163,"column":1}},"key":"hLSF5AuJts"}],"key":"rDjTwBPJsx"},{"type":"paragraph","position":{"start":{"line":165,"column":1},"end":{"line":165,"column":1}},"children":[{"type":"text","value":"向量化操作会对整列数据进行计算，比逐行循环快得多。","position":{"start":{"line":165,"column":1},"end":{"line":165,"column":1}},"key":"IqqQzbIpa0"}],"key":"mY9eGNkKQu"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"信号 vs 交易","position":{"start":{"line":167,"column":1},"end":{"line":167,"column":1}},"key":"yv0FwH8CH6"}],"key":"fOCh7p0UGu"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":169,"column":1},"end":{"line":170,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":169,"column":1},"end":{"line":169,"column":1}},"children":[{"type":"text","value":"信号由指标在K线收盘时生成，表示有意愿开仓。","position":{"start":{"line":169,"column":1},"end":{"line":169,"column":1}},"key":"A4orflhEBh"}],"key":"LfUiDwEXAg"},{"type":"listItem","spread":true,"position":{"start":{"line":170,"column":1},"end":{"line":170,"column":1}},"children":[{"type":"text","value":"交易是在实际下单（实盘时在交易所），会尽量在下一根K线开盘时成交。","position":{"start":{"line":170,"column":1},"end":{"line":170,"column":1}},"key":"zUWtA4NQmq"}],"key":"c0fA2DWEa0"}],"key":"rvlGwY07Ed"}],"key":"c0WQINMiyk"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"交易下单假设","position":{"start":{"line":174,"column":1},"end":{"line":174,"column":1}},"key":"l15rF5Xx53"}],"key":"uu5ECa9XIZ"},{"type":"paragraph","position":{"start":{"line":176,"column":1},"end":{"line":176,"column":1}},"children":[{"type":"text","value":"回测时，信号在K线收盘时生成，交易在下一根K线开盘时执行。","position":{"start":{"line":176,"column":1},"end":{"line":176,"column":1}},"key":"JmfPpFz0I5"}],"key":"HZDFVJaoCw"},{"type":"paragraph","position":{"start":{"line":178,"column":1},"end":{"line":178,"column":1}},"children":[{"type":"text","value":"dry/live 模式下，因需先分析所有交易对 dataframe，再处理下单，可能有延迟。建议减少交易对数量，并用高主频 CPU。","position":{"start":{"line":178,"column":1},"end":{"line":178,"column":1}},"key":"PPnQxrpJNI"}],"key":"z8UvUIzTWu"}],"key":"Te0C2EXrqq"},{"type":"heading","depth":5,"position":{"start":{"line":182,"column":1},"end":{"line":182,"column":1}},"children":[{"type":"text","value":"为什么看不到\"实时\"K线数据？","position":{"start":{"line":182,"column":1},"end":{"line":182,"column":1}},"key":"WxEEUSyDG7"}],"identifier":"id-k","label":"为什么看不到\"实时\"K线数据？","html_id":"id-k","implicit":true,"key":"sr1jhfyCP8"},{"type":"paragraph","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"children":[{"type":"text","value":"Freqtrade 不会在 dataframe 中存储未完成/未收盘的K线。","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"key":"rwRh3aAISc"}],"key":"RV6PHKsvlS"},{"type":"paragraph","position":{"start":{"line":186,"column":1},"end":{"line":186,"column":1}},"children":[{"type":"text","value":"用未完成数据做决策叫\"重绘\"，有些平台允许，但 Freqtrade 不支持。只有完整K线数据可用。","position":{"start":{"line":186,"column":1},"end":{"line":186,"column":1}},"key":"ky0as7IW8Y"}],"key":"PXEgXMfmqq"},{"type":"heading","depth":4,"position":{"start":{"line":188,"column":1},"end":{"line":188,"column":1}},"children":[{"type":"text","value":"自定义指标","position":{"start":{"line":188,"column":1},"end":{"line":188,"column":1}},"key":"PgHJ86WQ26"}],"identifier":"id","label":"自定义指标","html_id":"id-6","implicit":true,"key":"y8m2sohuli"},{"type":"paragraph","position":{"start":{"line":190,"column":1},"end":{"line":190,"column":1}},"children":[{"type":"text","value":"入场和出场信号需要用到指标。你可以在策略文件的 ","position":{"start":{"line":190,"column":1},"end":{"line":190,"column":1}},"key":"ZUMjtzf4Oq"},{"type":"inlineCode","value":"populate_indicators()","position":{"start":{"line":190,"column":1},"end":{"line":190,"column":1}},"key":"cFEps7wrHl"},{"type":"text","value":" 方法中添加更多指标。","position":{"start":{"line":190,"column":1},"end":{"line":190,"column":1}},"key":"MWPbGQGxbo"}],"key":"SxA8m4Rq5C"},{"type":"paragraph","position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"children":[{"type":"text","value":"只应添加在 ","position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"key":"YCf2wHMEsG"},{"type":"inlineCode","value":"populate_entry_trend()","position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"key":"t49ONUr3QS"},{"type":"text","value":"、","position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"key":"IgQgfWHIoG"},{"type":"inlineCode","value":"populate_exit_trend()","position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"key":"K0FxJ1vu02"},{"type":"text","value":" 或用于生成其他指标的指标，否则会影响性能。","position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"key":"wDjH50igCc"}],"key":"sdkjUGO0cf"},{"type":"paragraph","position":{"start":{"line":194,"column":1},"end":{"line":194,"column":1}},"children":[{"type":"text","value":"务必返回 dataframe，且不要删除/修改 “open”, “high”, “low”, “close”, “volume” 这几列，否则会导致异常。","position":{"start":{"line":194,"column":1},"end":{"line":194,"column":1}},"key":"iRqE4DONio"}],"key":"ndY5GMfvMk"},{"type":"paragraph","position":{"start":{"line":196,"column":1},"end":{"line":196,"column":1}},"children":[{"type":"text","value":"示例：","position":{"start":{"line":196,"column":1},"end":{"line":196,"column":1}},"key":"Zm0fJVvSso"}],"key":"alsqY8Apah"},{"type":"code","lang":"python","value":"def populate_indicators(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n    \"\"\"\n    为给定 DataFrame 添加多种技术指标\n\n    性能提示：为获得最佳性能，请只用你策略或超参优化用到的指标，否则会浪费内存和 CPU。\n    :param dataframe: 交易所数据 DataFrame\n    :param metadata: 额外信息，如当前交易对\n    :return: 包含所有策略所需指标的 DataFrame\n    \"\"\"\n    dataframe['sar'] = ta.SAR(dataframe)\n    dataframe['adx'] = ta.ADX(dataframe)\n    stoch = ta.STOCHF(dataframe)\n    dataframe['fastd'] = stoch['fastd']\n    dataframe['fastk'] = stoch['fastk']\n    dataframe['bb_lower'] = ta.BBANDS(dataframe, nbdevup=2, nbdevdn=2)['lowerband']\n    dataframe['sma'] = ta.SMA(dataframe, timeperiod=40)\n    dataframe['tema'] = ta.TEMA(dataframe, timeperiod=9)\n    dataframe['mfi'] = ta.MFI(dataframe)\n    dataframe['rsi'] = ta.RSI(dataframe)\n    dataframe['ema5'] = ta.EMA(dataframe, timeperiod=5)\n    dataframe['ema10'] = ta.EMA(dataframe, timeperiod=10)\n    dataframe['ema50'] = ta.EMA(dataframe, timeperiod=50)\n    dataframe['ema100'] = ta.EMA(dataframe, timeperiod=100)\n    dataframe['ao'] = awesome_oscillator(dataframe)\n    macd = ta.MACD(dataframe)\n    dataframe['macd'] = macd['macd']\n    dataframe['macdsignal'] = macd['macdsignal']\n    dataframe['macdhist'] = macd['macdhist']\n    hilbert = ta.HT_SINE(dataframe)\n    dataframe['htsine'] = hilbert['sine']\n    dataframe['htleadsine'] = hilbert['leadsine']\n    dataframe['plus_dm'] = ta.PLUS_DM(dataframe)\n    dataframe['plus_di'] = ta.PLUS_DI(dataframe)\n    dataframe['minus_dm'] = ta.MINUS_DM(dataframe)\n    dataframe['minus_di'] = ta.MINUS_DI(dataframe)\n\n    # 记得始终返回 dataframe\n    return dataframe","position":{"start":{"line":198,"column":1},"end":{"line":237,"column":1}},"key":"WCiXEpUniT"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"想要更多指标示例？","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"LahPqBXipV"}],"key":"s4b05BWARb"},{"type":"paragraph","position":{"start":{"line":240,"column":1},"end":{"line":240,"column":1}},"children":[{"type":"text","value":"请参考 ","position":{"start":{"line":240,"column":1},"end":{"line":240,"column":1}},"key":"pjnxDRz3tE"},{"type":"link","url":"https://github.com/freqtrade/freqtrade/blob/develop/freqtrade/templates/sample_strategy.py","position":{"start":{"line":240,"column":1},"end":{"line":240,"column":1}},"children":[{"type":"text","value":"user​_data​/strategies​/sample​_strategy​.py","position":{"start":{"line":240,"column":1},"end":{"line":240,"column":1}},"key":"vxjFK3Tbc3"}],"urlSource":"https://github.com/freqtrade/freqtrade/blob/develop/freqtrade/templates/sample_strategy.py","data":{"kind":"file","org":"freqtrade","repo":"freqtrade","reference":"develop","file":"freqtrade/templates/sample_strategy.py","raw":"https://raw.githubusercontent.com/freqtrade/freqtrade/develop/freqtrade/templates/sample_strategy.py"},"internal":false,"protocol":"github","key":"gjCk7Po8c8"},{"type":"text","value":"，取消注释你需要的指标。","position":{"start":{"line":240,"column":1},"end":{"line":240,"column":1}},"key":"x2ypknc7GQ"}],"key":"a09rI5TNvk"}],"key":"KviBZmu1ga"},{"type":"heading","depth":5,"position":{"start":{"line":243,"column":1},"end":{"line":243,"column":1}},"children":[{"type":"text","value":"指标库","position":{"start":{"line":243,"column":1},"end":{"line":243,"column":1}},"key":"bND3DKfg6B"}],"identifier":"id","label":"指标库","html_id":"id-7","implicit":true,"key":"UIY2ZZTVk9"},{"type":"paragraph","position":{"start":{"line":245,"column":1},"end":{"line":245,"column":1}},"children":[{"type":"text","value":"Freqtrade 默认安装了以下技术指标库：","position":{"start":{"line":245,"column":1},"end":{"line":245,"column":1}},"key":"xmerMttsy8"}],"key":"DGlH6f89Bk"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":247,"column":1},"end":{"line":250,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":247,"column":1},"end":{"line":247,"column":1}},"children":[{"type":"link","url":"https://ta-lib.github.io/ta-lib-python/","position":{"start":{"line":247,"column":1},"end":{"line":247,"column":1}},"children":[{"type":"text","value":"ta-lib","position":{"start":{"line":247,"column":1},"end":{"line":247,"column":1}},"key":"WlR4i60sX5"}],"urlSource":"https://ta-lib.github.io/ta-lib-python/","key":"XCSTAc92D9"}],"key":"KfV8uU3MrW"},{"type":"listItem","spread":true,"position":{"start":{"line":248,"column":1},"end":{"line":248,"column":1}},"children":[{"type":"link","url":"https://twopirllc.github.io/pandas-ta/","position":{"start":{"line":248,"column":1},"end":{"line":248,"column":1}},"children":[{"type":"text","value":"pandas-ta","position":{"start":{"line":248,"column":1},"end":{"line":248,"column":1}},"key":"QQkbrDYABH"}],"urlSource":"https://twopirllc.github.io/pandas-ta/","key":"qUmsCgna4U"}],"key":"EfecBbJsvo"},{"type":"listItem","spread":true,"position":{"start":{"line":249,"column":1},"end":{"line":250,"column":1}},"children":[{"type":"link","url":"https://technical.freqtrade.io","position":{"start":{"line":249,"column":1},"end":{"line":249,"column":1}},"children":[{"type":"text","value":"technical","position":{"start":{"line":249,"column":1},"end":{"line":249,"column":1}},"key":"sbPt9iz31q"}],"urlSource":"https://technical.freqtrade.io","key":"RuVKUlHtTb"}],"key":"PRAjD86AC9"}],"key":"YgLQ5GMq4D"},{"type":"paragraph","position":{"start":{"line":251,"column":1},"end":{"line":251,"column":1}},"children":[{"type":"text","value":"如有需要可安装其他技术指标库，或自行编写自定义指标。","position":{"start":{"line":251,"column":1},"end":{"line":251,"column":1}},"key":"r9IxckfzGZ"}],"key":"tntuc8BT6t"},{"type":"heading","depth":4,"position":{"start":{"line":253,"column":1},"end":{"line":253,"column":1}},"children":[{"type":"text","value":"策略启动期","position":{"start":{"line":253,"column":1},"end":{"line":253,"column":1}},"key":"nn46zRVDhx"}],"identifier":"id","label":"策略启动期","html_id":"id-8","implicit":true,"key":"DgHfH15aC9"},{"type":"paragraph","position":{"start":{"line":255,"column":1},"end":{"line":255,"column":1}},"children":[{"type":"text","value":"部分指标在启动初期因数据不足会出现 NaN 或计算不准确。Freqtrade 无法自动判断不稳定期长度，会直接用 dataframe 中的指标值。","position":{"start":{"line":255,"column":1},"end":{"line":255,"column":1}},"key":"RNweqbiDlr"}],"key":"ARuFeKZBts"},{"type":"paragraph","position":{"start":{"line":257,"column":1},"end":{"line":257,"column":1}},"children":[{"type":"text","value":"为此，策略可设置 ","position":{"start":{"line":257,"column":1},"end":{"line":257,"column":1}},"key":"BMUfH5VEtD"},{"type":"inlineCode","value":"startup_candle_count","position":{"start":{"line":257,"column":1},"end":{"line":257,"column":1}},"key":"maVg6KgAnu"},{"type":"text","value":" 属性。","position":{"start":{"line":257,"column":1},"end":{"line":257,"column":1}},"key":"TqyZ96tEHM"}],"key":"EqIeH0BSRt"},{"type":"paragraph","position":{"start":{"line":259,"column":1},"end":{"line":259,"column":1}},"children":[{"type":"text","value":"该值应设为策略中所有指标所需的最大历史K线数。若用到高阶时间周期 informative pair，","position":{"start":{"line":259,"column":1},"end":{"line":259,"column":1}},"key":"uRMCmYXMSg"},{"type":"inlineCode","value":"startup_candle_count","position":{"start":{"line":259,"column":1},"end":{"line":259,"column":1}},"key":"scfqw6Pmqa"},{"type":"text","value":" 也无需改变，只需用最大周期。","position":{"start":{"line":259,"column":1},"end":{"line":259,"column":1}},"key":"HqaJ1Z8nav"}],"key":"d4Ek3MT2cj"},{"type":"paragraph","position":{"start":{"line":261,"column":1},"end":{"line":261,"column":1}},"children":[{"type":"text","value":"可用 ","position":{"start":{"line":261,"column":1},"end":{"line":261,"column":1}},"key":"uK9w4hjiY2"},{"type":"link","url":"/recursive-analysis","position":{"start":{"line":261,"column":1},"end":{"line":261,"column":1}},"children":[{"type":"text","value":"recursive-analysis","position":{"start":{"line":261,"column":1},"end":{"line":261,"column":1}},"key":"t2Vj5R370h"}],"urlSource":"recursive-analysis.md","dataUrl":"/recursive-analysis.json","internal":true,"protocol":"file","key":"eOTma9MV9n"},{"type":"text","value":" 检查合适的 ","position":{"start":{"line":261,"column":1},"end":{"line":261,"column":1}},"key":"qeZRsq3DHo"},{"type":"inlineCode","value":"startup_candle_count","position":{"start":{"line":261,"column":1},"end":{"line":261,"column":1}},"key":"qXpaa2ktzQ"},{"type":"text","value":"。当递归分析显示方差为 0% 时，说明历史数据已足够。","position":{"start":{"line":261,"column":1},"end":{"line":261,"column":1}},"key":"p7eM49m9uJ"}],"key":"JhjtiO5sB2"},{"type":"paragraph","position":{"start":{"line":263,"column":1},"end":{"line":263,"column":1}},"children":[{"type":"text","value":"如本例策略用到 ema100，则应设为 400（","position":{"start":{"line":263,"column":1},"end":{"line":263,"column":1}},"key":"h4Lo7h46ds"},{"type":"inlineCode","value":"startup_candle_count = 400","position":{"start":{"line":263,"column":1},"end":{"line":263,"column":1}},"key":"O85VX0s1FU"},{"type":"text","value":"），以保证 ema100 计算准确。","position":{"start":{"line":263,"column":1},"end":{"line":263,"column":1}},"key":"crBQx9qiKG"}],"key":"GpLzwJM5pP"},{"type":"code","lang":"python","value":"    dataframe['ema100'] = ta.EMA(dataframe, timeperiod=100)","position":{"start":{"line":265,"column":1},"end":{"line":267,"column":1}},"key":"X0bnPProti"},{"type":"paragraph","position":{"start":{"line":269,"column":1},"end":{"line":269,"column":1}},"children":[{"type":"text","value":"告知机器人所需历史长度后，回测和超参优化可从指定时间点开始。","position":{"start":{"line":269,"column":1},"end":{"line":269,"column":1}},"key":"mS8JXQLgCj"}],"key":"nlEYhO1fNj"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"多次获取 OHLCV 的警告","position":{"start":{"line":271,"column":1},"end":{"line":271,"column":1}},"key":"r8YGZEjW1p"}],"key":"dCbbB69uP1"},{"type":"paragraph","position":{"start":{"line":272,"column":1},"end":{"line":272,"column":1}},"children":[{"type":"text","value":"若收到 ","position":{"start":{"line":272,"column":1},"end":{"line":272,"column":1}},"key":"kma5ISkzCC"},{"type":"inlineCode","value":"WARNING - Using 3 calls to get OHLCV...","position":{"start":{"line":272,"column":1},"end":{"line":272,"column":1}},"key":"vK3JTDis3f"},{"type":"text","value":"，请考虑是否真的需要这么多历史数据。过多会导致多次网络请求，拖慢机器人刷新速度。","position":{"start":{"line":272,"column":1},"end":{"line":272,"column":1}},"key":"hTuHMQfeCh"}],"key":"X5jv1FSKX8"},{"type":"paragraph","position":{"start":{"line":274,"column":1},"end":{"line":274,"column":1}},"children":[{"type":"text","value":"最多允许 5 次请求，避免过载。","position":{"start":{"line":274,"column":1},"end":{"line":274,"column":1}},"key":"svnRI9E6oj"}],"key":"Pnzr0NCLmk"}],"key":"aYYy9BKwaX"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"rwsRO3d4mm"}],"key":"OHnhqRHkTC"},{"type":"paragraph","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"children":[{"type":"inlineCode","value":"startup_candle_count","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"key":"MvVGMApc1x"},{"type":"text","value":" 应小于 ","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"key":"oKiyBoNbDp"},{"type":"inlineCode","value":"ohlcv_candle_limit * 5","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"key":"FcwlOUsadU"},{"type":"text","value":"（大多数交易所为 500 * 5），Dry-Run/Live 模式下只会有这么多K线。","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"key":"d4ok21mFlx"}],"key":"SRoEwT0FOZ"}],"key":"mkzxxKPNOi"},{"type":"heading","depth":5,"position":{"start":{"line":281,"column":1},"end":{"line":281,"column":1}},"children":[{"type":"text","value":"示例","position":{"start":{"line":281,"column":1},"end":{"line":281,"column":1}},"key":"zKNNRZJxWu"}],"identifier":"id","label":"示例","html_id":"id-9","implicit":true,"key":"VNLxByBZoW"},{"type":"paragraph","position":{"start":{"line":283,"column":1},"end":{"line":283,"column":1}},"children":[{"type":"text","value":"假设用 EMA100 策略回测 2019 年 1 月的 5m K 线：","position":{"start":{"line":283,"column":1},"end":{"line":283,"column":1}},"key":"OQyh03qCbu"}],"key":"dS5NQxv75V"},{"type":"code","lang":"bash","value":"freqtrade backtesting --timerange 20190101-20190201 --timeframe 5m","position":{"start":{"line":285,"column":1},"end":{"line":287,"column":1}},"key":"vONAhFSOoz"},{"type":"paragraph","position":{"start":{"line":289,"column":1},"end":{"line":289,"column":1}},"children":[{"type":"text","value":"若 ","position":{"start":{"line":289,"column":1},"end":{"line":289,"column":1}},"key":"ezdFmFyBXx"},{"type":"inlineCode","value":"startup_candle_count","position":{"start":{"line":289,"column":1},"end":{"line":289,"column":1}},"key":"pUYcf8wY5y"},{"type":"text","value":" 设为 400，回测会自动加载 400 根K线的历史数据，即从 ","position":{"start":{"line":289,"column":1},"end":{"line":289,"column":1}},"key":"jvnU5SdYeP"},{"type":"inlineCode","value":"20190101 - (400 * 5m)","position":{"start":{"line":289,"column":1},"end":{"line":289,"column":1}},"key":"XSuu1f2jm8"},{"type":"text","value":"，约等于 2018-12-30 11:40:00。","position":{"start":{"line":289,"column":1},"end":{"line":289,"column":1}},"key":"Ya7rc4icQZ"}],"key":"nnCCTmcfeY"},{"type":"paragraph","position":{"start":{"line":291,"column":1},"end":{"line":291,"column":1}},"children":[{"type":"text","value":"若有该数据，指标会用扩展时间段计算，启动期（到 2019-01-01 00:00:00）会被剔除。","position":{"start":{"line":291,"column":1},"end":{"line":291,"column":1}},"key":"bmuJiJ3BuK"}],"key":"SWUNRFQqF8"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"启动期数据不可用","position":{"start":{"line":293,"column":1},"end":{"line":293,"column":1}},"key":"ABKQTrE6ot"}],"key":"dXg4f0niKC"},{"type":"paragraph","position":{"start":{"line":294,"column":1},"end":{"line":294,"column":1}},"children":[{"type":"text","value":"若历史数据不足，回测会自动调整起始时间。例如本例会从 2019-01-02 09:20:00 开始。","position":{"start":{"line":294,"column":1},"end":{"line":294,"column":1}},"key":"HjVfAW58Y4"}],"key":"CcwDLLNCSd"}],"key":"HA0eMpTo1V"},{"type":"heading","depth":4,"position":{"start":{"line":297,"column":1},"end":{"line":297,"column":1}},"children":[{"type":"text","value":"入场信号规则","position":{"start":{"line":297,"column":1},"end":{"line":297,"column":1}},"key":"RObRCVednL"}],"identifier":"id","label":"入场信号规则","html_id":"id-10","implicit":true,"key":"ayjsBe6MUF"},{"type":"paragraph","position":{"start":{"line":299,"column":1},"end":{"line":299,"column":1}},"children":[{"type":"text","value":"编辑策略文件中的 ","position":{"start":{"line":299,"column":1},"end":{"line":299,"column":1}},"key":"xmfHU5TyWx"},{"type":"inlineCode","value":"populate_entry_trend()","position":{"start":{"line":299,"column":1},"end":{"line":299,"column":1}},"key":"Wn65X6YWJP"},{"type":"text","value":" 方法，更新入场逻辑。","position":{"start":{"line":299,"column":1},"end":{"line":299,"column":1}},"key":"PPrWfol9it"}],"key":"z1fq5U1JTn"},{"type":"paragraph","position":{"start":{"line":301,"column":1},"end":{"line":301,"column":1}},"children":[{"type":"text","value":"务必返回 dataframe，且不要删除/修改 “open”, “high”, “low”, “close”, “volume” 这几列，否则会导致异常。","position":{"start":{"line":301,"column":1},"end":{"line":301,"column":1}},"key":"hx7rQ2Xfz1"}],"key":"CIgl10ySkK"},{"type":"paragraph","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"children":[{"type":"text","value":"该方法还需定义新列 ","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"key":"GKiUnMIe7I"},{"type":"inlineCode","value":"enter_long","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"key":"Qhb5LKCOJb"},{"type":"text","value":"（做空为 ","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"key":"rM09WAlXkG"},{"type":"inlineCode","value":"enter_short","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"key":"sFfBRRM2Z4"},{"type":"text","value":"），入场时为 1，无操作为 0。即使只做空也必须设置 ","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"key":"bMapnRBfsc"},{"type":"inlineCode","value":"enter_long","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"key":"vjgM2OsZGe"},{"type":"text","value":"。","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"key":"VnEYZTj0JH"}],"key":"j0kwItQSal"},{"type":"paragraph","position":{"start":{"line":305,"column":1},"end":{"line":305,"column":1}},"children":[{"type":"text","value":"可用 ","position":{"start":{"line":305,"column":1},"end":{"line":305,"column":1}},"key":"CSXxn66Vof"},{"type":"inlineCode","value":"enter_tag","position":{"start":{"line":305,"column":1},"end":{"line":305,"column":1}},"key":"kF5cchoBZA"},{"type":"text","value":" 列为信号命名，便于后续调试和分析。","position":{"start":{"line":305,"column":1},"end":{"line":305,"column":1}},"key":"BCJnFRvfjI"}],"key":"wEOyob0cTo"},{"type":"paragraph","position":{"start":{"line":307,"column":1},"end":{"line":307,"column":1}},"children":[{"type":"text","value":"示例（来自 sample_strategy.py）：","position":{"start":{"line":307,"column":1},"end":{"line":307,"column":1}},"key":"ikuVmbGLfG"}],"key":"fmXK3ijsid"},{"type":"code","lang":"python","value":"def populate_entry_trend(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n    \"\"\"\n    基于技术指标，为给定 dataframe 生成买入信号\n    :param dataframe: 已填充指标的 DataFrame\n    :param metadata: 额外信息，如当前交易对\n    :return: 包含买入信号的 DataFrame\n    \"\"\"\n    dataframe.loc[\n        (\n            (qtpylib.crossed_above(dataframe['rsi'], 30)) &  # RSI 上穿 30\n            (dataframe['tema'] <= dataframe['bb_middleband']) &  # 条件\n            (dataframe['tema'] > dataframe['tema'].shift(1)) &  # 条件\n            (dataframe['volume'] > 0)  # 确保有成交量\n        ),\n        ['enter_long', 'enter_tag']] = (1, 'rsi_cross')\n\n    return dataframe","position":{"start":{"line":309,"column":1},"end":{"line":327,"column":1}},"key":"NaMwQfYQKt"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"做空信号","position":{"start":{"line":329,"column":1},"end":{"line":329,"column":1}},"key":"NhUKyro60e"}],"key":"cZ2szRPzfq"},{"type":"paragraph","position":{"start":{"line":330,"column":1},"end":{"line":332,"column":1}},"children":[{"type":"text","value":"做空可通过设置 ","position":{"start":{"line":330,"column":1},"end":{"line":330,"column":1}},"key":"fVIPbchwhh"},{"type":"inlineCode","value":"enter_short","position":{"start":{"line":330,"column":1},"end":{"line":330,"column":1}},"key":"X2QfPElqT5"},{"type":"text","value":"（对应多头的 ","position":{"start":{"line":330,"column":1},"end":{"line":330,"column":1}},"key":"xgcQ4vSV94"},{"type":"inlineCode","value":"enter_long","position":{"start":{"line":330,"column":1},"end":{"line":330,"column":1}},"key":"t4OmqcpWCd"},{"type":"text","value":"）实现。\n","position":{"start":{"line":330,"column":1},"end":{"line":330,"column":1}},"key":"GwcwXSErWg"},{"type":"inlineCode","value":"enter_tag","position":{"start":{"line":330,"column":1},"end":{"line":330,"column":1}},"key":"kdvKlBibuv"},{"type":"text","value":" 列用法相同。\n做空需交易所和市场支持！如需做空，务必设置 ","position":{"start":{"line":330,"column":1},"end":{"line":330,"column":1}},"key":"SbGb19M7oj"},{"type":"link","url":"#can-short","position":{"start":{"line":330,"column":1},"end":{"line":330,"column":1}},"children":[{"type":"inlineCode","value":"can_short","position":{"start":{"line":330,"column":1},"end":{"line":330,"column":1}},"key":"kRe9zdg16C"}],"urlSource":"#can-short","key":"jN0hdwun9I"},{"type":"text","value":" 为 True。","position":{"start":{"line":330,"column":1},"end":{"line":330,"column":1}},"key":"DansbvAek5"}],"key":"urMASSFS2b"},{"type":"code","lang":"python","value":"# 支持多空\ncan_short = True\n\ndef populate_entry_trend(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n    dataframe.loc[\n        (\n            (qtpylib.crossed_above(dataframe['rsi'], 30)) &\n            (dataframe['tema'] <= dataframe['bb_middleband']) &\n            (dataframe['tema'] > dataframe['tema'].shift(1)) &\n            (dataframe['volume'] > 0)\n        ),\n        ['enter_long', 'enter_tag']] = (1, 'rsi_cross')\n\n    dataframe.loc[\n        (\n            (qtpylib.crossed_below(dataframe['rsi'], 70)) &\n            (dataframe['tema'] > dataframe['bb_middleband']) &\n            (dataframe['tema'] < dataframe['tema'].shift(1)) &\n            (dataframe['volume'] > 0)\n        ),\n        ['enter_short', 'enter_tag']] = (1, 'rsi_cross')\n\n    return dataframe","position":{"start":{"line":334,"column":1},"end":{"line":358,"column":1}},"key":"et2IZpUEId"}],"key":"apwgOU1lx7"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Tip","key":"GfzvbDtzJ0"}],"key":"Yl3YaftcYJ"},{"type":"paragraph","position":{"start":{"line":363,"column":1},"end":{"line":363,"column":1}},"children":[{"type":"text","value":"买入需要有卖方，因此需 ","position":{"start":{"line":363,"column":1},"end":{"line":363,"column":1}},"key":"H6fneJxXny"},{"type":"inlineCode","value":"dataframe['volume'] > 0","position":{"start":{"line":363,"column":1},"end":{"line":363,"column":1}},"key":"xHQRGuGFum"},{"type":"text","value":"，避免在无成交量时买入/卖出。","position":{"start":{"line":363,"column":1},"end":{"line":363,"column":1}},"key":"Njq0ITQm3K"}],"key":"cDLz7D7Aio"}],"key":"Go1UYH3Qj6"},{"type":"heading","depth":4,"position":{"start":{"line":366,"column":1},"end":{"line":366,"column":1}},"children":[{"type":"text","value":"出场信号规则","position":{"start":{"line":366,"column":1},"end":{"line":366,"column":1}},"key":"dwjPdeJawe"}],"identifier":"id","label":"出场信号规则","html_id":"id-11","implicit":true,"key":"ZDqKFSFeAA"},{"type":"paragraph","position":{"start":{"line":368,"column":1},"end":{"line":368,"column":1}},"children":[{"type":"text","value":"编辑策略文件中的 ","position":{"start":{"line":368,"column":1},"end":{"line":368,"column":1}},"key":"P3yGYVg3Ef"},{"type":"inlineCode","value":"populate_exit_trend()","position":{"start":{"line":368,"column":1},"end":{"line":368,"column":1}},"key":"ixaJ7IInHa"},{"type":"text","value":" 方法，更新出场逻辑。","position":{"start":{"line":368,"column":1},"end":{"line":368,"column":1}},"key":"Ww416y2wtQ"}],"key":"SAx01akuyU"},{"type":"paragraph","position":{"start":{"line":370,"column":1},"end":{"line":370,"column":1}},"children":[{"type":"text","value":"可通过在配置或策略中设置 ","position":{"start":{"line":370,"column":1},"end":{"line":370,"column":1}},"key":"OorNTZOEym"},{"type":"inlineCode","value":"use_exit_signal","position":{"start":{"line":370,"column":1},"end":{"line":370,"column":1}},"key":"vpNSut49Aa"},{"type":"text","value":" 为 false 禁用出场信号。","position":{"start":{"line":370,"column":1},"end":{"line":370,"column":1}},"key":"TRp5BBAHZg"}],"key":"Er86YQlTNf"},{"type":"paragraph","position":{"start":{"line":372,"column":1},"end":{"line":372,"column":1}},"children":[{"type":"inlineCode","value":"use_exit_signal","position":{"start":{"line":372,"column":1},"end":{"line":372,"column":1}},"key":"lUEiZ0Vr06"},{"type":"text","value":" 不影响","position":{"start":{"line":372,"column":1},"end":{"line":372,"column":1}},"key":"Pw9qhFIHo8"},{"type":"link","url":"#%E4%BF%A1%E5%8F%B7%E5%86%B2%E7%AA%81","position":{"start":{"line":372,"column":1},"end":{"line":372,"column":1}},"children":[{"type":"text","value":"信号冲突规则","position":{"start":{"line":372,"column":1},"end":{"line":372,"column":1}},"key":"b7ciw8u9PC"}],"urlSource":"#%E4%BF%A1%E5%8F%B7%E5%86%B2%E7%AA%81","key":"FQFTimoV2n"},{"type":"text","value":"，后者仍然生效，可能阻止入场。","position":{"start":{"line":372,"column":1},"end":{"line":372,"column":1}},"key":"uuA7IvkIpb"}],"key":"pLNEhBMBH4"},{"type":"paragraph","position":{"start":{"line":374,"column":1},"end":{"line":374,"column":1}},"children":[{"type":"text","value":"务必返回 dataframe，且不要删除/修改 “open”, “high”, “low”, “close”, “volume” 这几列，否则会导致异常。","position":{"start":{"line":374,"column":1},"end":{"line":374,"column":1}},"key":"yj7tGLGSw5"}],"key":"liB4c7Rytq"},{"type":"paragraph","position":{"start":{"line":376,"column":1},"end":{"line":376,"column":1}},"children":[{"type":"text","value":"该方法还需定义新列 ","position":{"start":{"line":376,"column":1},"end":{"line":376,"column":1}},"key":"G1g2wwN7KL"},{"type":"inlineCode","value":"exit_long","position":{"start":{"line":376,"column":1},"end":{"line":376,"column":1}},"key":"DXyZucSWZg"},{"type":"text","value":"（做空为 ","position":{"start":{"line":376,"column":1},"end":{"line":376,"column":1}},"key":"UPjmTyu4pz"},{"type":"inlineCode","value":"exit_short","position":{"start":{"line":376,"column":1},"end":{"line":376,"column":1}},"key":"g3DOp1Unf1"},{"type":"text","value":"），出场时为 1，无操作为 0。","position":{"start":{"line":376,"column":1},"end":{"line":376,"column":1}},"key":"qQj6XHysoV"}],"key":"O1zG22WiO1"},{"type":"paragraph","position":{"start":{"line":378,"column":1},"end":{"line":378,"column":1}},"children":[{"type":"text","value":"可用 ","position":{"start":{"line":378,"column":1},"end":{"line":378,"column":1}},"key":"v7K1rfTZe1"},{"type":"inlineCode","value":"exit_tag","position":{"start":{"line":378,"column":1},"end":{"line":378,"column":1}},"key":"c7XSFXh9BA"},{"type":"text","value":" 列为信号命名，便于后续调试和分析。","position":{"start":{"line":378,"column":1},"end":{"line":378,"column":1}},"key":"QGmfWbNwgN"}],"key":"D2QqZVAvrv"},{"type":"paragraph","position":{"start":{"line":380,"column":1},"end":{"line":380,"column":1}},"children":[{"type":"text","value":"示例（来自 sample_strategy.py）：","position":{"start":{"line":380,"column":1},"end":{"line":380,"column":1}},"key":"zv0vb5tb66"}],"key":"P5HHw15eVY"},{"type":"code","lang":"python","value":"def populate_exit_trend(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n    \"\"\"\n    基于技术指标，为给定 dataframe 生成卖出信号\n    :param dataframe: 已填充指标的 DataFrame\n    :param metadata: 额外信息，如当前交易对\n    :return: 包含卖出信号的 DataFrame\n    \"\"\"\n    dataframe.loc[\n        (\n            (qtpylib.crossed_above(dataframe['rsi'], 70)) &  # RSI 上穿 70\n            (dataframe['tema'] > dataframe['bb_middleband']) &  # 条件\n            (dataframe['tema'] < dataframe['tema'].shift(1)) &  # 条件\n            (dataframe['volume'] > 0)  # 确保有成交量\n        ),\n        ['exit_long', 'exit_tag']] = (1, 'rsi_too_high')\n    return dataframe","position":{"start":{"line":382,"column":1},"end":{"line":399,"column":1}},"key":"z0bswAyCF1"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"做空平仓","position":{"start":{"line":401,"column":1},"end":{"line":401,"column":1}},"key":"M4hAL6uOco"}],"key":"Qr6FAmTNlk"},{"type":"paragraph","position":{"start":{"line":402,"column":1},"end":{"line":402,"column":1}},"children":[{"type":"text","value":"做空平仓可通过设置 ","position":{"start":{"line":402,"column":1},"end":{"line":402,"column":1}},"key":"yVl1s0Z1zU"},{"type":"inlineCode","value":"exit_short","position":{"start":{"line":402,"column":1},"end":{"line":402,"column":1}},"key":"d1RG5FmzSk"},{"type":"text","value":"（对应多头的 ","position":{"start":{"line":402,"column":1},"end":{"line":402,"column":1}},"key":"YaBDg6FrOc"},{"type":"inlineCode","value":"exit_long","position":{"start":{"line":402,"column":1},"end":{"line":402,"column":1}},"key":"iMRGX5T3hC"},{"type":"text","value":"）实现。","position":{"start":{"line":402,"column":1},"end":{"line":402,"column":1}},"key":"LqQqxpPsi8"}],"key":"B5cOseijZG"},{"type":"paragraph","position":{"start":{"line":404,"column":1},"end":{"line":404,"column":1}},"children":[{"type":"inlineCode","value":"exit_tag","position":{"start":{"line":404,"column":1},"end":{"line":404,"column":1}},"key":"ajigu9SWAr"},{"type":"text","value":" 列用法相同。","position":{"start":{"line":404,"column":1},"end":{"line":404,"column":1}},"key":"mZ31uD1GST"}],"key":"GMfIcHF3bL"},{"type":"paragraph","position":{"start":{"line":406,"column":1},"end":{"line":406,"column":1}},"children":[{"type":"text","value":"做空需交易所和市场支持！如需做空，务必设置 ","position":{"start":{"line":406,"column":1},"end":{"line":406,"column":1}},"key":"BqcE2VQRsX"},{"type":"link","url":"#can-short","position":{"start":{"line":406,"column":1},"end":{"line":406,"column":1}},"children":[{"type":"inlineCode","value":"can_short","position":{"start":{"line":406,"column":1},"end":{"line":406,"column":1}},"key":"NYwTb37Fzl"}],"urlSource":"#can-short","key":"GhZp9gOA2O"},{"type":"text","value":" 为 True。","position":{"start":{"line":406,"column":1},"end":{"line":406,"column":1}},"key":"aEMbDnyQ9d"}],"key":"ANQazO2lup"},{"type":"code","lang":"python","value":"    # 支持多空\n    can_short = True\n\n    def populate_exit_trend(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n        dataframe.loc[\n            (\n                (qtpylib.crossed_above(dataframe['rsi'], 70)) &\n                (dataframe['tema'] > dataframe['bb_middleband']) &\n                (dataframe['tema'] < dataframe['tema'].shift(1)) &\n                (dataframe['volume'] > 0)\n            ),\n            ['exit_long', 'exit_tag']] = (1, 'rsi_too_high')\n        dataframe.loc[\n            (\n                (qtpylib.crossed_below(dataframe['rsi'], 30)) &\n                (dataframe['tema'] < dataframe['bb_middleband']) &\n                (dataframe['tema'] > dataframe['tema'].shift(1)) &\n                (dataframe['volume'] > 0)\n            ),\n            ['exit_short', 'exit_tag']] = (1, 'rsi_too_low')\n        return dataframe","position":{"start":{"line":408,"column":1},"end":{"line":430,"column":1}},"key":"dV6bvsYnWI"}],"key":"snVBe2vC4B"},{"type":"heading","depth":4,"position":{"start":{"line":434,"column":1},"end":{"line":434,"column":1}},"children":[{"type":"text","value":"最小收益率（ROI）","position":{"start":{"line":434,"column":1},"end":{"line":434,"column":1}},"key":"lRcahZFEnX"}],"identifier":"id-roi","label":"最小收益率（ROI）","html_id":"id-roi","implicit":true,"key":"uM8FFqA5xr"},{"type":"paragraph","position":{"start":{"line":436,"column":1},"end":{"line":436,"column":1}},"children":[{"type":"inlineCode","value":"minimal_roi","position":{"start":{"line":436,"column":1},"end":{"line":436,"column":1}},"key":"sS9UymVqLm"},{"type":"text","value":" 策略变量定义了交易在退出前应达到的最小收益率，与出场信号无关。","position":{"start":{"line":436,"column":1},"end":{"line":436,"column":1}},"key":"K6sur77ayH"}],"key":"nqYpl0O6TP"},{"type":"paragraph","position":{"start":{"line":438,"column":1},"end":{"line":438,"column":1}},"children":[{"type":"text","value":"格式如下，是一个 python 字典，键为开仓后经过的分钟数，值为百分比：","position":{"start":{"line":438,"column":1},"end":{"line":438,"column":1}},"key":"Y873Nwd1Qw"}],"key":"XC4sL5eNM5"},{"type":"code","lang":"python","value":"minimal_roi = {\n    \"40\": 0.0,\n    \"30\": 0.01,\n    \"20\": 0.02,\n    \"0\": 0.04\n}","position":{"start":{"line":440,"column":1},"end":{"line":447,"column":1}},"key":"FvQ3BsXAls"},{"type":"paragraph","position":{"start":{"line":449,"column":1},"end":{"line":449,"column":1}},"children":[{"type":"text","value":"上述配置含义：","position":{"start":{"line":449,"column":1},"end":{"line":449,"column":1}},"key":"dOOhfExKtc"}],"key":"D0SzNarfyp"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":451,"column":1},"end":{"line":455,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":451,"column":1},"end":{"line":451,"column":1}},"children":[{"type":"text","value":"达到 4% 盈利时退出","position":{"start":{"line":451,"column":1},"end":{"line":451,"column":1}},"key":"l59sQ0mLOP"}],"key":"h8MCBIuILR"},{"type":"listItem","spread":true,"position":{"start":{"line":452,"column":1},"end":{"line":452,"column":1}},"children":[{"type":"text","value":"20 分钟后达到 2% 盈利时退出","position":{"start":{"line":452,"column":1},"end":{"line":452,"column":1}},"key":"zSshEL9NYu"}],"key":"Yc95Sda8cH"},{"type":"listItem","spread":true,"position":{"start":{"line":453,"column":1},"end":{"line":453,"column":1}},"children":[{"type":"text","value":"30 分钟后达到 1% 盈利时退出","position":{"start":{"line":453,"column":1},"end":{"line":453,"column":1}},"key":"RKo3PPpsv3"}],"key":"UpB0topXgM"},{"type":"listItem","spread":true,"position":{"start":{"line":454,"column":1},"end":{"line":455,"column":1}},"children":[{"type":"text","value":"40 分钟后只要不亏损就退出","position":{"start":{"line":454,"column":1},"end":{"line":454,"column":1}},"key":"yMFyWHeAxa"}],"key":"V9HfOGIU03"}],"key":"L4JU4FumqT"},{"type":"paragraph","position":{"start":{"line":456,"column":1},"end":{"line":456,"column":1}},"children":[{"type":"text","value":"计算时包含手续费。","position":{"start":{"line":456,"column":1},"end":{"line":456,"column":1}},"key":"slyZQM7CAB"}],"key":"D5cqowSYmM"},{"type":"heading","depth":5,"position":{"start":{"line":458,"column":1},"end":{"line":458,"column":1}},"children":[{"type":"text","value":"禁用最小 ROI","position":{"start":{"line":458,"column":1},"end":{"line":458,"column":1}},"key":"iyq1z1V7Z2"}],"identifier":"id-roi","label":"禁用最小 ROI","html_id":"id-roi-1","implicit":true,"key":"TgsQjzYyaR"},{"type":"paragraph","position":{"start":{"line":460,"column":1},"end":{"line":460,"column":1}},"children":[{"type":"text","value":"如需完全禁用 ROI，将其设为空字典：","position":{"start":{"line":460,"column":1},"end":{"line":460,"column":1}},"key":"P2pCZ5YXaN"}],"key":"nKFFNWFUma"},{"type":"code","lang":"python","value":"minimal_roi = {}","position":{"start":{"line":462,"column":1},"end":{"line":464,"column":1}},"key":"SHsoG7YWeQ"},{"type":"heading","depth":5,"position":{"start":{"line":466,"column":1},"end":{"line":466,"column":1}},"children":[{"type":"text","value":"ROI 中用计算表达式","position":{"start":{"line":466,"column":1},"end":{"line":466,"column":1}},"key":"TxdYIyRiRl"}],"identifier":"roi","label":"ROI 中用计算表达式","html_id":"roi","implicit":true,"key":"rpPPPy09mQ"},{"type":"paragraph","position":{"start":{"line":468,"column":1},"end":{"line":468,"column":1}},"children":[{"type":"text","value":"如需按K线周期（timeframe）设置时间，可用如下写法：","position":{"start":{"line":468,"column":1},"end":{"line":468,"column":1}},"key":"QlTZyjih2M"}],"key":"nXJA6LqnhI"},{"type":"code","lang":"python","value":"from freqtrade.exchange import timeframe_to_minutes\n\nclass AwesomeStrategy(IStrategy):\n\n    timeframe = \"1d\"\n    timeframe_mins = timeframe_to_minutes(timeframe)\n    minimal_roi = {\n        \"0\": 0.05,                      # 前 3 根 K 线 5%\n        str(timeframe_mins * 3): 0.02,  # 3 根 K 线后 2%\n        str(timeframe_mins * 6): 0.01,  # 6 根 K 线后 1%\n    }","position":{"start":{"line":470,"column":1},"end":{"line":482,"column":1}},"key":"V5akae0zm6"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"未立即成交的订单","position":{"start":{"line":484,"column":1},"end":{"line":484,"column":1}},"key":"iqCTmSF6U2"}],"key":"zHPxAQTIpW"},{"type":"paragraph","position":{"start":{"line":485,"column":1},"end":{"line":485,"column":1}},"children":[{"type":"inlineCode","value":"minimal_roi","position":{"start":{"line":485,"column":1},"end":{"line":485,"column":1}},"key":"RZBGBUaNXO"},{"type":"text","value":" 以 ","position":{"start":{"line":485,"column":1},"end":{"line":485,"column":1}},"key":"Ht7tzAk2KR"},{"type":"inlineCode","value":"trade.open_date","position":{"start":{"line":485,"column":1},"end":{"line":485,"column":1}},"key":"uKV4kdGYgw"},{"type":"text","value":" 为基准，即首次下单时间。","position":{"start":{"line":485,"column":1},"end":{"line":485,"column":1}},"key":"NOWWhPoIwf"}],"key":"vlRVLIZiQY"},{"type":"paragraph","position":{"start":{"line":487,"column":1},"end":{"line":487,"column":1}},"children":[{"type":"text","value":"对于未立即成交的限价单（如用 ","position":{"start":{"line":487,"column":1},"end":{"line":487,"column":1}},"key":"euV1oB5Nau"},{"type":"inlineCode","value":"custom_entry_price()","position":{"start":{"line":487,"column":1},"end":{"line":487,"column":1}},"key":"sEsd8JuDvK"},{"type":"text","value":"），或用 ","position":{"start":{"line":487,"column":1},"end":{"line":487,"column":1}},"key":"cCFQAgcozo"},{"type":"inlineCode","value":"adjust_entry_price()","position":{"start":{"line":487,"column":1},"end":{"line":487,"column":1}},"key":"agtketmMxi"},{"type":"text","value":" 调整价格的情况，时间仍以首次下单为准。","position":{"start":{"line":487,"column":1},"end":{"line":487,"column":1}},"key":"R7LpS2QWP7"}],"key":"L2WLYgRgs7"}],"key":"IXuztallwh"},{"type":"heading","depth":4,"position":{"start":{"line":490,"column":1},"end":{"line":490,"column":1}},"children":[{"type":"text","value":"止损","position":{"start":{"line":490,"column":1},"end":{"line":490,"column":1}},"key":"chhsMm3HFD"}],"identifier":"id","label":"止损","html_id":"id-12","implicit":true,"key":"K6MIsjpaou"},{"type":"paragraph","position":{"start":{"line":492,"column":1},"end":{"line":492,"column":1}},"children":[{"type":"text","value":"强烈建议设置止损，以保护资金免受极端行情影响。","position":{"start":{"line":492,"column":1},"end":{"line":492,"column":1}},"key":"SnlwM5iJqd"}],"key":"bHNY7BoBH4"},{"type":"paragraph","position":{"start":{"line":494,"column":1},"end":{"line":494,"column":1}},"children":[{"type":"text","value":"如设置 10% 止损：","position":{"start":{"line":494,"column":1},"end":{"line":494,"column":1}},"key":"Zekdx3rbUd"}],"key":"qYTjW8q4UR"},{"type":"code","lang":"python","value":"stoploss = -0.10","position":{"start":{"line":496,"column":1},"end":{"line":498,"column":1}},"key":"UqhY115y6y"},{"type":"paragraph","position":{"start":{"line":500,"column":1},"end":{"line":500,"column":1}},"children":[{"type":"text","value":"更多止损功能详见","position":{"start":{"line":500,"column":1},"end":{"line":500,"column":1}},"key":"a8DivOkUyX"},{"type":"link","url":"/stoploss","position":{"start":{"line":500,"column":1},"end":{"line":500,"column":1}},"children":[{"type":"text","value":"止损专页","position":{"start":{"line":500,"column":1},"end":{"line":500,"column":1}},"key":"IvjN6JONE6"}],"urlSource":"stoploss.md","dataUrl":"/stoploss.json","internal":true,"protocol":"file","key":"wAr3rzr0bW"},{"type":"text","value":"。","position":{"start":{"line":500,"column":1},"end":{"line":500,"column":1}},"key":"HwaJbqYlVP"}],"key":"jej372EdaM"},{"type":"heading","depth":4,"position":{"start":{"line":502,"column":1},"end":{"line":502,"column":1}},"children":[{"type":"text","value":"时间周期（Timeframe）","position":{"start":{"line":502,"column":1},"end":{"line":502,"column":1}},"key":"UjLWT5nK4d"}],"identifier":"id-timeframe","label":"时间周期（Timeframe）","html_id":"id-timeframe","implicit":true,"key":"ZHZoutwef9"},{"type":"paragraph","position":{"start":{"line":504,"column":1},"end":{"line":504,"column":1}},"children":[{"type":"text","value":"即策略用的K线周期。","position":{"start":{"line":504,"column":1},"end":{"line":504,"column":1}},"key":"d8palBHgHP"}],"key":"pcZepvuhxq"},{"type":"paragraph","position":{"start":{"line":506,"column":1},"end":{"line":506,"column":1}},"children":[{"type":"text","value":"常见值有 “1m”、“5m”、“15m”、“1h”，也可用交易所支持的其他周期。","position":{"start":{"line":506,"column":1},"end":{"line":506,"column":1}},"key":"s75Z2igA9o"}],"key":"epbhYvbZFZ"},{"type":"paragraph","position":{"start":{"line":508,"column":1},"end":{"line":508,"column":1}},"children":[{"type":"text","value":"同一入场/出场信号在不同周期下效果可能完全不同。","position":{"start":{"line":508,"column":1},"end":{"line":508,"column":1}},"key":"KPUdoTFirK"}],"key":"WBUlAjyE9g"},{"type":"paragraph","position":{"start":{"line":510,"column":1},"end":{"line":510,"column":1}},"children":[{"type":"text","value":"在策略方法中可通过 ","position":{"start":{"line":510,"column":1},"end":{"line":510,"column":1}},"key":"IXhhs8Tfjd"},{"type":"inlineCode","value":"self.timeframe","position":{"start":{"line":510,"column":1},"end":{"line":510,"column":1}},"key":"tC1AmU6qHA"},{"type":"text","value":" 访问。","position":{"start":{"line":510,"column":1},"end":{"line":510,"column":1}},"key":"xsNyRgY0fw"}],"key":"o5C2p8ubX2"},{"type":"heading","depth":4,"position":{"start":{"line":512,"column":1},"end":{"line":512,"column":1}},"children":[{"type":"text","value":"是否支持做空","position":{"start":{"line":512,"column":1},"end":{"line":512,"column":1}},"key":"s2kcoDXToD"}],"identifier":"id","label":"是否支持做空","html_id":"id-13","implicit":true,"key":"H4Ruyi4pKr"},{"type":"paragraph","position":{"start":{"line":514,"column":1},"end":{"line":514,"column":1}},"children":[{"type":"text","value":"如需在合约市场做空，需设置 ","position":{"start":{"line":514,"column":1},"end":{"line":514,"column":1}},"key":"ihLE4Sj5g8"},{"type":"inlineCode","value":"can_short = True","position":{"start":{"line":514,"column":1},"end":{"line":514,"column":1}},"key":"GYV7qRfuyN"},{"type":"text","value":"。","position":{"start":{"line":514,"column":1},"end":{"line":514,"column":1}},"key":"ShESe64f16"}],"key":"AaeKLWqkkn"},{"type":"paragraph","position":{"start":{"line":516,"column":1},"end":{"line":516,"column":1}},"children":[{"type":"text","value":"启用后，策略在现货市场会加载失败。","position":{"start":{"line":516,"column":1},"end":{"line":516,"column":1}},"key":"kTRPhsKTXT"}],"key":"yhs1fD2gqW"},{"type":"paragraph","position":{"start":{"line":518,"column":1},"end":{"line":518,"column":1}},"children":[{"type":"text","value":"如 ","position":{"start":{"line":518,"column":1},"end":{"line":518,"column":1}},"key":"j9u7LwyCgh"},{"type":"inlineCode","value":"enter_short","position":{"start":{"line":518,"column":1},"end":{"line":518,"column":1}},"key":"c7REmRBsvx"},{"type":"text","value":" 列有 1，但 ","position":{"start":{"line":518,"column":1},"end":{"line":518,"column":1}},"key":"O9SqBTQ77D"},{"type":"inlineCode","value":"can_short = False","position":{"start":{"line":518,"column":1},"end":{"line":518,"column":1}},"key":"xQun5IQ68G"},{"type":"text","value":"（默认），则即使配置了合约市场也不会做空。","position":{"start":{"line":518,"column":1},"end":{"line":518,"column":1}},"key":"oFekis0sMK"}],"key":"S0X9OuLjaG"},{"type":"heading","depth":4,"position":{"start":{"line":520,"column":1},"end":{"line":520,"column":1}},"children":[{"type":"text","value":"Metadata 字典","position":{"start":{"line":520,"column":1},"end":{"line":520,"column":1}},"key":"oR3Y2dAlap"}],"identifier":"metadata","label":"Metadata 字典","html_id":"metadata","implicit":true,"key":"ldT0HuKlVC"},{"type":"paragraph","position":{"start":{"line":522,"column":1},"end":{"line":523,"column":1}},"children":[{"type":"inlineCode","value":"metadata","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"zwTSKGl24Z"},{"type":"text","value":" 字典（","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"CUBVRBlHC0"},{"type":"inlineCode","value":"populate_entry_trend","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"q8xLpXWn9J"},{"type":"text","value":"、","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"T33lez0Rc5"},{"type":"inlineCode","value":"populate_exit_trend","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"XxNC6UdedD"},{"type":"text","value":"、","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"wjlFR5D9cF"},{"type":"inlineCode","value":"populate_indicators","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"qU1k4wZa1i"},{"type":"text","value":" 可用）包含额外信息。\n目前有 ","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"OijtUx5PcM"},{"type":"inlineCode","value":"pair","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"bWelfZUe24"},{"type":"text","value":"，可通过 ","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"VUReskD2V3"},{"type":"inlineCode","value":"metadata['pair']","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"RjGqcUH7PK"},{"type":"text","value":" 获取，如 ","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"oENfpagm0t"},{"type":"inlineCode","value":"XRP/BTC","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"zKxYCtcOpn"},{"type":"text","value":"（合约市场为 ","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"RZpg0LXBlL"},{"type":"inlineCode","value":"XRP/BTC:BTC","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"qFxbJ5pVGD"},{"type":"text","value":"）。","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"key":"OFUqhyEVUv"}],"key":"SoUF0oyCcO"},{"type":"paragraph","position":{"start":{"line":525,"column":1},"end":{"line":525,"column":1}},"children":[{"type":"text","value":"metadata 不应被修改，也不会在策略函数间持久化。","position":{"start":{"line":525,"column":1},"end":{"line":525,"column":1}},"key":"Jm4CukS18k"}],"key":"h8CnjekI8i"},{"type":"paragraph","position":{"start":{"line":527,"column":1},"end":{"line":527,"column":1}},"children":[{"type":"text","value":"如需持久化信息，请查阅","position":{"start":{"line":527,"column":1},"end":{"line":527,"column":1}},"key":"LS5EplihqE"},{"type":"crossReference","url":"/strategy-advanced","position":{"start":{"line":527,"column":1},"end":{"line":527,"column":1}},"children":[{"type":"text","value":"信息存储","position":{"start":{"line":527,"column":1},"end":{"line":527,"column":1}},"key":"l7AOm5uNPA"}],"urlSource":"strategy-advanced.md#storing-information-persistent","dataUrl":"/strategy-advanced.json","identifier":"storing-information-persistent","label":"storing-information-persistent","remote":true,"protocol":"file","key":"NRtpvVcFrL"},{"type":"text","value":"。","position":{"start":{"line":527,"column":1},"end":{"line":527,"column":1}},"key":"OyOFSDOplm"}],"key":"tXYcZmyna3"},{"type":"include","file":"includes/strategy-imports.md","literal":false,"lang":"markdown","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"策略所需的导入","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"a3hjyrLaow"}],"identifier":"id","label":"策略所需的导入","html_id":"id-14","implicit":true,"key":"JtEztpsEIq"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"在创建策略时，你需要导入必要的模块和类。以下是一个策略所需的导入：","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"g0tdYCDOv8"}],"key":"sfIOuNyl4G"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"默认情况下，我们建议使用以下导入作为策略的基础：\n这将涵盖 freqtrade 功能所需的所有导入。\n当然，你可以根据需要添加更多导入。","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"vSkK3r1SF7"}],"key":"sJXzWtTW6l"},{"type":"code","lang":"python","value":"# flake8: noqa: F401\n# isort: skip_file\n# --- Do not remove these imports ---\nimport numpy as np\nimport pandas as pd\nfrom datetime import datetime, timedelta, timezone\nfrom pandas import DataFrame\nfrom typing import Dict, Optional, Union, Tuple\n\nfrom freqtrade.strategy import (\n    IStrategy,\n    Trade, \n    Order,\n    PairLocks,\n    informative,  # @informative decorator\n    # Hyperopt Parameters\n    BooleanParameter,\n    CategoricalParameter,\n    DecimalParameter,\n    IntParameter,\n    RealParameter,\n    # timeframe helpers\n    timeframe_to_minutes,\n    timeframe_to_next_date,\n    timeframe_to_prev_date,\n    # Strategy helper functions\n    merge_informative_pair,\n    stoploss_from_absolute,\n    stoploss_from_open,\n)\n\n# --------------------------------\n# Add your lib to import here\nimport talib.abstract as ta\nfrom technical import qtpylib","position":{"start":{"line":9,"column":1},"end":{"line":45,"column":1}},"key":"BZ9VuI0bYo"}],"key":"WRO4Vc2mg7"},{"type":"heading","depth":3,"position":{"start":{"line":532,"column":1},"end":{"line":532,"column":1}},"children":[{"type":"text","value":"策略文件加载","position":{"start":{"line":532,"column":1},"end":{"line":532,"column":1}},"key":"YlQMNx6f3F"}],"identifier":"id","label":"策略文件加载","html_id":"id-15","implicit":true,"key":"zJiS3g1yf6"},{"type":"paragraph","position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"children":[{"type":"text","value":"默认情况下，freqtrade 会尝试从 ","position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"key":"es4oebTTPZ"},{"type":"inlineCode","value":"userdir","position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"key":"q1gDbydcJv"},{"type":"text","value":"（默认 ","position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"key":"qPhHHYY1Xb"},{"type":"inlineCode","value":"user_data/strategies","position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"key":"pWVtMVaR8z"},{"type":"text","value":"）下所有 ","position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"key":"jI9bOF9Xdn"},{"type":"inlineCode","value":".py","position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"key":"ktNPRskCWj"},{"type":"text","value":" 文件加载策略。","position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"key":"fgrgvXtLOs"}],"key":"B9kk4Lwiou"},{"type":"paragraph","position":{"start":{"line":536,"column":1},"end":{"line":536,"column":1}},"children":[{"type":"text","value":"假设你的策略叫 ","position":{"start":{"line":536,"column":1},"end":{"line":536,"column":1}},"key":"nbj4KixWJZ"},{"type":"inlineCode","value":"AwesomeStrategy","position":{"start":{"line":536,"column":1},"end":{"line":536,"column":1}},"key":"s0TnPy1GEH"},{"type":"text","value":"，文件为 ","position":{"start":{"line":536,"column":1},"end":{"line":536,"column":1}},"key":"VKZP9RWK0n"},{"type":"inlineCode","value":"user_data/strategies/AwesomeStrategy.py","position":{"start":{"line":536,"column":1},"end":{"line":536,"column":1}},"key":"pNh21zz5rP"},{"type":"text","value":"，可用如下命令 dry（或 live，视配置而定）运行：","position":{"start":{"line":536,"column":1},"end":{"line":536,"column":1}},"key":"DHF9PFGYZf"}],"key":"V4eWkTOEuz"},{"type":"code","lang":"bash","value":"freqtrade trade --strategy AwesomeStrategy","position":{"start":{"line":538,"column":1},"end":{"line":540,"column":1}},"key":"UAuoNaw89L"},{"type":"paragraph","position":{"start":{"line":542,"column":1},"end":{"line":542,"column":1}},"children":[{"type":"text","value":"注意这里用的是类名，不是文件名。","position":{"start":{"line":542,"column":1},"end":{"line":542,"column":1}},"key":"Uu9GtCECbc"}],"key":"YmMelLOYL7"},{"type":"paragraph","position":{"start":{"line":544,"column":1},"end":{"line":544,"column":1}},"children":[{"type":"text","value":"用 ","position":{"start":{"line":544,"column":1},"end":{"line":544,"column":1}},"key":"aMqe9h35Fc"},{"type":"inlineCode","value":"freqtrade list-strategies","position":{"start":{"line":544,"column":1},"end":{"line":544,"column":1}},"key":"KrjyE2GrZ1"},{"type":"text","value":" 可查看所有可加载的策略（正确目录下的所有策略）。会有\"状态\"字段，提示潜在问题。","position":{"start":{"line":544,"column":1},"end":{"line":544,"column":1}},"key":"mzxWdNz7GN"}],"key":"uyg0mM9XfT"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"自定义策略目录","position":{"start":{"line":546,"column":1},"end":{"line":546,"column":1}},"key":"O0B4svMZ6C"}],"key":"giWW1gg1BE"},{"type":"paragraph","position":{"start":{"line":547,"column":1},"end":{"line":547,"column":1}},"children":[{"type":"text","value":"可用 ","position":{"start":{"line":547,"column":1},"end":{"line":547,"column":1}},"key":"VTPVJ9BHO5"},{"type":"inlineCode","value":"--strategy-path user_data/otherPath","position":{"start":{"line":547,"column":1},"end":{"line":547,"column":1}},"key":"RdR3g6URiD"},{"type":"text","value":" 指定其他目录。所有需用策略的命令均支持此参数。","position":{"start":{"line":547,"column":1},"end":{"line":547,"column":1}},"key":"OZUJ0cxWh4"}],"key":"RZa7ZRSDF5"}],"key":"FA52gDDyw4"},{"type":"heading","depth":3,"position":{"start":{"line":550,"column":1},"end":{"line":550,"column":1}},"children":[{"type":"text","value":"辅助交易对（Informative Pairs）","position":{"start":{"line":550,"column":1},"end":{"line":550,"column":1}},"key":"OXlOuUDWPw"}],"identifier":"id-informative-pairs","label":"辅助交易对（Informative Pairs）","html_id":"id-informative-pairs","implicit":true,"key":"MaLVv9LGSQ"},{"type":"heading","depth":4,"position":{"start":{"line":554,"column":1},"end":{"line":554,"column":1}},"children":[{"type":"text","value":"获取非交易对的数据","position":{"start":{"line":554,"column":1},"end":{"line":554,"column":1}},"key":"cLgp0nO0jZ"}],"label":"get-data-for-non-tradeable-pairs","identifier":"get-data-for-non-tradeable-pairs","html_id":"get-data-for-non-tradeable-pairs","key":"W7NZ278QTX"},{"type":"paragraph","position":{"start":{"line":556,"column":1},"end":{"line":556,"column":1}},"children":[{"type":"text","value":"有些策略需要参考更大周期的其他交易对数据。","position":{"start":{"line":556,"column":1},"end":{"line":556,"column":1}},"key":"tKBdL9Pugt"}],"key":"HVsTk8cl9E"},{"type":"paragraph","position":{"start":{"line":558,"column":1},"end":{"line":558,"column":1}},"children":[{"type":"text","value":"这些辅助对的 OHLCV 数据会在常规白名单刷新时一并下载，可通过 ","position":{"start":{"line":558,"column":1},"end":{"line":558,"column":1}},"key":"THjNe6VXpC"},{"type":"inlineCode","value":"DataProvider","position":{"start":{"line":558,"column":1},"end":{"line":558,"column":1}},"key":"Uayb3QZZY1"},{"type":"text","value":" 获取。","position":{"start":{"line":558,"column":1},"end":{"line":558,"column":1}},"key":"nKJi56weM5"}],"key":"ppWGObo6Xk"},{"type":"paragraph","position":{"start":{"line":560,"column":1},"end":{"line":560,"column":1}},"children":[{"type":"text","value":"这些对","position":{"start":{"line":560,"column":1},"end":{"line":560,"column":1}},"key":"JIfFIdIeYJ"},{"type":"strong","position":{"start":{"line":560,"column":1},"end":{"line":560,"column":1}},"children":[{"type":"text","value":"不会","position":{"start":{"line":560,"column":1},"end":{"line":560,"column":1}},"key":"PTzFRu7n3i"}],"key":"GSqDCHvsZ6"},{"type":"text","value":"被交易，除非也在白名单或被动态白名单（如 ","position":{"start":{"line":560,"column":1},"end":{"line":560,"column":1}},"key":"RpO5ziRkYT"},{"type":"inlineCode","value":"VolumePairlist","position":{"start":{"line":560,"column":1},"end":{"line":560,"column":1}},"key":"qxSXa6g2DE"},{"type":"text","value":"）选中。","position":{"start":{"line":560,"column":1},"end":{"line":560,"column":1}},"key":"oPCJi2QBlu"}],"key":"ECujm0XLB3"},{"type":"paragraph","position":{"start":{"line":562,"column":1},"end":{"line":562,"column":1}},"children":[{"type":"text","value":"需用元组指定，格式为 ","position":{"start":{"line":562,"column":1},"end":{"line":562,"column":1}},"key":"NI9Sd8S1gf"},{"type":"inlineCode","value":"(\"pair\", \"timeframe\")","position":{"start":{"line":562,"column":1},"end":{"line":562,"column":1}},"key":"lrtfuH59jU"},{"type":"text","value":"，第一个为交易对，第二个为周期。","position":{"start":{"line":562,"column":1},"end":{"line":562,"column":1}},"key":"QgOIfKRXhh"}],"key":"JXaPn1ZQoK"},{"type":"paragraph","position":{"start":{"line":564,"column":1},"end":{"line":564,"column":1}},"children":[{"type":"text","value":"示例：","position":{"start":{"line":564,"column":1},"end":{"line":564,"column":1}},"key":"q1AciZfKYA"}],"key":"t11udZAe60"},{"type":"code","lang":"python","value":"def informative_pairs(self):\n    return [(\"ETH/USDT\", \"5m\"),\n            (\"BTC/TUSD\", \"15m\"),\n            ]","position":{"start":{"line":566,"column":1},"end":{"line":571,"column":1}},"key":"PX6rHzb5Yk"},{"type":"paragraph","position":{"start":{"line":573,"column":1},"end":{"line":573,"column":1}},"children":[{"type":"text","value":"完整示例见","position":{"start":{"line":573,"column":1},"end":{"line":573,"column":1}},"key":"RcYLVPdjD5"},{"type":"link","url":"#%E5%AE%8C%E6%95%B4%E6%95%B0%E6%8D%AE%E6%8F%90%E4%BE%9B%E8%80%85%E7%A4%BA%E4%BE%8B","position":{"start":{"line":573,"column":1},"end":{"line":573,"column":1}},"children":[{"type":"text","value":"DataProvider 部分","position":{"start":{"line":573,"column":1},"end":{"line":573,"column":1}},"key":"KOvvXAn1i4"}],"urlSource":"#%E5%AE%8C%E6%95%B4%E6%95%B0%E6%8D%AE%E6%8F%90%E4%BE%9B%E8%80%85%E7%A4%BA%E4%BE%8B","key":"eo8009xOfs"},{"type":"text","value":"。","position":{"start":{"line":573,"column":1},"end":{"line":573,"column":1}},"key":"fehISubxKI"}],"key":"M2lf3X2Oa0"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"b7HLzFMJ0Q"}],"key":"vs7EADKJ1x"},{"type":"paragraph","position":{"start":{"line":576,"column":1},"end":{"line":576,"column":1}},"children":[{"type":"text","value":"这些对会随白名单刷新，建议列表不要太长。","position":{"start":{"line":576,"column":1},"end":{"line":576,"column":1}},"key":"elOORPGwU0"}],"key":"lHC4KnbENk"},{"type":"paragraph","position":{"start":{"line":578,"column":1},"end":{"line":578,"column":1}},"children":[{"type":"text","value":"只要交易所支持，所有周期和对都可用。","position":{"start":{"line":578,"column":1},"end":{"line":578,"column":1}},"key":"nFdEmYUCP4"}],"key":"SezrTSp2lr"},{"type":"paragraph","position":{"start":{"line":580,"column":1},"end":{"line":580,"column":1}},"children":[{"type":"text","value":"但建议尽量用重采样方式获取大周期，避免请求过多被封。","position":{"start":{"line":580,"column":1},"end":{"line":580,"column":1}},"key":"CcC6ERaHfV"}],"key":"XYAEmVePKn"}],"key":"BBK4QiuGrG"},{"type":"admonition","kind":"attention","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"其他K线类型","position":{"start":{"line":583,"column":1},"end":{"line":583,"column":1}},"key":"x0ai21kPzW"}],"key":"zD3UoJWBVA"},{"type":"paragraph","position":{"start":{"line":584,"column":1},"end":{"line":584,"column":1}},"children":[{"type":"text","value":"informative_pairs 还可加第三个元素，显式指定K线类型。","position":{"start":{"line":584,"column":1},"end":{"line":584,"column":1}},"key":"KIm9A2yd6x"}],"key":"C8O6MkSEct"},{"type":"paragraph","position":{"start":{"line":586,"column":1},"end":{"line":586,"column":1}},"children":[{"type":"text","value":"可用性取决于交易模式和交易所。一般现货对不能用于合约市场，反之亦然。","position":{"start":{"line":586,"column":1},"end":{"line":586,"column":1}},"key":"goyrCEUOWW"}],"key":"piBl3SxFOr"},{"type":"paragraph","position":{"start":{"line":588,"column":1},"end":{"line":588,"column":1}},"children":[{"type":"text","value":"详情见交易所文档。","position":{"start":{"line":588,"column":1},"end":{"line":588,"column":1}},"key":"MhCUCk4k6h"}],"key":"GjiWxWKk3R"}],"key":"zz7wqRlrpa"},{"type":"code","lang":"python","value":"    def informative_pairs(self):\n        return [\n            (\"ETH/USDT\", \"5m\", \"\"),   # 默认 K 线类型，随 trading_mode 变化（推荐）\n            (\"ETH/USDT\", \"5m\", \"spot\"),   # 强制用现货 K 线（仅现货机器人）\n            (\"BTC/TUSD\", \"15m\", \"futures\"),  # 用合约 K 线（仅合约机器人）\n            (\"BTC/TUSD\", \"15m\", \"mark\"),  # 用标记 K 线（仅合约机器人）\n        ]","position":{"start":{"line":591,"column":1},"end":{"line":599,"column":1}},"key":"QyW3wU05Fp"},{"type":"heading","depth":4,"position":{"start":{"line":601,"column":1},"end":{"line":601,"column":1}},"children":[{"type":"text","value":"Informative pairs 装饰器（","position":{"start":{"line":601,"column":1},"end":{"line":601,"column":1}},"key":"Glmk4r7Yc1"},{"type":"inlineCode","value":"@informative()","position":{"start":{"line":601,"column":1},"end":{"line":601,"column":1}},"key":"a6oAi5fPoZ"},{"type":"text","value":"）","position":{"start":{"line":601,"column":1},"end":{"line":601,"column":1}},"key":"yOLDymFT8O"}],"identifier":"informative-pairs-informative","label":"Informative pairs 装饰器（@informative()）","html_id":"informative-pairs-informative","implicit":true,"key":"yT2bqgxA2i"},{"type":"paragraph","position":{"start":{"line":603,"column":1},"end":{"line":603,"column":1}},"children":[{"type":"text","value":"可用 ","position":{"start":{"line":603,"column":1},"end":{"line":603,"column":1}},"key":"enqFD2frNU"},{"type":"inlineCode","value":"@informative","position":{"start":{"line":603,"column":1},"end":{"line":603,"column":1}},"key":"PnCdrK2LqG"},{"type":"text","value":" 装饰器快速定义 informative pair。所有被装饰的 ","position":{"start":{"line":603,"column":1},"end":{"line":603,"column":1}},"key":"oAO9EwoFJs"},{"type":"inlineCode","value":"populate_indicators_*","position":{"start":{"line":603,"column":1},"end":{"line":603,"column":1}},"key":"KKVYfKWwNz"},{"type":"text","value":" 方法独立运行，不能访问其他 informative pair 的数据。但所有 informative dataframe 会合并传递给主 ","position":{"start":{"line":603,"column":1},"end":{"line":603,"column":1}},"key":"WpE6zFh68d"},{"type":"inlineCode","value":"populate_indicators()","position":{"start":{"line":603,"column":1},"end":{"line":603,"column":1}},"key":"i7yJ7UIks2"},{"type":"text","value":"。","position":{"start":{"line":603,"column":1},"end":{"line":603,"column":1}},"key":"zQGeEDH1pY"}],"key":"X8RPD1EqBJ"},{"type":"admonition","kind":"caution","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Caution","key":"MSh4ON3GdH"}],"key":"sRTNrBFWfA"},{"type":"paragraph","position":{"start":{"line":606,"column":1},"end":{"line":606,"column":1}},"children":[{"type":"text","value":"若需用一个 informative pair 的数据生成另一个 informative pair，请勿用 ","position":{"start":{"line":606,"column":1},"end":{"line":606,"column":1}},"key":"YYnQkjlA36"},{"type":"inlineCode","value":"@informative","position":{"start":{"line":606,"column":1},"end":{"line":606,"column":1}},"key":"Ag8e0aUy59"},{"type":"text","value":" 装饰器，而应手动定义 informative pair，见","position":{"start":{"line":606,"column":1},"end":{"line":606,"column":1}},"key":"gfsFwuGp57"},{"type":"link","url":"#%E5%AE%8C%E6%95%B4%E6%95%B0%E6%8D%AE%E6%8F%90%E4%BE%9B%E8%80%85%E7%A4%BA%E4%BE%8B","position":{"start":{"line":606,"column":1},"end":{"line":606,"column":1}},"children":[{"type":"text","value":"DataProvider 部分","position":{"start":{"line":606,"column":1},"end":{"line":606,"column":1}},"key":"NOaixcM2ZE"}],"urlSource":"#%E5%AE%8C%E6%95%B4%E6%95%B0%E6%8D%AE%E6%8F%90%E4%BE%9B%E8%80%85%E7%A4%BA%E4%BE%8B","key":"PbzFB96OJI"},{"type":"text","value":"。","position":{"start":{"line":606,"column":1},"end":{"line":606,"column":1}},"key":"zKauEvMceR"}],"key":"YOjrgYncTc"}],"key":"Asd6v9h7qX"},{"type":"paragraph","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"children":[{"type":"text","value":"超参优化时，hyperoptable 参数不支持 ","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"key":"XQlNwKNzdP"},{"type":"inlineCode","value":".value","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"key":"JSfIfw3cEw"},{"type":"text","value":"，请用 ","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"key":"o4Q01KCiuQ"},{"type":"inlineCode","value":".range","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"key":"KjT3yxovik"},{"type":"text","value":"。见","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"key":"Bx60jODXgs"},{"type":"crossReference","url":"/hyperopt","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"children":[{"type":"text","value":"优化指标参数","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"key":"RJ5fGdgbq5"}],"urlSource":"hyperopt.md#optimizing-an-indicator-parameter","dataUrl":"/hyperopt.json","identifier":"optimizing-an-indicator-parameter","label":"optimizing-an-indicator-parameter","remote":true,"protocol":"file","key":"RcqK6NzSBR"},{"type":"text","value":"。","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"key":"YmVz2y1Mmw"}],"key":"MW6YWH4Ch7"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"完整文档","position":{"start":{"line":611,"column":1},"end":{"line":611,"column":1}},"key":"wDCoFDthvO"}],"key":"ytHRYlSvmm"},{"type":"code","lang":"python","value":"    def informative(\n        timeframe: str,\n        asset: str = \"\",\n        fmt: str | Callable[[Any], str] | None = None,\n        *,\n        candle_type: CandleType | str | None = None,\n        ffill: bool = True,\n    ) -> Callable[[PopulateIndicators], PopulateIndicators]:\n        \"\"\"\n        用于 populate_indicators_Nn(self, dataframe, metadata) 的装饰器，定义 informative 指标。\n        \n        用法示例：\n\n            @informative('1h')\n            def populate_indicators_1h(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n                dataframe['rsi'] = ta.RSI(dataframe, timeperiod=14)\n                return dataframe\n\n        :param timeframe: 辅助K线周期，必须大于等于主策略周期。\n        :param asset: 辅助资产，如 BTC、BTC/USDT、ETH/BTC。不指定则用当前对。支持格式化字符串。\n        :param fmt: 列名格式（str）或格式化函数。默认：\n        * {base}_{quote}_{column}_{timeframe}（指定 asset 时）\n        * {column}_{timeframe}（未指定 asset 时）\n        支持变量：{base}、{BASE}、{quote}、{QUOTE}、{asset}、{column}、{timeframe}\n        :param ffill: informative pair 合并后是否前向填充。\n        :param candle_type: '', mark, index, premiumIndex, funding_rate\n        \"\"\"","position":{"start":{"line":613,"column":1},"end":{"line":641,"column":1}},"key":"j5SGNDZcQW"}],"key":"Jpr8Z3LUUp"},{"type":"admonition","kind":"hint","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"快速定义 informative pair","position":{"start":{"line":645,"column":1},"end":{"line":645,"column":1}},"key":"w4DqVqygzA"}],"key":"lyHysao30L"},{"type":"paragraph","position":{"start":{"line":647,"column":1},"end":{"line":647,"column":1}},"children":[{"type":"text","value":"大多数情况下无需用 ","position":{"start":{"line":647,"column":1},"end":{"line":647,"column":1}},"key":"gey2xb5Elr"},{"type":"inlineCode","value":"merge_informative_pair()","position":{"start":{"line":647,"column":1},"end":{"line":647,"column":1}},"key":"HpoENelj1x"},{"type":"text","value":"，可直接用装饰器：","position":{"start":{"line":647,"column":1},"end":{"line":647,"column":1}},"key":"hbaCmY7z6g"}],"key":"CAZowrfrbb"},{"type":"code","lang":"python","value":"\n    from datetime import datetime\n    from freqtrade.persistence import Trade\n    from freqtrade.strategy import IStrategy, informative\n\n    class AwesomeStrategy(IStrategy):\n        \n        # 可省略 informative_pairs 方法\n\n        # 为每个对定义高阶周期 informative pair。可叠加装饰器。\n        @informative('30m')\n        @informative('1h')\n        def populate_indicators_1h(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n            dataframe['rsi'] = ta.RSI(dataframe, timeperiod=14)\n            return dataframe\n\n        # 定义 BTC/STAKE informative pair。可用 {stake} 占位符。最终列名如 'btc_usdt_rsi_1h'。\n        @informative('1h', 'BTC/{stake}')\n        def populate_indicators_btc_1h(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n            dataframe['rsi'] = ta.RSI(dataframe, timeperiod=14)\n            return dataframe\n\n        # 定义 BTC/ETH informative pair。需指定 quote。最终列名如 'eth_btc_rsi_1h'。\n        @informative('1h', 'ETH/BTC')\n        def populate_indicators_eth_btc_1h(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n            dataframe['rsi'] = ta.RSI(dataframe, timeperiod=14)\n            return dataframe\n    \n        # 可自定义列名格式\n        @informative('1h', 'BTC/{stake}', '{column}_{timeframe}')\n        def populate_indicators_btc_1h_2(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n            dataframe['rsi_upper'] = ta.RSI(dataframe, timeperiod=14)\n            return dataframe\n    \n        def populate_indicators(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n            dataframe['rsi'] = ta.RSI(dataframe, timeperiod=14)\n            dataframe['rsi_less'] = dataframe['rsi'] < dataframe['rsi_1h']\n            return dataframe","position":{"start":{"line":649,"column":1},"end":{"line":688,"column":1}},"key":"U3Ur7R2mVm"}],"key":"dTjxpr6OME"},{"type":"admonition","kind":"attention","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Attention","key":"mr9Smxps9o"}],"key":"Oo9C0dDpoh"},{"type":"paragraph","position":{"start":{"line":693,"column":1},"end":{"line":693,"column":1}},"children":[{"type":"text","value":"访问其他对的 informative dataframe 时建议用字符串格式化，便于后续更换 stake 货币。","position":{"start":{"line":693,"column":1},"end":{"line":693,"column":1}},"key":"kPONIPqpU7"}],"key":"OAjIMBzJp0"},{"type":"code","lang":"python","value":"    def populate_entry_trend(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n        stake = self.config['stake_currency']\n        dataframe.loc[\n            (\n                (dataframe[f'btc_{stake}_rsi_1h'] < 35)\n                &\n                (dataframe['volume'] > 0)\n            ),\n            ['enter_long', 'enter_tag']] = (1, 'buy_signal_rsi')\n    \n        return dataframe","position":{"start":{"line":695,"column":1},"end":{"line":707,"column":1}},"key":"kbcBTlq3Gl"},{"type":"paragraph","position":{"start":{"line":709,"column":1},"end":{"line":709,"column":1}},"children":[{"type":"text","value":"或用列重命名去除 stake 货币：","position":{"start":{"line":709,"column":1},"end":{"line":709,"column":1}},"key":"ktF1RITUCR"},{"type":"inlineCode","value":"@informative('1h', 'BTC/{stake}', fmt='{base}_{column}_{timeframe}')","position":{"start":{"line":709,"column":1},"end":{"line":709,"column":1}},"key":"XK0Ag0NgwI"},{"type":"text","value":"。","position":{"start":{"line":709,"column":1},"end":{"line":709,"column":1}},"key":"L6qIaqhaJF"}],"key":"krljGEAS7r"}],"key":"gMtzT3gl6H"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"方法名重复","position":{"start":{"line":712,"column":1},"end":{"line":712,"column":1}},"key":"nnC8AmMAFc"}],"key":"Iu294G7hoZ"},{"type":"paragraph","position":{"start":{"line":714,"column":1},"end":{"line":714,"column":1}},"children":[{"type":"text","value":"被 ","position":{"start":{"line":714,"column":1},"end":{"line":714,"column":1}},"key":"nsxdrsXvwx"},{"type":"inlineCode","value":"@informative()","position":{"start":{"line":714,"column":1},"end":{"line":714,"column":1}},"key":"NTpdbqosg6"},{"type":"text","value":" 装饰的方法名必须唯一！重复会覆盖前面的定义且无报错，导致部分指标不可用。请仔细检查方法名。","position":{"start":{"line":714,"column":1},"end":{"line":714,"column":1}},"key":"m92hfwmNQX"}],"key":"qNtgWTMfRf"}],"key":"flyFGuzRos"},{"type":"heading","depth":4,"position":{"start":{"line":717,"column":1},"end":{"line":717,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":717,"column":1},"end":{"line":717,"column":1}},"children":[{"type":"text","value":"merge_informative_pair()","position":{"start":{"line":717,"column":1},"end":{"line":717,"column":1}},"key":"hwJCcSe1UR"}],"key":"qBTUbY2nnQ"}],"identifier":"merge-informative-pair","label":"merge_informative_pair()","html_id":"merge-informative-pair","implicit":true,"key":"rEGe2f0E2W"},{"type":"paragraph","position":{"start":{"line":719,"column":1},"end":{"line":719,"column":1}},"children":[{"type":"text","value":"该方法可安全、无前视偏差地将 informative pair 合并到主 dataframe。","position":{"start":{"line":719,"column":1},"end":{"line":719,"column":1}},"key":"hvtpyl3aXc"}],"key":"shYRflipHY"},{"type":"paragraph","position":{"start":{"line":721,"column":1},"end":{"line":721,"column":1}},"children":[{"type":"text","value":"功能：","position":{"start":{"line":721,"column":1},"end":{"line":721,"column":1}},"key":"db2xnMJPAs"}],"key":"D5v2JLlN0d"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":723,"column":1},"end":{"line":726,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":723,"column":1},"end":{"line":723,"column":1}},"children":[{"type":"text","value":"列重命名，避免冲突","position":{"start":{"line":723,"column":1},"end":{"line":723,"column":1}},"key":"fdFMk5R8Gj"}],"key":"ITz6wmPX5W"},{"type":"listItem","spread":true,"position":{"start":{"line":724,"column":1},"end":{"line":724,"column":1}},"children":[{"type":"text","value":"无前视偏差合并","position":{"start":{"line":724,"column":1},"end":{"line":724,"column":1}},"key":"UZGM4qjZPQ"}],"key":"qXPexd3zkJ"},{"type":"listItem","spread":true,"position":{"start":{"line":725,"column":1},"end":{"line":726,"column":1}},"children":[{"type":"text","value":"可选前向填充","position":{"start":{"line":725,"column":1},"end":{"line":725,"column":1}},"key":"l2A1HG5xtm"}],"key":"rOPRqa5BzD"}],"key":"uINAcMDdm2"},{"type":"paragraph","position":{"start":{"line":727,"column":1},"end":{"line":727,"column":1}},"children":[{"type":"text","value":"完整示例见","position":{"start":{"line":727,"column":1},"end":{"line":727,"column":1}},"key":"n0RYk4dLL2"},{"type":"link","url":"#%E5%AE%8C%E6%95%B4%E6%95%B0%E6%8D%AE%E6%8F%90%E4%BE%9B%E8%80%85%E7%A4%BA%E4%BE%8B","position":{"start":{"line":727,"column":1},"end":{"line":727,"column":1}},"children":[{"type":"text","value":"完整数据提供者示例","position":{"start":{"line":727,"column":1},"end":{"line":727,"column":1}},"key":"Dv8oS3zCYa"}],"urlSource":"#%E5%AE%8C%E6%95%B4%E6%95%B0%E6%8D%AE%E6%8F%90%E4%BE%9B%E8%80%85%E7%A4%BA%E4%BE%8B","key":"Zo0PKxYjzg"},{"type":"text","value":"。","position":{"start":{"line":727,"column":1},"end":{"line":727,"column":1}},"key":"V1mRl6qZt5"}],"key":"hK6GrURB1e"},{"type":"paragraph","position":{"start":{"line":729,"column":1},"end":{"line":729,"column":1}},"children":[{"type":"text","value":"所有 informative dataframe 列会以新名字出现在主 dataframe：","position":{"start":{"line":729,"column":1},"end":{"line":729,"column":1}},"key":"PdyIPKgFig"}],"key":"xFzld7lPNb"},{"type":"admonition","kind":"important","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"列重命名","position":{"start":{"line":731,"column":1},"end":{"line":731,"column":1}},"key":"GWjIdugrba"}],"key":"gfCrQYZMGk"},{"type":"paragraph","position":{"start":{"line":733,"column":1},"end":{"line":733,"column":1}},"children":[{"type":"text","value":"假设 ","position":{"start":{"line":733,"column":1},"end":{"line":733,"column":1}},"key":"aHhbSv7Q9C"},{"type":"inlineCode","value":"inf_tf = '1d'","position":{"start":{"line":733,"column":1},"end":{"line":733,"column":1}},"key":"mE6Xp3rfTt"},{"type":"text","value":"，合并后列名如下：","position":{"start":{"line":733,"column":1},"end":{"line":733,"column":1}},"key":"lfZSsDwl2F"}],"key":"rxtIhsWuVy"},{"type":"code","lang":"python","value":"    'date', 'open', 'high', 'low', 'close', 'rsi'                     # 原 dataframe\n    'date_1d', 'open_1d', 'high_1d', 'low_1d', 'close_1d', 'rsi_1d'   # informative dataframe","position":{"start":{"line":735,"column":1},"end":{"line":738,"column":1}},"key":"nj35uxnXfo"}],"key":"nbb3h3Ifih"},{"type":"admonition","kind":"important","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"1h 列重命名","position":{"start":{"line":742,"column":1},"end":{"line":742,"column":1}},"key":"YC1cW49DYC"}],"key":"vqqybKJrFs"},{"type":"paragraph","position":{"start":{"line":744,"column":1},"end":{"line":744,"column":1}},"children":[{"type":"text","value":"假设 ","position":{"start":{"line":744,"column":1},"end":{"line":744,"column":1}},"key":"pHNinyYChK"},{"type":"inlineCode","value":"inf_tf = '1h'","position":{"start":{"line":744,"column":1},"end":{"line":744,"column":1}},"key":"t6Xqsy40Mr"},{"type":"text","value":"，合并后列名如下：","position":{"start":{"line":744,"column":1},"end":{"line":744,"column":1}},"key":"D1hkinrrsF"}],"key":"e3PFd4eOZ6"},{"type":"code","lang":"python","value":"    'date', 'open', 'high', 'low', 'close', 'rsi'                     # 原 dataframe\n    'date_1h', 'open_1h', 'high_1h', 'low_1h', 'close_1h', 'rsi_1h'   # informative dataframe","position":{"start":{"line":746,"column":1},"end":{"line":749,"column":1}},"key":"QUmcZFG0EC"}],"key":"aF4N4ubudN"},{"type":"admonition","kind":"important","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"自定义实现","position":{"start":{"line":753,"column":1},"end":{"line":753,"column":1}},"key":"GcGzkyJjEE"}],"key":"TgIYSXDdN6"},{"type":"paragraph","position":{"start":{"line":754,"column":1},"end":{"line":754,"column":1}},"children":[{"type":"text","value":"可自定义实现如下：","position":{"start":{"line":754,"column":1},"end":{"line":754,"column":1}},"key":"e00pi8vyKP"}],"key":"ZZjVLaO6xG"},{"type":"code","lang":"python","value":"    # 日期右移 1 根K线\n    # This is necessary since the data is always the \"open date\"\n    # and a 15m candle starting at 12:15 should not know the close of the 1h candle from 12:00 to 13:00\n    minutes = timeframe_to_minutes(inf_tf)\n    # Only do this if the timeframes are different:\n    informative['date_merge'] = informative[\"date\"] + pd.to_timedelta(minutes, 'm')\n\n    # Rename columns to be unique\n    informative.columns = [f\"{col}_{inf_tf}\" for col in informative.columns]\n    # Assuming inf_tf = '1d' - then the columns will now be:\n    # date_1d, open_1d, high_1d, low_1d, close_1d, rsi_1d\n\n    # Combine the 2 dataframes\n    # all indicators on the informative sample MUST be calculated before this point\n    dataframe = pd.merge(dataframe, informative, left_on='date', right_on=f'date_merge_{inf_tf}', how='left')\n    # FFill to have the 1d value available in every row throughout the day.\n    # Without this, comparisons would only work once per day.\n    dataframe = dataframe.ffill()","position":{"start":{"line":756,"column":1},"end":{"line":775,"column":1}},"key":"HmCGwiAhbU"}],"key":"AsCQrqr6lP"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"informative 周期 < 主周期","position":{"start":{"line":778,"column":1},"end":{"line":778,"column":1}},"key":"yUv4hq3dA2"}],"key":"mHkxdKDawh"},{"type":"paragraph","position":{"start":{"line":779,"column":1},"end":{"line":779,"column":1}},"children":[{"type":"text","value":"用本方法时，不建议 informative 周期小于主 dataframe 周期，否则无法利用更多细节。若需用更细粒度信息，需用更高级方法（超出本文档范围）。","position":{"start":{"line":779,"column":1},"end":{"line":779,"column":1}},"key":"UUSS4Br4fb"}],"key":"gf2MPm8Kkd"}],"key":"fqWeOlw5GC"},{"type":"heading","depth":3,"position":{"start":{"line":782,"column":1},"end":{"line":782,"column":1}},"children":[{"type":"text","value":"额外数据（DataProvider）","position":{"start":{"line":782,"column":1},"end":{"line":782,"column":1}},"key":"M1VgmMa04o"}],"identifier":"id-dataprovider","label":"额外数据（DataProvider）","html_id":"id-dataprovider","implicit":true,"key":"JLolsGPCPS"},{"type":"paragraph","position":{"start":{"line":784,"column":1},"end":{"line":784,"column":1}},"children":[{"type":"text","value":"策略可通过 ","position":{"start":{"line":784,"column":1},"end":{"line":784,"column":1}},"key":"UyDINYUSKi"},{"type":"inlineCode","value":"DataProvider","position":{"start":{"line":784,"column":1},"end":{"line":784,"column":1}},"key":"QsNz47v0o1"},{"type":"text","value":" 获取更多数据。","position":{"start":{"line":784,"column":1},"end":{"line":784,"column":1}},"key":"JqbECe3ygK"}],"key":"jFjcg1OTnF"},{"type":"paragraph","position":{"start":{"line":786,"column":1},"end":{"line":786,"column":1}},"children":[{"type":"text","value":"所有方法失败时返回 None，不抛异常。","position":{"start":{"line":786,"column":1},"end":{"line":786,"column":1}},"key":"Jz0D1WHzLY"}],"key":"vEBE0sXzpW"},{"type":"paragraph","position":{"start":{"line":788,"column":1},"end":{"line":788,"column":1}},"children":[{"type":"text","value":"请根据运行模式选择合适方法（见下文示例）。","position":{"start":{"line":788,"column":1},"end":{"line":788,"column":1}},"key":"I6TXAHd6hF"}],"key":"PDNWdl0k6D"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"超参优化限制","position":{"start":{"line":790,"column":1},"end":{"line":790,"column":1}},"key":"mnzV7ptdv3"}],"key":"Clqh5uJdsV"},{"type":"paragraph","position":{"start":{"line":791,"column":1},"end":{"line":791,"column":1}},"children":[{"type":"text","value":"DataProvider 在超参优化时可用，但仅限于策略内的 ","position":{"start":{"line":791,"column":1},"end":{"line":791,"column":1}},"key":"RzLCkYBFcA"},{"type":"inlineCode","value":"populate_indicators()","position":{"start":{"line":791,"column":1},"end":{"line":791,"column":1}},"key":"L1YiNun54Q"},{"type":"text","value":"，不可用于超参优化类文件。","position":{"start":{"line":791,"column":1},"end":{"line":791,"column":1}},"key":"N1m5soTR2Z"}],"key":"t05bb9qKfg"},{"type":"paragraph","position":{"start":{"line":793,"column":1},"end":{"line":793,"column":1}},"children":[{"type":"text","value":"也不可用于 ","position":{"start":{"line":793,"column":1},"end":{"line":793,"column":1}},"key":"dkCrVUqph9"},{"type":"inlineCode","value":"populate_entry_trend()","position":{"start":{"line":793,"column":1},"end":{"line":793,"column":1}},"key":"QG0xpTS2TU"},{"type":"text","value":" 和 ","position":{"start":{"line":793,"column":1},"end":{"line":793,"column":1}},"key":"F7wfWPfrUC"},{"type":"inlineCode","value":"populate_exit_trend()","position":{"start":{"line":793,"column":1},"end":{"line":793,"column":1}},"key":"xWMCcHrz4J"},{"type":"text","value":"。","position":{"start":{"line":793,"column":1},"end":{"line":793,"column":1}},"key":"mtNXDfJRa4"}],"key":"TWk0DMwjRE"}],"key":"yGEvMBVeJz"},{"type":"heading","depth":4,"position":{"start":{"line":796,"column":1},"end":{"line":796,"column":1}},"children":[{"type":"text","value":"DataProvider 可用方法","position":{"start":{"line":796,"column":1},"end":{"line":796,"column":1}},"key":"wD06pTlYKi"}],"identifier":"dataprovider","label":"DataProvider 可用方法","html_id":"dataprovider","implicit":true,"key":"dbeiKFlw2f"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":798,"column":1},"end":{"line":808,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":798,"column":1},"end":{"line":798,"column":1}},"children":[{"type":"link","url":"#available_pairs","position":{"start":{"line":798,"column":1},"end":{"line":798,"column":1}},"children":[{"type":"inlineCode","value":"available_pairs","position":{"start":{"line":798,"column":1},"end":{"line":798,"column":1}},"key":"II7SifXFkS"}],"urlSource":"#available_pairs","key":"RRjYUHFIBH"},{"type":"text","value":" - 返回缓存的所有对及其周期（pair, timeframe）元组","position":{"start":{"line":798,"column":1},"end":{"line":798,"column":1}},"key":"j2NRFJxINm"}],"key":"TYGhBA42gh"},{"type":"listItem","spread":true,"position":{"start":{"line":799,"column":1},"end":{"line":799,"column":1}},"children":[{"type":"link","url":"#current_whitelist","position":{"start":{"line":799,"column":1},"end":{"line":799,"column":1}},"children":[{"type":"inlineCode","value":"current_whitelist()","position":{"start":{"line":799,"column":1},"end":{"line":799,"column":1}},"key":"dJhNJcSoyH"}],"urlSource":"#current_whitelist","key":"o4QeKLkoN7"},{"type":"text","value":" - 返回当前白名单对列表，适合动态白名单（如 VolumePairlist）","position":{"start":{"line":799,"column":1},"end":{"line":799,"column":1}},"key":"JbTJBBAsZ6"}],"key":"lrZtVigTZ8"},{"type":"listItem","spread":true,"position":{"start":{"line":800,"column":1},"end":{"line":800,"column":1}},"children":[{"type":"link","url":"#get_pair_dataframepair-timeframe","position":{"start":{"line":800,"column":1},"end":{"line":800,"column":1}},"children":[{"type":"inlineCode","value":"get_pair_dataframe(pair, timeframe)","position":{"start":{"line":800,"column":1},"end":{"line":800,"column":1}},"key":"hSLuIS1uKn"}],"urlSource":"#get_pair_dataframepair-timeframe","key":"mgeA2Dg5sy"},{"type":"text","value":" - 通用方法，回测时返回历史数据，dry/live 时返回缓存数据","position":{"start":{"line":800,"column":1},"end":{"line":800,"column":1}},"key":"fxuDdefOZB"}],"key":"jdHuetfL0l"},{"type":"listItem","spread":true,"position":{"start":{"line":801,"column":1},"end":{"line":801,"column":1}},"children":[{"type":"link","url":"#get_analyzed_dataframepair-timeframe","position":{"start":{"line":801,"column":1},"end":{"line":801,"column":1}},"children":[{"type":"inlineCode","value":"get_analyzed_dataframe(pair, timeframe)","position":{"start":{"line":801,"column":1},"end":{"line":801,"column":1}},"key":"skynpCYOJS"}],"urlSource":"#get_analyzed_dataframepair-timeframe","key":"JwZDj2oiYq"},{"type":"text","value":" - 返回分析后的 dataframe 及最新分析时间","position":{"start":{"line":801,"column":1},"end":{"line":801,"column":1}},"key":"FmOeOoWvvs"}],"key":"CAPIB2fvUO"},{"type":"listItem","spread":true,"position":{"start":{"line":802,"column":1},"end":{"line":802,"column":1}},"children":[{"type":"inlineCode","value":"historic_ohlcv(pair, timeframe)","position":{"start":{"line":802,"column":1},"end":{"line":802,"column":1}},"key":"tUejiV1X2B"},{"type":"text","value":" - 返回磁盘上的历史数据","position":{"start":{"line":802,"column":1},"end":{"line":802,"column":1}},"key":"nqvq5ITD6d"}],"key":"TwajIoQn8a"},{"type":"listItem","spread":true,"position":{"start":{"line":803,"column":1},"end":{"line":803,"column":1}},"children":[{"type":"inlineCode","value":"market(pair)","position":{"start":{"line":803,"column":1},"end":{"line":803,"column":1}},"key":"hUGRmyB74y"},{"type":"text","value":" - 返回交易对市场数据（手续费、限额、精度、活跃标志等）","position":{"start":{"line":803,"column":1},"end":{"line":803,"column":1}},"key":"ESIXuukZ9x"}],"key":"V2JniOeEvO"},{"type":"listItem","spread":true,"position":{"start":{"line":804,"column":1},"end":{"line":804,"column":1}},"children":[{"type":"inlineCode","value":"ohlcv(pair, timeframe)","position":{"start":{"line":804,"column":1},"end":{"line":804,"column":1}},"key":"t0Z3FvdGiO"},{"type":"text","value":" - 返回当前缓存的K线数据","position":{"start":{"line":804,"column":1},"end":{"line":804,"column":1}},"key":"gwCeu8pcVH"}],"key":"jAkzEx2YIr"},{"type":"listItem","spread":true,"position":{"start":{"line":805,"column":1},"end":{"line":805,"column":1}},"children":[{"type":"link","url":"#orderbookpair-maximum","position":{"start":{"line":805,"column":1},"end":{"line":805,"column":1}},"children":[{"type":"inlineCode","value":"orderbook(pair, maximum)","position":{"start":{"line":805,"column":1},"end":{"line":805,"column":1}},"key":"tJCxOJKFeL"}],"urlSource":"#orderbookpair-maximum","key":"L1OPs8Cudd"},{"type":"text","value":" - 返回最新 orderbook 数据（bids/asks）","position":{"start":{"line":805,"column":1},"end":{"line":805,"column":1}},"key":"o0kULWXcgK"}],"key":"l7SeIsn2q5"},{"type":"listItem","spread":true,"position":{"start":{"line":806,"column":1},"end":{"line":806,"column":1}},"children":[{"type":"link","url":"#tickerpair","position":{"start":{"line":806,"column":1},"end":{"line":806,"column":1}},"children":[{"type":"inlineCode","value":"ticker(pair)","position":{"start":{"line":806,"column":1},"end":{"line":806,"column":1}},"key":"v6xPqPeLIt"}],"urlSource":"#tickerpair","key":"FoR9G99PeK"},{"type":"text","value":" - 返回当前 ticker 数据","position":{"start":{"line":806,"column":1},"end":{"line":806,"column":1}},"key":"kiAtRsvAaq"}],"key":"kEs9P3LbaH"},{"type":"listItem","spread":true,"position":{"start":{"line":807,"column":1},"end":{"line":808,"column":1}},"children":[{"type":"inlineCode","value":"runmode","position":{"start":{"line":807,"column":1},"end":{"line":807,"column":1}},"key":"JVt5wDtXpN"},{"type":"text","value":" - 当前运行模式","position":{"start":{"line":807,"column":1},"end":{"line":807,"column":1}},"key":"rL5nPcCdkp"}],"key":"T9MksgmYsf"}],"key":"OuTswTOcHX"},{"type":"heading","depth":4,"position":{"start":{"line":809,"column":1},"end":{"line":809,"column":1}},"children":[{"type":"text","value":"示例用法","position":{"start":{"line":809,"column":1},"end":{"line":809,"column":1}},"key":"FM6syXaYar"}],"identifier":"id","label":"示例用法","html_id":"id-16","implicit":true,"key":"q0eFd5w2wx"},{"type":"heading","depth":4,"position":{"start":{"line":811,"column":1},"end":{"line":811,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":811,"column":1},"end":{"line":811,"column":1}},"children":[{"type":"text","value":"available_pairs","position":{"start":{"line":811,"column":1},"end":{"line":811,"column":1}},"key":"G7Rpqnk3BS"}],"key":"to5N92P8te"}],"identifier":"available-pairs","label":"available_pairs","html_id":"available-pairs","implicit":true,"key":"Nm2IasMkox"},{"type":"code","lang":"python","value":"for pair, timeframe in self.dp.available_pairs:\n    print(f\"available {pair}, {timeframe}\")","position":{"start":{"line":813,"column":1},"end":{"line":816,"column":1}},"key":"UiueNhst6E"},{"type":"heading","depth":4,"position":{"start":{"line":818,"column":1},"end":{"line":818,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":818,"column":1},"end":{"line":818,"column":1}},"children":[{"type":"text","value":"current_whitelist()","position":{"start":{"line":818,"column":1},"end":{"line":818,"column":1}},"key":"HaRH6140AC"}],"key":"kPXrHN9AAc"}],"identifier":"current-whitelist","label":"current_whitelist()","html_id":"current-whitelist","implicit":true,"key":"fWMPr5AKGG"},{"type":"paragraph","position":{"start":{"line":820,"column":1},"end":{"line":820,"column":1}},"children":[{"type":"text","value":"假设你开发了一个用 ","position":{"start":{"line":820,"column":1},"end":{"line":820,"column":1}},"key":"M25uLHrKKj"},{"type":"inlineCode","value":"5m","position":{"start":{"line":820,"column":1},"end":{"line":820,"column":1}},"key":"bBQs5ofjbS"},{"type":"text","value":" 周期、用 ","position":{"start":{"line":820,"column":1},"end":{"line":820,"column":1}},"key":"LhLApFHqXf"},{"type":"inlineCode","value":"1d","position":{"start":{"line":820,"column":1},"end":{"line":820,"column":1}},"key":"KWlFNryZnR"},{"type":"text","value":" 周期信号的策略，且用 VolumePairList 动态选前 10 个交易对。","position":{"start":{"line":820,"column":1},"end":{"line":820,"column":1}},"key":"JlfWqPC61O"}],"key":"uKzRM0Q1lJ"},{"type":"paragraph","position":{"start":{"line":822,"column":1},"end":{"line":822,"column":1}},"children":[{"type":"text","value":"策略逻辑如下：","position":{"start":{"line":822,"column":1},"end":{"line":822,"column":1}},"key":"h28RSalQDk"}],"key":"xfgwta0tdW"},{"type":"paragraph","position":{"start":{"line":824,"column":1},"end":{"line":824,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":824,"column":1},"end":{"line":824,"column":1}},"children":[{"type":"text","value":"每 5 分钟扫描前 10 个交易对，用 14 日 RSI 生成信号。","position":{"start":{"line":824,"column":1},"end":{"line":824,"column":1}},"key":"Fr7YQmLePu"}],"key":"yY3PVpErDW"}],"key":"LAD7UX0d4l"},{"type":"paragraph","position":{"start":{"line":826,"column":1},"end":{"line":826,"column":1}},"children":[{"type":"text","value":"因数据有限，无法用 5m K 线重采样成日线。大多数交易所只给 500-1000 根K线，约等于 1.74 天。我们需要至少 14 天！","position":{"start":{"line":826,"column":1},"end":{"line":826,"column":1}},"key":"M0ApOhGEwG"}],"key":"i4YVQRaRBK"},{"type":"paragraph","position":{"start":{"line":828,"column":1},"end":{"line":828,"column":1}},"children":[{"type":"text","value":"因此需用 informative pair，且因白名单动态变化，不知用哪些对！","position":{"start":{"line":828,"column":1},"end":{"line":828,"column":1}},"key":"sZ4w0NLpGD"}],"key":"Wwnm9FowEw"},{"type":"paragraph","position":{"start":{"line":830,"column":1},"end":{"line":830,"column":1}},"children":[{"type":"text","value":"此时可用 ","position":{"start":{"line":830,"column":1},"end":{"line":830,"column":1}},"key":"FP2L8iCda1"},{"type":"inlineCode","value":"self.dp.current_whitelist()","position":{"start":{"line":830,"column":1},"end":{"line":830,"column":1}},"key":"kIcxIzowBy"},{"type":"text","value":" 获取当前白名单对。","position":{"start":{"line":830,"column":1},"end":{"line":830,"column":1}},"key":"VKPJVAYItY"}],"key":"qtJ6Ghq1XN"},{"type":"code","lang":"python","value":"    def informative_pairs(self):\n\n        # 获取白名单所有对\n        pairs = self.dp.current_whitelist()\n        # 为每个对分配周期\n        informative_pairs = [(pair, '1d') for pair in pairs]\n        return informative_pairs","position":{"start":{"line":832,"column":1},"end":{"line":840,"column":1}},"key":"rPn9hbloUt"},{"type":"admonition","kind":"caution","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"current_whitelist 用于绘图","position":{"start":{"line":842,"column":1},"end":{"line":842,"column":1}},"key":"lIcRcqtLPD"}],"key":"zn8rMLLh3M"},{"type":"paragraph","position":{"start":{"line":843,"column":1},"end":{"line":843,"column":1}},"children":[{"type":"text","value":"current_whitelist 不支持 ","position":{"start":{"line":843,"column":1},"end":{"line":843,"column":1}},"key":"Z89xvSXNsV"},{"type":"inlineCode","value":"plot-dataframe","position":{"start":{"line":843,"column":1},"end":{"line":843,"column":1}},"key":"lvdVuHli40"},{"type":"text","value":"，也不支持 FreqUI 可视化（webserver 模式），因 webserver 配置无需白名单。","position":{"start":{"line":843,"column":1},"end":{"line":843,"column":1}},"key":"HrXwXDeL4e"}],"key":"Q4xSbrQMp0"}],"key":"hQmgbzHhx5"},{"type":"heading","depth":4,"position":{"start":{"line":846,"column":1},"end":{"line":846,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":846,"column":1},"end":{"line":846,"column":1}},"children":[{"type":"text","value":"get_pair_dataframe(pair, timeframe)","position":{"start":{"line":846,"column":1},"end":{"line":846,"column":1}},"key":"X0xPIN2tIg"}],"key":"UlMx1KSZ1l"}],"identifier":"get-pair-dataframe-pair-timeframe","label":"get_pair_dataframe(pair, timeframe)","html_id":"get-pair-dataframe-pair-timeframe","implicit":true,"key":"UMPyB5BG6I"},{"type":"code","lang":"python","value":"# 获取第一个 informative pair 的K线数据\ninf_pair, inf_timeframe = self.informative_pairs()[0]\ninformative = self.dp.get_pair_dataframe(pair=inf_pair,\n                                         timeframe=inf_timeframe)","position":{"start":{"line":848,"column":1},"end":{"line":853,"column":1}},"key":"bM3C64BRzf"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"回测注意","position":{"start":{"line":855,"column":1},"end":{"line":855,"column":1}},"key":"Ln55hHhbEs"}],"key":"RMykCQ1pDg"},{"type":"paragraph","position":{"start":{"line":856,"column":1},"end":{"line":856,"column":1}},"children":[{"type":"text","value":"回测时，","position":{"start":{"line":856,"column":1},"end":{"line":856,"column":1}},"key":"bHeAuA7hzM"},{"type":"inlineCode","value":"dp.get_pair_dataframe()","position":{"start":{"line":856,"column":1},"end":{"line":856,"column":1}},"key":"u2mD7X2fUQ"},{"type":"text","value":" 在 ","position":{"start":{"line":856,"column":1},"end":{"line":856,"column":1}},"key":"kOqBzX1Vab"},{"type":"inlineCode","value":"populate_*()","position":{"start":{"line":856,"column":1},"end":{"line":856,"column":1}},"key":"o1JmZn6zDa"},{"type":"text","value":" 方法中返回完整时间区间。请勿\"看未来\"，否则 dry/live 时会有意外。","position":{"start":{"line":856,"column":1},"end":{"line":856,"column":1}},"key":"WokAR21Fhf"}],"key":"eCChMhuNZl"},{"type":"paragraph","position":{"start":{"line":858,"column":1},"end":{"line":858,"column":1}},"children":[{"type":"text","value":"在 ","position":{"start":{"line":858,"column":1},"end":{"line":858,"column":1}},"key":"jGguUBKDt7"},{"type":"link","url":"/strategy-callbacks","position":{"start":{"line":858,"column":1},"end":{"line":858,"column":1}},"children":[{"type":"text","value":"回调函数","position":{"start":{"line":858,"column":1},"end":{"line":858,"column":1}},"key":"ckiKYafmGW"}],"urlSource":"strategy-callbacks.md","dataUrl":"/strategy-callbacks.json","internal":true,"protocol":"file","key":"t5fh0ysC53"},{"type":"text","value":" 中，则只返回当前（模拟）K线前的数据。","position":{"start":{"line":858,"column":1},"end":{"line":858,"column":1}},"key":"auESGfl83o"}],"key":"p1f2MSEyJv"}],"key":"fR9hvwOKxE"},{"type":"heading","depth":4,"position":{"start":{"line":861,"column":1},"end":{"line":861,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":861,"column":1},"end":{"line":861,"column":1}},"children":[{"type":"text","value":"get_analyzed_dataframe(pair, timeframe)","position":{"start":{"line":861,"column":1},"end":{"line":861,"column":1}},"key":"zXa00ZeIMF"}],"key":"SMtDKuqSgi"}],"identifier":"get-analyzed-dataframe-pair-timeframe","label":"get_analyzed_dataframe(pair, timeframe)","html_id":"get-analyzed-dataframe-pair-timeframe","implicit":true,"key":"K2kJcJnZUz"},{"type":"paragraph","position":{"start":{"line":863,"column":1},"end":{"line":863,"column":1}},"children":[{"type":"text","value":"该方法供 freqtrade 内部用来判断最后信号，也可在特定回调中用来获取触发操作的信号（见","position":{"start":{"line":863,"column":1},"end":{"line":863,"column":1}},"key":"xff2KHNZpp"},{"type":"link","url":"/strategy-advanced","position":{"start":{"line":863,"column":1},"end":{"line":863,"column":1}},"children":[{"type":"text","value":"高级策略文档","position":{"start":{"line":863,"column":1},"end":{"line":863,"column":1}},"key":"pzJ1pjIBVH"}],"urlSource":"strategy-advanced.md","dataUrl":"/strategy-advanced.json","internal":true,"protocol":"file","key":"twfQeBDn7Q"},{"type":"text","value":"）。","position":{"start":{"line":863,"column":1},"end":{"line":863,"column":1}},"key":"YgbK1dEhN7"}],"key":"gdSU1oPF0z"},{"type":"code","lang":"python","value":"# 获取当前 dataframe\ndataframe, last_updated = self.dp.get_analyzed_dataframe(pair=metadata['pair'],\n                                                         timeframe=self.timeframe)","position":{"start":{"line":865,"column":1},"end":{"line":869,"column":1}},"key":"vBdims1lnQ"},{"type":"admonition","kind":"caution","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"无数据","position":{"start":{"line":871,"column":1},"end":{"line":871,"column":1}},"key":"evh7zFvK1U"}],"key":"xQD4G3QjCM"},{"type":"paragraph","position":{"start":{"line":872,"column":1},"end":{"line":872,"column":1}},"children":[{"type":"text","value":"若请求的对未缓存，返回空 dataframe。可用 ","position":{"start":{"line":872,"column":1},"end":{"line":872,"column":1}},"key":"MA1kdmJHxT"},{"type":"inlineCode","value":"if dataframe.empty:","position":{"start":{"line":872,"column":1},"end":{"line":872,"column":1}},"key":"SP77TTA0Pi"},{"type":"text","value":" 检查。","position":{"start":{"line":872,"column":1},"end":{"line":872,"column":1}},"key":"Xehx1nYI8b"}],"key":"BRHjVlLNOt"}],"key":"fb6ugImfMv"},{"type":"heading","depth":4,"position":{"start":{"line":875,"column":1},"end":{"line":875,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":875,"column":1},"end":{"line":875,"column":1}},"children":[{"type":"text","value":"orderbook(pair, maximum)","position":{"start":{"line":875,"column":1},"end":{"line":875,"column":1}},"key":"YTZhomrQ7Q"}],"key":"LgJxCEYWBc"}],"identifier":"orderbook-pair-maximum","label":"orderbook(pair, maximum)","html_id":"orderbook-pair-maximum","implicit":true,"key":"OVLRWRaDIQ"},{"type":"code","lang":"python","value":"if self.dp.runmode.value in ('live', 'dry_run'):\n    ob = self.dp.orderbook(metadata['pair'], 1)\n    dataframe['best_bid'] = ob['bids'][0][0]\n    dataframe['best_ask'] = ob['asks'][0][0]","position":{"start":{"line":877,"column":1},"end":{"line":882,"column":1}},"key":"ybERjvUfOe"},{"type":"paragraph","position":{"start":{"line":884,"column":1},"end":{"line":884,"column":1}},"children":[{"type":"text","value":"orderbook 结构与 ","position":{"start":{"line":884,"column":1},"end":{"line":884,"column":1}},"key":"ubUtMIyyvY"},{"type":"link","url":"https://github.com/ccxt/ccxt/wiki/Manual#order-book-structure","position":{"start":{"line":884,"column":1},"end":{"line":884,"column":1}},"children":[{"type":"text","value":"ccxt","position":{"start":{"line":884,"column":1},"end":{"line":884,"column":1}},"key":"LqUlqQ8Re8"}],"urlSource":"https://github.com/ccxt/ccxt/wiki/Manual#order-book-structure","error":true,"key":"rpvF7XkMth"},{"type":"text","value":" 一致：","position":{"start":{"line":884,"column":1},"end":{"line":884,"column":1}},"key":"x1hLuuPdHt"}],"key":"n6lfBwefyK"},{"type":"code","lang":"js","value":"{\n    'bids': [\n        [ price, amount ],\n        ...\n    ],\n    'asks': [\n        [ price, amount ],\n        ...\n    ],\n}","position":{"start":{"line":886,"column":1},"end":{"line":897,"column":1}},"key":"gDdCOvThj4"},{"type":"paragraph","position":{"start":{"line":899,"column":1},"end":{"line":899,"column":1}},"children":[{"type":"text","value":"用 ","position":{"start":{"line":899,"column":1},"end":{"line":899,"column":1}},"key":"dT8hCn2Eo3"},{"type":"inlineCode","value":"ob['bids'][0][0]","position":{"start":{"line":899,"column":1},"end":{"line":899,"column":1}},"key":"dYxVYptUM5"},{"type":"text","value":" 可取最优买价，","position":{"start":{"line":899,"column":1},"end":{"line":899,"column":1}},"key":"zkLwCnZgZf"},{"type":"inlineCode","value":"ob['bids'][0][1]","position":{"start":{"line":899,"column":1},"end":{"line":899,"column":1}},"key":"hdTW8swvmh"},{"type":"text","value":" 为该价位数量。","position":{"start":{"line":899,"column":1},"end":{"line":899,"column":1}},"key":"f1lymiS6Ae"}],"key":"wnHlVB9RTU"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"回测注意","position":{"start":{"line":901,"column":1},"end":{"line":901,"column":1}},"key":"Ac8yilNSmT"}],"key":"G3zsxGpvEk"},{"type":"paragraph","position":{"start":{"line":902,"column":1},"end":{"line":902,"column":1}},"children":[{"type":"text","value":"订单簿不是历史数据的一部分，这意味着如果使用此方法，回测和超参数优化将无法正常工作，因为该方法将返回最新值。","position":{"start":{"line":902,"column":1},"end":{"line":902,"column":1}},"key":"WAMgaaYn12"}],"key":"zjLmPES3w2"}],"key":"lU7Lnflx5q"},{"type":"heading","depth":4,"position":{"start":{"line":905,"column":1},"end":{"line":905,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":905,"column":1},"end":{"line":905,"column":1}},"children":[{"type":"text","value":"ticker(pair)","position":{"start":{"line":905,"column":1},"end":{"line":905,"column":1}},"key":"kcteJtgA6S"}],"key":"BeVqv6qKW2"}],"identifier":"ticker-pair","label":"ticker(pair)","html_id":"ticker-pair","implicit":true,"key":"aptsuC1suA"},{"type":"code","lang":"python","value":"if self.dp.runmode.value in ('live', 'dry_run'):\n    ticker = self.dp.ticker(metadata['pair'])\n    dataframe['last_price'] = ticker['last']\n    dataframe['volume24h'] = ticker['quoteVolume']\n    dataframe['vwap'] = ticker['vwap']","position":{"start":{"line":907,"column":1},"end":{"line":913,"column":1}},"key":"zp8sYU6oeg"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"QouQIvzFgf"}],"key":"Ls5mMJTFSl"},{"type":"paragraph","position":{"start":{"line":916,"column":1},"end":{"line":916,"column":1}},"children":[{"type":"text","value":"虽然 ticker 数据结构是 ccxt 统一接口的一部分，但不同交易所返回的值可能会有所不同。例如，许多交易所不返回 ","position":{"start":{"line":916,"column":1},"end":{"line":916,"column":1}},"key":"ebrPv7nKTX"},{"type":"inlineCode","value":"vwap","position":{"start":{"line":916,"column":1},"end":{"line":916,"column":1}},"key":"wreJMHiSZ9"},{"type":"text","value":" 值，一些交易所并不总是填充 ","position":{"start":{"line":916,"column":1},"end":{"line":916,"column":1}},"key":"gmblshHDt8"},{"type":"inlineCode","value":"last","position":{"start":{"line":916,"column":1},"end":{"line":916,"column":1}},"key":"PAN0pnhf9P"},{"type":"text","value":" 字段（所以它可能为 None）等。因此，您需要仔细验证从交易所返回的 ticker 数据，并添加适当的错误处理/默认值。","position":{"start":{"line":916,"column":1},"end":{"line":916,"column":1}},"key":"zcWOkoFmBh"}],"key":"sySC1jmo2S"}],"key":"VHYi7fdQt1"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"回测警告","position":{"start":{"line":919,"column":1},"end":{"line":919,"column":1}},"key":"heSbI17h6h"}],"key":"nQUKqeuJop"},{"type":"paragraph","position":{"start":{"line":920,"column":1},"end":{"line":920,"column":1}},"children":[{"type":"text","value":"此方法将始终返回最新/实时值。因此，在回测/超参数优化期间使用而不检查运行模式将导致错误的结果，例如，您的整个 dataframe 将在所有行中包含相同的单个值。","position":{"start":{"line":920,"column":1},"end":{"line":920,"column":1}},"key":"SczzqKaX9w"}],"key":"D96xDUcUAl"}],"key":"J490nnSIV6"},{"type":"heading","depth":4,"position":{"start":{"line":923,"column":1},"end":{"line":923,"column":1}},"children":[{"type":"text","value":"发送通知","position":{"start":{"line":923,"column":1},"end":{"line":923,"column":1}},"key":"dR3VsAvugr"}],"identifier":"id","label":"发送通知","html_id":"id-17","implicit":true,"key":"bIxd6IvF8k"},{"type":"paragraph","position":{"start":{"line":925,"column":1},"end":{"line":926,"column":1}},"children":[{"type":"text","value":"dataprovider 的 ","position":{"start":{"line":925,"column":1},"end":{"line":925,"column":1}},"key":"u2QuL42ZPU"},{"type":"inlineCode","value":".send_msg()","position":{"start":{"line":925,"column":1},"end":{"line":925,"column":1}},"key":"NSSfgPEwAI"},{"type":"text","value":" 可在策略中发送自定义通知。\n相同的通知在每个蜡烛图期间只会发送一次，除非第二个参数（","position":{"start":{"line":925,"column":1},"end":{"line":925,"column":1}},"key":"lsg0B3z4Vb"},{"type":"inlineCode","value":"always_send","position":{"start":{"line":925,"column":1},"end":{"line":925,"column":1}},"key":"zwW5ALG1dg"},{"type":"text","value":"）设置为 True。","position":{"start":{"line":925,"column":1},"end":{"line":925,"column":1}},"key":"xhMLJPR5Vy"}],"key":"Jlttwz9HXr"},{"type":"code","lang":"python","value":"    self.dp.send_msg(f\"{metadata['pair']} just got hot!\")\n\n    # 强制发送此通知，避免缓存（请阅读下面的警告！）\n    self.dp.send_msg(f\"{metadata['pair']} just got hot!\", always_send=True)","position":{"start":{"line":928,"column":1},"end":{"line":933,"column":1}},"key":"ANcu1VGldQ"},{"type":"paragraph","position":{"start":{"line":935,"column":1},"end":{"line":935,"column":1}},"children":[{"type":"text","value":"通知只会在交易模式（实盘/模拟盘）中发送 - 因此可以在回测中无条件调用此方法。","position":{"start":{"line":935,"column":1},"end":{"line":935,"column":1}},"key":"g0IjFd7JNn"}],"key":"AVvWL1CiVv"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"消息轰炸","position":{"start":{"line":937,"column":1},"end":{"line":937,"column":1}},"key":"fBdSIJA2ZH"}],"key":"RDPALcNvfP"},{"type":"paragraph","position":{"start":{"line":938,"column":1},"end":{"line":938,"column":1}},"children":[{"type":"text","value":"通过在此方法中设置 ","position":{"start":{"line":938,"column":1},"end":{"line":938,"column":1}},"key":"Q2SaRxLitF"},{"type":"inlineCode","value":"always_send=True","position":{"start":{"line":938,"column":1},"end":{"line":938,"column":1}},"key":"fKpaIQy92l"},{"type":"text","value":"，您可能会给自己发送大量消息。请谨慎使用此功能，并且只在您知道不会在整个蜡烛图期间频繁触发的情况下使用，以避免每5秒就收到一条消息。","position":{"start":{"line":938,"column":1},"end":{"line":938,"column":1}},"key":"gqtALfTrv3"}],"key":"xpdilB79mA"}],"key":"MkfQaK4fx6"},{"type":"heading","depth":4,"position":{"start":{"line":941,"column":1},"end":{"line":941,"column":1}},"children":[{"type":"text","value":"完整 DataProvider 示例","position":{"start":{"line":941,"column":1},"end":{"line":941,"column":1}},"key":"f0ww6tO7jK"}],"identifier":"id-dataprovider","label":"完整 DataProvider 示例","html_id":"id-dataprovider-1","implicit":true,"key":"GjIL88AIoQ"},{"type":"code","lang":"python","value":"from freqtrade.strategy import IStrategy, merge_informative_pair\nfrom pandas import DataFrame\n\nclass SampleStrategy(IStrategy):\n    # 策略初始化...\n\n    timeframe = '5m'\n\n    # ...\n\n    def informative_pairs(self):\n\n        # 获取白名单所有对\n        pairs = self.dp.current_whitelist()\n        # 为每个对分配周期\n        informative_pairs = [(pair, '1d') for pair in pairs]\n        # 可选：添加静态对\n        informative_pairs += [(\"ETH/USDT\", \"5m\"),\n                              (\"BTC/TUSD\", \"15m\"),\n                            ]\n        return informative_pairs\n\n    def populate_indicators(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n        if not self.dp:\n            # DataProvider 不可用时不做任何操作\n            return dataframe\n\n        inf_tf = '1d'\n        # 获取信息对\n        informative = self.dp.get_pair_dataframe(pair=metadata['pair'], timeframe=inf_tf)\n        # 获取14天RSI\n        informative['rsi'] = ta.RSI(informative, timeperiod=14)\n\n        # 使用辅助函数 merge_informative_pair 安全地合并交易对\n        # 自动重命名列并合并较短时间周期的 dataframe 和较长时间周期的信息对\n        # 使用 ffill 使1天的值在一天中的每一行都可用\n        # 如果没有这个，原始数据框和信息对的列之间的比较每天只能进行一次\n        # 此方法的完整文档，见下文\n        dataframe = merge_informative_pair(dataframe, informative, self.timeframe, inf_tf, ffill=True)\n\n        # 计算原始数据框的RSI（5分钟时间周期）\n        dataframe['rsi'] = ta.RSI(dataframe, timeperiod=14)\n\n        # 其他操作\n        # ...\n\n        return dataframe\n\n    def populate_entry_trend(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n\n        dataframe.loc[\n            (\n                (qtpylib.crossed_above(dataframe['rsi'], 30)) &  # RSI 上穿 30\n                (dataframe['rsi_1d'] < 30) &                     # 日线 RSI < 30\n                (dataframe['volume'] > 0)                        # 有成交量\n            ),\n            ['enter_long', 'enter_tag']] = (1, 'rsi_cross')\n","position":{"start":{"line":943,"column":1},"end":{"line":1002,"column":1}},"key":"vqcjcBqjUc"},{"type":"thematicBreak","position":{"start":{"line":1004,"column":1},"end":{"line":1004,"column":1}},"key":"sOpf31KiDH"},{"type":"heading","depth":3,"position":{"start":{"line":1006,"column":1},"end":{"line":1006,"column":1}},"children":[{"type":"text","value":"额外数据（钱包 Wallets）","position":{"start":{"line":1006,"column":1},"end":{"line":1006,"column":1}},"key":"enJYCX2R1x"}],"identifier":"id-wallets","label":"额外数据（钱包 Wallets）","html_id":"id-wallets","implicit":true,"key":"lwRao8V4js"},{"type":"paragraph","position":{"start":{"line":1008,"column":1},"end":{"line":1008,"column":1}},"children":[{"type":"text","value":"策略可通过 ","position":{"start":{"line":1008,"column":1},"end":{"line":1008,"column":1}},"key":"kEYG9pzltR"},{"type":"inlineCode","value":"wallets","position":{"start":{"line":1008,"column":1},"end":{"line":1008,"column":1}},"key":"b1Fwt587Hg"},{"type":"text","value":" 对象获取当前钱包/账户余额。","position":{"start":{"line":1008,"column":1},"end":{"line":1008,"column":1}},"key":"pvN08CKPet"}],"key":"QORKMr7H7d"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"回测/超参优化","position":{"start":{"line":1010,"column":1},"end":{"line":1010,"column":1}},"key":"c19rUtBd6j"}],"key":"AjPygOBh13"},{"type":"paragraph","position":{"start":{"line":1011,"column":1},"end":{"line":1011,"column":1}},"children":[{"type":"text","value":"Wallets 在不同函数中表现不同。","position":{"start":{"line":1011,"column":1},"end":{"line":1011,"column":1}},"key":"uaWa74GpdD"}],"key":"k0Gdddxl9E"},{"type":"paragraph","position":{"start":{"line":1013,"column":1},"end":{"line":1013,"column":1}},"children":[{"type":"text","value":"在 ","position":{"start":{"line":1013,"column":1},"end":{"line":1013,"column":1}},"key":"pKqNoZad5N"},{"type":"inlineCode","value":"populate_*()","position":{"start":{"line":1013,"column":1},"end":{"line":1013,"column":1}},"key":"mPvFz9C6SP"},{"type":"text","value":" 方法中，返回完整钱包。","position":{"start":{"line":1013,"column":1},"end":{"line":1013,"column":1}},"key":"aQUxeMuRLq"}],"key":"w3hEgxpAY0"},{"type":"paragraph","position":{"start":{"line":1015,"column":1},"end":{"line":1015,"column":1}},"children":[{"type":"text","value":"在 ","position":{"start":{"line":1015,"column":1},"end":{"line":1015,"column":1}},"key":"RWUOHI9N1H"},{"type":"link","url":"/strategy-callbacks","position":{"start":{"line":1015,"column":1},"end":{"line":1015,"column":1}},"children":[{"type":"text","value":"回调函数","position":{"start":{"line":1015,"column":1},"end":{"line":1015,"column":1}},"key":"yrGaiotbWm"}],"urlSource":"strategy-callbacks.md","dataUrl":"/strategy-callbacks.json","internal":true,"protocol":"file","key":"ZJtQovtWkd"},{"type":"text","value":" 中，返回当前模拟钱包状态。","position":{"start":{"line":1015,"column":1},"end":{"line":1015,"column":1}},"key":"EA8TgprZDS"}],"key":"sqryXqG27g"}],"key":"lgUNNErKV7"},{"type":"paragraph","position":{"start":{"line":1018,"column":1},"end":{"line":1018,"column":1}},"children":[{"type":"text","value":"调用前请检查 ","position":{"start":{"line":1018,"column":1},"end":{"line":1018,"column":1}},"key":"IgK10N39bh"},{"type":"inlineCode","value":"wallets","position":{"start":{"line":1018,"column":1},"end":{"line":1018,"column":1}},"key":"U4Kp5EPPim"},{"type":"text","value":" 是否可用，避免回测时报错。","position":{"start":{"line":1018,"column":1},"end":{"line":1018,"column":1}},"key":"XyGCqzyRct"}],"key":"WEWOy0OBtD"},{"type":"code","lang":"python","value":"if self.wallets:\n    free_eth = self.wallets.get_free('ETH')\n    used_eth = self.wallets.get_used('ETH')\n    total_eth = self.wallets.get_total('ETH')","position":{"start":{"line":1020,"column":1},"end":{"line":1025,"column":1}},"key":"x9HkAQsVKR"},{"type":"heading","depth":4,"position":{"start":{"line":1027,"column":1},"end":{"line":1027,"column":1}},"children":[{"type":"text","value":"Wallets 可用方法","position":{"start":{"line":1027,"column":1},"end":{"line":1027,"column":1}},"key":"ftWAIzyjrO"}],"identifier":"wallets","label":"Wallets 可用方法","html_id":"wallets","implicit":true,"key":"ect2reWKN0"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1029,"column":1},"end":{"line":1032,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1029,"column":1},"end":{"line":1029,"column":1}},"children":[{"type":"inlineCode","value":"get_free(asset)","position":{"start":{"line":1029,"column":1},"end":{"line":1029,"column":1}},"key":"g8Fe9ug741"},{"type":"text","value":" - 当前可用余额","position":{"start":{"line":1029,"column":1},"end":{"line":1029,"column":1}},"key":"mp5JcmNWiF"}],"key":"ZI4XhzH2bq"},{"type":"listItem","spread":true,"position":{"start":{"line":1030,"column":1},"end":{"line":1030,"column":1}},"children":[{"type":"inlineCode","value":"get_used(asset)","position":{"start":{"line":1030,"column":1},"end":{"line":1030,"column":1}},"key":"OJrRJWAav1"},{"type":"text","value":" - 当前被占用余额（挂单）","position":{"start":{"line":1030,"column":1},"end":{"line":1030,"column":1}},"key":"h19tsrGAVF"}],"key":"MUoD7j1s2R"},{"type":"listItem","spread":true,"position":{"start":{"line":1031,"column":1},"end":{"line":1032,"column":1}},"children":[{"type":"inlineCode","value":"get_total(asset)","position":{"start":{"line":1031,"column":1},"end":{"line":1031,"column":1}},"key":"jMFKfzdBZ3"},{"type":"text","value":" - 总余额（前两者之和）","position":{"start":{"line":1031,"column":1},"end":{"line":1031,"column":1}},"key":"KGcqHAXaSF"}],"key":"PBBA8cyzK9"}],"key":"BAYa664rqP"},{"type":"thematicBreak","position":{"start":{"line":1033,"column":1},"end":{"line":1033,"column":1}},"key":"JdsapPC9xL"},{"type":"heading","depth":3,"position":{"start":{"line":1035,"column":1},"end":{"line":1035,"column":1}},"children":[{"type":"text","value":"额外数据（交易记录 Trades）","position":{"start":{"line":1035,"column":1},"end":{"line":1035,"column":1}},"key":"L9KpedV1VD"}],"identifier":"id-trades","label":"额外数据（交易记录 Trades）","html_id":"id-trades","implicit":true,"key":"PMpBW4nhmb"},{"type":"paragraph","position":{"start":{"line":1037,"column":1},"end":{"line":1037,"column":1}},"children":[{"type":"text","value":"可在策略中通过数据库查询历史交易。","position":{"start":{"line":1037,"column":1},"end":{"line":1037,"column":1}},"key":"f96TiN2jEx"}],"key":"wZPExJeen9"},{"type":"paragraph","position":{"start":{"line":1039,"column":1},"end":{"line":1039,"column":1}},"children":[{"type":"text","value":"在文件顶部，导入所需对象：","position":{"start":{"line":1039,"column":1},"end":{"line":1039,"column":1}},"key":"uXrxF5PX3F"}],"key":"DjcOStnB8q"},{"type":"code","lang":"python","value":"from freqtrade.persistence import Trade","position":{"start":{"line":1041,"column":1},"end":{"line":1043,"column":1}},"key":"sR97SYxqdM"},{"type":"paragraph","position":{"start":{"line":1045,"column":1},"end":{"line":1045,"column":1}},"children":[{"type":"text","value":"以下示例查询当天当前对的已平仓交易（可加其他过滤条件）：","position":{"start":{"line":1045,"column":1},"end":{"line":1045,"column":1}},"key":"uJwsBblu5F"}],"key":"CCk20lYi4j"},{"type":"code","lang":"python","value":"trades = Trade.get_trades_proxy(pair=metadata['pair'],\n                                open_date=datetime.now(timezone.utc) - timedelta(days=1),\n                                is_open=False,\n            ]).order_by(Trade.close_date).all()\n# 汇总该交易对的利润\ncurdayprofit = sum(trade.close_profit for trade in trades)","position":{"start":{"line":1047,"column":1},"end":{"line":1054,"column":1}},"key":"n2lBchHgxd"},{"type":"paragraph","position":{"start":{"line":1056,"column":1},"end":{"line":1056,"column":1}},"children":[{"type":"text","value":"更多方法请查阅 ","position":{"start":{"line":1056,"column":1},"end":{"line":1056,"column":1}},"key":"kRmaaSK7ps"},{"type":"link","url":"/trade-object","position":{"start":{"line":1056,"column":1},"end":{"line":1056,"column":1}},"children":[{"type":"text","value":"Trade 对象","position":{"start":{"line":1056,"column":1},"end":{"line":1056,"column":1}},"key":"Vo901Kj0sw"}],"urlSource":"trade-object.md","dataUrl":"/trade-object.json","internal":true,"protocol":"file","key":"io2FHopN7I"},{"type":"text","value":" 文档。","position":{"start":{"line":1056,"column":1},"end":{"line":1056,"column":1}},"key":"jQrYyO7MXD"}],"key":"EHGju19mrn"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"aAg7HQapv2"}],"key":"kWLnnPXbaI"},{"type":"paragraph","position":{"start":{"line":1059,"column":1},"end":{"line":1059,"column":1}},"children":[{"type":"text","value":"回测/超参优化时，","position":{"start":{"line":1059,"column":1},"end":{"line":1059,"column":1}},"key":"SZfkRfzr8l"},{"type":"inlineCode","value":"populate_*","position":{"start":{"line":1059,"column":1},"end":{"line":1059,"column":1}},"key":"L1XrALtr9U"},{"type":"text","value":" 方法中无法获取交易历史，结果为空。","position":{"start":{"line":1059,"column":1},"end":{"line":1059,"column":1}},"key":"U1BNTJeE00"}],"key":"Mj7HjMUpZR"}],"key":"tnmiad0s6a"},{"type":"heading","depth":3,"position":{"start":{"line":1062,"column":1},"end":{"line":1062,"column":1}},"children":[{"type":"text","value":"阻止特定对交易","position":{"start":{"line":1062,"column":1},"end":{"line":1062,"column":1}},"key":"lwLFtk0JV5"}],"identifier":"id","label":"阻止特定对交易","html_id":"id-18","implicit":true,"key":"GgZOTveN41"},{"type":"paragraph","position":{"start":{"line":1064,"column":1},"end":{"line":1064,"column":1}},"children":[{"type":"text","value":"Freqtrade 会在某对平仓后自动锁定该对至当前K线结束，防止同一K线内频繁交易。","position":{"start":{"line":1064,"column":1},"end":{"line":1064,"column":1}},"key":"U4MfymazaE"}],"key":"q0PPYyZTJo"},{"type":"paragraph","position":{"start":{"line":1066,"column":1},"end":{"line":1066,"column":1}},"children":[{"type":"text","value":"锁定对时会提示 ","position":{"start":{"line":1066,"column":1},"end":{"line":1066,"column":1}},"key":"iPaaSubPgx"},{"type":"inlineCode","value":"Pair <pair> is currently locked.","position":{"start":{"line":1066,"column":1},"end":{"line":1066,"column":1}},"key":"cI8vZG6bn3"},{"type":"text","value":"。","position":{"start":{"line":1066,"column":1},"end":{"line":1066,"column":1}},"key":"otTBAIdD7N"}],"key":"Ao2roCjd0q"},{"type":"heading","depth":4,"position":{"start":{"line":1068,"column":1},"end":{"line":1068,"column":1}},"children":[{"type":"text","value":"在策略中锁定对","position":{"start":{"line":1068,"column":1},"end":{"line":1068,"column":1}},"key":"fMXoSD6MdL"}],"identifier":"id","label":"在策略中锁定对","html_id":"id-19","implicit":true,"key":"NNKXZfnYzB"},{"type":"paragraph","position":{"start":{"line":1070,"column":1},"end":{"line":1070,"column":1}},"children":[{"type":"text","value":"有时希望在特定事件后锁定某对（如连续亏损）。","position":{"start":{"line":1070,"column":1},"end":{"line":1070,"column":1}},"key":"CfO3KICaVO"}],"key":"P2ef161jNt"},{"type":"paragraph","position":{"start":{"line":1072,"column":1},"end":{"line":1072,"column":1}},"children":[{"type":"text","value":"可用 ","position":{"start":{"line":1072,"column":1},"end":{"line":1072,"column":1}},"key":"WNzYGD9lvH"},{"type":"inlineCode","value":"self.lock_pair(pair, until, [reason])","position":{"start":{"line":1072,"column":1},"end":{"line":1072,"column":1}},"key":"DdrmsQlZMx"},{"type":"text","value":" 实现，","position":{"start":{"line":1072,"column":1},"end":{"line":1072,"column":1}},"key":"DcfmhDFGVY"},{"type":"inlineCode","value":"until","position":{"start":{"line":1072,"column":1},"end":{"line":1072,"column":1}},"key":"HaxvD1ZNiJ"},{"type":"text","value":" 为未来时间点，","position":{"start":{"line":1072,"column":1},"end":{"line":1072,"column":1}},"key":"KvT8NAcPE9"},{"type":"inlineCode","value":"reason","position":{"start":{"line":1072,"column":1},"end":{"line":1072,"column":1}},"key":"q7TPGAnRup"},{"type":"text","value":" 为可选说明。","position":{"start":{"line":1072,"column":1},"end":{"line":1072,"column":1}},"key":"C4BHWhDtpm"}],"key":"TVCtVOgvkh"},{"type":"paragraph","position":{"start":{"line":1074,"column":1},"end":{"line":1074,"column":1}},"children":[{"type":"text","value":"可用 ","position":{"start":{"line":1074,"column":1},"end":{"line":1074,"column":1}},"key":"o18hMKiuae"},{"type":"inlineCode","value":"self.unlock_pair(pair)","position":{"start":{"line":1074,"column":1},"end":{"line":1074,"column":1}},"key":"wF7sNhCMwt"},{"type":"text","value":" 或 ","position":{"start":{"line":1074,"column":1},"end":{"line":1074,"column":1}},"key":"WPggdnnoSO"},{"type":"inlineCode","value":"self.unlock_reason(<reason>)","position":{"start":{"line":1074,"column":1},"end":{"line":1074,"column":1}},"key":"dBDihUPxKY"},{"type":"text","value":" 手动解锁，后者会解锁所有因该原因锁定的对。","position":{"start":{"line":1074,"column":1},"end":{"line":1074,"column":1}},"key":"jrzDEv2Jgs"}],"key":"sPQ07ZzDZS"},{"type":"paragraph","position":{"start":{"line":1076,"column":1},"end":{"line":1076,"column":1}},"children":[{"type":"text","value":"用 ","position":{"start":{"line":1076,"column":1},"end":{"line":1076,"column":1}},"key":"slqqRPiF9i"},{"type":"inlineCode","value":"self.is_pair_locked(pair)","position":{"start":{"line":1076,"column":1},"end":{"line":1076,"column":1}},"key":"Y1KvJ9rfHN"},{"type":"text","value":" 检查对是否被锁定。","position":{"start":{"line":1076,"column":1},"end":{"line":1076,"column":1}},"key":"eAmHB7jzEX"}],"key":"aBWyscxjrZ"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"sGAt6Ejztg"}],"key":"R7Sk73FSxd"},{"type":"paragraph","position":{"start":{"line":1079,"column":1},"end":{"line":1079,"column":1}},"children":[{"type":"text","value":"锁定会自动延长到下一个K线结束。如 5m 周期，锁到 10:18 会延长到 10:20。","position":{"start":{"line":1079,"column":1},"end":{"line":1079,"column":1}},"key":"cylMYHDKNa"}],"key":"uIFZmzA2jl"}],"key":"bIfd33m20h"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"B3SLT3qbPD"}],"key":"BcNRMtDP4U"},{"type":"paragraph","position":{"start":{"line":1083,"column":1},"end":{"line":1083,"column":1}},"children":[{"type":"text","value":"手动锁定仅在实盘/模拟盘可用，回测时仅保护机制可锁定。","position":{"start":{"line":1083,"column":1},"end":{"line":1083,"column":1}},"key":"jAjc9ihCIG"}],"key":"TDUPYTkNT1"}],"key":"qbdB7Ymtkt"},{"type":"heading","depth":5,"position":{"start":{"line":1086,"column":1},"end":{"line":1086,"column":1}},"children":[{"type":"text","value":"锁定对示例","position":{"start":{"line":1086,"column":1},"end":{"line":1086,"column":1}},"key":"IhfsBFVPrs"}],"identifier":"id","label":"锁定对示例","html_id":"id-20","implicit":true,"key":"wJu4ZOZ5QJ"},{"type":"code","lang":"python","value":"from freqtrade.persistence import Trade\nfrom datetime import timedelta, datetime, timezone\n# 放在策略文件顶部\n# --------\n\n# 在 populate_indicators 或 populate_entry_trend 中：\nif self.config['runmode'].value in ('live', 'dry_run'):\n    # 查询近两天已平仓交易\n    trades = Trade.get_trades_proxy(\n        pair=metadata['pair'], is_open=False, \n        open_date=datetime.now(timezone.utc) - timedelta(days=2))\n    # 分析是否需要锁定\n    sumprofit = sum(trade.close_profit for trade in trades)\n    if sumprofit < 0:\n        # 锁定 12 小时\n        self.lock_pair(metadata['pair'], until=datetime.now(timezone.utc) + timedelta(hours=12))","position":{"start":{"line":1088,"column":1},"end":{"line":1105,"column":1}},"key":"dEXEBatz9I"},{"type":"heading","depth":3,"position":{"start":{"line":1107,"column":1},"end":{"line":1107,"column":1}},"children":[{"type":"text","value":"打印主 dataframe","position":{"start":{"line":1107,"column":1},"end":{"line":1107,"column":1}},"key":"YEnObhBM72"}],"identifier":"id-dataframe","label":"打印主 dataframe","html_id":"id-dataframe","implicit":true,"key":"cmcl5p6CrK"},{"type":"paragraph","position":{"start":{"line":1109,"column":1},"end":{"line":1109,"column":1}},"children":[{"type":"text","value":"可在 ","position":{"start":{"line":1109,"column":1},"end":{"line":1109,"column":1}},"key":"DvnMyDQtLi"},{"type":"inlineCode","value":"populate_entry_trend()","position":{"start":{"line":1109,"column":1},"end":{"line":1109,"column":1}},"key":"tNCsdWlak6"},{"type":"text","value":" 或 ","position":{"start":{"line":1109,"column":1},"end":{"line":1109,"column":1}},"key":"XLBycoxBnk"},{"type":"inlineCode","value":"populate_exit_trend()","position":{"start":{"line":1109,"column":1},"end":{"line":1109,"column":1}},"key":"XJZG1RctMt"},{"type":"text","value":" 中打印当前主 dataframe，便于调试。","position":{"start":{"line":1109,"column":1},"end":{"line":1109,"column":1}},"key":"SNh17p5OZz"}],"key":"RGhaA3rQnD"},{"type":"code","lang":"python","value":"def populate_entry_trend(self, dataframe: DataFrame, metadata: dict) -> DataFrame:\n    dataframe.loc[\n        (\n            #>> 你的条件 <<<\n        ),\n        ['enter_long', 'enter_tag']] = (1, 'somestring')\n\n    # 打印分析的对\n    print(f\"result for {metadata['pair']}\")\n\n    # 打印最后 5 行\n    print(dataframe.tail())\n\n    return dataframe","position":{"start":{"line":1111,"column":1},"end":{"line":1126,"column":1}},"key":"eu5GA91bOe"},{"type":"paragraph","position":{"start":{"line":1128,"column":1},"end":{"line":1128,"column":1}},"children":[{"type":"text","value":"如需打印更多行可用 ","position":{"start":{"line":1128,"column":1},"end":{"line":1128,"column":1}},"key":"V9NMGKFDap"},{"type":"inlineCode","value":"print(dataframe)","position":{"start":{"line":1128,"column":1},"end":{"line":1128,"column":1}},"key":"m1fhdLPcwH"},{"type":"text","value":"，但不建议，否则每对每 5 秒会输出约 500 行。","position":{"start":{"line":1128,"column":1},"end":{"line":1128,"column":1}},"key":"cVHVX01BG5"}],"key":"IHCWWW3lnH"},{"type":"heading","depth":3,"position":{"start":{"line":1130,"column":1},"end":{"line":1130,"column":1}},"children":[{"type":"text","value":"开发策略时的常见错误","position":{"start":{"line":1130,"column":1},"end":{"line":1130,"column":1}},"key":"YINrBptaq7"}],"identifier":"id","label":"开发策略时的常见错误","html_id":"id-21","implicit":true,"key":"FiCFiXAoZS"},{"type":"heading","depth":4,"position":{"start":{"line":1132,"column":1},"end":{"line":1132,"column":1}},"children":[{"type":"text","value":"回测时\"看未来\"","position":{"start":{"line":1132,"column":1},"end":{"line":1132,"column":1}},"key":"P7EH9mnRSc"}],"identifier":"id","label":"回测时\"看未来\"","html_id":"id-22","implicit":true,"key":"j5D6OSpQ8O"},{"type":"paragraph","position":{"start":{"line":1134,"column":1},"end":{"line":1134,"column":1}},"children":[{"type":"text","value":"回测为提升性能会一次性分析整个 dataframe。策略作者需确保不\"看未来\"，即不使用 dry/live 时不可用的数据。","position":{"start":{"line":1134,"column":1},"end":{"line":1134,"column":1}},"key":"m7CewKu9um"}],"key":"lk9JYvVPwO"},{"type":"paragraph","position":{"start":{"line":1136,"column":1},"end":{"line":1136,"column":1}},"children":[{"type":"text","value":"这是常见痛点，易导致回测与 dry/live 巨大差异。看未来的策略回测时表现极佳，实盘却很差。","position":{"start":{"line":1136,"column":1},"end":{"line":1136,"column":1}},"key":"agOJLCgRL5"}],"key":"eizl8F58RR"},{"type":"paragraph","position":{"start":{"line":1138,"column":1},"end":{"line":1138,"column":1}},"children":[{"type":"text","value":"常见错误包括：","position":{"start":{"line":1138,"column":1},"end":{"line":1138,"column":1}},"key":"GVQJ4YSJ51"}],"key":"rxBZjPZeeP"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1140,"column":1},"end":{"line":1145,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1140,"column":1},"end":{"line":1140,"column":1}},"children":[{"type":"text","value":"不要用 ","position":{"start":{"line":1140,"column":1},"end":{"line":1140,"column":1}},"key":"nSJyCDVF3h"},{"type":"inlineCode","value":"shift(-1)","position":{"start":{"line":1140,"column":1},"end":{"line":1140,"column":1}},"key":"KWTCaWQbBz"},{"type":"text","value":" 或负数，这会用到未来数据","position":{"start":{"line":1140,"column":1},"end":{"line":1140,"column":1}},"key":"ZexjBIs39P"}],"key":"LsjbaSrnmQ"},{"type":"listItem","spread":true,"position":{"start":{"line":1141,"column":1},"end":{"line":1141,"column":1}},"children":[{"type":"text","value":"不要在 ","position":{"start":{"line":1141,"column":1},"end":{"line":1141,"column":1}},"key":"jd2i2ZnzZM"},{"type":"inlineCode","value":"populate_","position":{"start":{"line":1141,"column":1},"end":{"line":1141,"column":1}},"key":"lZquzgUWer"},{"type":"text","value":" 函数中用 ","position":{"start":{"line":1141,"column":1},"end":{"line":1141,"column":1}},"key":"FbV4wC4oVN"},{"type":"inlineCode","value":".iloc[-1]","position":{"start":{"line":1141,"column":1},"end":{"line":1141,"column":1}},"key":"YQC8m4ii5y"},{"type":"text","value":" 或其他绝对位置，dry-run 和回测时表现不同。回调函数中可安全用 iloc","position":{"start":{"line":1141,"column":1},"end":{"line":1141,"column":1}},"key":"N3085hLdAe"}],"key":"FiPRfHZzYg"},{"type":"listItem","spread":true,"position":{"start":{"line":1142,"column":1},"end":{"line":1142,"column":1}},"children":[{"type":"text","value":"不要用 ","position":{"start":{"line":1142,"column":1},"end":{"line":1142,"column":1}},"key":"qTyoc3aIQe"},{"type":"inlineCode","value":"dataframe['mean_volume'] = dataframe['volume'].mean()","position":{"start":{"line":1142,"column":1},"end":{"line":1142,"column":1}},"key":"VZ6uTIe2oI"},{"type":"text","value":" 这类全列函数，回测时会用到未来数据。应用 rolling() 计算，如 ","position":{"start":{"line":1142,"column":1},"end":{"line":1142,"column":1}},"key":"D3ELeD6rv4"},{"type":"inlineCode","value":"dataframe['volume'].rolling(<window>).mean()","position":{"start":{"line":1142,"column":1},"end":{"line":1142,"column":1}},"key":"jfX51NCnA1"}],"key":"BLhYheMbLg"},{"type":"listItem","spread":true,"position":{"start":{"line":1143,"column":1},"end":{"line":1143,"column":1}},"children":[{"type":"text","value":"不要用 ","position":{"start":{"line":1143,"column":1},"end":{"line":1143,"column":1}},"key":"SdOLXtvL45"},{"type":"inlineCode","value":".resample('1h')","position":{"start":{"line":1143,"column":1},"end":{"line":1143,"column":1}},"key":"bkyk5hZHKW"},{"type":"text","value":"，这会用左边界，应用 ","position":{"start":{"line":1143,"column":1},"end":{"line":1143,"column":1}},"key":"yd4JOJuXWL"},{"type":"inlineCode","value":".resample('1h', label='right')","position":{"start":{"line":1143,"column":1},"end":{"line":1143,"column":1}},"key":"F1P58YHXd5"}],"key":"dtoGE5gfb3"},{"type":"listItem","spread":true,"position":{"start":{"line":1144,"column":1},"end":{"line":1145,"column":1}},"children":[{"type":"text","value":"不要用 ","position":{"start":{"line":1144,"column":1},"end":{"line":1144,"column":1}},"key":"QGn92A246M"},{"type":"inlineCode","value":".merge()","position":{"start":{"line":1144,"column":1},"end":{"line":1144,"column":1}},"key":"ImTAtHBvsX"},{"type":"text","value":" 合并大周期到小周期，应用 ","position":{"start":{"line":1144,"column":1},"end":{"line":1144,"column":1}},"key":"PnvYcPTbRy"},{"type":"link","url":"#%E8%BE%85%E5%8A%A9%E4%BA%A4%E6%98%93%E5%AF%B9","position":{"start":{"line":1144,"column":1},"end":{"line":1144,"column":1}},"children":[{"type":"text","value":"informative pair","position":{"start":{"line":1144,"column":1},"end":{"line":1144,"column":1}},"key":"FDqxP3RXnN"}],"urlSource":"#%E8%BE%85%E5%8A%A9%E4%BA%A4%E6%98%93%E5%AF%B9","key":"fg18mhVoZN"},{"type":"text","value":" 工具。普通 merge 会有前视偏差","position":{"start":{"line":1144,"column":1},"end":{"line":1144,"column":1}},"key":"GX0vgkjgA9"}],"key":"QgH9oAM5HE"}],"key":"VgkEGefpi4"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"如何发现问题","position":{"start":{"line":1146,"column":1},"end":{"line":1146,"column":1}},"key":"v26vXjq0RN"}],"key":"QYwcvDHd5n"},{"type":"paragraph","position":{"start":{"line":1147,"column":1},"end":{"line":1147,"column":1}},"children":[{"type":"text","value":"建议用 ","position":{"start":{"line":1147,"column":1},"end":{"line":1147,"column":1}},"key":"Zsn3B1G7pX"},{"type":"link","url":"/lookahead-analysis","position":{"start":{"line":1147,"column":1},"end":{"line":1147,"column":1}},"children":[{"type":"text","value":"lookahead-analysis","position":{"start":{"line":1147,"column":1},"end":{"line":1147,"column":1}},"key":"IwLehGR9tu"}],"urlSource":"lookahead-analysis.md","dataUrl":"/lookahead-analysis.json","internal":true,"protocol":"file","key":"TkT7elKI48"},{"type":"text","value":" 和 ","position":{"start":{"line":1147,"column":1},"end":{"line":1147,"column":1}},"key":"nycNYVmXZb"},{"type":"link","url":"/recursive-analysis","position":{"start":{"line":1147,"column":1},"end":{"line":1147,"column":1}},"children":[{"type":"text","value":"recursive-analysis","position":{"start":{"line":1147,"column":1},"end":{"line":1147,"column":1}},"key":"zedgwrU4sG"}],"urlSource":"recursive-analysis.md","dataUrl":"/recursive-analysis.json","internal":true,"protocol":"file","key":"uPE6IpnMfb"},{"type":"text","value":" 两个工具辅助排查。","position":{"start":{"line":1147,"column":1},"end":{"line":1147,"column":1}},"key":"x3c1X6A10l"}],"key":"MjRTzALKg0"},{"type":"paragraph","position":{"start":{"line":1149,"column":1},"end":{"line":1149,"column":1}},"children":[{"type":"text","value":"但两者都不能保证完全无误。","position":{"start":{"line":1149,"column":1},"end":{"line":1149,"column":1}},"key":"J5pJJGVRcP"}],"key":"UaV7ZO16s2"}],"key":"rP5vhPsrLS"},{"type":"heading","depth":4,"position":{"start":{"line":1152,"column":1},"end":{"line":1152,"column":1}},"children":[{"type":"text","value":"信号冲突","position":{"start":{"line":1152,"column":1},"end":{"line":1152,"column":1}},"key":"s8vpvkmkiu"}],"identifier":"id","label":"信号冲突","html_id":"id-23","implicit":true,"key":"rRfHee8epX"},{"type":"paragraph","position":{"start":{"line":1154,"column":1},"end":{"line":1154,"column":1}},"children":[{"type":"text","value":"当信号冲突（如 ","position":{"start":{"line":1154,"column":1},"end":{"line":1154,"column":1}},"key":"MhIAc3YClw"},{"type":"inlineCode","value":"enter_long","position":{"start":{"line":1154,"column":1},"end":{"line":1154,"column":1}},"key":"etjqb1X7wI"},{"type":"text","value":" 和 ","position":{"start":{"line":1154,"column":1},"end":{"line":1154,"column":1}},"key":"JQp0IPetNN"},{"type":"inlineCode","value":"exit_long","position":{"start":{"line":1154,"column":1},"end":{"line":1154,"column":1}},"key":"jx4846zCoR"},{"type":"text","value":" 同时为 1）时，freqtrade 会忽略入场信号，避免刚进场就立刻出场。","position":{"start":{"line":1154,"column":1},"end":{"line":1154,"column":1}},"key":"hZvuPtUkhE"}],"key":"QuJwZu6Qmx"},{"type":"paragraph","position":{"start":{"line":1156,"column":1},"end":{"line":1156,"column":1}},"children":[{"type":"text","value":"规则如下，若 3 个信号中有多个为 1，则忽略入场：","position":{"start":{"line":1156,"column":1},"end":{"line":1156,"column":1}},"key":"psZOAKxsoG"}],"key":"jsiDMyU0Dx"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1158,"column":1},"end":{"line":1160,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1158,"column":1},"end":{"line":1158,"column":1}},"children":[{"type":"inlineCode","value":"enter_long","position":{"start":{"line":1158,"column":1},"end":{"line":1158,"column":1}},"key":"YR7fO2Z6tT"},{"type":"text","value":" -> ","position":{"start":{"line":1158,"column":1},"end":{"line":1158,"column":1}},"key":"gzeI4KcDF7"},{"type":"inlineCode","value":"exit_long","position":{"start":{"line":1158,"column":1},"end":{"line":1158,"column":1}},"key":"QJ1jaIapip"},{"type":"text","value":", ","position":{"start":{"line":1158,"column":1},"end":{"line":1158,"column":1}},"key":"GcXnghuF0i"},{"type":"inlineCode","value":"enter_short","position":{"start":{"line":1158,"column":1},"end":{"line":1158,"column":1}},"key":"UL5uEXEgjT"}],"key":"ju22ueYJqk"},{"type":"listItem","spread":true,"position":{"start":{"line":1159,"column":1},"end":{"line":1160,"column":1}},"children":[{"type":"inlineCode","value":"enter_short","position":{"start":{"line":1159,"column":1},"end":{"line":1159,"column":1}},"key":"lxq8zbTdSm"},{"type":"text","value":" -> ","position":{"start":{"line":1159,"column":1},"end":{"line":1159,"column":1}},"key":"QTaSUVagFF"},{"type":"inlineCode","value":"exit_short","position":{"start":{"line":1159,"column":1},"end":{"line":1159,"column":1}},"key":"StZkpq6lpO"},{"type":"text","value":", ","position":{"start":{"line":1159,"column":1},"end":{"line":1159,"column":1}},"key":"D54QuiFqOc"},{"type":"inlineCode","value":"enter_long","position":{"start":{"line":1159,"column":1},"end":{"line":1159,"column":1}},"key":"rqL8d34Ra4"}],"key":"WTTajYpFMc"}],"key":"woOpe7xq67"},{"type":"heading","depth":3,"position":{"start":{"line":1161,"column":1},"end":{"line":1161,"column":1}},"children":[{"type":"text","value":"更多策略思路","position":{"start":{"line":1161,"column":1},"end":{"line":1161,"column":1}},"key":"FK6qvadCDI"}],"identifier":"id","label":"更多策略思路","html_id":"id-24","implicit":true,"key":"zO8QB7MtCq"},{"type":"paragraph","position":{"start":{"line":1163,"column":1},"end":{"line":1163,"column":1}},"children":[{"type":"text","value":"如需更多策略思路，请访问 ","position":{"start":{"line":1163,"column":1},"end":{"line":1163,"column":1}},"key":"C0n7OEqQDm"},{"type":"link","url":"https://github.com/freqtrade/freqtrade-strategies","position":{"start":{"line":1163,"column":1},"end":{"line":1163,"column":1}},"children":[{"type":"text","value":"策略仓库","position":{"start":{"line":1163,"column":1},"end":{"line":1163,"column":1}},"key":"A9bdvfnYKM"}],"urlSource":"https://github.com/freqtrade/freqtrade-strategies","error":true,"key":"g2TaZ6qlZO"},{"type":"text","value":"。可作为学习参考，实际效果取决于市场、交易对等。请务必先回测，再 dry-run，谨慎实盘。","position":{"start":{"line":1163,"column":1},"end":{"line":1163,"column":1}},"key":"ISMhBgWmDD"}],"key":"L9DprAbdDg"},{"type":"paragraph","position":{"start":{"line":1165,"column":1},"end":{"line":1165,"column":1}},"children":[{"type":"text","value":"欢迎参考、改编，也欢迎向仓库提交新策略 PR。","position":{"start":{"line":1165,"column":1},"end":{"line":1165,"column":1}},"key":"u3OF6qX7iF"}],"key":"iKJEoTmAch"},{"type":"heading","depth":3,"position":{"start":{"line":1167,"column":1},"end":{"line":1167,"column":1}},"children":[{"type":"text","value":"下一步","position":{"start":{"line":1167,"column":1},"end":{"line":1167,"column":1}},"key":"wlHeCgx6GF"}],"identifier":"id","label":"下一步","html_id":"id-25","implicit":true,"key":"mgRLfFtOF5"},{"type":"paragraph","position":{"start":{"line":1169,"column":1},"end":{"line":1169,"column":1}},"children":[{"type":"text","value":"现在你已经有了完美的策略，下一步请学习","position":{"start":{"line":1169,"column":1},"end":{"line":1169,"column":1}},"key":"l5ohqYQKeh"},{"type":"link","url":"/backtesting","position":{"start":{"line":1169,"column":1},"end":{"line":1169,"column":1}},"children":[{"type":"text","value":"如何回测","position":{"start":{"line":1169,"column":1},"end":{"line":1169,"column":1}},"key":"N0wR9Gvtk6"}],"urlSource":"backtesting.md","dataUrl":"/backtesting.json","internal":true,"protocol":"file","key":"Zp95kxcMwD"},{"type":"text","value":"。","position":{"start":{"line":1169,"column":1},"end":{"line":1169,"column":1}},"key":"d9wxKnzTzW"}],"key":"buy3N4Zfr6"}],"key":"pVdOM64XSF"}],"key":"dTytcQXa50"},"references":{"cite":{"order":[],"data":{}}}}