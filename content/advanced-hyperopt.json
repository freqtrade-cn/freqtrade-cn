{"version":2,"kind":"Article","sha256":"45a50edc4c2ac8e52f5904ef3ee966d6aff822647bf135a69116b9de0f4f0901","slug":"advanced-hyperopt","location":"/advanced-hyperopt.md","dependencies":[],"frontmatter":{"title":"高级超参数优化","description":"本文档介绍了 FreqTrade 的高级超参数优化功能,包括自定义损失函数等高级特性。","short_title":"高级超参数优化","subtitle":"深入了解超参数优化功能","subject":"FreqTrade 高级超参数优化指南","authors":[{"id":"Freqtrade","name":"Freqtrade"}],"github":"https://github.com/freqtrade-cn/docs_zh-CN","keywords":["Freqtrade","中文文档","交易机器人","量化交易","加密货币","数字货币","区块链","人工智能","机器学习"],"numbering":{"title":{"offset":1}},"edit_url":"https://github.com/freqtrade-cn/docs_zh-CN/blob/main/advanced-hyperopt.md","exports":[{"format":"md","filename":"advanced-hyperopt.md","url":"/advanced-hyperopt-38e4886c21e6881ebd27b9adab7149b6.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"高级超参数优化（Hyperopt）","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"g0uBy3yxGo"}],"identifier":"id-hyperopt","label":"高级超参数优化（Hyperopt）","html_id":"id-hyperopt","implicit":true,"key":"OV7pncFJ9D"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"本页介绍一些高级 Hyperopt 主题，可能比创建普通超参数优化类需要更高的编码技能和 Python 知识。","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"a4yiwxE6lu"}],"key":"xoLi4b7Ngl"},{"type":"heading","depth":3,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"创建和使用自定义损失函数","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"dnsAQwjOv9"}],"identifier":"id","label":"创建和使用自定义损失函数","html_id":"id","implicit":true,"key":"LIPG90GC8N"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"要使用自定义损失函数类，请确保你的自定义 hyperopt 损失类中定义了 ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"jHVmfoIIvT"},{"type":"inlineCode","value":"hyperopt_loss_function","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"VlDUkHhLk9"},{"type":"text","value":" 函数。\n对于下方的示例，你需要在 hyperopt 命令中添加参数 ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"BSRzIV0z5m"},{"type":"inlineCode","value":"--hyperopt-loss SuperDuperHyperOptLoss","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"O8IH4e0yCY"},{"type":"text","value":"，以便使用该函数。","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"PTaKp29Sqm"}],"key":"QElTplHNzA"},{"type":"paragraph","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"下面是一个示例，与默认 Hyperopt 损失实现完全相同。完整示例可见于 ","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"kp8eXta3aP"},{"type":"link","url":"https://github.com/freqtrade/freqtrade/blob/develop/freqtrade/templates/sample_hyperopt_loss.py","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"userdata/hyperopts","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"p9vBlfJq5t"}],"urlSource":"https://github.com/freqtrade/freqtrade/blob/develop/freqtrade/templates/sample_hyperopt_loss.py","data":{"kind":"file","org":"freqtrade","repo":"freqtrade","reference":"develop","file":"freqtrade/templates/sample_hyperopt_loss.py","raw":"https://raw.githubusercontent.com/freqtrade/freqtrade/develop/freqtrade/templates/sample_hyperopt_loss.py"},"internal":false,"protocol":"github","key":"HU4PZhztlQ"},{"type":"text","value":"。","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"x0n8HuK61v"}],"key":"xKHRBDy1ur"},{"type":"code","lang":"python","value":"from datetime import datetime\nfrom typing import Any, Dict\n\nfrom pandas import DataFrame\n\nfrom freqtrade.constants import Config\nfrom freqtrade.optimize.hyperopt import IHyperOptLoss\n\nTARGET_TRADES = 600\nEXPECTED_MAX_PROFIT = 3.0\nMAX_ACCEPTED_TRADE_DURATION = 300\n\nclass SuperDuperHyperOptLoss(IHyperOptLoss):\n    \"\"\"\n    定义 hyperopt 的默认损失函数\n    \"\"\"\n\n    @staticmethod\n    def hyperopt_loss_function(\n        *,\n        results: DataFrame,\n        trade_count: int,\n        min_date: datetime,\n        max_date: datetime,\n        config: Config,\n        processed: dict[str, DataFrame],\n        backtest_stats: dict[str, Any],\n        starting_balance: float,\n        **kwargs,\n    ) -> float:\n        \"\"\"\n        目标函数，结果越小越好\n        这是传统算法（freqtrade 一直使用的）。权重分配如下：\n        * 0.4 给交易时长\n        * 0.25：避免交易亏损\n        * 1.0 给总利润，相对于上面定义的期望值（`EXPECTED_MAX_PROFIT`）\n        \"\"\"\n        total_profit = results['profit_ratio'].sum()\n        trade_duration = results['trade_duration'].mean()\n\n        trade_loss = 1 - 0.25 * exp(-(trade_count - TARGET_TRADES) ** 2 / 10 ** 5.8)\n        profit_loss = max(0, 1 - total_profit / EXPECTED_MAX_PROFIT)\n        duration_loss = 0.4 * min(trade_duration / MAX_ACCEPTED_TRADE_DURATION, 1)\n        result = trade_loss + profit_loss + duration_loss\n        return result","position":{"start":{"line":20,"column":1},"end":{"line":66,"column":1}},"key":"ewEhdMB8be"},{"type":"paragraph","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"children":[{"type":"text","value":"目前，参数说明如下：","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"h1zhrT5wJY"}],"key":"nl6D7AFSwP"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":70,"column":1},"end":{"line":80,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":70,"column":1},"end":{"line":72,"column":1}},"children":[{"type":"inlineCode","value":"results","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"uNW4h3PzzK"},{"type":"text","value":"：包含结果交易的 DataFrame。\n结果中可用的列如下（与回测时 ","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"ASl9qiMPUP"},{"type":"inlineCode","value":"--export trades","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"woo7TkxlBw"},{"type":"text","value":" 输出文件一致）：","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"KfwL1mKZfQ"},{"type":"break","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"TlPb7B7KCf"},{"type":"inlineCode","value":"pair, profit_ratio, profit_abs, open_date, open_rate, fee_open, close_date, close_rate, fee_close, amount, trade_duration, is_open, exit_reason, stake_amount, min_rate, max_rate, stop_loss_ratio, stop_loss_abs","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"uRbvBHoPIB"}],"key":"DPD9VsvxIR"},{"type":"listItem","spread":true,"position":{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},"children":[{"type":"inlineCode","value":"trade_count","position":{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},"key":"yvw2X5isQB"},{"type":"text","value":"：交易数量（等同于 ","position":{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},"key":"Prwcv9LTRq"},{"type":"inlineCode","value":"len(results)","position":{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},"key":"zxqdaBj9zX"},{"type":"text","value":"）","position":{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},"key":"WNMpMwVLDQ"}],"key":"ObOXImnCEV"},{"type":"listItem","spread":true,"position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"children":[{"type":"inlineCode","value":"min_date","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"key":"wNSN5e16Ng"},{"type":"text","value":"：使用的时间范围起始日期","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"key":"p6vMlYswyi"}],"key":"xsqv7U34bX"},{"type":"listItem","spread":true,"position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"children":[{"type":"inlineCode","value":"max_date","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"Fa7ULT4BMH"},{"type":"text","value":"：使用的时间范围结束日期","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"cjqlsGyeTp"}],"key":"jXhlkmz1zl"},{"type":"listItem","spread":true,"position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"children":[{"type":"inlineCode","value":"config","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"Jswpudc4zD"},{"type":"text","value":"：使用的配置对象（注意：如果某些策略相关参数属于 hyperopt 空间，这里未必会更新全部参数）。","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"vNhSsnNxFe"}],"key":"d8lF4oyYGq"},{"type":"listItem","spread":true,"position":{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},"children":[{"type":"inlineCode","value":"processed","position":{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},"key":"bruPBQNZk7"},{"type":"text","value":"：以交易对为键的 DataFrame 字典，包含回测用到的数据。","position":{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},"key":"AvSHj7i5Bm"}],"key":"kCUj0UUqbk"},{"type":"listItem","spread":true,"position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"children":[{"type":"inlineCode","value":"backtest_stats","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"YNNXa7M1f6"},{"type":"text","value":"：回测统计信息，格式与回测文件“strategy”子结构一致。可用字段见 ","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"yIYedtHw3S"},{"type":"inlineCode","value":"optimize_reports.py","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"GhTKu3D6eg"},{"type":"text","value":" 中的 ","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"fNtFLzZhTj"},{"type":"inlineCode","value":"generate_strategy_stats()","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"b4bUNCdB70"},{"type":"text","value":"。","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"aXCaxsT61M"}],"key":"V0SXvOQF0I"},{"type":"listItem","spread":true,"position":{"start":{"line":79,"column":1},"end":{"line":80,"column":1}},"children":[{"type":"inlineCode","value":"starting_balance","position":{"start":{"line":79,"column":1},"end":{"line":79,"column":1}},"key":"x7zqqZ0Pwk"},{"type":"text","value":"：回测使用的初始资金。","position":{"start":{"line":79,"column":1},"end":{"line":79,"column":1}},"key":"taSDxKLmFp"}],"key":"TCXdjZB7Gp"}],"key":"l4zTEILYGk"},{"type":"paragraph","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"children":[{"type":"text","value":"该函数需返回一个浮点数（","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"byD3cfE2gq"},{"type":"inlineCode","value":"float","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"H3D91b4jcy"},{"type":"text","value":"）。数值越小，结果越好。参数和权重分配可自行调整。","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"uThtCYwfQZ"}],"key":"jfNo9GRdBw"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"wRJ5zwje9N"}],"key":"j8dBLAj1kb"},{"type":"paragraph","position":{"start":{"line":84,"column":1},"end":{"line":84,"column":1}},"children":[{"type":"text","value":"该函数每个 epoch 调用一次——请尽量优化代码，避免拖慢 hyperopt。","position":{"start":{"line":84,"column":1},"end":{"line":84,"column":1}},"key":"Td4wz9p1C0"}],"key":"LTVKxY648H"}],"key":"jjy8pr7UuV"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"inlineCode","value":"*args","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"SYWeSepGPB"},{"type":"text","value":" 和 ","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"FktJpq9wBY"},{"type":"inlineCode","value":"**kwargs","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"WXZWhDRywU"}],"key":"Ze55TE6edN"},{"type":"paragraph","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"children":[{"type":"text","value":"请保留接口中的 ","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"key":"vBgsjHdQax"},{"type":"inlineCode","value":"*args","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"key":"mMUaPmBaJc"},{"type":"text","value":" 和 ","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"key":"zdN2u9YkWf"},{"type":"inlineCode","value":"**kwargs","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"key":"jKvPWJUQ46"},{"type":"text","value":"，以便未来扩展。","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"key":"Uv1ZGhWfuG"}],"key":"apow5jjXoP"}],"key":"qUE0eMtUSS"},{"type":"heading","depth":3,"position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"children":[{"type":"text","value":"覆盖预定义空间","position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"key":"kaV6uoQgDt"}],"label":"overriding-pre-defined-spaces","identifier":"overriding-pre-defined-spaces","html_id":"overriding-pre-defined-spaces","key":"Q9xyR1bQLc"},{"type":"paragraph","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"children":[{"type":"text","value":"要覆盖预定义空间（如 ","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"ow0lZ11smj"},{"type":"inlineCode","value":"roi_space","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"UCgWFKZ0jF"},{"type":"text","value":"、","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"DFNVOii1zL"},{"type":"inlineCode","value":"generate_roi_table","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"FnFflk3rRM"},{"type":"text","value":"、","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"d25QpjWI2M"},{"type":"inlineCode","value":"stoploss_space","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"agBhQdQZha"},{"type":"text","value":"、","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"e5qnBSIPI5"},{"type":"inlineCode","value":"trailing_space","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"PSF9xAWmJ7"},{"type":"text","value":"、","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"HgpERYwxuq"},{"type":"inlineCode","value":"max_open_trades_space","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"Ry9QvECcCf"},{"type":"text","value":"），请在策略中定义一个嵌套的 Hyperopt 类，并如下定义所需空间：","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"PL1SwZJmNm"}],"key":"IaC5FjGoYw"},{"type":"code","lang":"python","value":"from freqtrade.optimize.space import Categorical, Dimension, Integer, SKDecimal\n\nclass MyAwesomeStrategy(IStrategy):\n    class HyperOpt:\n        # 自定义止损空间\n        def stoploss_space():\n            return [SKDecimal(-0.05, -0.01, decimals=3, name='stoploss')]\n\n        # 自定义 ROI 空间\n        def roi_space() -> List[Dimension]:\n            return [\n                Integer(10, 120, name='roi_t1'),\n                Integer(10, 60, name='roi_t2'),\n                Integer(10, 40, name='roi_t3'),\n                SKDecimal(0.01, 0.04, decimals=3, name='roi_p1'),\n                SKDecimal(0.01, 0.07, decimals=3, name='roi_p2'),\n                SKDecimal(0.01, 0.20, decimals=3, name='roi_p3'),\n            ]\n\n        def generate_roi_table(params: Dict) -> dict[int, float]:\n\n            roi_table = {}\n            roi_table[0] = params['roi_p1'] + params['roi_p2'] + params['roi_p3']\n            roi_table[params['roi_t3']] = params['roi_p1'] + params['roi_p2']\n            roi_table[params['roi_t3'] + params['roi_t2']] = params['roi_p1']\n            roi_table[params['roi_t3'] + params['roi_t2'] + params['roi_t1']] = 0\n\n            return roi_table\n\n        def trailing_space() -> List[Dimension]:\n            # 这里所有参数都是必需的，只能修改类型或范围。\n            return [\n                # 固定为 true，如果优化 trailing_stop，则假定始终使用追踪止损。\n                Categorical([True], name='trailing_stop'),\n\n                SKDecimal(0.01, 0.35, decimals=3, name='trailing_stop_positive'),\n                # 'trailing_stop_positive_offset' 应大于 'trailing_stop_positive'，\n                # 所以这里用中间参数表示两者的差值。'trailing_stop_positive_offset' 的值在\n                # generate_trailing_params() 方法中构造。\n                # 这类似于用于构造 ROI 表的 hyperspace 维度。\n                SKDecimal(0.001, 0.1, decimals=3, name='trailing_stop_positive_offset_p1'),\n\n                Categorical([True, False], name='trailing_only_offset_is_reached'),\n        ]\n\n        # 自定义最大持仓数空间\n        def max_open_trades_space(self) -> List[Dimension]:\n            return [\n                Integer(-1, 10, name='max_open_trades'),\n            ]","position":{"start":{"line":97,"column":1},"end":{"line":148,"column":1}},"key":"kcVuh3KY2K"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"FZYcG904Jp"}],"key":"f9U2JYFCSM"},{"type":"paragraph","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"children":[{"type":"text","value":"所有覆盖都是可选的，可根据需要混合使用。","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"key":"ptCdh0CgPA"}],"key":"rRIDOSZZYq"}],"key":"agipWnn25x"},{"type":"heading","depth":4,"position":{"start":{"line":154,"column":1},"end":{"line":154,"column":1}},"children":[{"type":"text","value":"动态参数","position":{"start":{"line":154,"column":1},"end":{"line":154,"column":1}},"key":"TPaeKoODxT"}],"identifier":"id","label":"动态参数","html_id":"id-1","implicit":true,"key":"Hh0gu94xRW"},{"type":"paragraph","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"children":[{"type":"text","value":"参数也可以动态定义，但在 ","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"key":"IPkU4BydB7"},{"type":"crossReference","url":"/strategy-callbacks","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"children":[{"type":"inlineCode","value":"bot_start()","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"key":"zuseLWo2A8"},{"type":"text","value":" 回调","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"key":"iSss9DBUxM"}],"urlSource":"strategy-callbacks.md#bot-start","dataUrl":"/strategy-callbacks.json","identifier":"bot-start","label":"bot-start","remote":true,"protocol":"file","kind":"heading","template":"{name}","resolved":true,"html_id":"bot-start","key":"bI4SgNPVIE"},{"type":"text","value":" 被调用后，实例必须能访问到这些参数。","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"key":"ZOONpNhOxC"}],"key":"LKpGZVUQwY"},{"type":"code","lang":"python","value":"\nclass MyAwesomeStrategy(IStrategy):\n\n    def bot_start(self, **kwargs) -> None:\n        self.buy_adx = IntParameter(20, 30, default=30, optimize=True)\n\n    # ...","position":{"start":{"line":158,"column":1},"end":{"line":166,"column":1}},"key":"HsEvi1mS6v"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"gw8owggwTp"}],"key":"TUt4QNeGD5"},{"type":"paragraph","position":{"start":{"line":169,"column":1},"end":{"line":169,"column":1}},"children":[{"type":"text","value":"以这种方式创建的参数不会出现在 ","position":{"start":{"line":169,"column":1},"end":{"line":169,"column":1}},"key":"NZHRhRjC2n"},{"type":"inlineCode","value":"list-strategies","position":{"start":{"line":169,"column":1},"end":{"line":169,"column":1}},"key":"MxZtg87Vya"},{"type":"text","value":" 的参数计数中。","position":{"start":{"line":169,"column":1},"end":{"line":169,"column":1}},"key":"PZKoudy6sb"}],"key":"Cl0qiStci6"}],"key":"ouUvkU8siz"},{"type":"heading","depth":4,"position":{"start":{"line":172,"column":1},"end":{"line":172,"column":1}},"children":[{"type":"text","value":"覆盖 Base estimator","position":{"start":{"line":172,"column":1},"end":{"line":172,"column":1}},"key":"akqixLV3J0"}],"identifier":"id-base-estimator","label":"覆盖 Base estimator","html_id":"id-base-estimator","implicit":true,"key":"QfG72TxokM"},{"type":"paragraph","position":{"start":{"line":174,"column":1},"end":{"line":174,"column":1}},"children":[{"type":"text","value":"你可以通过在 Hyperopt 子类中实现 ","position":{"start":{"line":174,"column":1},"end":{"line":174,"column":1}},"key":"fNgvGOcNuO"},{"type":"inlineCode","value":"generate_estimator()","position":{"start":{"line":174,"column":1},"end":{"line":174,"column":1}},"key":"YtmptOYQ0J"},{"type":"text","value":"，为 Hyperopt 定义自己的 optuna 采样器。","position":{"start":{"line":174,"column":1},"end":{"line":174,"column":1}},"key":"Kcf9vRld7i"}],"key":"uo0R1WdQGf"},{"type":"code","lang":"python","value":"class MyAwesomeStrategy(IStrategy):\n    class HyperOpt:\n        def generate_estimator(dimensions: List['Dimension'], **kwargs):\n            return \"NSGAIIISampler\"\n","position":{"start":{"line":176,"column":1},"end":{"line":182,"column":1}},"key":"ntkVbFZYWr"},{"type":"paragraph","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"children":[{"type":"text","value":"可用值包括 “NSGAIISampler”、“TPESampler”、“GPSampler”、“CmaEsSampler”、“NSGAIIISampler”、“QMCSampler”（详情见 ","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"key":"CjCuvzBkUF"},{"type":"link","url":"https://optuna.readthedocs.io/en/stable/reference/samplers/index.html","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"children":[{"type":"text","value":"optuna-samplers 文档","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"key":"uDhLpjIFWt"}],"urlSource":"https://optuna.readthedocs.io/en/stable/reference/samplers/index.html","key":"uZ6IIzEj60"},{"type":"text","value":"），也可以是继承自 ","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"key":"tfM6Zrbq9b"},{"type":"inlineCode","value":"optuna.samplers.BaseSampler","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"key":"gkOeLDzMxq"},{"type":"text","value":" 的类实例。","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"key":"Znhj3P6VmB"}],"key":"fG4pe4rYmv"},{"type":"paragraph","position":{"start":{"line":186,"column":1},"end":{"line":186,"column":1}},"children":[{"type":"text","value":"有时需要自行研究以发现更多采样器（如 optunahub 提供的）。","position":{"start":{"line":186,"column":1},"end":{"line":186,"column":1}},"key":"PDMo00js7a"}],"key":"maIt2E351M"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"cOLaJu7RY3"}],"key":"M18ccCI2hJ"},{"type":"paragraph","position":{"start":{"line":189,"column":1},"end":{"line":190,"column":1}},"children":[{"type":"text","value":"虽然可以自定义 estimator，但需要你自己研究参数并分析/理解应使用哪些参数。\n如果不确定，建议直接使用默认值（","position":{"start":{"line":189,"column":1},"end":{"line":189,"column":1}},"key":"SqwzYBSPau"},{"type":"inlineCode","value":"\"NSGAIIISampler\"","position":{"start":{"line":189,"column":1},"end":{"line":189,"column":1}},"key":"Wqh2We18p8"},{"type":"text","value":" 被证明最为通用）。","position":{"start":{"line":189,"column":1},"end":{"line":189,"column":1}},"key":"Kzb57cdzGU"}],"key":"P6qKx5uJee"}],"key":"mPx47tOvkW"},{"type":"admonition","kind":"hint","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"使用 Optunahub 的 ","position":{"start":{"line":193,"column":1},"end":{"line":193,"column":1}},"key":"YDH2pw150b"},{"type":"inlineCode","value":"AutoSampler","position":{"start":{"line":193,"column":1},"end":{"line":193,"column":1}},"key":"TfYjtUlPy7"}],"key":"cTGy6QlFFi"},{"type":"paragraph","position":{"start":{"line":195,"column":1},"end":{"line":195,"column":1}},"children":[{"type":"link","url":"https://hub.optuna.org/samplers/auto_sampler/","position":{"start":{"line":195,"column":1},"end":{"line":195,"column":1}},"children":[{"type":"text","value":"AutoSampler 文档","position":{"start":{"line":195,"column":1},"end":{"line":195,"column":1}},"key":"CySOJqGx5A"}],"urlSource":"https://hub.optuna.org/samplers/auto_sampler/","key":"NvlzTIpYJ9"}],"key":"nVFGPYQwLn"},{"type":"paragraph","position":{"start":{"line":197,"column":1},"end":{"line":197,"column":1}},"children":[{"type":"text","value":"安装必要依赖","position":{"start":{"line":197,"column":1},"end":{"line":197,"column":1}},"key":"Ayqi3KTfIy"}],"key":"E9SrfeweS8"},{"type":"code","lang":"bash","value":"pip install optunahub cmaes torch scipy","position":{"start":{"line":198,"column":1},"end":{"line":200,"column":1}},"key":"xflMiRlQC3"},{"type":"paragraph","position":{"start":{"line":201,"column":1},"end":{"line":201,"column":1}},"children":[{"type":"text","value":"在策略中实现 ","position":{"start":{"line":201,"column":1},"end":{"line":201,"column":1}},"key":"fkXvZsqy9d"},{"type":"inlineCode","value":"generate_estimator()","position":{"start":{"line":201,"column":1},"end":{"line":201,"column":1}},"key":"R4KYcO9bRc"}],"key":"k7HdLu2pk4"},{"type":"code","lang":"python","value":"# ...\nfrom freqtrade.strategy.interface import IStrategy\nfrom typing import List\nimport optunahub\n# ... \n\nclass my_strategy(IStrategy):\n    class HyperOpt:\n        def generate_estimator(dimensions: List[\"Dimension\"], **kwargs):\n            if \"random_state\" in kwargs.keys():\n                return optunahub.load_module(\"samplers/auto_sampler\").AutoSampler(seed=kwargs[\"random_state\"])\n            else:\n                return optunahub.load_module(\"samplers/auto_sampler\").AutoSampler()\n","position":{"start":{"line":203,"column":1},"end":{"line":218,"column":1}},"key":"rm46sAoe46"},{"type":"paragraph","position":{"start":{"line":220,"column":1},"end":{"line":220,"column":1}},"children":[{"type":"text","value":"显然，optuna 支持的其他采样器也可用同样方式集成。","position":{"start":{"line":220,"column":1},"end":{"line":220,"column":1}},"key":"rnXN0CMlyL"}],"key":"Vv9NyGZNGD"}],"key":"u9NRRtK4Rr"},{"type":"heading","depth":3,"position":{"start":{"line":223,"column":1},"end":{"line":223,"column":1}},"children":[{"type":"text","value":"空间类型选项","position":{"start":{"line":223,"column":1},"end":{"line":223,"column":1}},"key":"vRyEzN8tiY"}],"identifier":"id","label":"空间类型选项","html_id":"id-2","implicit":true,"key":"VKbS8dVUzt"},{"type":"paragraph","position":{"start":{"line":225,"column":1},"end":{"line":225,"column":1}},"children":[{"type":"text","value":"对于附加空间，scikit-optimize（结合 Freqtrade）提供以下空间类型：","position":{"start":{"line":225,"column":1},"end":{"line":225,"column":1}},"key":"r8OxoaQ6tJ"}],"key":"ESZbcqvRIl"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":227,"column":1},"end":{"line":231,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"children":[{"type":"inlineCode","value":"Categorical","position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"key":"dLI554FZuJ"},{"type":"text","value":" - 从类别列表中选择（如 ","position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"key":"N2NKc5R5oc"},{"type":"inlineCode","value":"Categorical(['a', 'b', 'c'], name=\"cat\")","position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"key":"PFO3FxC1M8"},{"type":"text","value":"）","position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"key":"LdRfrIh4RL"}],"key":"itLFAx3b3W"},{"type":"listItem","spread":true,"position":{"start":{"line":228,"column":1},"end":{"line":228,"column":1}},"children":[{"type":"inlineCode","value":"Integer","position":{"start":{"line":228,"column":1},"end":{"line":228,"column":1}},"key":"V6vxI64KQK"},{"type":"text","value":" - 从整数范围中选择（如 ","position":{"start":{"line":228,"column":1},"end":{"line":228,"column":1}},"key":"yi1mQOcAZc"},{"type":"inlineCode","value":"Integer(1, 10, name='rsi')","position":{"start":{"line":228,"column":1},"end":{"line":228,"column":1}},"key":"V04awIth7l"},{"type":"text","value":"）","position":{"start":{"line":228,"column":1},"end":{"line":228,"column":1}},"key":"rCkjGHNN2a"}],"key":"vnAu4IM1SZ"},{"type":"listItem","spread":true,"position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"children":[{"type":"inlineCode","value":"SKDecimal","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"key":"wBDfcFiX9B"},{"type":"text","value":" - 从有限精度的小数范围中选择（如 ","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"key":"hSYrXjLVmu"},{"type":"inlineCode","value":"SKDecimal(0.1, 0.5, decimals=3, name='adx')","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"key":"LHd3ZYeevz"},{"type":"text","value":"）。","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"key":"i1w7Oq1d5I"},{"type":"emphasis","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"children":[{"type":"text","value":"仅 Freqtrade 提供。","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"key":"YnqXeov6az"}],"key":"XzOc35CXuJ"}],"key":"rv90nrhTvQ"},{"type":"listItem","spread":true,"position":{"start":{"line":230,"column":1},"end":{"line":231,"column":1}},"children":[{"type":"inlineCode","value":"Real","position":{"start":{"line":230,"column":1},"end":{"line":230,"column":1}},"key":"Qb4ebpv4KI"},{"type":"text","value":" - 从全精度小数范围中选择（如 ","position":{"start":{"line":230,"column":1},"end":{"line":230,"column":1}},"key":"qFOr7vYaPX"},{"type":"inlineCode","value":"Real(0.1, 0.5, name='adx')","position":{"start":{"line":230,"column":1},"end":{"line":230,"column":1}},"key":"fqF5WtlB4x"},{"type":"text","value":"）","position":{"start":{"line":230,"column":1},"end":{"line":230,"column":1}},"key":"C5ktQbAhDZ"}],"key":"lWVyCr45dB"}],"key":"griVjhwdYx"},{"type":"paragraph","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"children":[{"type":"text","value":"你可以从 ","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"JWADrA2BYU"},{"type":"inlineCode","value":"freqtrade.optimize.space","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"fECMb5nwPa"},{"type":"text","value":" 导入所有这些类型，尽管 ","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"R7Th4LBpWY"},{"type":"inlineCode","value":"Categorical","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"Rw2As9JGC6"},{"type":"text","value":"、","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"DtIICGHFXY"},{"type":"inlineCode","value":"Integer","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"OQE9G8Wvuj"},{"type":"text","value":" 和 ","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"IO2wPDWdzp"},{"type":"inlineCode","value":"Real","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"qf2JPBnc5d"},{"type":"text","value":" 只是 scikit-optimize 空间的别名。","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"ZXpDjze5MW"},{"type":"inlineCode","value":"SKDecimal","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"pJpoYfa9mw"},{"type":"text","value":" 由 freqtrade 提供，用于更快的优化。","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"PmznRefEIs"}],"key":"t7Q8Ye8CLb"},{"type":"code","lang":"python","value":"from freqtrade.optimize.space import Categorical, Dimension, Integer, SKDecimal, Real  # noqa","position":{"start":{"line":234,"column":1},"end":{"line":236,"column":1}},"key":"ML569ndwwJ"},{"type":"admonition","kind":"hint","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"SKDecimal vs. Real","position":{"start":{"line":238,"column":1},"end":{"line":238,"column":1}},"key":"pNvFQAqlPZ"}],"key":"U2CmyC7jfP"},{"type":"paragraph","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"children":[{"type":"text","value":"我们建议几乎所有场景都使用 ","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"WeGVrOB6cB"},{"type":"inlineCode","value":"SKDecimal","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"jCCvUxoZQk"},{"type":"text","value":"，而不是 ","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"J1g4Doo9Kx"},{"type":"inlineCode","value":"Real","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"JaUJSzzyQw"},{"type":"text","value":" 空间。虽然 Real 空间提供全精度（高达约 16 位小数），但这种精度很少需要，且会导致 hyperopt 时间过长。","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"vlVU68UfNM"}],"key":"WWIhQdiIue"},{"type":"paragraph","position":{"start":{"line":241,"column":1},"end":{"line":241,"column":1}},"children":[{"type":"text","value":"假设定义了一个较小的空间（","position":{"start":{"line":241,"column":1},"end":{"line":241,"column":1}},"key":"S15lI1xiWu"},{"type":"inlineCode","value":"SKDecimal(0.10, 0.15, decimals=2, name='xxx')","position":{"start":{"line":241,"column":1},"end":{"line":241,"column":1}},"key":"UOCOvyu4D8"},{"type":"text","value":"）——SKDecimal 只有 5 种可能（","position":{"start":{"line":241,"column":1},"end":{"line":241,"column":1}},"key":"OzExsv7BiR"},{"type":"inlineCode","value":"[0.10, 0.11, 0.12, 0.13, 0.14, 0.15]","position":{"start":{"line":241,"column":1},"end":{"line":241,"column":1}},"key":"J8S6CKkmHm"},{"type":"text","value":"）。","position":{"start":{"line":241,"column":1},"end":{"line":241,"column":1}},"key":"TmmT3ZB3X3"}],"key":"jqNYqceLaV"},{"type":"paragraph","position":{"start":{"line":243,"column":1},"end":{"line":243,"column":1}},"children":[{"type":"text","value":"相应的 real 空间 ","position":{"start":{"line":243,"column":1},"end":{"line":243,"column":1}},"key":"d2Jy37iAko"},{"type":"inlineCode","value":"Real(0.10, 0.15 name='xxx')","position":{"start":{"line":243,"column":1},"end":{"line":243,"column":1}},"key":"cZeLBv4lCH"},{"type":"text","value":" 则有几乎无限多的可能（","position":{"start":{"line":243,"column":1},"end":{"line":243,"column":1}},"key":"TShNqEZFFc"},{"type":"inlineCode","value":"[0.10, 0.010000000001, 0.010000000002, ... 0.014999999999, 0.01500000000]","position":{"start":{"line":243,"column":1},"end":{"line":243,"column":1}},"key":"RI1SkwE0p5"},{"type":"text","value":"）。","position":{"start":{"line":243,"column":1},"end":{"line":243,"column":1}},"key":"HQc1GKssZC"}],"key":"xBR9tLyrsu"}],"key":"hMElZgt8MN"}],"key":"wY7XAkSJNZ"}],"key":"M6FWy8j8fM"},"references":{"cite":{"order":[],"data":{}}}}