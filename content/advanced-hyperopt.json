{"version":2,"kind":"Article","sha256":"45a50edc4c2ac8e52f5904ef3ee966d6aff822647bf135a69116b9de0f4f0901","slug":"advanced-hyperopt","location":"/advanced-hyperopt.md","dependencies":[],"frontmatter":{"title":"高级超参数优化","description":"本文档介绍了 FreqTrade 的高级超参数优化功能,包括自定义损失函数等高级特性。","short_title":"高级超参数优化","subtitle":"深入了解超参数优化功能","subject":"FreqTrade 高级超参数优化指南","authors":[{"id":"Freqtrade","name":"Freqtrade"}],"github":"https://github.com/freqtrade-cn/docs_zh-CN","keywords":["Freqtrade","中文文档","交易机器人","量化交易","加密货币","数字货币","区块链","人工智能","机器学习"],"numbering":{"title":{"offset":1}},"edit_url":"https://github.com/freqtrade-cn/docs_zh-CN/blob/main/advanced-hyperopt.md","exports":[{"format":"md","filename":"advanced-hyperopt.md","url":"/advanced-hyperopt-38e4886c21e6881ebd27b9adab7149b6.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"高级超参数优化（Hyperopt）","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"GAW1LYRvvg"}],"identifier":"id-hyperopt","label":"高级超参数优化（Hyperopt）","html_id":"id-hyperopt","implicit":true,"key":"zHoHWzO965"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"本页介绍一些高级 Hyperopt 主题，可能比创建普通超参数优化类需要更高的编码技能和 Python 知识。","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"pjEDezV59C"}],"key":"SXGoyGxgCi"},{"type":"heading","depth":3,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"创建和使用自定义损失函数","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"XPvAp3OSo2"}],"identifier":"id","label":"创建和使用自定义损失函数","html_id":"id","implicit":true,"key":"eVTV05oXju"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"要使用自定义损失函数类，请确保你的自定义 hyperopt 损失类中定义了 ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"QDslDdbZJG"},{"type":"inlineCode","value":"hyperopt_loss_function","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"dxR8qVh8PL"},{"type":"text","value":" 函数。\n对于下方的示例，你需要在 hyperopt 命令中添加参数 ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"xu3QMAIOu9"},{"type":"inlineCode","value":"--hyperopt-loss SuperDuperHyperOptLoss","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"vdFrwr9zLT"},{"type":"text","value":"，以便使用该函数。","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"kjqqT1dYNg"}],"key":"IWd7EXCFd3"},{"type":"paragraph","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"下面是一个示例，与默认 Hyperopt 损失实现完全相同。完整示例可见于 ","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"BgSHZWTWGo"},{"type":"link","url":"https://github.com/freqtrade/freqtrade/blob/develop/freqtrade/templates/sample_hyperopt_loss.py","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"userdata/hyperopts","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"DFDBO5VJNG"}],"urlSource":"https://github.com/freqtrade/freqtrade/blob/develop/freqtrade/templates/sample_hyperopt_loss.py","data":{"kind":"file","org":"freqtrade","repo":"freqtrade","reference":"develop","file":"freqtrade/templates/sample_hyperopt_loss.py","raw":"https://raw.githubusercontent.com/freqtrade/freqtrade/develop/freqtrade/templates/sample_hyperopt_loss.py"},"internal":false,"protocol":"github","key":"VGe8VRxVj2"},{"type":"text","value":"。","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"D7pjODVRUT"}],"key":"BYZ7IjyzEB"},{"type":"code","lang":"python","value":"from datetime import datetime\nfrom typing import Any, Dict\n\nfrom pandas import DataFrame\n\nfrom freqtrade.constants import Config\nfrom freqtrade.optimize.hyperopt import IHyperOptLoss\n\nTARGET_TRADES = 600\nEXPECTED_MAX_PROFIT = 3.0\nMAX_ACCEPTED_TRADE_DURATION = 300\n\nclass SuperDuperHyperOptLoss(IHyperOptLoss):\n    \"\"\"\n    定义 hyperopt 的默认损失函数\n    \"\"\"\n\n    @staticmethod\n    def hyperopt_loss_function(\n        *,\n        results: DataFrame,\n        trade_count: int,\n        min_date: datetime,\n        max_date: datetime,\n        config: Config,\n        processed: dict[str, DataFrame],\n        backtest_stats: dict[str, Any],\n        starting_balance: float,\n        **kwargs,\n    ) -> float:\n        \"\"\"\n        目标函数，结果越小越好\n        这是传统算法（freqtrade 一直使用的）。权重分配如下：\n        * 0.4 给交易时长\n        * 0.25：避免交易亏损\n        * 1.0 给总利润，相对于上面定义的期望值（`EXPECTED_MAX_PROFIT`）\n        \"\"\"\n        total_profit = results['profit_ratio'].sum()\n        trade_duration = results['trade_duration'].mean()\n\n        trade_loss = 1 - 0.25 * exp(-(trade_count - TARGET_TRADES) ** 2 / 10 ** 5.8)\n        profit_loss = max(0, 1 - total_profit / EXPECTED_MAX_PROFIT)\n        duration_loss = 0.4 * min(trade_duration / MAX_ACCEPTED_TRADE_DURATION, 1)\n        result = trade_loss + profit_loss + duration_loss\n        return result","position":{"start":{"line":20,"column":1},"end":{"line":66,"column":1}},"key":"tHsbQlbdaQ"},{"type":"paragraph","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"children":[{"type":"text","value":"目前，参数说明如下：","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"GXeNI0HPpC"}],"key":"uj8qCxrUI3"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":70,"column":1},"end":{"line":80,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":70,"column":1},"end":{"line":72,"column":1}},"children":[{"type":"inlineCode","value":"results","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"gurlMNSPIm"},{"type":"text","value":"：包含结果交易的 DataFrame。\n结果中可用的列如下（与回测时 ","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"AQ4mOC0erQ"},{"type":"inlineCode","value":"--export trades","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"pJZRFUwol4"},{"type":"text","value":" 输出文件一致）：","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"SH0YmnTA0t"},{"type":"break","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"EIbZSfmqDW"},{"type":"inlineCode","value":"pair, profit_ratio, profit_abs, open_date, open_rate, fee_open, close_date, close_rate, fee_close, amount, trade_duration, is_open, exit_reason, stake_amount, min_rate, max_rate, stop_loss_ratio, stop_loss_abs","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"JbpsXlZCsT"}],"key":"yXbee1hTxI"},{"type":"listItem","spread":true,"position":{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},"children":[{"type":"inlineCode","value":"trade_count","position":{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},"key":"w4SfNn9tXB"},{"type":"text","value":"：交易数量（等同于 ","position":{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},"key":"fAVyBOilUv"},{"type":"inlineCode","value":"len(results)","position":{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},"key":"XXXg7cRKfN"},{"type":"text","value":"）","position":{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},"key":"mSv6JnhwEo"}],"key":"lT4oU0QEKk"},{"type":"listItem","spread":true,"position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"children":[{"type":"inlineCode","value":"min_date","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"key":"DHRu6yU4Rv"},{"type":"text","value":"：使用的时间范围起始日期","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"key":"Oo4kORMbUe"}],"key":"IgTz4Y1C2R"},{"type":"listItem","spread":true,"position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"children":[{"type":"inlineCode","value":"max_date","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"hT6yWuNSH6"},{"type":"text","value":"：使用的时间范围结束日期","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"XSkGBfjaf6"}],"key":"OUUpStEFna"},{"type":"listItem","spread":true,"position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"children":[{"type":"inlineCode","value":"config","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"gBcoaX8gi8"},{"type":"text","value":"：使用的配置对象（注意：如果某些策略相关参数属于 hyperopt 空间，这里未必会更新全部参数）。","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"Axvz3tOITz"}],"key":"TEX9LXODKP"},{"type":"listItem","spread":true,"position":{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},"children":[{"type":"inlineCode","value":"processed","position":{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},"key":"HQMbc08Hdu"},{"type":"text","value":"：以交易对为键的 DataFrame 字典，包含回测用到的数据。","position":{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},"key":"huJ8vbB8g8"}],"key":"VQhMvbrcuu"},{"type":"listItem","spread":true,"position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"children":[{"type":"inlineCode","value":"backtest_stats","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"MTy0Mj7OEG"},{"type":"text","value":"：回测统计信息，格式与回测文件“strategy”子结构一致。可用字段见 ","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"nyGbLVMIyr"},{"type":"inlineCode","value":"optimize_reports.py","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"S5IomEvwgT"},{"type":"text","value":" 中的 ","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"aeP7Ov7a7D"},{"type":"inlineCode","value":"generate_strategy_stats()","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"cx1DxGRrhR"},{"type":"text","value":"。","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"Pwfl8yZZHy"}],"key":"XD1Is54BDM"},{"type":"listItem","spread":true,"position":{"start":{"line":79,"column":1},"end":{"line":80,"column":1}},"children":[{"type":"inlineCode","value":"starting_balance","position":{"start":{"line":79,"column":1},"end":{"line":79,"column":1}},"key":"raqxrgQmxb"},{"type":"text","value":"：回测使用的初始资金。","position":{"start":{"line":79,"column":1},"end":{"line":79,"column":1}},"key":"E7weRUqlZL"}],"key":"C9euN0rVpS"}],"key":"zxvQK9lTOf"},{"type":"paragraph","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"children":[{"type":"text","value":"该函数需返回一个浮点数（","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"jkUKQeaz1M"},{"type":"inlineCode","value":"float","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"ohm1We9eUm"},{"type":"text","value":"）。数值越小，结果越好。参数和权重分配可自行调整。","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"zbbh0PHhOb"}],"key":"a3bqREGt59"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"sslobOwO6n"}],"key":"F7WyvfCEbc"},{"type":"paragraph","position":{"start":{"line":84,"column":1},"end":{"line":84,"column":1}},"children":[{"type":"text","value":"该函数每个 epoch 调用一次——请尽量优化代码，避免拖慢 hyperopt。","position":{"start":{"line":84,"column":1},"end":{"line":84,"column":1}},"key":"UffmAiwqrU"}],"key":"er8urMXvqn"}],"key":"j2CJQoGMNt"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"inlineCode","value":"*args","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"XHNg0v8BFh"},{"type":"text","value":" 和 ","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"y3hOgtvVey"},{"type":"inlineCode","value":"**kwargs","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"dEeIksYDYF"}],"key":"S7SleqJhI2"},{"type":"paragraph","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"children":[{"type":"text","value":"请保留接口中的 ","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"key":"NvMRjFYFDs"},{"type":"inlineCode","value":"*args","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"key":"Q1oXbhRUsa"},{"type":"text","value":" 和 ","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"key":"EokgqQHlLf"},{"type":"inlineCode","value":"**kwargs","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"key":"XixiABidoy"},{"type":"text","value":"，以便未来扩展。","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"key":"LhXSD6IR5w"}],"key":"MZv9bYyAqY"}],"key":"R5v3aSVMlP"},{"type":"heading","depth":3,"position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"children":[{"type":"text","value":"覆盖预定义空间","position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"key":"aG4ayWPeFK"}],"label":"overriding-pre-defined-spaces","identifier":"overriding-pre-defined-spaces","html_id":"overriding-pre-defined-spaces","key":"Dp2XR0uywC"},{"type":"paragraph","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"children":[{"type":"text","value":"要覆盖预定义空间（如 ","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"rdgMw3p8Fc"},{"type":"inlineCode","value":"roi_space","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"QJy5ZDLpJX"},{"type":"text","value":"、","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"Vm6rXCJn4i"},{"type":"inlineCode","value":"generate_roi_table","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"O9cmV1tQAs"},{"type":"text","value":"、","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"ZJVungT4GQ"},{"type":"inlineCode","value":"stoploss_space","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"Mnuhe3N7PC"},{"type":"text","value":"、","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"V12zHGpdXp"},{"type":"inlineCode","value":"trailing_space","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"aEvMhHuTpd"},{"type":"text","value":"、","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"MnDpqSq3OS"},{"type":"inlineCode","value":"max_open_trades_space","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"iXHq9lIENc"},{"type":"text","value":"），请在策略中定义一个嵌套的 Hyperopt 类，并如下定义所需空间：","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"XJzZmCyZdw"}],"key":"Ck4RQwiytG"},{"type":"code","lang":"python","value":"from freqtrade.optimize.space import Categorical, Dimension, Integer, SKDecimal\n\nclass MyAwesomeStrategy(IStrategy):\n    class HyperOpt:\n        # 自定义止损空间\n        def stoploss_space():\n            return [SKDecimal(-0.05, -0.01, decimals=3, name='stoploss')]\n\n        # 自定义 ROI 空间\n        def roi_space() -> List[Dimension]:\n            return [\n                Integer(10, 120, name='roi_t1'),\n                Integer(10, 60, name='roi_t2'),\n                Integer(10, 40, name='roi_t3'),\n                SKDecimal(0.01, 0.04, decimals=3, name='roi_p1'),\n                SKDecimal(0.01, 0.07, decimals=3, name='roi_p2'),\n                SKDecimal(0.01, 0.20, decimals=3, name='roi_p3'),\n            ]\n\n        def generate_roi_table(params: Dict) -> dict[int, float]:\n\n            roi_table = {}\n            roi_table[0] = params['roi_p1'] + params['roi_p2'] + params['roi_p3']\n            roi_table[params['roi_t3']] = params['roi_p1'] + params['roi_p2']\n            roi_table[params['roi_t3'] + params['roi_t2']] = params['roi_p1']\n            roi_table[params['roi_t3'] + params['roi_t2'] + params['roi_t1']] = 0\n\n            return roi_table\n\n        def trailing_space() -> List[Dimension]:\n            # 这里所有参数都是必需的，只能修改类型或范围。\n            return [\n                # 固定为 true，如果优化 trailing_stop，则假定始终使用追踪止损。\n                Categorical([True], name='trailing_stop'),\n\n                SKDecimal(0.01, 0.35, decimals=3, name='trailing_stop_positive'),\n                # 'trailing_stop_positive_offset' 应大于 'trailing_stop_positive'，\n                # 所以这里用中间参数表示两者的差值。'trailing_stop_positive_offset' 的值在\n                # generate_trailing_params() 方法中构造。\n                # 这类似于用于构造 ROI 表的 hyperspace 维度。\n                SKDecimal(0.001, 0.1, decimals=3, name='trailing_stop_positive_offset_p1'),\n\n                Categorical([True, False], name='trailing_only_offset_is_reached'),\n        ]\n\n        # 自定义最大持仓数空间\n        def max_open_trades_space(self) -> List[Dimension]:\n            return [\n                Integer(-1, 10, name='max_open_trades'),\n            ]","position":{"start":{"line":97,"column":1},"end":{"line":148,"column":1}},"key":"WBXWjHl2NO"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"ZlzABewWkV"}],"key":"Uf6YoCXruC"},{"type":"paragraph","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"children":[{"type":"text","value":"所有覆盖都是可选的，可根据需要混合使用。","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"key":"mVGFvwLJ9D"}],"key":"sI4cqoSAqS"}],"key":"X9i3MqmOfG"},{"type":"heading","depth":4,"position":{"start":{"line":154,"column":1},"end":{"line":154,"column":1}},"children":[{"type":"text","value":"动态参数","position":{"start":{"line":154,"column":1},"end":{"line":154,"column":1}},"key":"xTXY7AWW7q"}],"identifier":"id","label":"动态参数","html_id":"id-1","implicit":true,"key":"jM4TF2sRFO"},{"type":"paragraph","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"children":[{"type":"text","value":"参数也可以动态定义，但在 ","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"key":"G074sUL7sy"},{"type":"crossReference","url":"/strategy-callbacks","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"children":[{"type":"inlineCode","value":"bot_start()","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"key":"RpvPlVU0DP"},{"type":"text","value":" 回调","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"key":"cL3BFvUkm9"}],"urlSource":"strategy-callbacks.md#bot-start","dataUrl":"/strategy-callbacks.json","identifier":"bot-start","label":"bot-start","remote":true,"protocol":"file","kind":"heading","template":"{name}","resolved":true,"html_id":"bot-start","key":"jB0BWyW37r"},{"type":"text","value":" 被调用后，实例必须能访问到这些参数。","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"key":"c0DSeA5egD"}],"key":"N5OveENd8V"},{"type":"code","lang":"python","value":"\nclass MyAwesomeStrategy(IStrategy):\n\n    def bot_start(self, **kwargs) -> None:\n        self.buy_adx = IntParameter(20, 30, default=30, optimize=True)\n\n    # ...","position":{"start":{"line":158,"column":1},"end":{"line":166,"column":1}},"key":"C9iw7wUuhu"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"uaoIDtxwS2"}],"key":"LyoKKA6LHk"},{"type":"paragraph","position":{"start":{"line":169,"column":1},"end":{"line":169,"column":1}},"children":[{"type":"text","value":"以这种方式创建的参数不会出现在 ","position":{"start":{"line":169,"column":1},"end":{"line":169,"column":1}},"key":"SVasrXfO64"},{"type":"inlineCode","value":"list-strategies","position":{"start":{"line":169,"column":1},"end":{"line":169,"column":1}},"key":"YxhF2ObcCG"},{"type":"text","value":" 的参数计数中。","position":{"start":{"line":169,"column":1},"end":{"line":169,"column":1}},"key":"msyNC0cELz"}],"key":"hQb8ZtOOno"}],"key":"PTu5Xu23hm"},{"type":"heading","depth":4,"position":{"start":{"line":172,"column":1},"end":{"line":172,"column":1}},"children":[{"type":"text","value":"覆盖 Base estimator","position":{"start":{"line":172,"column":1},"end":{"line":172,"column":1}},"key":"bH7v790pfl"}],"identifier":"id-base-estimator","label":"覆盖 Base estimator","html_id":"id-base-estimator","implicit":true,"key":"qXd1LGJZct"},{"type":"paragraph","position":{"start":{"line":174,"column":1},"end":{"line":174,"column":1}},"children":[{"type":"text","value":"你可以通过在 Hyperopt 子类中实现 ","position":{"start":{"line":174,"column":1},"end":{"line":174,"column":1}},"key":"fZA0mLEuFe"},{"type":"inlineCode","value":"generate_estimator()","position":{"start":{"line":174,"column":1},"end":{"line":174,"column":1}},"key":"uKBq5LYpiy"},{"type":"text","value":"，为 Hyperopt 定义自己的 optuna 采样器。","position":{"start":{"line":174,"column":1},"end":{"line":174,"column":1}},"key":"IesQDKtFxG"}],"key":"dwOnitDzs4"},{"type":"code","lang":"python","value":"class MyAwesomeStrategy(IStrategy):\n    class HyperOpt:\n        def generate_estimator(dimensions: List['Dimension'], **kwargs):\n            return \"NSGAIIISampler\"\n","position":{"start":{"line":176,"column":1},"end":{"line":182,"column":1}},"key":"z4gmoscCrl"},{"type":"paragraph","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"children":[{"type":"text","value":"可用值包括 “NSGAIISampler”、“TPESampler”、“GPSampler”、“CmaEsSampler”、“NSGAIIISampler”、“QMCSampler”（详情见 ","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"key":"ZPvHjyHMPI"},{"type":"link","url":"https://optuna.readthedocs.io/en/stable/reference/samplers/index.html","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"children":[{"type":"text","value":"optuna-samplers 文档","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"key":"crdd4KOiPZ"}],"urlSource":"https://optuna.readthedocs.io/en/stable/reference/samplers/index.html","key":"epRwZGriwA"},{"type":"text","value":"），也可以是继承自 ","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"key":"JNqzUtNONI"},{"type":"inlineCode","value":"optuna.samplers.BaseSampler","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"key":"VB6GhQSKU9"},{"type":"text","value":" 的类实例。","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"key":"ervaSKZ0zG"}],"key":"PpBcLrXKDQ"},{"type":"paragraph","position":{"start":{"line":186,"column":1},"end":{"line":186,"column":1}},"children":[{"type":"text","value":"有时需要自行研究以发现更多采样器（如 optunahub 提供的）。","position":{"start":{"line":186,"column":1},"end":{"line":186,"column":1}},"key":"jCAZl0vFGf"}],"key":"Tcep8YZgKO"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"tnSWzNXONT"}],"key":"x7EoONQwTG"},{"type":"paragraph","position":{"start":{"line":189,"column":1},"end":{"line":190,"column":1}},"children":[{"type":"text","value":"虽然可以自定义 estimator，但需要你自己研究参数并分析/理解应使用哪些参数。\n如果不确定，建议直接使用默认值（","position":{"start":{"line":189,"column":1},"end":{"line":189,"column":1}},"key":"nv2M2fktjl"},{"type":"inlineCode","value":"\"NSGAIIISampler\"","position":{"start":{"line":189,"column":1},"end":{"line":189,"column":1}},"key":"moMSWD67Cv"},{"type":"text","value":" 被证明最为通用）。","position":{"start":{"line":189,"column":1},"end":{"line":189,"column":1}},"key":"TxOr64CDVj"}],"key":"aYYw04W4Rx"}],"key":"ClgqjA6UN1"},{"type":"admonition","kind":"hint","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"使用 Optunahub 的 ","position":{"start":{"line":193,"column":1},"end":{"line":193,"column":1}},"key":"I8fdfrMm9q"},{"type":"inlineCode","value":"AutoSampler","position":{"start":{"line":193,"column":1},"end":{"line":193,"column":1}},"key":"AwKUaI64tL"}],"key":"HufQb1JB6e"},{"type":"paragraph","position":{"start":{"line":195,"column":1},"end":{"line":195,"column":1}},"children":[{"type":"link","url":"https://hub.optuna.org/samplers/auto_sampler/","position":{"start":{"line":195,"column":1},"end":{"line":195,"column":1}},"children":[{"type":"text","value":"AutoSampler 文档","position":{"start":{"line":195,"column":1},"end":{"line":195,"column":1}},"key":"oKgcbnxibp"}],"urlSource":"https://hub.optuna.org/samplers/auto_sampler/","key":"MZUXeQjnqN"}],"key":"F3kq3Plgyq"},{"type":"paragraph","position":{"start":{"line":197,"column":1},"end":{"line":197,"column":1}},"children":[{"type":"text","value":"安装必要依赖","position":{"start":{"line":197,"column":1},"end":{"line":197,"column":1}},"key":"AB6FPgu0xL"}],"key":"sWpT4VHNww"},{"type":"code","lang":"bash","value":"pip install optunahub cmaes torch scipy","position":{"start":{"line":198,"column":1},"end":{"line":200,"column":1}},"key":"hDbXBSnveG"},{"type":"paragraph","position":{"start":{"line":201,"column":1},"end":{"line":201,"column":1}},"children":[{"type":"text","value":"在策略中实现 ","position":{"start":{"line":201,"column":1},"end":{"line":201,"column":1}},"key":"en2bT5UWPm"},{"type":"inlineCode","value":"generate_estimator()","position":{"start":{"line":201,"column":1},"end":{"line":201,"column":1}},"key":"ahGcWFbpO7"}],"key":"TRK1vIC7DR"},{"type":"code","lang":"python","value":"# ...\nfrom freqtrade.strategy.interface import IStrategy\nfrom typing import List\nimport optunahub\n# ... \n\nclass my_strategy(IStrategy):\n    class HyperOpt:\n        def generate_estimator(dimensions: List[\"Dimension\"], **kwargs):\n            if \"random_state\" in kwargs.keys():\n                return optunahub.load_module(\"samplers/auto_sampler\").AutoSampler(seed=kwargs[\"random_state\"])\n            else:\n                return optunahub.load_module(\"samplers/auto_sampler\").AutoSampler()\n","position":{"start":{"line":203,"column":1},"end":{"line":218,"column":1}},"key":"wCHT966IJM"},{"type":"paragraph","position":{"start":{"line":220,"column":1},"end":{"line":220,"column":1}},"children":[{"type":"text","value":"显然，optuna 支持的其他采样器也可用同样方式集成。","position":{"start":{"line":220,"column":1},"end":{"line":220,"column":1}},"key":"JBppA04KBw"}],"key":"hZI2si6LIx"}],"key":"xIpNlfuq1k"},{"type":"heading","depth":3,"position":{"start":{"line":223,"column":1},"end":{"line":223,"column":1}},"children":[{"type":"text","value":"空间类型选项","position":{"start":{"line":223,"column":1},"end":{"line":223,"column":1}},"key":"ysEoEw3Kz9"}],"identifier":"id","label":"空间类型选项","html_id":"id-2","implicit":true,"key":"pfuqeNwKqK"},{"type":"paragraph","position":{"start":{"line":225,"column":1},"end":{"line":225,"column":1}},"children":[{"type":"text","value":"对于附加空间，scikit-optimize（结合 Freqtrade）提供以下空间类型：","position":{"start":{"line":225,"column":1},"end":{"line":225,"column":1}},"key":"tAXWrCe61a"}],"key":"oe5WFMyefw"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":227,"column":1},"end":{"line":231,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"children":[{"type":"inlineCode","value":"Categorical","position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"key":"ZuzIKwSCwz"},{"type":"text","value":" - 从类别列表中选择（如 ","position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"key":"GSD076hi9o"},{"type":"inlineCode","value":"Categorical(['a', 'b', 'c'], name=\"cat\")","position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"key":"w7XX5QOeMw"},{"type":"text","value":"）","position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"key":"MWpJRLDB1y"}],"key":"ZsPnpjGapJ"},{"type":"listItem","spread":true,"position":{"start":{"line":228,"column":1},"end":{"line":228,"column":1}},"children":[{"type":"inlineCode","value":"Integer","position":{"start":{"line":228,"column":1},"end":{"line":228,"column":1}},"key":"v0gErk9u8X"},{"type":"text","value":" - 从整数范围中选择（如 ","position":{"start":{"line":228,"column":1},"end":{"line":228,"column":1}},"key":"Mv6oV9slOP"},{"type":"inlineCode","value":"Integer(1, 10, name='rsi')","position":{"start":{"line":228,"column":1},"end":{"line":228,"column":1}},"key":"O6XLdOX0zL"},{"type":"text","value":"）","position":{"start":{"line":228,"column":1},"end":{"line":228,"column":1}},"key":"GfYEDdMCz9"}],"key":"mbkZKcgSUg"},{"type":"listItem","spread":true,"position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"children":[{"type":"inlineCode","value":"SKDecimal","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"key":"hNf4k7aTqu"},{"type":"text","value":" - 从有限精度的小数范围中选择（如 ","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"key":"FaicTrlaNU"},{"type":"inlineCode","value":"SKDecimal(0.1, 0.5, decimals=3, name='adx')","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"key":"JyoW98P01T"},{"type":"text","value":"）。","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"key":"b7I0wuQMg2"},{"type":"emphasis","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"children":[{"type":"text","value":"仅 Freqtrade 提供。","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"key":"f2AjgzzYVj"}],"key":"hy289IN9mM"}],"key":"CW8SNCqbbf"},{"type":"listItem","spread":true,"position":{"start":{"line":230,"column":1},"end":{"line":231,"column":1}},"children":[{"type":"inlineCode","value":"Real","position":{"start":{"line":230,"column":1},"end":{"line":230,"column":1}},"key":"bvOy3UGRmp"},{"type":"text","value":" - 从全精度小数范围中选择（如 ","position":{"start":{"line":230,"column":1},"end":{"line":230,"column":1}},"key":"LVtHg8EpLG"},{"type":"inlineCode","value":"Real(0.1, 0.5, name='adx')","position":{"start":{"line":230,"column":1},"end":{"line":230,"column":1}},"key":"XL6UtBvBsF"},{"type":"text","value":"）","position":{"start":{"line":230,"column":1},"end":{"line":230,"column":1}},"key":"LD1yPkcPtP"}],"key":"ox3xTS9sim"}],"key":"b6SoafH4dC"},{"type":"paragraph","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"children":[{"type":"text","value":"你可以从 ","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"BciGd84xem"},{"type":"inlineCode","value":"freqtrade.optimize.space","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"RRyQeKI21Z"},{"type":"text","value":" 导入所有这些类型，尽管 ","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"waiFnzKmYJ"},{"type":"inlineCode","value":"Categorical","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"XBu2PSIonq"},{"type":"text","value":"、","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"lxL3sQ1Aki"},{"type":"inlineCode","value":"Integer","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"q4RU10jbp8"},{"type":"text","value":" 和 ","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"lLHiei0H39"},{"type":"inlineCode","value":"Real","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"uLTmwyY0Ww"},{"type":"text","value":" 只是 scikit-optimize 空间的别名。","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"HzibwFPICK"},{"type":"inlineCode","value":"SKDecimal","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"ECApCUgThV"},{"type":"text","value":" 由 freqtrade 提供，用于更快的优化。","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"bPSpOJWCZt"}],"key":"NIBnwM8wUi"},{"type":"code","lang":"python","value":"from freqtrade.optimize.space import Categorical, Dimension, Integer, SKDecimal, Real  # noqa","position":{"start":{"line":234,"column":1},"end":{"line":236,"column":1}},"key":"Mks30viY5t"},{"type":"admonition","kind":"hint","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"SKDecimal vs. Real","position":{"start":{"line":238,"column":1},"end":{"line":238,"column":1}},"key":"Z3xkmKJzc2"}],"key":"wzoofzXu3O"},{"type":"paragraph","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"children":[{"type":"text","value":"我们建议几乎所有场景都使用 ","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"HoxSOmHKXS"},{"type":"inlineCode","value":"SKDecimal","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"nvZLRDOcfv"},{"type":"text","value":"，而不是 ","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"wYlO499IVl"},{"type":"inlineCode","value":"Real","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"P1oLsj2WlP"},{"type":"text","value":" 空间。虽然 Real 空间提供全精度（高达约 16 位小数），但这种精度很少需要，且会导致 hyperopt 时间过长。","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"Xhkvzid7T8"}],"key":"U8ZpK5FBQJ"},{"type":"paragraph","position":{"start":{"line":241,"column":1},"end":{"line":241,"column":1}},"children":[{"type":"text","value":"假设定义了一个较小的空间（","position":{"start":{"line":241,"column":1},"end":{"line":241,"column":1}},"key":"HgQy4cBrwZ"},{"type":"inlineCode","value":"SKDecimal(0.10, 0.15, decimals=2, name='xxx')","position":{"start":{"line":241,"column":1},"end":{"line":241,"column":1}},"key":"tGg8nKBugC"},{"type":"text","value":"）——SKDecimal 只有 5 种可能（","position":{"start":{"line":241,"column":1},"end":{"line":241,"column":1}},"key":"Rw6v8K2rhh"},{"type":"inlineCode","value":"[0.10, 0.11, 0.12, 0.13, 0.14, 0.15]","position":{"start":{"line":241,"column":1},"end":{"line":241,"column":1}},"key":"Vq7LJ4gB6Y"},{"type":"text","value":"）。","position":{"start":{"line":241,"column":1},"end":{"line":241,"column":1}},"key":"g3c5XcaX9d"}],"key":"LUv4E0LHpN"},{"type":"paragraph","position":{"start":{"line":243,"column":1},"end":{"line":243,"column":1}},"children":[{"type":"text","value":"相应的 real 空间 ","position":{"start":{"line":243,"column":1},"end":{"line":243,"column":1}},"key":"t2oaU6EXVU"},{"type":"inlineCode","value":"Real(0.10, 0.15 name='xxx')","position":{"start":{"line":243,"column":1},"end":{"line":243,"column":1}},"key":"p9ktdaVtpI"},{"type":"text","value":" 则有几乎无限多的可能（","position":{"start":{"line":243,"column":1},"end":{"line":243,"column":1}},"key":"DOHKMbILA3"},{"type":"inlineCode","value":"[0.10, 0.010000000001, 0.010000000002, ... 0.014999999999, 0.01500000000]","position":{"start":{"line":243,"column":1},"end":{"line":243,"column":1}},"key":"Z30alOlt6u"},{"type":"text","value":"）。","position":{"start":{"line":243,"column":1},"end":{"line":243,"column":1}},"key":"EbFd25PxPy"}],"key":"S6iJCS2pNw"}],"key":"j9U3Z2B7gw"}],"key":"cxop2eZYUU"}],"key":"mUfm4p4roE"},"references":{"cite":{"order":[],"data":{}}}}